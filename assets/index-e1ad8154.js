function QR(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in t)){const a=Object.getOwnPropertyDescriptor(i,r);a&&Object.defineProperty(t,r,a.get?a:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();var eD=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function k1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var X2={exports:{}},e_={},q2={exports:{}},Qt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Of=Symbol.for("react.element"),tD=Symbol.for("react.portal"),nD=Symbol.for("react.fragment"),iD=Symbol.for("react.strict_mode"),rD=Symbol.for("react.profiler"),sD=Symbol.for("react.provider"),oD=Symbol.for("react.context"),aD=Symbol.for("react.forward_ref"),lD=Symbol.for("react.suspense"),cD=Symbol.for("react.memo"),uD=Symbol.for("react.lazy"),hA=Symbol.iterator;function hD(t){return t===null||typeof t!="object"?null:(t=hA&&t[hA]||t["@@iterator"],typeof t=="function"?t:null)}var $2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Z2=Object.assign,J2={};function ph(t,e,n){this.props=t,this.context=e,this.refs=J2,this.updater=n||$2}ph.prototype.isReactComponent={};ph.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ph.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function K2(){}K2.prototype=ph.prototype;function F1(t,e,n){this.props=t,this.context=e,this.refs=J2,this.updater=n||$2}var z1=F1.prototype=new K2;z1.constructor=F1;Z2(z1,ph.prototype);z1.isPureReactComponent=!0;var dA=Array.isArray,Y2=Object.prototype.hasOwnProperty,N1={current:null},Q2={key:!0,ref:!0,__self:!0,__source:!0};function eC(t,e,n){var i,r={},a=null,h=null;if(e!=null)for(i in e.ref!==void 0&&(h=e.ref),e.key!==void 0&&(a=""+e.key),e)Y2.call(e,i)&&!Q2.hasOwnProperty(i)&&(r[i]=e[i]);var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){for(var y=Array(l),x=0;x<l;x++)y[x]=arguments[x+2];r.children=y}if(t&&t.defaultProps)for(i in l=t.defaultProps,l)r[i]===void 0&&(r[i]=l[i]);return{$$typeof:Of,type:t,key:a,ref:h,props:r,_owner:N1.current}}function dD(t,e){return{$$typeof:Of,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function U1(t){return typeof t=="object"&&t!==null&&t.$$typeof===Of}function fD(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var fA=/\/+/g;function Py(t,e){return typeof t=="object"&&t!==null&&t.key!=null?fD(""+t.key):e.toString(36)}function Hm(t,e,n,i,r){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var h=!1;if(t===null)h=!0;else switch(a){case"string":case"number":h=!0;break;case"object":switch(t.$$typeof){case Of:case tD:h=!0}}if(h)return h=t,r=r(h),t=i===""?"."+Py(h,0):i,dA(r)?(n="",t!=null&&(n=t.replace(fA,"$&/")+"/"),Hm(r,e,n,"",function(x){return x})):r!=null&&(U1(r)&&(r=dD(r,n+(!r.key||h&&h.key===r.key?"":(""+r.key).replace(fA,"$&/")+"/")+t)),e.push(r)),1;if(h=0,i=i===""?".":i+":",dA(t))for(var l=0;l<t.length;l++){a=t[l];var y=i+Py(a,l);h+=Hm(a,e,n,y,r)}else if(y=hD(t),typeof y=="function")for(t=y.call(t),l=0;!(a=t.next()).done;)a=a.value,y=i+Py(a,l++),h+=Hm(a,e,n,y,r);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return h}function em(t,e,n){if(t==null)return t;var i=[],r=0;return Hm(t,i,"","",function(a){return e.call(n,a,r++)}),i}function pD(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Lr={current:null},Wm={transition:null},mD={ReactCurrentDispatcher:Lr,ReactCurrentBatchConfig:Wm,ReactCurrentOwner:N1};Qt.Children={map:em,forEach:function(t,e,n){em(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return em(t,function(){e++}),e},toArray:function(t){return em(t,function(e){return e})||[]},only:function(t){if(!U1(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Qt.Component=ph;Qt.Fragment=nD;Qt.Profiler=rD;Qt.PureComponent=F1;Qt.StrictMode=iD;Qt.Suspense=lD;Qt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mD;Qt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=Z2({},t.props),r=t.key,a=t.ref,h=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,h=N1.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(y in e)Y2.call(e,y)&&!Q2.hasOwnProperty(y)&&(i[y]=e[y]===void 0&&l!==void 0?l[y]:e[y])}var y=arguments.length-2;if(y===1)i.children=n;else if(1<y){l=Array(y);for(var x=0;x<y;x++)l[x]=arguments[x+2];i.children=l}return{$$typeof:Of,type:t.type,key:r,ref:a,props:i,_owner:h}};Qt.createContext=function(t){return t={$$typeof:oD,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:sD,_context:t},t.Consumer=t};Qt.createElement=eC;Qt.createFactory=function(t){var e=eC.bind(null,t);return e.type=t,e};Qt.createRef=function(){return{current:null}};Qt.forwardRef=function(t){return{$$typeof:aD,render:t}};Qt.isValidElement=U1;Qt.lazy=function(t){return{$$typeof:uD,_payload:{_status:-1,_result:t},_init:pD}};Qt.memo=function(t,e){return{$$typeof:cD,type:t,compare:e===void 0?null:e}};Qt.startTransition=function(t){var e=Wm.transition;Wm.transition={};try{t()}finally{Wm.transition=e}};Qt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Qt.useCallback=function(t,e){return Lr.current.useCallback(t,e)};Qt.useContext=function(t){return Lr.current.useContext(t)};Qt.useDebugValue=function(){};Qt.useDeferredValue=function(t){return Lr.current.useDeferredValue(t)};Qt.useEffect=function(t,e){return Lr.current.useEffect(t,e)};Qt.useId=function(){return Lr.current.useId()};Qt.useImperativeHandle=function(t,e,n){return Lr.current.useImperativeHandle(t,e,n)};Qt.useInsertionEffect=function(t,e){return Lr.current.useInsertionEffect(t,e)};Qt.useLayoutEffect=function(t,e){return Lr.current.useLayoutEffect(t,e)};Qt.useMemo=function(t,e){return Lr.current.useMemo(t,e)};Qt.useReducer=function(t,e,n){return Lr.current.useReducer(t,e,n)};Qt.useRef=function(t){return Lr.current.useRef(t)};Qt.useState=function(t){return Lr.current.useState(t)};Qt.useSyncExternalStore=function(t,e,n){return Lr.current.useSyncExternalStore(t,e,n)};Qt.useTransition=function(){return Lr.current.useTransition()};Qt.version="18.2.0";q2.exports=Qt;var Pt=q2.exports;const gD=k1(Pt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _D=Pt,yD=Symbol.for("react.element"),vD=Symbol.for("react.fragment"),xD=Object.prototype.hasOwnProperty,bD=_D.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,wD={key:!0,ref:!0,__self:!0,__source:!0};function tC(t,e,n){var i,r={},a=null,h=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(h=e.ref);for(i in e)xD.call(e,i)&&!wD.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:yD,type:t,key:a,ref:h,props:r,_owner:bD.current}}e_.Fragment=vD;e_.jsx=tC;e_.jsxs=tC;X2.exports=e_;var dr=X2.exports,iv={},nC={exports:{}},bs={},iC={exports:{}},rC={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Ke,vt){var Et=Ke.length;Ke.push(vt);e:for(;0<Et;){var en=Et-1>>>1,sn=Ke[en];if(0<r(sn,vt))Ke[en]=vt,Ke[Et]=sn,Et=en;else break e}}function n(Ke){return Ke.length===0?null:Ke[0]}function i(Ke){if(Ke.length===0)return null;var vt=Ke[0],Et=Ke.pop();if(Et!==vt){Ke[0]=Et;e:for(var en=0,sn=Ke.length,ji=sn>>>1;en<ji;){var pi=2*(en+1)-1,Di=Ke[pi],mi=pi+1,mn=Ke[mi];if(0>r(Di,Et))mi<sn&&0>r(mn,Di)?(Ke[en]=mn,Ke[mi]=Et,en=mi):(Ke[en]=Di,Ke[pi]=Et,en=pi);else if(mi<sn&&0>r(mn,Et))Ke[en]=mn,Ke[mi]=Et,en=mi;else break e}}return vt}function r(Ke,vt){var Et=Ke.sortIndex-vt.sortIndex;return Et!==0?Et:Ke.id-vt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var h=Date,l=h.now();t.unstable_now=function(){return h.now()-l}}var y=[],x=[],T=1,C=null,S=3,z=!1,V=!1,Z=!1,ue=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function K(Ke){for(var vt=n(x);vt!==null;){if(vt.callback===null)i(x);else if(vt.startTime<=Ke)i(x),vt.sortIndex=vt.expirationTime,e(y,vt);else break;vt=n(x)}}function de(Ke){if(Z=!1,K(Ke),!V)if(n(y)!==null)V=!0,yt(ve);else{var vt=n(x);vt!==null&&Yn(de,vt.startTime-Ke)}}function ve(Ke,vt){V=!1,Z&&(Z=!1,q(Fe),Fe=-1),z=!0;var Et=S;try{for(K(vt),C=n(y);C!==null&&(!(C.expirationTime>vt)||Ke&&!dt());){var en=C.callback;if(typeof en=="function"){C.callback=null,S=C.priorityLevel;var sn=en(C.expirationTime<=vt);vt=t.unstable_now(),typeof sn=="function"?C.callback=sn:C===n(y)&&i(y),K(vt)}else i(y);C=n(y)}if(C!==null)var ji=!0;else{var pi=n(x);pi!==null&&Yn(de,pi.startTime-vt),ji=!1}return ji}finally{C=null,S=Et,z=!1}}var Ie=!1,De=null,Fe=-1,je=5,Ne=-1;function dt(){return!(t.unstable_now()-Ne<je)}function Nt(){if(De!==null){var Ke=t.unstable_now();Ne=Ke;var vt=!0;try{vt=De(!0,Ke)}finally{vt?Xt():(Ie=!1,De=null)}}else Ie=!1}var Xt;if(typeof j=="function")Xt=function(){j(Nt)};else if(typeof MessageChannel<"u"){var Lt=new MessageChannel,jn=Lt.port2;Lt.port1.onmessage=Nt,Xt=function(){jn.postMessage(null)}}else Xt=function(){ue(Nt,0)};function yt(Ke){De=Ke,Ie||(Ie=!0,Xt())}function Yn(Ke,vt){Fe=ue(function(){Ke(t.unstable_now())},vt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ke){Ke.callback=null},t.unstable_continueExecution=function(){V||z||(V=!0,yt(ve))},t.unstable_forceFrameRate=function(Ke){0>Ke||125<Ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):je=0<Ke?Math.floor(1e3/Ke):5},t.unstable_getCurrentPriorityLevel=function(){return S},t.unstable_getFirstCallbackNode=function(){return n(y)},t.unstable_next=function(Ke){switch(S){case 1:case 2:case 3:var vt=3;break;default:vt=S}var Et=S;S=vt;try{return Ke()}finally{S=Et}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Ke,vt){switch(Ke){case 1:case 2:case 3:case 4:case 5:break;default:Ke=3}var Et=S;S=Ke;try{return vt()}finally{S=Et}},t.unstable_scheduleCallback=function(Ke,vt,Et){var en=t.unstable_now();switch(typeof Et=="object"&&Et!==null?(Et=Et.delay,Et=typeof Et=="number"&&0<Et?en+Et:en):Et=en,Ke){case 1:var sn=-1;break;case 2:sn=250;break;case 5:sn=1073741823;break;case 4:sn=1e4;break;default:sn=5e3}return sn=Et+sn,Ke={id:T++,callback:vt,priorityLevel:Ke,startTime:Et,expirationTime:sn,sortIndex:-1},Et>en?(Ke.sortIndex=Et,e(x,Ke),n(y)===null&&Ke===n(x)&&(Z?(q(Fe),Fe=-1):Z=!0,Yn(de,Et-en))):(Ke.sortIndex=sn,e(y,Ke),V||z||(V=!0,yt(ve))),Ke},t.unstable_shouldYield=dt,t.unstable_wrapCallback=function(Ke){var vt=S;return function(){var Et=S;S=vt;try{return Ke.apply(this,arguments)}finally{S=Et}}}})(rC);iC.exports=rC;var AD=iC.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sC=Pt,vs=AD;function He(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var oC=new Set,sf={};function Pc(t,e){Ju(t,e),Ju(t+"Capture",e)}function Ju(t,e){for(sf[t]=e,t=0;t<e.length;t++)oC.add(e[t])}var Ta=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rv=Object.prototype.hasOwnProperty,ED=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pA={},mA={};function TD(t){return rv.call(mA,t)?!0:rv.call(pA,t)?!1:ED.test(t)?mA[t]=!0:(pA[t]=!0,!1)}function SD(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function CD(t,e,n,i){if(e===null||typeof e>"u"||SD(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Rr(t,e,n,i,r,a,h){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=h}var er={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){er[t]=new Rr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];er[e]=new Rr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){er[t]=new Rr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){er[t]=new Rr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){er[t]=new Rr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){er[t]=new Rr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){er[t]=new Rr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){er[t]=new Rr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){er[t]=new Rr(t,5,!1,t.toLowerCase(),null,!1,!1)});var G1=/[\-:]([a-z])/g;function V1(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(G1,V1);er[e]=new Rr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(G1,V1);er[e]=new Rr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(G1,V1);er[e]=new Rr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){er[t]=new Rr(t,1,!1,t.toLowerCase(),null,!1,!1)});er.xlinkHref=new Rr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){er[t]=new Rr(t,1,!1,t.toLowerCase(),null,!0,!0)});function j1(t,e,n,i){var r=er.hasOwnProperty(e)?er[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(CD(e,n,r,i)&&(n=null),i||r===null?TD(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var La=sC.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,tm=Symbol.for("react.element"),Eu=Symbol.for("react.portal"),Tu=Symbol.for("react.fragment"),H1=Symbol.for("react.strict_mode"),sv=Symbol.for("react.profiler"),aC=Symbol.for("react.provider"),lC=Symbol.for("react.context"),W1=Symbol.for("react.forward_ref"),ov=Symbol.for("react.suspense"),av=Symbol.for("react.suspense_list"),X1=Symbol.for("react.memo"),cl=Symbol.for("react.lazy"),cC=Symbol.for("react.offscreen"),gA=Symbol.iterator;function fd(t){return t===null||typeof t!="object"?null:(t=gA&&t[gA]||t["@@iterator"],typeof t=="function"?t:null)}var Kn=Object.assign,By;function Dd(t){if(By===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);By=e&&e[1]||""}return`
`+By+t}var Ly=!1;function Ry(t,e){if(!t||Ly)return"";Ly=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(x){var i=x}Reflect.construct(t,[],e)}else{try{e.call()}catch(x){i=x}t.call(e.prototype)}else{try{throw Error()}catch(x){i=x}t()}}catch(x){if(x&&i&&typeof x.stack=="string"){for(var r=x.stack.split(`
`),a=i.stack.split(`
`),h=r.length-1,l=a.length-1;1<=h&&0<=l&&r[h]!==a[l];)l--;for(;1<=h&&0<=l;h--,l--)if(r[h]!==a[l]){if(h!==1||l!==1)do if(h--,l--,0>l||r[h]!==a[l]){var y=`
`+r[h].replace(" at new "," at ");return t.displayName&&y.includes("<anonymous>")&&(y=y.replace("<anonymous>",t.displayName)),y}while(1<=h&&0<=l);break}}}finally{Ly=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Dd(t):""}function ID(t){switch(t.tag){case 5:return Dd(t.type);case 16:return Dd("Lazy");case 13:return Dd("Suspense");case 19:return Dd("SuspenseList");case 0:case 2:case 15:return t=Ry(t.type,!1),t;case 11:return t=Ry(t.type.render,!1),t;case 1:return t=Ry(t.type,!0),t;default:return""}}function lv(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Tu:return"Fragment";case Eu:return"Portal";case sv:return"Profiler";case H1:return"StrictMode";case ov:return"Suspense";case av:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case lC:return(t.displayName||"Context")+".Consumer";case aC:return(t._context.displayName||"Context")+".Provider";case W1:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case X1:return e=t.displayName||null,e!==null?e:lv(t.type)||"Memo";case cl:e=t._payload,t=t._init;try{return lv(t(e))}catch{}}return null}function MD(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return lv(e);case 8:return e===H1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Cl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function uC(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function PD(t){var e=uC(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(h){i=""+h,a.call(this,h)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(h){i=""+h},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function nm(t){t._valueTracker||(t._valueTracker=PD(t))}function hC(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=uC(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function fg(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function cv(t,e){var n=e.checked;return Kn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function _A(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Cl(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function dC(t,e){e=e.checked,e!=null&&j1(t,"checked",e,!1)}function uv(t,e){dC(t,e);var n=Cl(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?hv(t,e.type,n):e.hasOwnProperty("defaultValue")&&hv(t,e.type,Cl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function yA(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function hv(t,e,n){(e!=="number"||fg(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Od=Array.isArray;function Uu(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Cl(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function dv(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(He(91));return Kn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function vA(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(He(92));if(Od(n)){if(1<n.length)throw Error(He(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Cl(n)}}function fC(t,e){var n=Cl(e.value),i=Cl(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function xA(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function pC(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fv(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?pC(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var im,mC=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(im=im||document.createElement("div"),im.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=im.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function of(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Gd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},BD=["Webkit","ms","Moz","O"];Object.keys(Gd).forEach(function(t){BD.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Gd[e]=Gd[t]})});function gC(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Gd.hasOwnProperty(t)&&Gd[t]?(""+e).trim():e+"px"}function _C(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=gC(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var LD=Kn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pv(t,e){if(e){if(LD[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(He(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(He(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(He(61))}if(e.style!=null&&typeof e.style!="object")throw Error(He(62))}}function mv(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gv=null;function q1(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var _v=null,Gu=null,Vu=null;function bA(t){if(t=zf(t)){if(typeof _v!="function")throw Error(He(280));var e=t.stateNode;e&&(e=s_(e),_v(t.stateNode,t.type,e))}}function yC(t){Gu?Vu?Vu.push(t):Vu=[t]:Gu=t}function vC(){if(Gu){var t=Gu,e=Vu;if(Vu=Gu=null,bA(t),e)for(t=0;t<e.length;t++)bA(e[t])}}function xC(t,e){return t(e)}function bC(){}var Dy=!1;function wC(t,e,n){if(Dy)return t(e,n);Dy=!0;try{return xC(t,e,n)}finally{Dy=!1,(Gu!==null||Vu!==null)&&(bC(),vC())}}function af(t,e){var n=t.stateNode;if(n===null)return null;var i=s_(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(He(231,e,typeof n));return n}var yv=!1;if(Ta)try{var pd={};Object.defineProperty(pd,"passive",{get:function(){yv=!0}}),window.addEventListener("test",pd,pd),window.removeEventListener("test",pd,pd)}catch{yv=!1}function RD(t,e,n,i,r,a,h,l,y){var x=Array.prototype.slice.call(arguments,3);try{e.apply(n,x)}catch(T){this.onError(T)}}var Vd=!1,pg=null,mg=!1,vv=null,DD={onError:function(t){Vd=!0,pg=t}};function OD(t,e,n,i,r,a,h,l,y){Vd=!1,pg=null,RD.apply(DD,arguments)}function kD(t,e,n,i,r,a,h,l,y){if(OD.apply(this,arguments),Vd){if(Vd){var x=pg;Vd=!1,pg=null}else throw Error(He(198));mg||(mg=!0,vv=x)}}function Bc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function AC(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function wA(t){if(Bc(t)!==t)throw Error(He(188))}function FD(t){var e=t.alternate;if(!e){if(e=Bc(t),e===null)throw Error(He(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var a=r.alternate;if(a===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return wA(r),t;if(a===i)return wA(r),e;a=a.sibling}throw Error(He(188))}if(n.return!==i.return)n=r,i=a;else{for(var h=!1,l=r.child;l;){if(l===n){h=!0,n=r,i=a;break}if(l===i){h=!0,i=r,n=a;break}l=l.sibling}if(!h){for(l=a.child;l;){if(l===n){h=!0,n=a,i=r;break}if(l===i){h=!0,i=a,n=r;break}l=l.sibling}if(!h)throw Error(He(189))}}if(n.alternate!==i)throw Error(He(190))}if(n.tag!==3)throw Error(He(188));return n.stateNode.current===n?t:e}function EC(t){return t=FD(t),t!==null?TC(t):null}function TC(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=TC(t);if(e!==null)return e;t=t.sibling}return null}var SC=vs.unstable_scheduleCallback,AA=vs.unstable_cancelCallback,zD=vs.unstable_shouldYield,ND=vs.unstable_requestPaint,fi=vs.unstable_now,UD=vs.unstable_getCurrentPriorityLevel,$1=vs.unstable_ImmediatePriority,CC=vs.unstable_UserBlockingPriority,gg=vs.unstable_NormalPriority,GD=vs.unstable_LowPriority,IC=vs.unstable_IdlePriority,t_=null,qo=null;function VD(t){if(qo&&typeof qo.onCommitFiberRoot=="function")try{qo.onCommitFiberRoot(t_,t,void 0,(t.current.flags&128)===128)}catch{}}var fo=Math.clz32?Math.clz32:WD,jD=Math.log,HD=Math.LN2;function WD(t){return t>>>=0,t===0?32:31-(jD(t)/HD|0)|0}var rm=64,sm=4194304;function kd(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function _g(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,a=t.pingedLanes,h=n&268435455;if(h!==0){var l=h&~r;l!==0?i=kd(l):(a&=h,a!==0&&(i=kd(a)))}else h=n&~r,h!==0?i=kd(h):a!==0&&(i=kd(a));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,a=e&-e,r>=a||r===16&&(a&4194240)!==0))return e;if(i&4&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-fo(e),r=1<<n,i|=t[n],e&=~r;return i}function XD(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qD(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,a=t.pendingLanes;0<a;){var h=31-fo(a),l=1<<h,y=r[h];y===-1?(!(l&n)||l&i)&&(r[h]=XD(l,e)):y<=e&&(t.expiredLanes|=l),a&=~l}}function xv(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function MC(){var t=rm;return rm<<=1,!(rm&4194240)&&(rm=64),t}function Oy(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function kf(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-fo(e),t[e]=n}function $D(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-fo(n),a=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~a}}function Z1(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-fo(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var wn=0;function PC(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var BC,J1,LC,RC,DC,bv=!1,om=[],_l=null,yl=null,vl=null,lf=new Map,cf=new Map,hl=[],ZD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function EA(t,e){switch(t){case"focusin":case"focusout":_l=null;break;case"dragenter":case"dragleave":yl=null;break;case"mouseover":case"mouseout":vl=null;break;case"pointerover":case"pointerout":lf.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":cf.delete(e.pointerId)}}function md(t,e,n,i,r,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},e!==null&&(e=zf(e),e!==null&&J1(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function JD(t,e,n,i,r){switch(e){case"focusin":return _l=md(_l,t,e,n,i,r),!0;case"dragenter":return yl=md(yl,t,e,n,i,r),!0;case"mouseover":return vl=md(vl,t,e,n,i,r),!0;case"pointerover":var a=r.pointerId;return lf.set(a,md(lf.get(a)||null,t,e,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,cf.set(a,md(cf.get(a)||null,t,e,n,i,r)),!0}return!1}function OC(t){var e=fc(t.target);if(e!==null){var n=Bc(e);if(n!==null){if(e=n.tag,e===13){if(e=AC(n),e!==null){t.blockedOn=e,DC(t.priority,function(){LC(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Xm(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=wv(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);gv=i,n.target.dispatchEvent(i),gv=null}else return e=zf(n),e!==null&&J1(e),t.blockedOn=n,!1;e.shift()}return!0}function TA(t,e,n){Xm(t)&&n.delete(e)}function KD(){bv=!1,_l!==null&&Xm(_l)&&(_l=null),yl!==null&&Xm(yl)&&(yl=null),vl!==null&&Xm(vl)&&(vl=null),lf.forEach(TA),cf.forEach(TA)}function gd(t,e){t.blockedOn===e&&(t.blockedOn=null,bv||(bv=!0,vs.unstable_scheduleCallback(vs.unstable_NormalPriority,KD)))}function uf(t){function e(r){return gd(r,t)}if(0<om.length){gd(om[0],t);for(var n=1;n<om.length;n++){var i=om[n];i.blockedOn===t&&(i.blockedOn=null)}}for(_l!==null&&gd(_l,t),yl!==null&&gd(yl,t),vl!==null&&gd(vl,t),lf.forEach(e),cf.forEach(e),n=0;n<hl.length;n++)i=hl[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<hl.length&&(n=hl[0],n.blockedOn===null);)OC(n),n.blockedOn===null&&hl.shift()}var ju=La.ReactCurrentBatchConfig,yg=!0;function YD(t,e,n,i){var r=wn,a=ju.transition;ju.transition=null;try{wn=1,K1(t,e,n,i)}finally{wn=r,ju.transition=a}}function QD(t,e,n,i){var r=wn,a=ju.transition;ju.transition=null;try{wn=4,K1(t,e,n,i)}finally{wn=r,ju.transition=a}}function K1(t,e,n,i){if(yg){var r=wv(t,e,n,i);if(r===null)Wy(t,e,i,vg,n),EA(t,i);else if(JD(r,t,e,n,i))i.stopPropagation();else if(EA(t,i),e&4&&-1<ZD.indexOf(t)){for(;r!==null;){var a=zf(r);if(a!==null&&BC(a),a=wv(t,e,n,i),a===null&&Wy(t,e,i,vg,n),a===r)break;r=a}r!==null&&i.stopPropagation()}else Wy(t,e,i,null,n)}}var vg=null;function wv(t,e,n,i){if(vg=null,t=q1(i),t=fc(t),t!==null)if(e=Bc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=AC(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return vg=t,null}function kC(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(UD()){case $1:return 1;case CC:return 4;case gg:case GD:return 16;case IC:return 536870912;default:return 16}default:return 16}}var pl=null,Y1=null,qm=null;function FC(){if(qm)return qm;var t,e=Y1,n=e.length,i,r="value"in pl?pl.value:pl.textContent,a=r.length;for(t=0;t<n&&e[t]===r[t];t++);var h=n-t;for(i=1;i<=h&&e[n-i]===r[a-i];i++);return qm=r.slice(t,1<i?1-i:void 0)}function $m(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function am(){return!0}function SA(){return!1}function ws(t){function e(n,i,r,a,h){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=a,this.target=h,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?am:SA,this.isPropagationStopped=SA,this}return Kn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=am)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=am)},persist:function(){},isPersistent:am}),e}var mh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Q1=ws(mh),Ff=Kn({},mh,{view:0,detail:0}),e3=ws(Ff),ky,Fy,_d,n_=Kn({},Ff,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ex,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==_d&&(_d&&t.type==="mousemove"?(ky=t.screenX-_d.screenX,Fy=t.screenY-_d.screenY):Fy=ky=0,_d=t),ky)},movementY:function(t){return"movementY"in t?t.movementY:Fy}}),CA=ws(n_),t3=Kn({},n_,{dataTransfer:0}),n3=ws(t3),i3=Kn({},Ff,{relatedTarget:0}),zy=ws(i3),r3=Kn({},mh,{animationName:0,elapsedTime:0,pseudoElement:0}),s3=ws(r3),o3=Kn({},mh,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),a3=ws(o3),l3=Kn({},mh,{data:0}),IA=ws(l3),c3={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},u3={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},h3={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function d3(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=h3[t])?!!e[t]:!1}function ex(){return d3}var f3=Kn({},Ff,{key:function(t){if(t.key){var e=c3[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=$m(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?u3[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ex,charCode:function(t){return t.type==="keypress"?$m(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?$m(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),p3=ws(f3),m3=Kn({},n_,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),MA=ws(m3),g3=Kn({},Ff,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ex}),_3=ws(g3),y3=Kn({},mh,{propertyName:0,elapsedTime:0,pseudoElement:0}),v3=ws(y3),x3=Kn({},n_,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),b3=ws(x3),w3=[9,13,27,32],tx=Ta&&"CompositionEvent"in window,jd=null;Ta&&"documentMode"in document&&(jd=document.documentMode);var A3=Ta&&"TextEvent"in window&&!jd,zC=Ta&&(!tx||jd&&8<jd&&11>=jd),PA=String.fromCharCode(32),BA=!1;function NC(t,e){switch(t){case"keyup":return w3.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function UC(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Su=!1;function E3(t,e){switch(t){case"compositionend":return UC(e);case"keypress":return e.which!==32?null:(BA=!0,PA);case"textInput":return t=e.data,t===PA&&BA?null:t;default:return null}}function T3(t,e){if(Su)return t==="compositionend"||!tx&&NC(t,e)?(t=FC(),qm=Y1=pl=null,Su=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return zC&&e.locale!=="ko"?null:e.data;default:return null}}var S3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function LA(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!S3[t.type]:e==="textarea"}function GC(t,e,n,i){yC(i),e=xg(e,"onChange"),0<e.length&&(n=new Q1("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Hd=null,hf=null;function C3(t){YC(t,0)}function i_(t){var e=Mu(t);if(hC(e))return t}function I3(t,e){if(t==="change")return e}var VC=!1;if(Ta){var Ny;if(Ta){var Uy="oninput"in document;if(!Uy){var RA=document.createElement("div");RA.setAttribute("oninput","return;"),Uy=typeof RA.oninput=="function"}Ny=Uy}else Ny=!1;VC=Ny&&(!document.documentMode||9<document.documentMode)}function DA(){Hd&&(Hd.detachEvent("onpropertychange",jC),hf=Hd=null)}function jC(t){if(t.propertyName==="value"&&i_(hf)){var e=[];GC(e,hf,t,q1(t)),wC(C3,e)}}function M3(t,e,n){t==="focusin"?(DA(),Hd=e,hf=n,Hd.attachEvent("onpropertychange",jC)):t==="focusout"&&DA()}function P3(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return i_(hf)}function B3(t,e){if(t==="click")return i_(e)}function L3(t,e){if(t==="input"||t==="change")return i_(e)}function R3(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var _o=typeof Object.is=="function"?Object.is:R3;function df(t,e){if(_o(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!rv.call(e,r)||!_o(t[r],e[r]))return!1}return!0}function OA(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function kA(t,e){var n=OA(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=OA(n)}}function HC(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?HC(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function WC(){for(var t=window,e=fg();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=fg(t.document)}return e}function nx(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function D3(t){var e=WC(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&HC(n.ownerDocument.documentElement,n)){if(i!==null&&nx(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,a=Math.min(i.start,r);i=i.end===void 0?a:Math.min(i.end,r),!t.extend&&a>i&&(r=i,i=a,a=r),r=kA(n,a);var h=kA(n,i);r&&h&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==h.node||t.focusOffset!==h.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),a>i?(t.addRange(e),t.extend(h.node,h.offset)):(e.setEnd(h.node,h.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var O3=Ta&&"documentMode"in document&&11>=document.documentMode,Cu=null,Av=null,Wd=null,Ev=!1;function FA(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ev||Cu==null||Cu!==fg(i)||(i=Cu,"selectionStart"in i&&nx(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Wd&&df(Wd,i)||(Wd=i,i=xg(Av,"onSelect"),0<i.length&&(e=new Q1("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Cu)))}function lm(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Iu={animationend:lm("Animation","AnimationEnd"),animationiteration:lm("Animation","AnimationIteration"),animationstart:lm("Animation","AnimationStart"),transitionend:lm("Transition","TransitionEnd")},Gy={},XC={};Ta&&(XC=document.createElement("div").style,"AnimationEvent"in window||(delete Iu.animationend.animation,delete Iu.animationiteration.animation,delete Iu.animationstart.animation),"TransitionEvent"in window||delete Iu.transitionend.transition);function r_(t){if(Gy[t])return Gy[t];if(!Iu[t])return t;var e=Iu[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in XC)return Gy[t]=e[n];return t}var qC=r_("animationend"),$C=r_("animationiteration"),ZC=r_("animationstart"),JC=r_("transitionend"),KC=new Map,zA="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Bl(t,e){KC.set(t,e),Pc(e,[t])}for(var Vy=0;Vy<zA.length;Vy++){var jy=zA[Vy],k3=jy.toLowerCase(),F3=jy[0].toUpperCase()+jy.slice(1);Bl(k3,"on"+F3)}Bl(qC,"onAnimationEnd");Bl($C,"onAnimationIteration");Bl(ZC,"onAnimationStart");Bl("dblclick","onDoubleClick");Bl("focusin","onFocus");Bl("focusout","onBlur");Bl(JC,"onTransitionEnd");Ju("onMouseEnter",["mouseout","mouseover"]);Ju("onMouseLeave",["mouseout","mouseover"]);Ju("onPointerEnter",["pointerout","pointerover"]);Ju("onPointerLeave",["pointerout","pointerover"]);Pc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Pc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Pc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Pc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Pc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Pc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),z3=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fd));function NA(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,kD(i,e,void 0,t),t.currentTarget=null}function YC(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var a=void 0;if(e)for(var h=i.length-1;0<=h;h--){var l=i[h],y=l.instance,x=l.currentTarget;if(l=l.listener,y!==a&&r.isPropagationStopped())break e;NA(r,l,x),a=y}else for(h=0;h<i.length;h++){if(l=i[h],y=l.instance,x=l.currentTarget,l=l.listener,y!==a&&r.isPropagationStopped())break e;NA(r,l,x),a=y}}}if(mg)throw t=vv,mg=!1,vv=null,t}function Fn(t,e){var n=e[Mv];n===void 0&&(n=e[Mv]=new Set);var i=t+"__bubble";n.has(i)||(QC(e,t,2,!1),n.add(i))}function Hy(t,e,n){var i=0;e&&(i|=4),QC(n,t,i,e)}var cm="_reactListening"+Math.random().toString(36).slice(2);function ff(t){if(!t[cm]){t[cm]=!0,oC.forEach(function(n){n!=="selectionchange"&&(z3.has(n)||Hy(n,!1,t),Hy(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[cm]||(e[cm]=!0,Hy("selectionchange",!1,e))}}function QC(t,e,n,i){switch(kC(e)){case 1:var r=YD;break;case 4:r=QD;break;default:r=K1}n=r.bind(null,e,n,t),r=void 0,!yv||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Wy(t,e,n,i,r){var a=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var h=i.tag;if(h===3||h===4){var l=i.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(h===4)for(h=i.return;h!==null;){var y=h.tag;if((y===3||y===4)&&(y=h.stateNode.containerInfo,y===r||y.nodeType===8&&y.parentNode===r))return;h=h.return}for(;l!==null;){if(h=fc(l),h===null)return;if(y=h.tag,y===5||y===6){i=a=h;continue e}l=l.parentNode}}i=i.return}wC(function(){var x=a,T=q1(n),C=[];e:{var S=KC.get(t);if(S!==void 0){var z=Q1,V=t;switch(t){case"keypress":if($m(n)===0)break e;case"keydown":case"keyup":z=p3;break;case"focusin":V="focus",z=zy;break;case"focusout":V="blur",z=zy;break;case"beforeblur":case"afterblur":z=zy;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":z=CA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":z=n3;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":z=_3;break;case qC:case $C:case ZC:z=s3;break;case JC:z=v3;break;case"scroll":z=e3;break;case"wheel":z=b3;break;case"copy":case"cut":case"paste":z=a3;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":z=MA}var Z=(e&4)!==0,ue=!Z&&t==="scroll",q=Z?S!==null?S+"Capture":null:S;Z=[];for(var j=x,K;j!==null;){K=j;var de=K.stateNode;if(K.tag===5&&de!==null&&(K=de,q!==null&&(de=af(j,q),de!=null&&Z.push(pf(j,de,K)))),ue)break;j=j.return}0<Z.length&&(S=new z(S,V,null,n,T),C.push({event:S,listeners:Z}))}}if(!(e&7)){e:{if(S=t==="mouseover"||t==="pointerover",z=t==="mouseout"||t==="pointerout",S&&n!==gv&&(V=n.relatedTarget||n.fromElement)&&(fc(V)||V[Sa]))break e;if((z||S)&&(S=T.window===T?T:(S=T.ownerDocument)?S.defaultView||S.parentWindow:window,z?(V=n.relatedTarget||n.toElement,z=x,V=V?fc(V):null,V!==null&&(ue=Bc(V),V!==ue||V.tag!==5&&V.tag!==6)&&(V=null)):(z=null,V=x),z!==V)){if(Z=CA,de="onMouseLeave",q="onMouseEnter",j="mouse",(t==="pointerout"||t==="pointerover")&&(Z=MA,de="onPointerLeave",q="onPointerEnter",j="pointer"),ue=z==null?S:Mu(z),K=V==null?S:Mu(V),S=new Z(de,j+"leave",z,n,T),S.target=ue,S.relatedTarget=K,de=null,fc(T)===x&&(Z=new Z(q,j+"enter",V,n,T),Z.target=K,Z.relatedTarget=ue,de=Z),ue=de,z&&V)t:{for(Z=z,q=V,j=0,K=Z;K;K=uu(K))j++;for(K=0,de=q;de;de=uu(de))K++;for(;0<j-K;)Z=uu(Z),j--;for(;0<K-j;)q=uu(q),K--;for(;j--;){if(Z===q||q!==null&&Z===q.alternate)break t;Z=uu(Z),q=uu(q)}Z=null}else Z=null;z!==null&&UA(C,S,z,Z,!1),V!==null&&ue!==null&&UA(C,ue,V,Z,!0)}}e:{if(S=x?Mu(x):window,z=S.nodeName&&S.nodeName.toLowerCase(),z==="select"||z==="input"&&S.type==="file")var ve=I3;else if(LA(S))if(VC)ve=L3;else{ve=P3;var Ie=M3}else(z=S.nodeName)&&z.toLowerCase()==="input"&&(S.type==="checkbox"||S.type==="radio")&&(ve=B3);if(ve&&(ve=ve(t,x))){GC(C,ve,n,T);break e}Ie&&Ie(t,S,x),t==="focusout"&&(Ie=S._wrapperState)&&Ie.controlled&&S.type==="number"&&hv(S,"number",S.value)}switch(Ie=x?Mu(x):window,t){case"focusin":(LA(Ie)||Ie.contentEditable==="true")&&(Cu=Ie,Av=x,Wd=null);break;case"focusout":Wd=Av=Cu=null;break;case"mousedown":Ev=!0;break;case"contextmenu":case"mouseup":case"dragend":Ev=!1,FA(C,n,T);break;case"selectionchange":if(O3)break;case"keydown":case"keyup":FA(C,n,T)}var De;if(tx)e:{switch(t){case"compositionstart":var Fe="onCompositionStart";break e;case"compositionend":Fe="onCompositionEnd";break e;case"compositionupdate":Fe="onCompositionUpdate";break e}Fe=void 0}else Su?NC(t,n)&&(Fe="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Fe="onCompositionStart");Fe&&(zC&&n.locale!=="ko"&&(Su||Fe!=="onCompositionStart"?Fe==="onCompositionEnd"&&Su&&(De=FC()):(pl=T,Y1="value"in pl?pl.value:pl.textContent,Su=!0)),Ie=xg(x,Fe),0<Ie.length&&(Fe=new IA(Fe,t,null,n,T),C.push({event:Fe,listeners:Ie}),De?Fe.data=De:(De=UC(n),De!==null&&(Fe.data=De)))),(De=A3?E3(t,n):T3(t,n))&&(x=xg(x,"onBeforeInput"),0<x.length&&(T=new IA("onBeforeInput","beforeinput",null,n,T),C.push({event:T,listeners:x}),T.data=De))}YC(C,e)})}function pf(t,e,n){return{instance:t,listener:e,currentTarget:n}}function xg(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,a=r.stateNode;r.tag===5&&a!==null&&(r=a,a=af(t,n),a!=null&&i.unshift(pf(t,a,r)),a=af(t,e),a!=null&&i.push(pf(t,a,r))),t=t.return}return i}function uu(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function UA(t,e,n,i,r){for(var a=e._reactName,h=[];n!==null&&n!==i;){var l=n,y=l.alternate,x=l.stateNode;if(y!==null&&y===i)break;l.tag===5&&x!==null&&(l=x,r?(y=af(n,a),y!=null&&h.unshift(pf(n,y,l))):r||(y=af(n,a),y!=null&&h.push(pf(n,y,l)))),n=n.return}h.length!==0&&t.push({event:e,listeners:h})}var N3=/\r\n?/g,U3=/\u0000|\uFFFD/g;function GA(t){return(typeof t=="string"?t:""+t).replace(N3,`
`).replace(U3,"")}function um(t,e,n){if(e=GA(e),GA(t)!==e&&n)throw Error(He(425))}function bg(){}var Tv=null,Sv=null;function Cv(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Iv=typeof setTimeout=="function"?setTimeout:void 0,G3=typeof clearTimeout=="function"?clearTimeout:void 0,VA=typeof Promise=="function"?Promise:void 0,V3=typeof queueMicrotask=="function"?queueMicrotask:typeof VA<"u"?function(t){return VA.resolve(null).then(t).catch(j3)}:Iv;function j3(t){setTimeout(function(){throw t})}function Xy(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),uf(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);uf(e)}function xl(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function jA(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var gh=Math.random().toString(36).slice(2),Go="__reactFiber$"+gh,mf="__reactProps$"+gh,Sa="__reactContainer$"+gh,Mv="__reactEvents$"+gh,H3="__reactListeners$"+gh,W3="__reactHandles$"+gh;function fc(t){var e=t[Go];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Sa]||n[Go]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=jA(t);t!==null;){if(n=t[Go])return n;t=jA(t)}return e}t=n,n=t.parentNode}return null}function zf(t){return t=t[Go]||t[Sa],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Mu(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(He(33))}function s_(t){return t[mf]||null}var Pv=[],Pu=-1;function Ll(t){return{current:t}}function zn(t){0>Pu||(t.current=Pv[Pu],Pv[Pu]=null,Pu--)}function On(t,e){Pu++,Pv[Pu]=t.current,t.current=e}var Il={},gr=Ll(Il),Xr=Ll(!1),wc=Il;function Ku(t,e){var n=t.type.contextTypes;if(!n)return Il;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},a;for(a in n)r[a]=e[a];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function qr(t){return t=t.childContextTypes,t!=null}function wg(){zn(Xr),zn(gr)}function HA(t,e,n){if(gr.current!==Il)throw Error(He(168));On(gr,e),On(Xr,n)}function eI(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(He(108,MD(t)||"Unknown",r));return Kn({},n,i)}function Ag(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Il,wc=gr.current,On(gr,t),On(Xr,Xr.current),!0}function WA(t,e,n){var i=t.stateNode;if(!i)throw Error(He(169));n?(t=eI(t,e,wc),i.__reactInternalMemoizedMergedChildContext=t,zn(Xr),zn(gr),On(gr,t)):zn(Xr),On(Xr,n)}var ma=null,o_=!1,qy=!1;function tI(t){ma===null?ma=[t]:ma.push(t)}function X3(t){o_=!0,tI(t)}function Rl(){if(!qy&&ma!==null){qy=!0;var t=0,e=wn;try{var n=ma;for(wn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}ma=null,o_=!1}catch(r){throw ma!==null&&(ma=ma.slice(t+1)),SC($1,Rl),r}finally{wn=e,qy=!1}}return null}var Bu=[],Lu=0,Eg=null,Tg=0,zs=[],Ns=0,Ac=null,_a=1,ya="";function uc(t,e){Bu[Lu++]=Tg,Bu[Lu++]=Eg,Eg=t,Tg=e}function nI(t,e,n){zs[Ns++]=_a,zs[Ns++]=ya,zs[Ns++]=Ac,Ac=t;var i=_a;t=ya;var r=32-fo(i)-1;i&=~(1<<r),n+=1;var a=32-fo(e)+r;if(30<a){var h=r-r%5;a=(i&(1<<h)-1).toString(32),i>>=h,r-=h,_a=1<<32-fo(e)+r|n<<r|i,ya=a+t}else _a=1<<a|n<<r|i,ya=t}function ix(t){t.return!==null&&(uc(t,1),nI(t,1,0))}function rx(t){for(;t===Eg;)Eg=Bu[--Lu],Bu[Lu]=null,Tg=Bu[--Lu],Bu[Lu]=null;for(;t===Ac;)Ac=zs[--Ns],zs[Ns]=null,ya=zs[--Ns],zs[Ns]=null,_a=zs[--Ns],zs[Ns]=null}var _s=null,ms=null,Vn=!1,ao=null;function iI(t,e){var n=Us(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function XA(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,_s=t,ms=xl(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,_s=t,ms=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ac!==null?{id:_a,overflow:ya}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Us(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,_s=t,ms=null,!0):!1;default:return!1}}function Bv(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Lv(t){if(Vn){var e=ms;if(e){var n=e;if(!XA(t,e)){if(Bv(t))throw Error(He(418));e=xl(n.nextSibling);var i=_s;e&&XA(t,e)?iI(i,n):(t.flags=t.flags&-4097|2,Vn=!1,_s=t)}}else{if(Bv(t))throw Error(He(418));t.flags=t.flags&-4097|2,Vn=!1,_s=t}}}function qA(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;_s=t}function hm(t){if(t!==_s)return!1;if(!Vn)return qA(t),Vn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Cv(t.type,t.memoizedProps)),e&&(e=ms)){if(Bv(t))throw rI(),Error(He(418));for(;e;)iI(t,e),e=xl(e.nextSibling)}if(qA(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(He(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ms=xl(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ms=null}}else ms=_s?xl(t.stateNode.nextSibling):null;return!0}function rI(){for(var t=ms;t;)t=xl(t.nextSibling)}function Yu(){ms=_s=null,Vn=!1}function sx(t){ao===null?ao=[t]:ao.push(t)}var q3=La.ReactCurrentBatchConfig;function so(t,e){if(t&&t.defaultProps){e=Kn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Sg=Ll(null),Cg=null,Ru=null,ox=null;function ax(){ox=Ru=Cg=null}function lx(t){var e=Sg.current;zn(Sg),t._currentValue=e}function Rv(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Hu(t,e){Cg=t,ox=Ru=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Hr=!0),t.firstContext=null)}function Xs(t){var e=t._currentValue;if(ox!==t)if(t={context:t,memoizedValue:e,next:null},Ru===null){if(Cg===null)throw Error(He(308));Ru=t,Cg.dependencies={lanes:0,firstContext:t}}else Ru=Ru.next=t;return e}var pc=null;function cx(t){pc===null?pc=[t]:pc.push(t)}function sI(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,cx(e)):(n.next=r.next,r.next=n),e.interleaved=n,Ca(t,i)}function Ca(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ul=!1;function ux(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function oI(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function wa(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function bl(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,hn&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Ca(t,n)}return r=i.interleaved,r===null?(e.next=e,cx(i)):(e.next=r.next,r.next=e),i.interleaved=e,Ca(t,n)}function Zm(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Z1(t,n)}}function $A(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var h={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?r=a=h:a=a.next=h,n=n.next}while(n!==null);a===null?r=a=e:a=a.next=e}else r=a=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ig(t,e,n,i){var r=t.updateQueue;ul=!1;var a=r.firstBaseUpdate,h=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var y=l,x=y.next;y.next=null,h===null?a=x:h.next=x,h=y;var T=t.alternate;T!==null&&(T=T.updateQueue,l=T.lastBaseUpdate,l!==h&&(l===null?T.firstBaseUpdate=x:l.next=x,T.lastBaseUpdate=y))}if(a!==null){var C=r.baseState;h=0,T=x=y=null,l=a;do{var S=l.lane,z=l.eventTime;if((i&S)===S){T!==null&&(T=T.next={eventTime:z,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var V=t,Z=l;switch(S=e,z=n,Z.tag){case 1:if(V=Z.payload,typeof V=="function"){C=V.call(z,C,S);break e}C=V;break e;case 3:V.flags=V.flags&-65537|128;case 0:if(V=Z.payload,S=typeof V=="function"?V.call(z,C,S):V,S==null)break e;C=Kn({},C,S);break e;case 2:ul=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,S=r.effects,S===null?r.effects=[l]:S.push(l))}else z={eventTime:z,lane:S,tag:l.tag,payload:l.payload,callback:l.callback,next:null},T===null?(x=T=z,y=C):T=T.next=z,h|=S;if(l=l.next,l===null){if(l=r.shared.pending,l===null)break;S=l,l=S.next,S.next=null,r.lastBaseUpdate=S,r.shared.pending=null}}while(1);if(T===null&&(y=C),r.baseState=y,r.firstBaseUpdate=x,r.lastBaseUpdate=T,e=r.shared.interleaved,e!==null){r=e;do h|=r.lane,r=r.next;while(r!==e)}else a===null&&(r.shared.lanes=0);Tc|=h,t.lanes=h,t.memoizedState=C}}function ZA(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(He(191,r));r.call(i)}}}var aI=new sC.Component().refs;function Dv(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Kn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var a_={isMounted:function(t){return(t=t._reactInternals)?Bc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Br(),r=Al(t),a=wa(i,r);a.payload=e,n!=null&&(a.callback=n),e=bl(t,a,r),e!==null&&(po(e,t,r,i),Zm(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Br(),r=Al(t),a=wa(i,r);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=bl(t,a,r),e!==null&&(po(e,t,r,i),Zm(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Br(),i=Al(t),r=wa(n,i);r.tag=2,e!=null&&(r.callback=e),e=bl(t,r,i),e!==null&&(po(e,t,i,n),Zm(e,t,i))}};function JA(t,e,n,i,r,a,h){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,a,h):e.prototype&&e.prototype.isPureReactComponent?!df(n,i)||!df(r,a):!0}function lI(t,e,n){var i=!1,r=Il,a=e.contextType;return typeof a=="object"&&a!==null?a=Xs(a):(r=qr(e)?wc:gr.current,i=e.contextTypes,a=(i=i!=null)?Ku(t,r):Il),e=new e(n,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=a_,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=a),e}function KA(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&a_.enqueueReplaceState(e,e.state,null)}function Ov(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=aI,ux(t);var a=e.contextType;typeof a=="object"&&a!==null?r.context=Xs(a):(a=qr(e)?wc:gr.current,r.context=Ku(t,a)),r.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(Dv(t,e,a,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&a_.enqueueReplaceState(r,r.state,null),Ig(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function yd(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(He(309));var i=n.stateNode}if(!i)throw Error(He(147,t));var r=i,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(h){var l=r.refs;l===aI&&(l=r.refs={}),h===null?delete l[a]:l[a]=h},e._stringRef=a,e)}if(typeof t!="string")throw Error(He(284));if(!n._owner)throw Error(He(290,t))}return t}function dm(t,e){throw t=Object.prototype.toString.call(e),Error(He(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function YA(t){var e=t._init;return e(t._payload)}function cI(t){function e(q,j){if(t){var K=q.deletions;K===null?(q.deletions=[j],q.flags|=16):K.push(j)}}function n(q,j){if(!t)return null;for(;j!==null;)e(q,j),j=j.sibling;return null}function i(q,j){for(q=new Map;j!==null;)j.key!==null?q.set(j.key,j):q.set(j.index,j),j=j.sibling;return q}function r(q,j){return q=El(q,j),q.index=0,q.sibling=null,q}function a(q,j,K){return q.index=K,t?(K=q.alternate,K!==null?(K=K.index,K<j?(q.flags|=2,j):K):(q.flags|=2,j)):(q.flags|=1048576,j)}function h(q){return t&&q.alternate===null&&(q.flags|=2),q}function l(q,j,K,de){return j===null||j.tag!==6?(j=e0(K,q.mode,de),j.return=q,j):(j=r(j,K),j.return=q,j)}function y(q,j,K,de){var ve=K.type;return ve===Tu?T(q,j,K.props.children,de,K.key):j!==null&&(j.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===cl&&YA(ve)===j.type)?(de=r(j,K.props),de.ref=yd(q,j,K),de.return=q,de):(de=tg(K.type,K.key,K.props,null,q.mode,de),de.ref=yd(q,j,K),de.return=q,de)}function x(q,j,K,de){return j===null||j.tag!==4||j.stateNode.containerInfo!==K.containerInfo||j.stateNode.implementation!==K.implementation?(j=t0(K,q.mode,de),j.return=q,j):(j=r(j,K.children||[]),j.return=q,j)}function T(q,j,K,de,ve){return j===null||j.tag!==7?(j=vc(K,q.mode,de,ve),j.return=q,j):(j=r(j,K),j.return=q,j)}function C(q,j,K){if(typeof j=="string"&&j!==""||typeof j=="number")return j=e0(""+j,q.mode,K),j.return=q,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case tm:return K=tg(j.type,j.key,j.props,null,q.mode,K),K.ref=yd(q,null,j),K.return=q,K;case Eu:return j=t0(j,q.mode,K),j.return=q,j;case cl:var de=j._init;return C(q,de(j._payload),K)}if(Od(j)||fd(j))return j=vc(j,q.mode,K,null),j.return=q,j;dm(q,j)}return null}function S(q,j,K,de){var ve=j!==null?j.key:null;if(typeof K=="string"&&K!==""||typeof K=="number")return ve!==null?null:l(q,j,""+K,de);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case tm:return K.key===ve?y(q,j,K,de):null;case Eu:return K.key===ve?x(q,j,K,de):null;case cl:return ve=K._init,S(q,j,ve(K._payload),de)}if(Od(K)||fd(K))return ve!==null?null:T(q,j,K,de,null);dm(q,K)}return null}function z(q,j,K,de,ve){if(typeof de=="string"&&de!==""||typeof de=="number")return q=q.get(K)||null,l(j,q,""+de,ve);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case tm:return q=q.get(de.key===null?K:de.key)||null,y(j,q,de,ve);case Eu:return q=q.get(de.key===null?K:de.key)||null,x(j,q,de,ve);case cl:var Ie=de._init;return z(q,j,K,Ie(de._payload),ve)}if(Od(de)||fd(de))return q=q.get(K)||null,T(j,q,de,ve,null);dm(j,de)}return null}function V(q,j,K,de){for(var ve=null,Ie=null,De=j,Fe=j=0,je=null;De!==null&&Fe<K.length;Fe++){De.index>Fe?(je=De,De=null):je=De.sibling;var Ne=S(q,De,K[Fe],de);if(Ne===null){De===null&&(De=je);break}t&&De&&Ne.alternate===null&&e(q,De),j=a(Ne,j,Fe),Ie===null?ve=Ne:Ie.sibling=Ne,Ie=Ne,De=je}if(Fe===K.length)return n(q,De),Vn&&uc(q,Fe),ve;if(De===null){for(;Fe<K.length;Fe++)De=C(q,K[Fe],de),De!==null&&(j=a(De,j,Fe),Ie===null?ve=De:Ie.sibling=De,Ie=De);return Vn&&uc(q,Fe),ve}for(De=i(q,De);Fe<K.length;Fe++)je=z(De,q,Fe,K[Fe],de),je!==null&&(t&&je.alternate!==null&&De.delete(je.key===null?Fe:je.key),j=a(je,j,Fe),Ie===null?ve=je:Ie.sibling=je,Ie=je);return t&&De.forEach(function(dt){return e(q,dt)}),Vn&&uc(q,Fe),ve}function Z(q,j,K,de){var ve=fd(K);if(typeof ve!="function")throw Error(He(150));if(K=ve.call(K),K==null)throw Error(He(151));for(var Ie=ve=null,De=j,Fe=j=0,je=null,Ne=K.next();De!==null&&!Ne.done;Fe++,Ne=K.next()){De.index>Fe?(je=De,De=null):je=De.sibling;var dt=S(q,De,Ne.value,de);if(dt===null){De===null&&(De=je);break}t&&De&&dt.alternate===null&&e(q,De),j=a(dt,j,Fe),Ie===null?ve=dt:Ie.sibling=dt,Ie=dt,De=je}if(Ne.done)return n(q,De),Vn&&uc(q,Fe),ve;if(De===null){for(;!Ne.done;Fe++,Ne=K.next())Ne=C(q,Ne.value,de),Ne!==null&&(j=a(Ne,j,Fe),Ie===null?ve=Ne:Ie.sibling=Ne,Ie=Ne);return Vn&&uc(q,Fe),ve}for(De=i(q,De);!Ne.done;Fe++,Ne=K.next())Ne=z(De,q,Fe,Ne.value,de),Ne!==null&&(t&&Ne.alternate!==null&&De.delete(Ne.key===null?Fe:Ne.key),j=a(Ne,j,Fe),Ie===null?ve=Ne:Ie.sibling=Ne,Ie=Ne);return t&&De.forEach(function(Nt){return e(q,Nt)}),Vn&&uc(q,Fe),ve}function ue(q,j,K,de){if(typeof K=="object"&&K!==null&&K.type===Tu&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case tm:e:{for(var ve=K.key,Ie=j;Ie!==null;){if(Ie.key===ve){if(ve=K.type,ve===Tu){if(Ie.tag===7){n(q,Ie.sibling),j=r(Ie,K.props.children),j.return=q,q=j;break e}}else if(Ie.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===cl&&YA(ve)===Ie.type){n(q,Ie.sibling),j=r(Ie,K.props),j.ref=yd(q,Ie,K),j.return=q,q=j;break e}n(q,Ie);break}else e(q,Ie);Ie=Ie.sibling}K.type===Tu?(j=vc(K.props.children,q.mode,de,K.key),j.return=q,q=j):(de=tg(K.type,K.key,K.props,null,q.mode,de),de.ref=yd(q,j,K),de.return=q,q=de)}return h(q);case Eu:e:{for(Ie=K.key;j!==null;){if(j.key===Ie)if(j.tag===4&&j.stateNode.containerInfo===K.containerInfo&&j.stateNode.implementation===K.implementation){n(q,j.sibling),j=r(j,K.children||[]),j.return=q,q=j;break e}else{n(q,j);break}else e(q,j);j=j.sibling}j=t0(K,q.mode,de),j.return=q,q=j}return h(q);case cl:return Ie=K._init,ue(q,j,Ie(K._payload),de)}if(Od(K))return V(q,j,K,de);if(fd(K))return Z(q,j,K,de);dm(q,K)}return typeof K=="string"&&K!==""||typeof K=="number"?(K=""+K,j!==null&&j.tag===6?(n(q,j.sibling),j=r(j,K),j.return=q,q=j):(n(q,j),j=e0(K,q.mode,de),j.return=q,q=j),h(q)):n(q,j)}return ue}var Qu=cI(!0),uI=cI(!1),Nf={},$o=Ll(Nf),gf=Ll(Nf),_f=Ll(Nf);function mc(t){if(t===Nf)throw Error(He(174));return t}function hx(t,e){switch(On(_f,e),On(gf,t),On($o,Nf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:fv(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=fv(e,t)}zn($o),On($o,e)}function eh(){zn($o),zn(gf),zn(_f)}function hI(t){mc(_f.current);var e=mc($o.current),n=fv(e,t.type);e!==n&&(On(gf,t),On($o,n))}function dx(t){gf.current===t&&(zn($o),zn(gf))}var $n=Ll(0);function Mg(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var $y=[];function fx(){for(var t=0;t<$y.length;t++)$y[t]._workInProgressVersionPrimary=null;$y.length=0}var Jm=La.ReactCurrentDispatcher,Zy=La.ReactCurrentBatchConfig,Ec=0,Jn=null,Pi=null,Gi=null,Pg=!1,Xd=!1,yf=0,$3=0;function cr(){throw Error(He(321))}function px(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!_o(t[n],e[n]))return!1;return!0}function mx(t,e,n,i,r,a){if(Ec=a,Jn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Jm.current=t===null||t.memoizedState===null?Y3:Q3,t=n(i,r),Xd){a=0;do{if(Xd=!1,yf=0,25<=a)throw Error(He(301));a+=1,Gi=Pi=null,e.updateQueue=null,Jm.current=eO,t=n(i,r)}while(Xd)}if(Jm.current=Bg,e=Pi!==null&&Pi.next!==null,Ec=0,Gi=Pi=Jn=null,Pg=!1,e)throw Error(He(300));return t}function gx(){var t=yf!==0;return yf=0,t}function Uo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Gi===null?Jn.memoizedState=Gi=t:Gi=Gi.next=t,Gi}function qs(){if(Pi===null){var t=Jn.alternate;t=t!==null?t.memoizedState:null}else t=Pi.next;var e=Gi===null?Jn.memoizedState:Gi.next;if(e!==null)Gi=e,Pi=t;else{if(t===null)throw Error(He(310));Pi=t,t={memoizedState:Pi.memoizedState,baseState:Pi.baseState,baseQueue:Pi.baseQueue,queue:Pi.queue,next:null},Gi===null?Jn.memoizedState=Gi=t:Gi=Gi.next=t}return Gi}function vf(t,e){return typeof e=="function"?e(t):e}function Jy(t){var e=qs(),n=e.queue;if(n===null)throw Error(He(311));n.lastRenderedReducer=t;var i=Pi,r=i.baseQueue,a=n.pending;if(a!==null){if(r!==null){var h=r.next;r.next=a.next,a.next=h}i.baseQueue=r=a,n.pending=null}if(r!==null){a=r.next,i=i.baseState;var l=h=null,y=null,x=a;do{var T=x.lane;if((Ec&T)===T)y!==null&&(y=y.next={lane:0,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null}),i=x.hasEagerState?x.eagerState:t(i,x.action);else{var C={lane:T,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null};y===null?(l=y=C,h=i):y=y.next=C,Jn.lanes|=T,Tc|=T}x=x.next}while(x!==null&&x!==a);y===null?h=i:y.next=l,_o(i,e.memoizedState)||(Hr=!0),e.memoizedState=i,e.baseState=h,e.baseQueue=y,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do a=r.lane,Jn.lanes|=a,Tc|=a,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ky(t){var e=qs(),n=e.queue;if(n===null)throw Error(He(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,a=e.memoizedState;if(r!==null){n.pending=null;var h=r=r.next;do a=t(a,h.action),h=h.next;while(h!==r);_o(a,e.memoizedState)||(Hr=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),n.lastRenderedState=a}return[a,i]}function dI(){}function fI(t,e){var n=Jn,i=qs(),r=e(),a=!_o(i.memoizedState,r);if(a&&(i.memoizedState=r,Hr=!0),i=i.queue,_x(gI.bind(null,n,i,t),[t]),i.getSnapshot!==e||a||Gi!==null&&Gi.memoizedState.tag&1){if(n.flags|=2048,xf(9,mI.bind(null,n,i,r,e),void 0,null),Vi===null)throw Error(He(349));Ec&30||pI(n,e,r)}return r}function pI(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Jn.updateQueue,e===null?(e={lastEffect:null,stores:null},Jn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function mI(t,e,n,i){e.value=n,e.getSnapshot=i,_I(e)&&yI(t)}function gI(t,e,n){return n(function(){_I(e)&&yI(t)})}function _I(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!_o(t,n)}catch{return!0}}function yI(t){var e=Ca(t,1);e!==null&&po(e,t,1,-1)}function QA(t){var e=Uo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vf,lastRenderedState:t},e.queue=t,t=t.dispatch=K3.bind(null,Jn,t),[e.memoizedState,t]}function xf(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Jn.updateQueue,e===null?(e={lastEffect:null,stores:null},Jn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function vI(){return qs().memoizedState}function Km(t,e,n,i){var r=Uo();Jn.flags|=t,r.memoizedState=xf(1|e,n,void 0,i===void 0?null:i)}function l_(t,e,n,i){var r=qs();i=i===void 0?null:i;var a=void 0;if(Pi!==null){var h=Pi.memoizedState;if(a=h.destroy,i!==null&&px(i,h.deps)){r.memoizedState=xf(e,n,a,i);return}}Jn.flags|=t,r.memoizedState=xf(1|e,n,a,i)}function eE(t,e){return Km(8390656,8,t,e)}function _x(t,e){return l_(2048,8,t,e)}function xI(t,e){return l_(4,2,t,e)}function bI(t,e){return l_(4,4,t,e)}function wI(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function AI(t,e,n){return n=n!=null?n.concat([t]):null,l_(4,4,wI.bind(null,e,t),n)}function yx(){}function EI(t,e){var n=qs();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&px(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function TI(t,e){var n=qs();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&px(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function SI(t,e,n){return Ec&21?(_o(n,e)||(n=MC(),Jn.lanes|=n,Tc|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Hr=!0),t.memoizedState=n)}function Z3(t,e){var n=wn;wn=n!==0&&4>n?n:4,t(!0);var i=Zy.transition;Zy.transition={};try{t(!1),e()}finally{wn=n,Zy.transition=i}}function CI(){return qs().memoizedState}function J3(t,e,n){var i=Al(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},II(t))MI(e,n);else if(n=sI(t,e,n,i),n!==null){var r=Br();po(n,t,i,r),PI(n,e,i)}}function K3(t,e,n){var i=Al(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(II(t))MI(e,r);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var h=e.lastRenderedState,l=a(h,n);if(r.hasEagerState=!0,r.eagerState=l,_o(l,h)){var y=e.interleaved;y===null?(r.next=r,cx(e)):(r.next=y.next,y.next=r),e.interleaved=r;return}}catch{}finally{}n=sI(t,e,r,i),n!==null&&(r=Br(),po(n,t,i,r),PI(n,e,i))}}function II(t){var e=t.alternate;return t===Jn||e!==null&&e===Jn}function MI(t,e){Xd=Pg=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function PI(t,e,n){if(n&4194240){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Z1(t,n)}}var Bg={readContext:Xs,useCallback:cr,useContext:cr,useEffect:cr,useImperativeHandle:cr,useInsertionEffect:cr,useLayoutEffect:cr,useMemo:cr,useReducer:cr,useRef:cr,useState:cr,useDebugValue:cr,useDeferredValue:cr,useTransition:cr,useMutableSource:cr,useSyncExternalStore:cr,useId:cr,unstable_isNewReconciler:!1},Y3={readContext:Xs,useCallback:function(t,e){return Uo().memoizedState=[t,e===void 0?null:e],t},useContext:Xs,useEffect:eE,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Km(4194308,4,wI.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Km(4194308,4,t,e)},useInsertionEffect:function(t,e){return Km(4,2,t,e)},useMemo:function(t,e){var n=Uo();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Uo();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=J3.bind(null,Jn,t),[i.memoizedState,t]},useRef:function(t){var e=Uo();return t={current:t},e.memoizedState=t},useState:QA,useDebugValue:yx,useDeferredValue:function(t){return Uo().memoizedState=t},useTransition:function(){var t=QA(!1),e=t[0];return t=Z3.bind(null,t[1]),Uo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Jn,r=Uo();if(Vn){if(n===void 0)throw Error(He(407));n=n()}else{if(n=e(),Vi===null)throw Error(He(349));Ec&30||pI(i,e,n)}r.memoizedState=n;var a={value:n,getSnapshot:e};return r.queue=a,eE(gI.bind(null,i,a,t),[t]),i.flags|=2048,xf(9,mI.bind(null,i,a,n,e),void 0,null),n},useId:function(){var t=Uo(),e=Vi.identifierPrefix;if(Vn){var n=ya,i=_a;n=(i&~(1<<32-fo(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=yf++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=$3++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Q3={readContext:Xs,useCallback:EI,useContext:Xs,useEffect:_x,useImperativeHandle:AI,useInsertionEffect:xI,useLayoutEffect:bI,useMemo:TI,useReducer:Jy,useRef:vI,useState:function(){return Jy(vf)},useDebugValue:yx,useDeferredValue:function(t){var e=qs();return SI(e,Pi.memoizedState,t)},useTransition:function(){var t=Jy(vf)[0],e=qs().memoizedState;return[t,e]},useMutableSource:dI,useSyncExternalStore:fI,useId:CI,unstable_isNewReconciler:!1},eO={readContext:Xs,useCallback:EI,useContext:Xs,useEffect:_x,useImperativeHandle:AI,useInsertionEffect:xI,useLayoutEffect:bI,useMemo:TI,useReducer:Ky,useRef:vI,useState:function(){return Ky(vf)},useDebugValue:yx,useDeferredValue:function(t){var e=qs();return Pi===null?e.memoizedState=t:SI(e,Pi.memoizedState,t)},useTransition:function(){var t=Ky(vf)[0],e=qs().memoizedState;return[t,e]},useMutableSource:dI,useSyncExternalStore:fI,useId:CI,unstable_isNewReconciler:!1};function th(t,e){try{var n="",i=e;do n+=ID(i),i=i.return;while(i);var r=n}catch(a){r=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:r,digest:null}}function Yy(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function kv(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var tO=typeof WeakMap=="function"?WeakMap:Map;function BI(t,e,n){n=wa(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Rg||(Rg=!0,Xv=i),kv(t,e)},n}function LI(t,e,n){n=wa(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){kv(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){kv(t,e),typeof i!="function"&&(wl===null?wl=new Set([this]):wl.add(this));var h=e.stack;this.componentDidCatch(e.value,{componentStack:h!==null?h:""})}),n}function tE(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new tO;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=mO.bind(null,t,e,n),e.then(t,t))}function nE(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function iE(t,e,n,i,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=wa(-1,1),e.tag=2,bl(n,e,1))),n.lanes|=1),t)}var nO=La.ReactCurrentOwner,Hr=!1;function Ir(t,e,n,i){e.child=t===null?uI(e,null,n,i):Qu(e,t.child,n,i)}function rE(t,e,n,i,r){n=n.render;var a=e.ref;return Hu(e,r),i=mx(t,e,n,i,a,r),n=gx(),t!==null&&!Hr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Ia(t,e,r)):(Vn&&n&&ix(e),e.flags|=1,Ir(t,e,i,r),e.child)}function sE(t,e,n,i,r){if(t===null){var a=n.type;return typeof a=="function"&&!Sx(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,RI(t,e,a,i,r)):(t=tg(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&r)){var h=a.memoizedProps;if(n=n.compare,n=n!==null?n:df,n(h,i)&&t.ref===e.ref)return Ia(t,e,r)}return e.flags|=1,t=El(a,i),t.ref=e.ref,t.return=e,e.child=t}function RI(t,e,n,i,r){if(t!==null){var a=t.memoizedProps;if(df(a,i)&&t.ref===e.ref)if(Hr=!1,e.pendingProps=i=a,(t.lanes&r)!==0)t.flags&131072&&(Hr=!0);else return e.lanes=t.lanes,Ia(t,e,r)}return Fv(t,e,n,i,r)}function DI(t,e,n){var i=e.pendingProps,r=i.children,a=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},On(Ou,fs),fs|=n;else{if(!(n&1073741824))return t=a!==null?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,On(Ou,fs),fs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=a!==null?a.baseLanes:n,On(Ou,fs),fs|=i}else a!==null?(i=a.baseLanes|n,e.memoizedState=null):i=n,On(Ou,fs),fs|=i;return Ir(t,e,r,n),e.child}function OI(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Fv(t,e,n,i,r){var a=qr(n)?wc:gr.current;return a=Ku(e,a),Hu(e,r),n=mx(t,e,n,i,a,r),i=gx(),t!==null&&!Hr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Ia(t,e,r)):(Vn&&i&&ix(e),e.flags|=1,Ir(t,e,n,r),e.child)}function oE(t,e,n,i,r){if(qr(n)){var a=!0;Ag(e)}else a=!1;if(Hu(e,r),e.stateNode===null)Ym(t,e),lI(e,n,i),Ov(e,n,i,r),i=!0;else if(t===null){var h=e.stateNode,l=e.memoizedProps;h.props=l;var y=h.context,x=n.contextType;typeof x=="object"&&x!==null?x=Xs(x):(x=qr(n)?wc:gr.current,x=Ku(e,x));var T=n.getDerivedStateFromProps,C=typeof T=="function"||typeof h.getSnapshotBeforeUpdate=="function";C||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(l!==i||y!==x)&&KA(e,h,i,x),ul=!1;var S=e.memoizedState;h.state=S,Ig(e,i,h,r),y=e.memoizedState,l!==i||S!==y||Xr.current||ul?(typeof T=="function"&&(Dv(e,n,T,i),y=e.memoizedState),(l=ul||JA(e,n,l,i,S,y,x))?(C||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(e.flags|=4194308)):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=y),h.props=i,h.state=y,h.context=x,i=l):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{h=e.stateNode,oI(t,e),l=e.memoizedProps,x=e.type===e.elementType?l:so(e.type,l),h.props=x,C=e.pendingProps,S=h.context,y=n.contextType,typeof y=="object"&&y!==null?y=Xs(y):(y=qr(n)?wc:gr.current,y=Ku(e,y));var z=n.getDerivedStateFromProps;(T=typeof z=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(l!==C||S!==y)&&KA(e,h,i,y),ul=!1,S=e.memoizedState,h.state=S,Ig(e,i,h,r);var V=e.memoizedState;l!==C||S!==V||Xr.current||ul?(typeof z=="function"&&(Dv(e,n,z,i),V=e.memoizedState),(x=ul||JA(e,n,x,i,S,V,y)||!1)?(T||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(i,V,y),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(i,V,y)),typeof h.componentDidUpdate=="function"&&(e.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof h.componentDidUpdate!="function"||l===t.memoizedProps&&S===t.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&S===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=V),h.props=i,h.state=V,h.context=y,i=x):(typeof h.componentDidUpdate!="function"||l===t.memoizedProps&&S===t.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&S===t.memoizedState||(e.flags|=1024),i=!1)}return zv(t,e,n,i,a,r)}function zv(t,e,n,i,r,a){OI(t,e);var h=(e.flags&128)!==0;if(!i&&!h)return r&&WA(e,n,!1),Ia(t,e,a);i=e.stateNode,nO.current=e;var l=h&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&h?(e.child=Qu(e,t.child,null,a),e.child=Qu(e,null,l,a)):Ir(t,e,l,a),e.memoizedState=i.state,r&&WA(e,n,!0),e.child}function kI(t){var e=t.stateNode;e.pendingContext?HA(t,e.pendingContext,e.pendingContext!==e.context):e.context&&HA(t,e.context,!1),hx(t,e.containerInfo)}function aE(t,e,n,i,r){return Yu(),sx(r),e.flags|=256,Ir(t,e,n,i),e.child}var Nv={dehydrated:null,treeContext:null,retryLane:0};function Uv(t){return{baseLanes:t,cachePool:null,transitions:null}}function FI(t,e,n){var i=e.pendingProps,r=$n.current,a=!1,h=(e.flags&128)!==0,l;if((l=h)||(l=t!==null&&t.memoizedState===null?!1:(r&2)!==0),l?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),On($n,r&1),t===null)return Lv(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(h=i.children,t=i.fallback,a?(i=e.mode,a=e.child,h={mode:"hidden",children:h},!(i&1)&&a!==null?(a.childLanes=0,a.pendingProps=h):a=h_(h,i,0,null),t=vc(t,i,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=Uv(n),e.memoizedState=Nv,t):vx(e,h));if(r=t.memoizedState,r!==null&&(l=r.dehydrated,l!==null))return iO(t,e,h,i,l,r,n);if(a){a=i.fallback,h=e.mode,r=t.child,l=r.sibling;var y={mode:"hidden",children:i.children};return!(h&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=y,e.deletions=null):(i=El(r,y),i.subtreeFlags=r.subtreeFlags&14680064),l!==null?a=El(l,a):(a=vc(a,h,n,null),a.flags|=2),a.return=e,i.return=e,i.sibling=a,e.child=i,i=a,a=e.child,h=t.child.memoizedState,h=h===null?Uv(n):{baseLanes:h.baseLanes|n,cachePool:null,transitions:h.transitions},a.memoizedState=h,a.childLanes=t.childLanes&~n,e.memoizedState=Nv,i}return a=t.child,t=a.sibling,i=El(a,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function vx(t,e){return e=h_({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function fm(t,e,n,i){return i!==null&&sx(i),Qu(e,t.child,null,n),t=vx(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function iO(t,e,n,i,r,a,h){if(n)return e.flags&256?(e.flags&=-257,i=Yy(Error(He(422))),fm(t,e,h,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=i.fallback,r=e.mode,i=h_({mode:"visible",children:i.children},r,0,null),a=vc(a,r,h,null),a.flags|=2,i.return=e,a.return=e,i.sibling=a,e.child=i,e.mode&1&&Qu(e,t.child,null,h),e.child.memoizedState=Uv(h),e.memoizedState=Nv,a);if(!(e.mode&1))return fm(t,e,h,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var l=i.dgst;return i=l,a=Error(He(419)),i=Yy(a,i,void 0),fm(t,e,h,i)}if(l=(h&t.childLanes)!==0,Hr||l){if(i=Vi,i!==null){switch(h&-h){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|h)?0:r,r!==0&&r!==a.retryLane&&(a.retryLane=r,Ca(t,r),po(i,t,r,-1))}return Tx(),i=Yy(Error(He(421))),fm(t,e,h,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=gO.bind(null,t),r._reactRetry=e,null):(t=a.treeContext,ms=xl(r.nextSibling),_s=e,Vn=!0,ao=null,t!==null&&(zs[Ns++]=_a,zs[Ns++]=ya,zs[Ns++]=Ac,_a=t.id,ya=t.overflow,Ac=e),e=vx(e,i.children),e.flags|=4096,e)}function lE(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),Rv(t.return,e,n)}function Qy(t,e,n,i,r){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function zI(t,e,n){var i=e.pendingProps,r=i.revealOrder,a=i.tail;if(Ir(t,e,i.children,n),i=$n.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&lE(t,n,e);else if(t.tag===19)lE(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(On($n,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Mg(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Qy(e,!1,r,n,a);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Mg(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Qy(e,!0,n,null,a);break;case"together":Qy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ym(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ia(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Tc|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(He(153));if(e.child!==null){for(t=e.child,n=El(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=El(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function rO(t,e,n){switch(e.tag){case 3:kI(e),Yu();break;case 5:hI(e);break;case 1:qr(e.type)&&Ag(e);break;case 4:hx(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;On(Sg,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(On($n,$n.current&1),e.flags|=128,null):n&e.child.childLanes?FI(t,e,n):(On($n,$n.current&1),t=Ia(t,e,n),t!==null?t.sibling:null);On($n,$n.current&1);break;case 19:if(i=(n&e.childLanes)!==0,t.flags&128){if(i)return zI(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),On($n,$n.current),i)break;return null;case 22:case 23:return e.lanes=0,DI(t,e,n)}return Ia(t,e,n)}var NI,Gv,UI,GI;NI=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Gv=function(){};UI=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,mc($o.current);var a=null;switch(n){case"input":r=cv(t,r),i=cv(t,i),a=[];break;case"select":r=Kn({},r,{value:void 0}),i=Kn({},i,{value:void 0}),a=[];break;case"textarea":r=dv(t,r),i=dv(t,i),a=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=bg)}pv(n,i);var h;n=null;for(x in r)if(!i.hasOwnProperty(x)&&r.hasOwnProperty(x)&&r[x]!=null)if(x==="style"){var l=r[x];for(h in l)l.hasOwnProperty(h)&&(n||(n={}),n[h]="")}else x!=="dangerouslySetInnerHTML"&&x!=="children"&&x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(sf.hasOwnProperty(x)?a||(a=[]):(a=a||[]).push(x,null));for(x in i){var y=i[x];if(l=r!=null?r[x]:void 0,i.hasOwnProperty(x)&&y!==l&&(y!=null||l!=null))if(x==="style")if(l){for(h in l)!l.hasOwnProperty(h)||y&&y.hasOwnProperty(h)||(n||(n={}),n[h]="");for(h in y)y.hasOwnProperty(h)&&l[h]!==y[h]&&(n||(n={}),n[h]=y[h])}else n||(a||(a=[]),a.push(x,n)),n=y;else x==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,l=l?l.__html:void 0,y!=null&&l!==y&&(a=a||[]).push(x,y)):x==="children"?typeof y!="string"&&typeof y!="number"||(a=a||[]).push(x,""+y):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&(sf.hasOwnProperty(x)?(y!=null&&x==="onScroll"&&Fn("scroll",t),a||l===y||(a=[])):(a=a||[]).push(x,y))}n&&(a=a||[]).push("style",n);var x=a;(e.updateQueue=x)&&(e.flags|=4)}};GI=function(t,e,n,i){n!==i&&(e.flags|=4)};function vd(t,e){if(!Vn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function ur(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function sO(t,e,n){var i=e.pendingProps;switch(rx(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ur(e),null;case 1:return qr(e.type)&&wg(),ur(e),null;case 3:return i=e.stateNode,eh(),zn(Xr),zn(gr),fx(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(hm(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ao!==null&&(Zv(ao),ao=null))),Gv(t,e),ur(e),null;case 5:dx(e);var r=mc(_f.current);if(n=e.type,t!==null&&e.stateNode!=null)UI(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(He(166));return ur(e),null}if(t=mc($o.current),hm(e)){i=e.stateNode,n=e.type;var a=e.memoizedProps;switch(i[Go]=e,i[mf]=a,t=(e.mode&1)!==0,n){case"dialog":Fn("cancel",i),Fn("close",i);break;case"iframe":case"object":case"embed":Fn("load",i);break;case"video":case"audio":for(r=0;r<Fd.length;r++)Fn(Fd[r],i);break;case"source":Fn("error",i);break;case"img":case"image":case"link":Fn("error",i),Fn("load",i);break;case"details":Fn("toggle",i);break;case"input":_A(i,a),Fn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!a.multiple},Fn("invalid",i);break;case"textarea":vA(i,a),Fn("invalid",i)}pv(n,a),r=null;for(var h in a)if(a.hasOwnProperty(h)){var l=a[h];h==="children"?typeof l=="string"?i.textContent!==l&&(a.suppressHydrationWarning!==!0&&um(i.textContent,l,t),r=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(a.suppressHydrationWarning!==!0&&um(i.textContent,l,t),r=["children",""+l]):sf.hasOwnProperty(h)&&l!=null&&h==="onScroll"&&Fn("scroll",i)}switch(n){case"input":nm(i),yA(i,a,!0);break;case"textarea":nm(i),xA(i);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(i.onclick=bg)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{h=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=pC(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=h.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=h.createElement(n,{is:i.is}):(t=h.createElement(n),n==="select"&&(h=t,i.multiple?h.multiple=!0:i.size&&(h.size=i.size))):t=h.createElementNS(t,n),t[Go]=e,t[mf]=i,NI(t,e,!1,!1),e.stateNode=t;e:{switch(h=mv(n,i),n){case"dialog":Fn("cancel",t),Fn("close",t),r=i;break;case"iframe":case"object":case"embed":Fn("load",t),r=i;break;case"video":case"audio":for(r=0;r<Fd.length;r++)Fn(Fd[r],t);r=i;break;case"source":Fn("error",t),r=i;break;case"img":case"image":case"link":Fn("error",t),Fn("load",t),r=i;break;case"details":Fn("toggle",t),r=i;break;case"input":_A(t,i),r=cv(t,i),Fn("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=Kn({},i,{value:void 0}),Fn("invalid",t);break;case"textarea":vA(t,i),r=dv(t,i),Fn("invalid",t);break;default:r=i}pv(n,r),l=r;for(a in l)if(l.hasOwnProperty(a)){var y=l[a];a==="style"?_C(t,y):a==="dangerouslySetInnerHTML"?(y=y?y.__html:void 0,y!=null&&mC(t,y)):a==="children"?typeof y=="string"?(n!=="textarea"||y!=="")&&of(t,y):typeof y=="number"&&of(t,""+y):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(sf.hasOwnProperty(a)?y!=null&&a==="onScroll"&&Fn("scroll",t):y!=null&&j1(t,a,y,h))}switch(n){case"input":nm(t),yA(t,i,!1);break;case"textarea":nm(t),xA(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Cl(i.value));break;case"select":t.multiple=!!i.multiple,a=i.value,a!=null?Uu(t,!!i.multiple,a,!1):i.defaultValue!=null&&Uu(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=bg)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ur(e),null;case 6:if(t&&e.stateNode!=null)GI(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(He(166));if(n=mc(_f.current),mc($o.current),hm(e)){if(i=e.stateNode,n=e.memoizedProps,i[Go]=e,(a=i.nodeValue!==n)&&(t=_s,t!==null))switch(t.tag){case 3:um(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&um(i.nodeValue,n,(t.mode&1)!==0)}a&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Go]=e,e.stateNode=i}return ur(e),null;case 13:if(zn($n),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Vn&&ms!==null&&e.mode&1&&!(e.flags&128))rI(),Yu(),e.flags|=98560,a=!1;else if(a=hm(e),i!==null&&i.dehydrated!==null){if(t===null){if(!a)throw Error(He(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(He(317));a[Go]=e}else Yu(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ur(e),a=!1}else ao!==null&&(Zv(ao),ao=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||$n.current&1?Bi===0&&(Bi=3):Tx())),e.updateQueue!==null&&(e.flags|=4),ur(e),null);case 4:return eh(),Gv(t,e),t===null&&ff(e.stateNode.containerInfo),ur(e),null;case 10:return lx(e.type._context),ur(e),null;case 17:return qr(e.type)&&wg(),ur(e),null;case 19:if(zn($n),a=e.memoizedState,a===null)return ur(e),null;if(i=(e.flags&128)!==0,h=a.rendering,h===null)if(i)vd(a,!1);else{if(Bi!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(h=Mg(t),h!==null){for(e.flags|=128,vd(a,!1),i=h.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)a=n,t=i,a.flags&=14680066,h=a.alternate,h===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=h.childLanes,a.lanes=h.lanes,a.child=h.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=h.memoizedProps,a.memoizedState=h.memoizedState,a.updateQueue=h.updateQueue,a.type=h.type,t=h.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return On($n,$n.current&1|2),e.child}t=t.sibling}a.tail!==null&&fi()>nh&&(e.flags|=128,i=!0,vd(a,!1),e.lanes=4194304)}else{if(!i)if(t=Mg(h),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),vd(a,!0),a.tail===null&&a.tailMode==="hidden"&&!h.alternate&&!Vn)return ur(e),null}else 2*fi()-a.renderingStartTime>nh&&n!==1073741824&&(e.flags|=128,i=!0,vd(a,!1),e.lanes=4194304);a.isBackwards?(h.sibling=e.child,e.child=h):(n=a.last,n!==null?n.sibling=h:e.child=h,a.last=h)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=fi(),e.sibling=null,n=$n.current,On($n,i?n&1|2:n&1),e):(ur(e),null);case 22:case 23:return Ex(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?fs&1073741824&&(ur(e),e.subtreeFlags&6&&(e.flags|=8192)):ur(e),null;case 24:return null;case 25:return null}throw Error(He(156,e.tag))}function oO(t,e){switch(rx(e),e.tag){case 1:return qr(e.type)&&wg(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return eh(),zn(Xr),zn(gr),fx(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return dx(e),null;case 13:if(zn($n),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(He(340));Yu()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return zn($n),null;case 4:return eh(),null;case 10:return lx(e.type._context),null;case 22:case 23:return Ex(),null;case 24:return null;default:return null}}var pm=!1,mr=!1,aO=typeof WeakSet=="function"?WeakSet:Set,gt=null;function Du(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){si(t,e,i)}else n.current=null}function Vv(t,e,n){try{n()}catch(i){si(t,e,i)}}var cE=!1;function lO(t,e){if(Tv=yg,t=WC(),nx(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,a=i.focusNode;i=i.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var h=0,l=-1,y=-1,x=0,T=0,C=t,S=null;t:for(;;){for(var z;C!==n||r!==0&&C.nodeType!==3||(l=h+r),C!==a||i!==0&&C.nodeType!==3||(y=h+i),C.nodeType===3&&(h+=C.nodeValue.length),(z=C.firstChild)!==null;)S=C,C=z;for(;;){if(C===t)break t;if(S===n&&++x===r&&(l=h),S===a&&++T===i&&(y=h),(z=C.nextSibling)!==null)break;C=S,S=C.parentNode}C=z}n=l===-1||y===-1?null:{start:l,end:y}}else n=null}n=n||{start:0,end:0}}else n=null;for(Sv={focusedElem:t,selectionRange:n},yg=!1,gt=e;gt!==null;)if(e=gt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,gt=t;else for(;gt!==null;){e=gt;try{var V=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(V!==null){var Z=V.memoizedProps,ue=V.memoizedState,q=e.stateNode,j=q.getSnapshotBeforeUpdate(e.elementType===e.type?Z:so(e.type,Z),ue);q.__reactInternalSnapshotBeforeUpdate=j}break;case 3:var K=e.stateNode.containerInfo;K.nodeType===1?K.textContent="":K.nodeType===9&&K.documentElement&&K.removeChild(K.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(He(163))}}catch(de){si(e,e.return,de)}if(t=e.sibling,t!==null){t.return=e.return,gt=t;break}gt=e.return}return V=cE,cE=!1,V}function qd(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var a=r.destroy;r.destroy=void 0,a!==void 0&&Vv(e,n,a)}r=r.next}while(r!==i)}}function c_(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function jv(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function VI(t){var e=t.alternate;e!==null&&(t.alternate=null,VI(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Go],delete e[mf],delete e[Mv],delete e[H3],delete e[W3])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function jI(t){return t.tag===5||t.tag===3||t.tag===4}function uE(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||jI(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Hv(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=bg));else if(i!==4&&(t=t.child,t!==null))for(Hv(t,e,n),t=t.sibling;t!==null;)Hv(t,e,n),t=t.sibling}function Wv(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Wv(t,e,n),t=t.sibling;t!==null;)Wv(t,e,n),t=t.sibling}var Yi=null,oo=!1;function tl(t,e,n){for(n=n.child;n!==null;)HI(t,e,n),n=n.sibling}function HI(t,e,n){if(qo&&typeof qo.onCommitFiberUnmount=="function")try{qo.onCommitFiberUnmount(t_,n)}catch{}switch(n.tag){case 5:mr||Du(n,e);case 6:var i=Yi,r=oo;Yi=null,tl(t,e,n),Yi=i,oo=r,Yi!==null&&(oo?(t=Yi,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Yi.removeChild(n.stateNode));break;case 18:Yi!==null&&(oo?(t=Yi,n=n.stateNode,t.nodeType===8?Xy(t.parentNode,n):t.nodeType===1&&Xy(t,n),uf(t)):Xy(Yi,n.stateNode));break;case 4:i=Yi,r=oo,Yi=n.stateNode.containerInfo,oo=!0,tl(t,e,n),Yi=i,oo=r;break;case 0:case 11:case 14:case 15:if(!mr&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var a=r,h=a.destroy;a=a.tag,h!==void 0&&(a&2||a&4)&&Vv(n,e,h),r=r.next}while(r!==i)}tl(t,e,n);break;case 1:if(!mr&&(Du(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){si(n,e,l)}tl(t,e,n);break;case 21:tl(t,e,n);break;case 22:n.mode&1?(mr=(i=mr)||n.memoizedState!==null,tl(t,e,n),mr=i):tl(t,e,n);break;default:tl(t,e,n)}}function hE(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new aO),e.forEach(function(i){var r=_O.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function io(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var a=t,h=e,l=h;e:for(;l!==null;){switch(l.tag){case 5:Yi=l.stateNode,oo=!1;break e;case 3:Yi=l.stateNode.containerInfo,oo=!0;break e;case 4:Yi=l.stateNode.containerInfo,oo=!0;break e}l=l.return}if(Yi===null)throw Error(He(160));HI(a,h,r),Yi=null,oo=!1;var y=r.alternate;y!==null&&(y.return=null),r.return=null}catch(x){si(r,e,x)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)WI(e,t),e=e.sibling}function WI(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(io(e,t),Oo(t),i&4){try{qd(3,t,t.return),c_(3,t)}catch(Z){si(t,t.return,Z)}try{qd(5,t,t.return)}catch(Z){si(t,t.return,Z)}}break;case 1:io(e,t),Oo(t),i&512&&n!==null&&Du(n,n.return);break;case 5:if(io(e,t),Oo(t),i&512&&n!==null&&Du(n,n.return),t.flags&32){var r=t.stateNode;try{of(r,"")}catch(Z){si(t,t.return,Z)}}if(i&4&&(r=t.stateNode,r!=null)){var a=t.memoizedProps,h=n!==null?n.memoizedProps:a,l=t.type,y=t.updateQueue;if(t.updateQueue=null,y!==null)try{l==="input"&&a.type==="radio"&&a.name!=null&&dC(r,a),mv(l,h);var x=mv(l,a);for(h=0;h<y.length;h+=2){var T=y[h],C=y[h+1];T==="style"?_C(r,C):T==="dangerouslySetInnerHTML"?mC(r,C):T==="children"?of(r,C):j1(r,T,C,x)}switch(l){case"input":uv(r,a);break;case"textarea":fC(r,a);break;case"select":var S=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var z=a.value;z!=null?Uu(r,!!a.multiple,z,!1):S!==!!a.multiple&&(a.defaultValue!=null?Uu(r,!!a.multiple,a.defaultValue,!0):Uu(r,!!a.multiple,a.multiple?[]:"",!1))}r[mf]=a}catch(Z){si(t,t.return,Z)}}break;case 6:if(io(e,t),Oo(t),i&4){if(t.stateNode===null)throw Error(He(162));r=t.stateNode,a=t.memoizedProps;try{r.nodeValue=a}catch(Z){si(t,t.return,Z)}}break;case 3:if(io(e,t),Oo(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{uf(e.containerInfo)}catch(Z){si(t,t.return,Z)}break;case 4:io(e,t),Oo(t);break;case 13:io(e,t),Oo(t),r=t.child,r.flags&8192&&(a=r.memoizedState!==null,r.stateNode.isHidden=a,!a||r.alternate!==null&&r.alternate.memoizedState!==null||(wx=fi())),i&4&&hE(t);break;case 22:if(T=n!==null&&n.memoizedState!==null,t.mode&1?(mr=(x=mr)||T,io(e,t),mr=x):io(e,t),Oo(t),i&8192){if(x=t.memoizedState!==null,(t.stateNode.isHidden=x)&&!T&&t.mode&1)for(gt=t,T=t.child;T!==null;){for(C=gt=T;gt!==null;){switch(S=gt,z=S.child,S.tag){case 0:case 11:case 14:case 15:qd(4,S,S.return);break;case 1:Du(S,S.return);var V=S.stateNode;if(typeof V.componentWillUnmount=="function"){i=S,n=S.return;try{e=i,V.props=e.memoizedProps,V.state=e.memoizedState,V.componentWillUnmount()}catch(Z){si(i,n,Z)}}break;case 5:Du(S,S.return);break;case 22:if(S.memoizedState!==null){fE(C);continue}}z!==null?(z.return=S,gt=z):fE(C)}T=T.sibling}e:for(T=null,C=t;;){if(C.tag===5){if(T===null){T=C;try{r=C.stateNode,x?(a=r.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(l=C.stateNode,y=C.memoizedProps.style,h=y!=null&&y.hasOwnProperty("display")?y.display:null,l.style.display=gC("display",h))}catch(Z){si(t,t.return,Z)}}}else if(C.tag===6){if(T===null)try{C.stateNode.nodeValue=x?"":C.memoizedProps}catch(Z){si(t,t.return,Z)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===t)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===t)break e;for(;C.sibling===null;){if(C.return===null||C.return===t)break e;T===C&&(T=null),C=C.return}T===C&&(T=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:io(e,t),Oo(t),i&4&&hE(t);break;case 21:break;default:io(e,t),Oo(t)}}function Oo(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(jI(n)){var i=n;break e}n=n.return}throw Error(He(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(of(r,""),i.flags&=-33);var a=uE(t);Wv(t,a,r);break;case 3:case 4:var h=i.stateNode.containerInfo,l=uE(t);Hv(t,l,h);break;default:throw Error(He(161))}}catch(y){si(t,t.return,y)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function cO(t,e,n){gt=t,XI(t)}function XI(t,e,n){for(var i=(t.mode&1)!==0;gt!==null;){var r=gt,a=r.child;if(r.tag===22&&i){var h=r.memoizedState!==null||pm;if(!h){var l=r.alternate,y=l!==null&&l.memoizedState!==null||mr;l=pm;var x=mr;if(pm=h,(mr=y)&&!x)for(gt=r;gt!==null;)h=gt,y=h.child,h.tag===22&&h.memoizedState!==null?pE(r):y!==null?(y.return=h,gt=y):pE(r);for(;a!==null;)gt=a,XI(a),a=a.sibling;gt=r,pm=l,mr=x}dE(t)}else r.subtreeFlags&8772&&a!==null?(a.return=r,gt=a):dE(t)}}function dE(t){for(;gt!==null;){var e=gt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:mr||c_(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!mr)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:so(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&ZA(e,a,i);break;case 3:var h=e.updateQueue;if(h!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}ZA(e,h,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var y=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":y.autoFocus&&n.focus();break;case"img":y.src&&(n.src=y.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var x=e.alternate;if(x!==null){var T=x.memoizedState;if(T!==null){var C=T.dehydrated;C!==null&&uf(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(He(163))}mr||e.flags&512&&jv(e)}catch(S){si(e,e.return,S)}}if(e===t){gt=null;break}if(n=e.sibling,n!==null){n.return=e.return,gt=n;break}gt=e.return}}function fE(t){for(;gt!==null;){var e=gt;if(e===t){gt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,gt=n;break}gt=e.return}}function pE(t){for(;gt!==null;){var e=gt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{c_(4,e)}catch(y){si(e,n,y)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(y){si(e,r,y)}}var a=e.return;try{jv(e)}catch(y){si(e,a,y)}break;case 5:var h=e.return;try{jv(e)}catch(y){si(e,h,y)}}}catch(y){si(e,e.return,y)}if(e===t){gt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,gt=l;break}gt=e.return}}var uO=Math.ceil,Lg=La.ReactCurrentDispatcher,xx=La.ReactCurrentOwner,Hs=La.ReactCurrentBatchConfig,hn=0,Vi=null,Ei=null,Qi=0,fs=0,Ou=Ll(0),Bi=0,bf=null,Tc=0,u_=0,bx=0,$d=null,Vr=null,wx=0,nh=1/0,pa=null,Rg=!1,Xv=null,wl=null,mm=!1,ml=null,Dg=0,Zd=0,qv=null,Qm=-1,eg=0;function Br(){return hn&6?fi():Qm!==-1?Qm:Qm=fi()}function Al(t){return t.mode&1?hn&2&&Qi!==0?Qi&-Qi:q3.transition!==null?(eg===0&&(eg=MC()),eg):(t=wn,t!==0||(t=window.event,t=t===void 0?16:kC(t.type)),t):1}function po(t,e,n,i){if(50<Zd)throw Zd=0,qv=null,Error(He(185));kf(t,n,i),(!(hn&2)||t!==Vi)&&(t===Vi&&(!(hn&2)&&(u_|=n),Bi===4&&dl(t,Qi)),$r(t,i),n===1&&hn===0&&!(e.mode&1)&&(nh=fi()+500,o_&&Rl()))}function $r(t,e){var n=t.callbackNode;qD(t,e);var i=_g(t,t===Vi?Qi:0);if(i===0)n!==null&&AA(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&AA(n),e===1)t.tag===0?X3(mE.bind(null,t)):tI(mE.bind(null,t)),V3(function(){!(hn&6)&&Rl()}),n=null;else{switch(PC(i)){case 1:n=$1;break;case 4:n=CC;break;case 16:n=gg;break;case 536870912:n=IC;break;default:n=gg}n=eM(n,qI.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function qI(t,e){if(Qm=-1,eg=0,hn&6)throw Error(He(327));var n=t.callbackNode;if(Wu()&&t.callbackNode!==n)return null;var i=_g(t,t===Vi?Qi:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Og(t,i);else{e=i;var r=hn;hn|=2;var a=ZI();(Vi!==t||Qi!==e)&&(pa=null,nh=fi()+500,yc(t,e));do try{fO();break}catch(l){$I(t,l)}while(1);ax(),Lg.current=a,hn=r,Ei!==null?e=0:(Vi=null,Qi=0,e=Bi)}if(e!==0){if(e===2&&(r=xv(t),r!==0&&(i=r,e=$v(t,r))),e===1)throw n=bf,yc(t,0),dl(t,i),$r(t,fi()),n;if(e===6)dl(t,i);else{if(r=t.current.alternate,!(i&30)&&!hO(r)&&(e=Og(t,i),e===2&&(a=xv(t),a!==0&&(i=a,e=$v(t,a))),e===1))throw n=bf,yc(t,0),dl(t,i),$r(t,fi()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(He(345));case 2:hc(t,Vr,pa);break;case 3:if(dl(t,i),(i&130023424)===i&&(e=wx+500-fi(),10<e)){if(_g(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Br(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Iv(hc.bind(null,t,Vr,pa),e);break}hc(t,Vr,pa);break;case 4:if(dl(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var h=31-fo(i);a=1<<h,h=e[h],h>r&&(r=h),i&=~a}if(i=r,i=fi()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*uO(i/1960))-i,10<i){t.timeoutHandle=Iv(hc.bind(null,t,Vr,pa),i);break}hc(t,Vr,pa);break;case 5:hc(t,Vr,pa);break;default:throw Error(He(329))}}}return $r(t,fi()),t.callbackNode===n?qI.bind(null,t):null}function $v(t,e){var n=$d;return t.current.memoizedState.isDehydrated&&(yc(t,e).flags|=256),t=Og(t,e),t!==2&&(e=Vr,Vr=n,e!==null&&Zv(e)),t}function Zv(t){Vr===null?Vr=t:Vr.push.apply(Vr,t)}function hO(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!_o(a(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function dl(t,e){for(e&=~bx,e&=~u_,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-fo(e),i=1<<n;t[n]=-1,e&=~i}}function mE(t){if(hn&6)throw Error(He(327));Wu();var e=_g(t,0);if(!(e&1))return $r(t,fi()),null;var n=Og(t,e);if(t.tag!==0&&n===2){var i=xv(t);i!==0&&(e=i,n=$v(t,i))}if(n===1)throw n=bf,yc(t,0),dl(t,e),$r(t,fi()),n;if(n===6)throw Error(He(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,hc(t,Vr,pa),$r(t,fi()),null}function Ax(t,e){var n=hn;hn|=1;try{return t(e)}finally{hn=n,hn===0&&(nh=fi()+500,o_&&Rl())}}function Sc(t){ml!==null&&ml.tag===0&&!(hn&6)&&Wu();var e=hn;hn|=1;var n=Hs.transition,i=wn;try{if(Hs.transition=null,wn=1,t)return t()}finally{wn=i,Hs.transition=n,hn=e,!(hn&6)&&Rl()}}function Ex(){fs=Ou.current,zn(Ou)}function yc(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,G3(n)),Ei!==null)for(n=Ei.return;n!==null;){var i=n;switch(rx(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&wg();break;case 3:eh(),zn(Xr),zn(gr),fx();break;case 5:dx(i);break;case 4:eh();break;case 13:zn($n);break;case 19:zn($n);break;case 10:lx(i.type._context);break;case 22:case 23:Ex()}n=n.return}if(Vi=t,Ei=t=El(t.current,null),Qi=fs=e,Bi=0,bf=null,bx=u_=Tc=0,Vr=$d=null,pc!==null){for(e=0;e<pc.length;e++)if(n=pc[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,a=n.pending;if(a!==null){var h=a.next;a.next=r,i.next=h}n.pending=i}pc=null}return t}function $I(t,e){do{var n=Ei;try{if(ax(),Jm.current=Bg,Pg){for(var i=Jn.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}Pg=!1}if(Ec=0,Gi=Pi=Jn=null,Xd=!1,yf=0,xx.current=null,n===null||n.return===null){Bi=1,bf=e,Ei=null;break}e:{var a=t,h=n.return,l=n,y=e;if(e=Qi,l.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){var x=y,T=l,C=T.tag;if(!(T.mode&1)&&(C===0||C===11||C===15)){var S=T.alternate;S?(T.updateQueue=S.updateQueue,T.memoizedState=S.memoizedState,T.lanes=S.lanes):(T.updateQueue=null,T.memoizedState=null)}var z=nE(h);if(z!==null){z.flags&=-257,iE(z,h,l,a,e),z.mode&1&&tE(a,x,e),e=z,y=x;var V=e.updateQueue;if(V===null){var Z=new Set;Z.add(y),e.updateQueue=Z}else V.add(y);break e}else{if(!(e&1)){tE(a,x,e),Tx();break e}y=Error(He(426))}}else if(Vn&&l.mode&1){var ue=nE(h);if(ue!==null){!(ue.flags&65536)&&(ue.flags|=256),iE(ue,h,l,a,e),sx(th(y,l));break e}}a=y=th(y,l),Bi!==4&&(Bi=2),$d===null?$d=[a]:$d.push(a),a=h;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var q=BI(a,y,e);$A(a,q);break e;case 1:l=y;var j=a.type,K=a.stateNode;if(!(a.flags&128)&&(typeof j.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(wl===null||!wl.has(K)))){a.flags|=65536,e&=-e,a.lanes|=e;var de=LI(a,l,e);$A(a,de);break e}}a=a.return}while(a!==null)}KI(n)}catch(ve){e=ve,Ei===n&&n!==null&&(Ei=n=n.return);continue}break}while(1)}function ZI(){var t=Lg.current;return Lg.current=Bg,t===null?Bg:t}function Tx(){(Bi===0||Bi===3||Bi===2)&&(Bi=4),Vi===null||!(Tc&268435455)&&!(u_&268435455)||dl(Vi,Qi)}function Og(t,e){var n=hn;hn|=2;var i=ZI();(Vi!==t||Qi!==e)&&(pa=null,yc(t,e));do try{dO();break}catch(r){$I(t,r)}while(1);if(ax(),hn=n,Lg.current=i,Ei!==null)throw Error(He(261));return Vi=null,Qi=0,Bi}function dO(){for(;Ei!==null;)JI(Ei)}function fO(){for(;Ei!==null&&!zD();)JI(Ei)}function JI(t){var e=QI(t.alternate,t,fs);t.memoizedProps=t.pendingProps,e===null?KI(t):Ei=e,xx.current=null}function KI(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=oO(n,e),n!==null){n.flags&=32767,Ei=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Bi=6,Ei=null;return}}else if(n=sO(n,e,fs),n!==null){Ei=n;return}if(e=e.sibling,e!==null){Ei=e;return}Ei=e=t}while(e!==null);Bi===0&&(Bi=5)}function hc(t,e,n){var i=wn,r=Hs.transition;try{Hs.transition=null,wn=1,pO(t,e,n,i)}finally{Hs.transition=r,wn=i}return null}function pO(t,e,n,i){do Wu();while(ml!==null);if(hn&6)throw Error(He(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(He(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if($D(t,a),t===Vi&&(Ei=Vi=null,Qi=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||mm||(mm=!0,eM(gg,function(){return Wu(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=Hs.transition,Hs.transition=null;var h=wn;wn=1;var l=hn;hn|=4,xx.current=null,lO(t,n),WI(n,t),D3(Sv),yg=!!Tv,Sv=Tv=null,t.current=n,cO(n),ND(),hn=l,wn=h,Hs.transition=a}else t.current=n;if(mm&&(mm=!1,ml=t,Dg=r),a=t.pendingLanes,a===0&&(wl=null),VD(n.stateNode),$r(t,fi()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(Rg)throw Rg=!1,t=Xv,Xv=null,t;return Dg&1&&t.tag!==0&&Wu(),a=t.pendingLanes,a&1?t===qv?Zd++:(Zd=0,qv=t):Zd=0,Rl(),null}function Wu(){if(ml!==null){var t=PC(Dg),e=Hs.transition,n=wn;try{if(Hs.transition=null,wn=16>t?16:t,ml===null)var i=!1;else{if(t=ml,ml=null,Dg=0,hn&6)throw Error(He(331));var r=hn;for(hn|=4,gt=t.current;gt!==null;){var a=gt,h=a.child;if(gt.flags&16){var l=a.deletions;if(l!==null){for(var y=0;y<l.length;y++){var x=l[y];for(gt=x;gt!==null;){var T=gt;switch(T.tag){case 0:case 11:case 15:qd(8,T,a)}var C=T.child;if(C!==null)C.return=T,gt=C;else for(;gt!==null;){T=gt;var S=T.sibling,z=T.return;if(VI(T),T===x){gt=null;break}if(S!==null){S.return=z,gt=S;break}gt=z}}}var V=a.alternate;if(V!==null){var Z=V.child;if(Z!==null){V.child=null;do{var ue=Z.sibling;Z.sibling=null,Z=ue}while(Z!==null)}}gt=a}}if(a.subtreeFlags&2064&&h!==null)h.return=a,gt=h;else e:for(;gt!==null;){if(a=gt,a.flags&2048)switch(a.tag){case 0:case 11:case 15:qd(9,a,a.return)}var q=a.sibling;if(q!==null){q.return=a.return,gt=q;break e}gt=a.return}}var j=t.current;for(gt=j;gt!==null;){h=gt;var K=h.child;if(h.subtreeFlags&2064&&K!==null)K.return=h,gt=K;else e:for(h=j;gt!==null;){if(l=gt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:c_(9,l)}}catch(ve){si(l,l.return,ve)}if(l===h){gt=null;break e}var de=l.sibling;if(de!==null){de.return=l.return,gt=de;break e}gt=l.return}}if(hn=r,Rl(),qo&&typeof qo.onPostCommitFiberRoot=="function")try{qo.onPostCommitFiberRoot(t_,t)}catch{}i=!0}return i}finally{wn=n,Hs.transition=e}}return!1}function gE(t,e,n){e=th(n,e),e=BI(t,e,1),t=bl(t,e,1),e=Br(),t!==null&&(kf(t,1,e),$r(t,e))}function si(t,e,n){if(t.tag===3)gE(t,t,n);else for(;e!==null;){if(e.tag===3){gE(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(wl===null||!wl.has(i))){t=th(n,t),t=LI(e,t,1),e=bl(e,t,1),t=Br(),e!==null&&(kf(e,1,t),$r(e,t));break}}e=e.return}}function mO(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Br(),t.pingedLanes|=t.suspendedLanes&n,Vi===t&&(Qi&n)===n&&(Bi===4||Bi===3&&(Qi&130023424)===Qi&&500>fi()-wx?yc(t,0):bx|=n),$r(t,e)}function YI(t,e){e===0&&(t.mode&1?(e=sm,sm<<=1,!(sm&130023424)&&(sm=4194304)):e=1);var n=Br();t=Ca(t,e),t!==null&&(kf(t,e,n),$r(t,n))}function gO(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),YI(t,n)}function _O(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(He(314))}i!==null&&i.delete(e),YI(t,n)}var QI;QI=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Xr.current)Hr=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Hr=!1,rO(t,e,n);Hr=!!(t.flags&131072)}else Hr=!1,Vn&&e.flags&1048576&&nI(e,Tg,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Ym(t,e),t=e.pendingProps;var r=Ku(e,gr.current);Hu(e,n),r=mx(null,e,i,t,r,n);var a=gx();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,qr(i)?(a=!0,Ag(e)):a=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,ux(e),r.updater=a_,e.stateNode=r,r._reactInternals=e,Ov(e,i,t,n),e=zv(null,e,i,!0,a,n)):(e.tag=0,Vn&&a&&ix(e),Ir(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Ym(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=vO(i),t=so(i,t),r){case 0:e=Fv(null,e,i,t,n);break e;case 1:e=oE(null,e,i,t,n);break e;case 11:e=rE(null,e,i,t,n);break e;case 14:e=sE(null,e,i,so(i.type,t),n);break e}throw Error(He(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:so(i,r),Fv(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:so(i,r),oE(t,e,i,r,n);case 3:e:{if(kI(e),t===null)throw Error(He(387));i=e.pendingProps,a=e.memoizedState,r=a.element,oI(t,e),Ig(e,i,null,n);var h=e.memoizedState;if(i=h.element,a.isDehydrated)if(a={element:i,isDehydrated:!1,cache:h.cache,pendingSuspenseBoundaries:h.pendingSuspenseBoundaries,transitions:h.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){r=th(Error(He(423)),e),e=aE(t,e,i,n,r);break e}else if(i!==r){r=th(Error(He(424)),e),e=aE(t,e,i,n,r);break e}else for(ms=xl(e.stateNode.containerInfo.firstChild),_s=e,Vn=!0,ao=null,n=uI(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Yu(),i===r){e=Ia(t,e,n);break e}Ir(t,e,i,n)}e=e.child}return e;case 5:return hI(e),t===null&&Lv(e),i=e.type,r=e.pendingProps,a=t!==null?t.memoizedProps:null,h=r.children,Cv(i,r)?h=null:a!==null&&Cv(i,a)&&(e.flags|=32),OI(t,e),Ir(t,e,h,n),e.child;case 6:return t===null&&Lv(e),null;case 13:return FI(t,e,n);case 4:return hx(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Qu(e,null,i,n):Ir(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:so(i,r),rE(t,e,i,r,n);case 7:return Ir(t,e,e.pendingProps,n),e.child;case 8:return Ir(t,e,e.pendingProps.children,n),e.child;case 12:return Ir(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,a=e.memoizedProps,h=r.value,On(Sg,i._currentValue),i._currentValue=h,a!==null)if(_o(a.value,h)){if(a.children===r.children&&!Xr.current){e=Ia(t,e,n);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){h=a.child;for(var y=l.firstContext;y!==null;){if(y.context===i){if(a.tag===1){y=wa(-1,n&-n),y.tag=2;var x=a.updateQueue;if(x!==null){x=x.shared;var T=x.pending;T===null?y.next=y:(y.next=T.next,T.next=y),x.pending=y}}a.lanes|=n,y=a.alternate,y!==null&&(y.lanes|=n),Rv(a.return,n,e),l.lanes|=n;break}y=y.next}}else if(a.tag===10)h=a.type===e.type?null:a.child;else if(a.tag===18){if(h=a.return,h===null)throw Error(He(341));h.lanes|=n,l=h.alternate,l!==null&&(l.lanes|=n),Rv(h,n,e),h=a.sibling}else h=a.child;if(h!==null)h.return=a;else for(h=a;h!==null;){if(h===e){h=null;break}if(a=h.sibling,a!==null){a.return=h.return,h=a;break}h=h.return}a=h}Ir(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Hu(e,n),r=Xs(r),i=i(r),e.flags|=1,Ir(t,e,i,n),e.child;case 14:return i=e.type,r=so(i,e.pendingProps),r=so(i.type,r),sE(t,e,i,r,n);case 15:return RI(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:so(i,r),Ym(t,e),e.tag=1,qr(i)?(t=!0,Ag(e)):t=!1,Hu(e,n),lI(e,i,r),Ov(e,i,r,n),zv(null,e,i,!0,t,n);case 19:return zI(t,e,n);case 22:return DI(t,e,n)}throw Error(He(156,e.tag))};function eM(t,e){return SC(t,e)}function yO(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Us(t,e,n,i){return new yO(t,e,n,i)}function Sx(t){return t=t.prototype,!(!t||!t.isReactComponent)}function vO(t){if(typeof t=="function")return Sx(t)?1:0;if(t!=null){if(t=t.$$typeof,t===W1)return 11;if(t===X1)return 14}return 2}function El(t,e){var n=t.alternate;return n===null?(n=Us(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function tg(t,e,n,i,r,a){var h=2;if(i=t,typeof t=="function")Sx(t)&&(h=1);else if(typeof t=="string")h=5;else e:switch(t){case Tu:return vc(n.children,r,a,e);case H1:h=8,r|=8;break;case sv:return t=Us(12,n,e,r|2),t.elementType=sv,t.lanes=a,t;case ov:return t=Us(13,n,e,r),t.elementType=ov,t.lanes=a,t;case av:return t=Us(19,n,e,r),t.elementType=av,t.lanes=a,t;case cC:return h_(n,r,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case aC:h=10;break e;case lC:h=9;break e;case W1:h=11;break e;case X1:h=14;break e;case cl:h=16,i=null;break e}throw Error(He(130,t==null?t:typeof t,""))}return e=Us(h,n,e,r),e.elementType=t,e.type=i,e.lanes=a,e}function vc(t,e,n,i){return t=Us(7,t,i,e),t.lanes=n,t}function h_(t,e,n,i){return t=Us(22,t,i,e),t.elementType=cC,t.lanes=n,t.stateNode={isHidden:!1},t}function e0(t,e,n){return t=Us(6,t,null,e),t.lanes=n,t}function t0(t,e,n){return e=Us(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function xO(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Oy(0),this.expirationTimes=Oy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Oy(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Cx(t,e,n,i,r,a,h,l,y){return t=new xO(t,e,n,l,y),e===1?(e=1,a===!0&&(e|=8)):e=0,a=Us(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ux(a),t}function bO(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Eu,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function tM(t){if(!t)return Il;t=t._reactInternals;e:{if(Bc(t)!==t||t.tag!==1)throw Error(He(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(qr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(He(171))}if(t.tag===1){var n=t.type;if(qr(n))return eI(t,n,e)}return e}function nM(t,e,n,i,r,a,h,l,y){return t=Cx(n,i,!0,t,r,a,h,l,y),t.context=tM(null),n=t.current,i=Br(),r=Al(n),a=wa(i,r),a.callback=e??null,bl(n,a,r),t.current.lanes=r,kf(t,r,i),$r(t,i),t}function d_(t,e,n,i){var r=e.current,a=Br(),h=Al(r);return n=tM(n),e.context===null?e.context=n:e.pendingContext=n,e=wa(a,h),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=bl(r,e,h),t!==null&&(po(t,r,h,a),Zm(t,r,h)),h}function kg(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function _E(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ix(t,e){_E(t,e),(t=t.alternate)&&_E(t,e)}function wO(){return null}var iM=typeof reportError=="function"?reportError:function(t){console.error(t)};function Mx(t){this._internalRoot=t}f_.prototype.render=Mx.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(He(409));d_(t,e,null,null)};f_.prototype.unmount=Mx.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Sc(function(){d_(null,t,null,null)}),e[Sa]=null}};function f_(t){this._internalRoot=t}f_.prototype.unstable_scheduleHydration=function(t){if(t){var e=RC();t={blockedOn:null,target:t,priority:e};for(var n=0;n<hl.length&&e!==0&&e<hl[n].priority;n++);hl.splice(n,0,t),n===0&&OC(t)}};function Px(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function p_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function yE(){}function AO(t,e,n,i,r){if(r){if(typeof i=="function"){var a=i;i=function(){var x=kg(h);a.call(x)}}var h=nM(e,i,t,0,null,!1,!1,"",yE);return t._reactRootContainer=h,t[Sa]=h.current,ff(t.nodeType===8?t.parentNode:t),Sc(),h}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var l=i;i=function(){var x=kg(y);l.call(x)}}var y=Cx(t,0,!1,null,null,!1,!1,"",yE);return t._reactRootContainer=y,t[Sa]=y.current,ff(t.nodeType===8?t.parentNode:t),Sc(function(){d_(e,y,n,i)}),y}function m_(t,e,n,i,r){var a=n._reactRootContainer;if(a){var h=a;if(typeof r=="function"){var l=r;r=function(){var y=kg(h);l.call(y)}}d_(e,h,t,r)}else h=AO(n,e,t,r,i);return kg(h)}BC=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=kd(e.pendingLanes);n!==0&&(Z1(e,n|1),$r(e,fi()),!(hn&6)&&(nh=fi()+500,Rl()))}break;case 13:Sc(function(){var i=Ca(t,1);if(i!==null){var r=Br();po(i,t,1,r)}}),Ix(t,1)}};J1=function(t){if(t.tag===13){var e=Ca(t,134217728);if(e!==null){var n=Br();po(e,t,134217728,n)}Ix(t,134217728)}};LC=function(t){if(t.tag===13){var e=Al(t),n=Ca(t,e);if(n!==null){var i=Br();po(n,t,e,i)}Ix(t,e)}};RC=function(){return wn};DC=function(t,e){var n=wn;try{return wn=t,e()}finally{wn=n}};_v=function(t,e,n){switch(e){case"input":if(uv(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=s_(i);if(!r)throw Error(He(90));hC(i),uv(i,r)}}}break;case"textarea":fC(t,n);break;case"select":e=n.value,e!=null&&Uu(t,!!n.multiple,e,!1)}};xC=Ax;bC=Sc;var EO={usingClientEntryPoint:!1,Events:[zf,Mu,s_,yC,vC,Ax]},xd={findFiberByHostInstance:fc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},TO={bundleType:xd.bundleType,version:xd.version,rendererPackageName:xd.rendererPackageName,rendererConfig:xd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:La.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=EC(t),t===null?null:t.stateNode},findFiberByHostInstance:xd.findFiberByHostInstance||wO,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gm.isDisabled&&gm.supportsFiber)try{t_=gm.inject(TO),qo=gm}catch{}}bs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=EO;bs.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Px(e))throw Error(He(200));return bO(t,e,null,n)};bs.createRoot=function(t,e){if(!Px(t))throw Error(He(299));var n=!1,i="",r=iM;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Cx(t,1,!1,null,null,n,!1,i,r),t[Sa]=e.current,ff(t.nodeType===8?t.parentNode:t),new Mx(e)};bs.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(He(188)):(t=Object.keys(t).join(","),Error(He(268,t)));return t=EC(e),t=t===null?null:t.stateNode,t};bs.flushSync=function(t){return Sc(t)};bs.hydrate=function(t,e,n){if(!p_(e))throw Error(He(200));return m_(null,t,e,!0,n)};bs.hydrateRoot=function(t,e,n){if(!Px(t))throw Error(He(405));var i=n!=null&&n.hydratedSources||null,r=!1,a="",h=iM;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(h=n.onRecoverableError)),e=nM(e,null,t,1,n??null,r,!1,a,h),t[Sa]=e.current,ff(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new f_(e)};bs.render=function(t,e,n){if(!p_(e))throw Error(He(200));return m_(null,t,e,!1,n)};bs.unmountComponentAtNode=function(t){if(!p_(t))throw Error(He(40));return t._reactRootContainer?(Sc(function(){m_(null,null,t,!1,function(){t._reactRootContainer=null,t[Sa]=null})}),!0):!1};bs.unstable_batchedUpdates=Ax;bs.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!p_(n))throw Error(He(200));if(t==null||t._reactInternals===void 0)throw Error(He(38));return m_(t,e,n,!1,i)};bs.version="18.2.0-next-9e3b772b8-20220608";function rM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rM)}catch(t){console.error(t)}}rM(),nC.exports=bs;var Bx=nC.exports,vE=Bx;iv.createRoot=vE.createRoot,iv.hydrateRoot=vE.hydrateRoot;function wf(t){"@babel/helpers - typeof";return wf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wf(t)}function SO(t,e){if(wf(t)!=="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e||"default");if(wf(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function CO(t){var e=SO(t,"string");return wf(e)==="symbol"?e:String(e)}function L(t,e,n){return e=CO(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xn(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const g_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),xE=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);xE&&parseFloat(xE[1]);const IO="3.4.4";function Zo(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const n0={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},MO=n0.global||n0.self||n0.window||{},Aa=typeof process!="object"||String(process)!=="[object process]"||process.browser,Lx=typeof importScripts=="function",PO=typeof window<"u"&&typeof window.orientation<"u",bE=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);bE&&parseFloat(bE[1]);class BO{constructor(e,n){L(this,"name",void 0),L(this,"workerThread",void 0),L(this,"isRunning",!0),L(this,"result",void 0),L(this,"_resolve",()=>{}),L(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Zo(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Zo(this.isRunning),this.isRunning=!1,this._reject(e)}}let i0=class{terminate(){}};const r0=new Map;function LO(t){Zo(t.source&&!t.url||!t.source&&t.url);let e=r0.get(t.source||t.url);return e||(t.url&&(e=RO(t.url),r0.set(t.url,e)),t.source&&(e=sM(t.source),r0.set(t.source,e))),Zo(e),e}function RO(t){if(!t.startsWith("http"))return t;const e=DO(t);return sM(e)}function sM(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function DO(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function oM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const i=n||new Set;if(t){if(wE(t))i.add(t);else if(wE(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)oM(t[r],e,i)}}return n===void 0?Array.from(i):[]}function wE(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const s0=()=>{};class Jv{static isSupported(){return typeof Worker<"u"&&Aa||typeof i0<"u"&&!Aa}constructor(e){L(this,"name",void 0),L(this,"source",void 0),L(this,"url",void 0),L(this,"terminated",!1),L(this,"worker",void 0),L(this,"onMessage",void 0),L(this,"onError",void 0),L(this,"_loadableURL","");const{name:n,source:i,url:r}=e;Zo(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=s0,this.onError=a=>console.log(a),this.worker=Aa?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=s0,this.onError=s0,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||oM(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=LO({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new i0(i,{eval:!1})}else if(this.source)e=new i0(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class OO{static isSupported(){return Jv.isSupported()}constructor(e){L(this,"name","unnamed"),L(this,"source",void 0),L(this,"url",void 0),L(this,"maxConcurrency",1),L(this,"maxMobileConcurrency",1),L(this,"onDebug",()=>{}),L(this,"reuseWorkers",!0),L(this,"props",{}),L(this,"jobQueue",[]),L(this,"idleQueue",[]),L(this,"count",0),L(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(a,h,l)=>a.done(l),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(a,h)=>a.error(h);const r=new Promise(a=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:a}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new BO(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Jv({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return PO?this.maxMobileConcurrency:this.maxConcurrency}}const kO={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class ga{static isSupported(){return Jv.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ga._workerFarm=ga._workerFarm||new ga({}),ga._workerFarm.setProps(e),ga._workerFarm}constructor(e){L(this,"props",void 0),L(this,"workerPools",new Map),this.props={...kO},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let a=this.workerPools.get(n);return a||(a=new OO({name:n,source:i,url:r}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}L(ga,"_workerFarm",void 0);const FO="latest";function zO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let a=t.version;a==="latest"&&(a=FO);const h=a?"@".concat(a):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(h,"/dist/").concat(i)}return Zo(r),r}function NO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:IO;Zo(t,"no worker provided");const n=t.version;return!(!e||!n)}const UO={},GO=Object.freeze(Object.defineProperty({__proto__:null,default:UO},Symbol.toStringTag,{value:"Module"})),VO="3.4.4",o0={};async function xc(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(t=jO(t,e,n)),o0[t]=o0[t]||HO(t),await o0[t]}function jO(t,e,n){if(t.startsWith("http"))return t;const i=n.modules||{};return i[t]?i[t]:Aa?n.CDN?(Zo(n.CDN.startsWith("http")),"".concat(n.CDN,"/").concat(e,"@").concat(VO,"/dist/libs/").concat(t)):Lx?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}async function HO(t){if(t.endsWith("wasm"))return await(await fetch(t)).arrayBuffer();if(!Aa)try{return GO&&void 0}catch{return null}if(Lx)return importScripts(t);const n=await(await fetch(t)).text();return WO(n,t)}function WO(t,e){if(!Aa)return;if(Lx)return eval.call(MO,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}function XO(t,e){return!ga.isSupported()||!Aa&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function qO(t,e,n,i,r){const a=t.id,h=zO(t,n),y=ga.getWorkerFarm(n).getWorkerPool({name:a,url:h});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const x=await y.startJob("process-on-worker",$O.bind(null,r));return x.postMessage("process",{input:e,options:n,context:i}),await(await x.result).result}async function $O(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:a,options:h}=i;try{const l=await t(a,h);e.postMessage("done",{id:r,result:l})}catch(l){const y=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:r,error:y})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function ZO(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?AE(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?AE(t,0,e):""}function AE(t,e,n){if(t.byteLength<=e+n)return"";const i=new DataView(t);let r="";for(let a=0;a<n;a++)r+=String.fromCharCode(i.getUint8(e+a));return r}function JO(t){try{return JSON.parse(t)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(ZO(t),'"'))}}function KO(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let a=0;a<i.length;++a)if(i[a]!==r[a])return!1;return!0}function YO(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=e.map(l=>l instanceof ArrayBuffer?new Uint8Array(l):l),r=i.reduce((l,y)=>l+y.byteLength,0),a=new Uint8Array(r);let h=0;for(const l of i)a.set(l,h),h+=l.byteLength;return a.buffer}function Rx(t,e,n){const i=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}function Uf(t,e){return xn(t>=0),xn(e>0),t+(e-1)&~(e-1)}function QO(t,e,n){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{const r=t.byteOffset,a=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,r,a)}return e.set(i,n),n+Uf(i.byteLength,4)}async function ek(t){const e=[];for await(const n of t)e.push(n);return YO(...e)}function EE(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let TE=class{constructor(e,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=EE(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(EE()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},tk=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:i}=e;let r=this.stats[n];return r||(e instanceof TE?r=e:r=new TE(n,i),this.stats[n]=r),r}};const nk="Queued Requests",ik="Active Requests",rk="Cancelled Requests",sk="Queued Requests Ever",ok="Active Requests Ever",ak={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class lk{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};L(this,"props",void 0),L(this,"stats",void 0),L(this,"activeRequestCount",0),L(this,"requestQueue",[]),L(this,"requestMap",new Map),L(this,"deferredUpdate",null),this.props={...ak,...e},this.stats=new tk({id:this.props.id}),this.stats.get(nk),this.stats.get(ik),this.stats.get(rk),this.stats.get(sk),this.stats.get(ok)}scheduleRequest(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:n},r=new Promise(a=>(i.resolve=a,i));return this.requestQueue.push(i),this.requestMap.set(e,r),this._issueNewRequests(),r}_issueRequest(e){const{handle:n,resolve:i}=e;let r=!1;const a=()=>{r||(r=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:a}):Promise.resolve({done:a})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const i=e[n];this._updateRequest(i)||(e.splice(n,1),this.requestMap.delete(i.handle),n--)}e.sort((n,i)=>n.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let ck="";const SE={};function uk(t){for(const e in SE)if(t.startsWith(e)){const n=SE[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(ck).concat(t)),t}function hk(t){return t&&typeof t=="object"&&t.isBuffer}function aM(t){if(hk(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function lM(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Dx(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const dk=t=>typeof t=="boolean",Jd=t=>typeof t=="function",Gf=t=>t!==null&&typeof t=="object",CE=t=>Gf(t)&&t.constructor==={}.constructor,fk=t=>t&&typeof t[Symbol.iterator]=="function",pk=t=>t&&typeof t[Symbol.asyncIterator]=="function",Lc=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Rc=t=>typeof Blob<"u"&&t instanceof Blob,mk=t=>t&&typeof t=="object"&&t.isBuffer,gk=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Gf(t)&&Jd(t.tee)&&Jd(t.cancel)&&Jd(t.getReader),_k=t=>Gf(t)&&Jd(t.read)&&Jd(t.pipe)&&dk(t.readable),cM=t=>gk(t)||_k(t),yk=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,vk=/^([-\w.]+\/[-\w.+]+)/;function xk(t){const e=vk.exec(t);return e?e[1]:t}function IE(t){const e=yk.exec(t);return e?e[1]:""}const uM=/\?.*/;function bk(t){const e=t.match(uM);return e&&e[0]}function Ox(t){return t.replace(uM,"")}function __(t){return Lc(t)?t.url:Rc(t)?t.name||"":typeof t=="string"?t:""}function kx(t){if(Lc(t)){const e=t,n=e.headers.get("content-type")||"",i=Ox(e.url);return xk(n)||IE(i)}return Rc(t)?t.type||"":typeof t=="string"?IE(t):""}function wk(t){return Lc(t)?t.headers["content-length"]||-1:Rc(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function hM(t){if(Lc(t))return t;const e={},n=wk(t);n>=0&&(e["content-length"]=String(n));const i=__(t),r=kx(t);r&&(e["content-type"]=r);const a=await Tk(t);a&&(e["x-first-bytes"]=a),typeof t=="string"&&(t=new TextEncoder().encode(t));const h=new Response(t,{headers:e});return Object.defineProperty(h,"url",{value:i}),h}async function Ak(t){if(!t.ok){const e=await Ek(t);throw new Error(e)}}async function Ek(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function Tk(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=a=>{var h;return i(a==null||(h=a.target)===null||h===void 0?void 0:h.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=Sk(n);return"data:base64,".concat(i)}return null}function Sk(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function Af(t,e){if(typeof t=="string"){t=uk(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await hM(t)}function Ck(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Vf(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Ck()}const _m=globalThis.window||globalThis.self||globalThis.global,bd=globalThis.process||{},dM=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Vf();function Ik(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let Mk=class{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=Ik(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function Pk(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function Bk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function a0(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const a=t.width*n,h=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(h/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(h,"px;"),"background:url(".concat(r,");"),"background-size:".concat(a,"px ").concat(h,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Fg;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Fg||(Fg={}));const Lk=10;function ME(t){return typeof t!="string"?t:(t=t.toUpperCase(),Fg[t]||Fg.WHITE)}function Rk(t,e,n){if(!Vf&&typeof t=="string"){if(e){const i=ME(e);t="\x1B[".concat(i,"m").concat(t,"\x1B[39m")}if(n){const i=ME(n);t="\x1B[".concat(i+Lk,"m").concat(t,"\x1B[49m")}}return t}function Dk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n),r=t;for(const a of i){const h=r[a];typeof h=="function"&&(e.find(l=>a===l)||(r[a]=h.bind(t)))}}function zg(t,e){if(!t)throw new Error(e||"Assertion failed")}function hu(){let t;if(Vf()&&_m.performance){var e,n;t=_m==null||(e=_m.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in bd){var i;const r=bd==null||(i=bd.hrtime)===null||i===void 0?void 0:i.call(bd);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const du={debug:Vf()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Ok={enabled:!0,level:0};function ks(){}const PE={},BE={once:!0};let Fx=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=dM,this._startTs=hu(),this._deltaTs=hu(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Mk("__probe-".concat(this.id,"__"),Ok),this.timeStamp("".concat(this.id," started")),Dk(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((hu()-this._startTs).toPrecision(10))}getDelta(){return Number((hu()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){zg(e,n)}warn(e){return this._getLogFunction(0,e,du.warn,arguments,BE)}error(e){return this._getLogFunction(0,e,du.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,du.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,du.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,du.debug||du.info,arguments,BE)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||ks,i&&[i],{tag:Nk(n)}):ks}image(e){let{logLevel:n,priority:i,image:r,message:a="",scale:h=1}=e;return this._shouldLog(n||i)?Vf()?zk({image:r,message:a,scale:h}):Fk():ks}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ks)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=LE({logLevel:e,message:n,opts:i}),{collapsed:a}=i;return r.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ks)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=fM(e)}_getLogFunction(e,n,i,r,a){if(this._shouldLog(e)){a=LE({logLevel:e,message:n,args:r,opts:a}),i=i||a.method,zg(i),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=hu();const h=a.tag||a.message;if(a.once&&h)if(!PE[h])PE[h]=hu();else return ks;return n=kk(this.id,a.message,a),i.bind(console,n,...a.args)}return ks}};Fx.VERSION=dM;function fM(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return zg(Number.isFinite(e)&&e>=0),e}function LE(t){const{logLevel:e,message:n}=t;t.logLevel=fM(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return zg(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function kk(t,e,n){if(typeof e=="string"){const i=n.time?Bk(Pk(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=Rk(e,n.color,n.background)}return e}function Fk(t){return console.warn("removed"),ks}function zk(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const a=new Image;return a.onload=()=>{const h=a0(a,n,i);console.log(...h)},a.src=e,ks}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...a0(e,n,i)),ks;if(r.toLowerCase()==="canvas"){const a=new Image;return a.onload=()=>console.log(...a0(a,n,i)),a.src=e.toDataURL(),ks}return ks}function Nk(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const RE=new Fx({id:"loaders.gl"});class Uk{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Gk{constructor(){L(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return this.console.error.bind(this.console,...n)}}const pM={fetch:null,mimeType:void 0,nothrow:!1,log:new Gk,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:g_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Vk={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function mM(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const gM=()=>{const t=mM();return t.globalOptions=t.globalOptions||{...pM},t.globalOptions};function jk(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],Hk(t,n),Xk(e,t,i)}function Hk(t,e){DE(t,null,pM,Vk,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},a=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};DE(i,n.id,r,a,e)}}function DE(t,e,n,i,r){const a=e||"Top level",h=e?"".concat(e,"."):"";for(const l in t){const y=!e&&Gf(t[l]),x=l==="baseUri"&&!e,T=l==="workerUrl"&&e;if(!(l in n)&&!x&&!T){if(l in i)RE.warn("".concat(a," loader option '").concat(h).concat(l,"' no longer supported, use '").concat(i[l],"'"))();else if(!y){const C=Wk(l,r);RE.warn("".concat(a," loader option '").concat(h).concat(l,"' not recognized. ").concat(C))()}}}}function Wk(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const a in r.options){if(t===a)return"Did you mean '".concat(r.id,".").concat(a,"'?");const h=a.toLowerCase();(n.startsWith(h)||h.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(a,"'?"))}return i}function Xk(t,e,n){const r={...t.options||{}};return qk(r,n),r.log===null&&(r.log=new Uk),OE(r,gM()),OE(r,e),r}function OE(t,e){for(const n in e)if(n in e){const i=e[n];CE(i)&&CE(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function qk(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function zx(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Nx(t){var e,n;xn(t,"null loader"),xn(zx(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const _M=()=>{const t=mM();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function $k(t){const e=_M();t=Array.isArray(t)?t:[t];for(const n of t){const i=Nx(n);e.find(r=>i===r)||e.unshift(i)}}function Zk(){return _M()}const Jk=new Fx({id:"loaders.gl"}),Kk=/\.([^.]+)$/;async function Yk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!yM(t))return null;let r=kE(t,e,{...n,nothrow:!0},i);if(r)return r;if(Rc(t)&&(t=await t.slice(0,10).arrayBuffer(),r=kE(t,e,n,i)),!r&&!(n!=null&&n.nothrow))throw new Error(vM(t));return r}function kE(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!yM(t))return null;if(e&&!Array.isArray(e))return Nx(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(...Zk()),eF(r);const a=Qk(t,r,n,i);if(!a&&!(n!=null&&n.nothrow))throw new Error(vM(t));return a}function Qk(t,e,n,i){const r=__(t),a=kx(t),h=Ox(r)||(i==null?void 0:i.url);let l=null,y="";if(n!=null&&n.mimeType&&(l=l0(e,n==null?void 0:n.mimeType),y="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),l=l||tF(e,h),y=y||(l?"matched url ".concat(h):""),l=l||l0(e,a),y=y||(l?"matched MIME type ".concat(a):""),l=l||iF(e,t),y=y||(l?"matched initial data ".concat(xM(t)):""),l=l||l0(e,n==null?void 0:n.fallbackMimeType),y=y||(l?"matched fallback MIME type ".concat(a):""),y){var x;Jk.log(1,"selectLoader selected ".concat((x=l)===null||x===void 0?void 0:x.name,": ").concat(y,"."))}return l}function yM(t){return!(t instanceof Response&&t.status===204)}function vM(t){const e=__(t),n=kx(t);let i="No valid loader found (";i+=e?"".concat(lM(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?xM(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function eF(t){for(const e of t)Nx(e)}function tF(t,e){const n=e&&Kk.exec(e),i=n&&n[1];return i?nF(t,i):null}function nF(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function l0(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function iF(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(rF(e,n))return n}else if(ArrayBuffer.isView(e)){if(FE(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&FE(e,0,n))return n;return null}function rF(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function FE(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>sF(t,e,n,r))}function sF(t,e,n,i){if(i instanceof ArrayBuffer)return KO(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const r=Kv(t,e,i.length);return i===r;default:return!1}}function xM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Kv(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Kv(t,0,e):""}function Kv(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let a=0;a<n;a++)r+=String.fromCharCode(i.getUint8(e+a));return r}const oF=256*1024;function*aF(t,e){const n=(e==null?void 0:e.chunkSize)||oF;let i=0;const r=new TextEncoder;for(;i<t.length;){const a=Math.min(t.length-i,n),h=t.slice(i,i+a);i+=a,yield r.encode(h)}}const lF=256*1024;function cF(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=lF}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),a=new ArrayBuffer(r),h=new Uint8Array(t,i,r);new Uint8Array(a).set(h),i+=r,yield a}}()}const uF=1024*1024;async function*hF(t,e){const n=(e==null?void 0:e.chunkSize)||uF;let i=0;for(;i<t.size;){const r=i+n,a=await t.slice(i,r).arrayBuffer();i=r,yield a}}function zE(t,e){return g_?dF(t,e):fF(t)}async function*dF(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:a,value:h}=await r;if(a)return;yield aM(h)}}catch{n.releaseLock()}}async function*fF(t,e){for await(const n of t)yield aM(n)}function pF(t,e){if(typeof t=="string")return aF(t,e);if(t instanceof ArrayBuffer)return cF(t,e);if(Rc(t))return hF(t,e);if(cM(t))return zE(t,e);if(Lc(t))return zE(t.body,e);throw new Error("makeIterator")}const bM="Cannot convert supplied data type";function mF(t,e,n){if(e.text&&typeof t=="string")return t;if(mk(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(bM)}async function gF(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return mF(t,e);if(Rc(t)&&(t=await hM(t)),Lc(t)){const r=t;return await Ak(r),e.binary?await r.arrayBuffer():await r.text()}if(cM(t)&&(t=pF(t,n)),fk(t)||pk(t))return ek(t);throw new Error(bM)}function wM(t,e){const n=gM(),i=t||n;return typeof i.fetch=="function"?i.fetch:Gf(i.fetch)?r=>Af(r,i):e!=null&&e.fetch?e==null?void 0:e.fetch:Af}function _F(t,e,n){if(n)return n;const i={fetch:wM(e,t),...t};if(i.url){const r=Ox(i.url);i.baseUrl=r,i.queryString=bk(i.url),i.filename=lM(r),i.baseUrl=Dx(r)}return Array.isArray(i.loaders)||(i.loaders=null),i}function yF(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function Ux(t,e,n,i){Zo(!i||typeof i=="object"),e&&!Array.isArray(e)&&!zx(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const r=__(t),h=yF(e,i),l=await Yk(t,h,n);return l?(n=jk(n,l,h,r),i=_F({url:r,parse:Ux,loaders:h},n,i||null),await vF(l,t,n,i)):null}async function vF(t,e,n,i){if(NO(t),Lc(e)){const r=e,{ok:a,redirected:h,status:l,statusText:y,type:x,url:T}=r,C=Object.fromEntries(r.headers.entries());i.response={headers:C,ok:a,redirected:h,status:l,statusText:y,type:x,url:T}}if(e=await gF(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(XO(t,n))return await qO(t,e,n,i,Ux);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw Zo(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function Ml(t,e,n,i){!Array.isArray(e)&&!zx(e)&&(n=e,e=void 0);const r=wM(n);let a=t;return typeof t=="string"&&(a=await r(t)),Rc(t)&&(a=await r(t)),await Ux(a,e,n)}const xF="3.4.4",{_parseImageNode:bF}=globalThis,Yv=typeof Image<"u",Qv=typeof ImageBitmap<"u",wF=!!bF,e1=g_?!0:wF;function AF(t){switch(t){case"auto":return Qv||Yv||e1;case"imagebitmap":return Qv;case"image":return Yv;case"data":return e1;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function EF(){if(Qv)return"imagebitmap";if(Yv)return"image";if(e1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function TF(t){const e=CF(t);if(!e)throw new Error("Not an image");return e}function SF(t){switch(TF(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function CF(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const IF=/^data:image\/svg\+xml/,MF=/\.svg((\?|#).*)?$/;function Gx(t){return t&&(IF.test(t)||MF.test(t))}function PF(t,e){if(Gx(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(a){throw new Error(a.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return AM(t,e)}function AM(t,e){if(Gx(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function EM(t,e,n){const i=PF(t,n),r=self.URL||self.webkitURL,a=typeof i!="string"&&r.createObjectURL(i);try{return await BF(a||i,e)}finally{a&&r.revokeObjectURL(a)}}async function BF(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=a=>r(new Error("Could not load image ".concat(t,": ").concat(a)))}catch(a){r(a)}})}const LF={};let NE=!0;async function RF(t,e,n){let i;Gx(n)?i=await EM(t,e,n):i=AM(t,n);const r=e&&e.imagebitmap;return await DF(i,r)}async function DF(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((OF(e)||!NE)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),NE=!1}return await createImageBitmap(t)}function OF(t){for(const e in t||LF)return!1;return!0}function kF(t){return!UF(t,"ftyp",4)||!(t[8]&96)?null:FF(t)}function FF(t){switch(zF(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function zF(t,e,n){return String.fromCharCode(...t.slice(e,n))}function NF(t){return[...t].map(e=>e.charCodeAt(0))}function UF(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=NF(e);for(let r=0;r<i.length;++r)if(i[r]!==t[r+n])return!1;return!0}const Vo=!1,Kd=!0;function Vx(t){const e=jf(t);return VF(e)||WF(e)||jF(e)||HF(e)||GF(e)}function GF(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=kF(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function VF(t){const e=jf(t);return e.byteLength>=24&&e.getUint32(0,Vo)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Vo),height:e.getUint32(20,Vo)}:null}function jF(t){const e=jf(t);return e.byteLength>=10&&e.getUint32(0,Vo)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Kd),height:e.getUint16(8,Kd)}:null}function HF(t){const e=jf(t);return e.byteLength>=14&&e.getUint16(0,Vo)===16973&&e.getUint32(2,Kd)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Kd),height:e.getUint32(22,Kd)}:null}function WF(t){const e=jf(t);if(!(e.byteLength>=3&&e.getUint16(0,Vo)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=XF();let a=2;for(;a+9<e.byteLength;){const h=e.getUint16(a,Vo);if(r.has(h))return{mimeType:"image/jpeg",height:e.getUint16(a+5,Vo),width:e.getUint16(a+7,Vo)};if(!i.has(h))return null;a+=2,a+=e.getUint16(a,Vo)}return null}function XF(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function jf(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function qF(t,e){const{mimeType:n}=Vx(t)||{},i=globalThis._parseImageNode;return xn(i),await i(t,n)}async function $F(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:a}=n||{},h=ZF(r);let l;switch(h){case"imagebitmap":l=await RF(t,e,a);break;case"image":l=await EM(t,e,a);break;case"data":l=await qF(t);break;default:xn(!1)}return r==="data"&&(l=SF(l)),l}function ZF(t){switch(t){case"auto":case"data":return EF();default:return AF(t),t}}const JF=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],KF=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],YF={image:{type:"auto",decode:!0}},TM={id:"image",module:"images",name:"Images",version:xF,mimeTypes:KF,extensions:JF,parse:$F,tests:[t=>!!Vx(new DataView(t))],options:YF},c0={};function QF(t){if(c0[t]===void 0){const e=g_?tz(t):ez(t);c0[t]=e}return c0[t]}function ez(t){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:n,_imageFormatsNode:i=e}=globalThis;return!!n&&i.includes(t)}function tz(t){switch(t){case"image/avif":case"image/webp":return nz(t);default:return!0}}function nz(t){try{return document.createElement("canvas").toDataURL(t).indexOf("data:".concat(t))===0}catch{return!1}}function SM(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Ra(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||SM()}const ng={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},ym=ng.window||ng.self||ng.global,wd=ng.process||{},CM=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Ra();const u0=globalThis;function IM(t){if(!t&&!Ra())return"Node";if(SM(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r?"IE":u0.chrome?"Chrome":u0.safari?"Safari":u0.mozInnerScreenX?"Firefox":"Unknown"}function iz(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class rz{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";L(this,"storage",void 0),L(this,"id",void 0),L(this,"config",void 0),this.storage=iz(i),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function sz(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function oz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function h0(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const a=t.width*n,h=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(h/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(h,"px;"),"background:url(".concat(r,");"),"background-size:".concat(a,"px ").concat(h,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Ng;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ng||(Ng={}));function UE(t){return typeof t=="string"?Ng[t.toUpperCase()]||Ng.WHITE:t}function az(t,e,n){return!Ra&&typeof t=="string"&&(e&&(e=UE(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=UE(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function lz(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const r of i)typeof t[r]=="function"&&(e.find(a=>r===a)||(t[r]=t[r].bind(t)))}function Ug(t,e){if(!t)throw new Error(e||"Assertion failed")}function fu(){let t;if(Ra&&"performance"in ym){var e,n;t=ym==null||(e=ym.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in wd){var i;const r=wd==null||(i=wd.hrtime)===null||i===void 0?void 0:i.call(wd);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const pu={debug:Ra&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},cz={enabled:!0,level:0};function Fs(){}const GE={},VE={once:!0};class jx{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};L(this,"id",void 0),L(this,"VERSION",CM),L(this,"_startTs",fu()),L(this,"_deltaTs",fu()),L(this,"_storage",void 0),L(this,"userData",{}),L(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new rz("__probe-".concat(this.id,"__"),cz),this.timeStamp("".concat(this.id," started")),lz(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((fu()-this._startTs).toPrecision(10))}getDelta(){return Number((fu()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Ug(e,n)}warn(e){return this._getLogFunction(0,e,pu.warn,arguments,VE)}error(e){return this._getLogFunction(0,e,pu.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,pu.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,pu.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];return this._getLogFunction(e,n,pu.debug||pu.info,arguments,VE)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||Fs,i&&[i],{tag:fz(n)}):Fs}image(e){let{logLevel:n,priority:i,image:r,message:a="",scale:h=1}=e;return this._shouldLog(n||i)?Ra?dz({image:r,message:a,scale:h}):hz():Fs}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Fs)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=jE({logLevel:e,message:n,opts:i}),{collapsed:a}=i;return r.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Fs)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=MM(e)}_getLogFunction(e,n,i,r,a){if(this._shouldLog(e)){a=jE({logLevel:e,message:n,args:r,opts:a}),i=i||a.method,Ug(i),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=fu();const h=a.tag||a.message;if(a.once)if(!GE[h])GE[h]=fu();else return Fs;return n=uz(this.id,a.message,a),i.bind(console,n,...a.args)}return Fs}}L(jx,"VERSION",CM);function MM(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Ug(Number.isFinite(e)&&e>=0),e}function jE(t){const{logLevel:e,message:n}=t;t.logLevel=MM(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return Ug(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function uz(t,e,n){if(typeof e=="string"){const i=n.time?oz(sz(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=az(e,n.color,n.background)}return e}function hz(t){return console.warn("removed"),Fs}function dz(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const a=new Image;return a.onload=()=>{const h=h0(a,n,i);console.log(...h)},a.src=e,Fs}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...h0(e,n,i)),Fs;if(r.toLowerCase()==="canvas"){const a=new Image;return a.onload=()=>console.log(...h0(a,n,i)),a.src=e.toDataURL(),Fs}return Fs}function fz(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const dn=new jx({id:"deck"});let t1={};function pz(t){t1=t}function fr(t,e,n,i){dn.level>0&&t1[t]&&t1[t].call(null,e,n,i)}function mz(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const gz={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:mz,parseTextSync:JSON.parse};function _z(){const t="8.9.18",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(dn.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:dn,_registerLoggers:pz},$k([gz,[TM,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const yz=_z(),rn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(rn,"IDENTITY",{get:()=>(dn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ho={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},n1={common:0,meters:1,pixels:2},HE={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},_t=new jx({id:"luma.gl"});function Mr(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const vz="Invalid WebGLRenderingContext",xz="Requires WebGL2";function y_(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function $t(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function bz(t){return $t(t)?t:null}function v_(t){return Mr(y_(t),vz),t}function Pr(t){return Mr($t(t),xz),t}const zd={};function wz(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function Az(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function Ez(t,e){zd[t]=!0,e!==void 0&&wz(e)}function Tz(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(zd[i]=!0);while(i!==0);for(i in zd)if(zd[i])return delete zd[i],parseInt(i,10);return 0}}const Hf=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const r=new t.VertexAttrib(n);this.attribs[i]=r}this.maxAttrib=0};Hf.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};Hf.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Dc=function(e){const n=this;this.gl=e,Tz(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(a){return a===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(a){const h=n.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,a);const l=h.attribs[a];return l.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(a){const h=n.currentVertexArrayObject;h.maxAttrib=Math.max(h.maxAttrib,a);const l=h.attribs[a];return l.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(a,h){switch(a){case 34962:n.currentArrayBuffer=h;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=h;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(a,h){const y=n.currentVertexArrayObject.attribs[a];switch(h){case 34975:return y.buffer;case 34338:return y.enabled;case 34339:return y.size;case 34340:return y.stride;case 34341:return y.type;case 34922:return y.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(a,h,l,y,x,T){const C=n.currentVertexArrayObject;C.maxAttrib=Math.max(C.maxAttrib,a);const S=C.attribs[a];return S.buffer=n.currentArrayBuffer,S.size=h,S.type=l,S.normalized=y,S.stride=x,S.offset=T,S.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{Az("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Dc.prototype.VERTEX_ARRAY_BINDING_OES=34229;Dc.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new Hf(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Dc.prototype.createVertexArrayOES=function(){const e=new Hf(this);return this.vertexArrayObjects.push(e),e};Dc.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Dc.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Hf&&e.hasBeenBound&&e.ext===this)};Dc.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){Ez(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const a=this.currentVertexArrayObject;if(r===a)return;(!r||a.elementArrayBuffer!==r.elementArrayBuffer)&&i.bindBuffer.call(n,34963,a.elementArrayBuffer);let h=this.currentArrayBuffer;const l=Math.max(r?r.maxAttrib:0,a.maxAttrib);for(let y=0;y<=l;y++){const x=a.attribs[y],T=r?r.attribs[y]:null;if((!r||x.enabled!==T.enabled)&&(x.enabled?i.enableVertexAttribArray.call(n,y):i.disableVertexAttribArray.call(n,y)),x.enabled){let C=!1;(!r||x.buffer!==T.buffer)&&(h!==x.buffer&&(i.bindBuffer.call(n,34962,x.buffer),h=x.buffer),C=!0),(C||x.cached!==T.cached)&&i.vertexAttribPointer.call(n,y,x.size,x.type,x.normalized,x.stride,x.offset)}}this.currentArrayBuffer!==h&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function Sz(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const n=t.getExtension;t.getExtension=function(r){const a=n.call(this,r);return a||(r!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Dc(this)),this.__OESVertexArrayObject))}}const WE="OES_element_index",XE="WEBGL_draw_buffers",Cz="EXT_disjoint_timer_query",Iz="EXT_disjoint_timer_query_webgl2",Mz="EXT_texture_filter_anisotropic",qE="WEBGL_debug_renderer_info",Pz=35723,Bz=4352,Lz=36795,Rz=34047,Dz=37445,Oz=37446,Rn=t=>$t(t)?void 0:0,kz={[3074]:t=>$t(t)?void 0:36064,[Pz]:t=>$t(t)?void 0:Bz,[35977]:Rn,[32937]:Rn,[Lz]:(t,e)=>{const n=$t(t)?t.getExtension(Iz):t.getExtension(Cz);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[Dz]:(t,e)=>{const n=t.getExtension(qE);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[Oz]:(t,e)=>{const n=t.getExtension(qE);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[Rz]:(t,e)=>{const n=t.luma.extensions[Mz];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:Rn,[35071]:Rn,[37447]:Rn,[36063]:(t,e)=>{if(!$t(t)){const n=t.getExtension(XE);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:Rn,[35374]:Rn,[35377]:Rn,[34852]:t=>{if(!$t(t)){const e=t.getExtension(XE);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(WE)?2147483647:65535,[33001]:t=>t.getExtension(WE)?16777216:65535,[33e3]:t=>16777216,[37157]:Rn,[35373]:Rn,[35657]:Rn,[36183]:Rn,[37137]:Rn,[34045]:Rn,[35978]:Rn,[35979]:Rn,[35968]:Rn,[35376]:Rn,[35375]:Rn,[35659]:Rn,[37154]:Rn,[35371]:Rn,[35658]:Rn,[35076]:Rn,[35077]:Rn,[35380]:Rn};function Fz(t,e,n){const i=kz[n],r=typeof i=="function"?i(t,e,n):i;return r!==void 0?r:e(n)}const zz="OES_vertex_array_object",PM="ANGLE_instanced_arrays",Nz="WEBGL_draw_buffers",Uz="EXT_disjoint_timer_query",Gz="EXT_texture_filter_anisotropic",Vz="VertexArray requires WebGL2 or OES_vertex_array_object extension";function jz(t,e){return{webgl2:$t(t),ext:t.getExtension(e)}}const BM={[zz]:{meta:{suffix:"OES"},createVertexArray:()=>{Mr(!1,Vz)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[PM]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Mr(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[Nz]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Mr(!1)}},[Uz]:{meta:{suffix:"EXT"},createQuery:()=>{Mr(!1)},deleteQuery:()=>{Mr(!1)},beginQuery:()=>{Mr(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},d0={readBuffer:(t,e,n)=>{$t(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:r,ext:a}=jz(t,PM);let h;switch(i){case 35069:h=r?void 0:!1;break;case 35070:h=!r&&!a?0:void 0;break}return h!==void 0?h:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!$t(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,r)=>{if(!$t(t))switch(r){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,r)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:r}=t.luma,a=r[Gz];i=a&&a.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:Fz,hint(t,e,n,i){return e(n,i)}};function Hz(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(Sz(t),Wz(t),qz(t,BM),Xz(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=Hz;function Wz(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function Xz(t,e){let{target:n,target2:i}=e;Object.keys(d0).forEach(r=>{if(typeof d0[r]=="function"){const a=t[r]?t[r].bind(t):()=>{},h=d0[r].bind(null,t,a);n[r]=h,i[r]=h}})}function qz(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&$z(t,{extension:n,target:t.luma,target2:t})}function $z(t,e){let{extension:n,target:i,target2:r}=e;const a=BM[n];Mr(a);const{meta:h={}}=a,{suffix:l=""}=h,y=t.getExtension(n);for(const x of Object.keys(a)){const T="".concat(x).concat(l);let C=null;x==="meta"||typeof t[x]=="function"||(y&&typeof y[T]=="function"?C=function(){return y[T](...arguments)}:typeof a[x]=="function"&&(C=a[x].bind(i))),C&&(i[x]=C,r[x]=C)}}const Hx={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},nl=(t,e,n)=>e?t.enable(n):t.disable(n),$E=(t,e,n)=>t.hint(n,e),ls=(t,e,n)=>t.pixelStorei(n,e),Zz=(t,e)=>{const n=$t(t)?36009:36160;return t.bindFramebuffer(n,e)},Jz=(t,e)=>t.bindFramebuffer(36008,e);function Ad(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const Kz={[3042]:nl,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:nl,[2885]:(t,e)=>t.cullFace(e),[2929]:nl,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:nl,[35723]:$E,[36006]:Zz,[2886]:(t,e)=>t.frontFace(e),[33170]:$E,[2849]:(t,e)=>t.lineWidth(e),[32823]:nl,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:nl,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:nl,[3088]:(t,e)=>t.scissor(...e),[2960]:nl,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:ls,[3317]:ls,[37440]:ls,[37441]:ls,[37443]:ls,[3330]:ls,[3332]:ls,[3331]:ls,[36010]:Jz,[3314]:ls,[32878]:ls,[3316]:ls,[3315]:ls,[32877]:ls,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=Ad(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=Ad(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Ad(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=Ad(e)&&e.length===3?[...e,...e]:e;const[n,i,r,a,h,l]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,a,h,l)},stencilOp:(t,e)=>{e=Ad(e)&&e.length===3?[...e,...e]:e;const[n,i,r,a,h,l]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,a,h,l)},viewport:(t,e)=>t.viewport(...e)};function ii(t,e,n){return e[t]!==void 0?e[t]:n[t]}const Yz={blendEquation:(t,e,n)=>t.blendEquationSeparate(ii(32777,e,n),ii(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(ii(32969,e,n),ii(32968,e,n),ii(32971,e,n),ii(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(ii(32824,e,n),ii(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(ii(32938,e,n),ii(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,ii(2962,e,n),ii(2967,e,n),ii(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,ii(34816,e,n),ii(36003,e,n),ii(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,ii(2964,e,n),ii(2965,e,n),ii(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,ii(34817,e,n),ii(34818,e,n),ii(34819,e,n))},ZE={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,i,r)=>t({[32773]:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,i,r)=>t({[32969]:e,[32968]:n,[32971]:i,[32970]:r}),clearColor:(t,e,n,i,r)=>t({[3106]:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,i,r)=>t({[3107]:[e,n,i,r]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,i,r)=>t({[3088]:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({[2962]:e,[2967]:n,[2963]:i,[34816]:e,[36003]:n,[36004]:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({[2964]:e,[2965]:n,[2966]:i,[34817]:e,[34818]:n,[34819]:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({[2978]:[e,n,i,r]})},ko=(t,e)=>t.isEnabled(e),JE={[3042]:ko,[2884]:ko,[2929]:ko,[3024]:ko,[32823]:ko,[32926]:ko,[32928]:ko,[3089]:ko,[2960]:ko,[35977]:ko};function LM(t){for(const e in t)return!1;return!0}function Qz(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}function KE(t,e){const n=t[e].bind(t);t[e]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in t.state.cache?t.state.enable?t.state.cache[r]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function eN(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var a=arguments.length,h=new Array(a),l=0;l<a;l++)h[l]=arguments[l];const{valueChanged:y,oldValue:x}=n(t.state._updateCache,...h);return y&&i(...h),x},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function tN(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class nN{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?rN(e):Object.assign({},Hx),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Mr(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Ma(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const a in e){Mr(a!==void 0);const h=e[a],l=this.cache[a];Qz(h,l)||(n=!0,i=l,r&&!(a in r)&&(r[a]=l),this.cache[a]=h)}return{valueChanged:n,oldValue:i}}}function RM(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(Mr(i!==void 0),!t.state){const{polyfillContext:r}=globalThis;r&&r(t),t.state=new nN(t,{copyState:i}),tN(t);for(const a in ZE){const h=ZE[a];eN(t,a,h)}KE(t,"getParameter"),KE(t,"isEnabled")}return t.state.enable=n,t}function iN(t){t.state||RM(t,{copyState:!1}),t.state.push()}function YE(t){Mr(t.state),t.state.pop()}function Ma(t,e){if(Mr(y_(t),"setParameters requires a WebGL context"),LM(e))return;const n={};for(const r in e){const a=Number(r),h=Kz[r];h&&(typeof h=="string"?n[h]=!0:h(t,e[r],a))}const i=t.state&&t.state.cache;if(i)for(const r in n){const a=Yz[r];a(t,e,i)}}function rN(t,e){if(e=e||Hx,typeof e=="number"){const r=e,a=JE[r];return a?a(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const a=JE[r];i[r]=a?a(t,Number(r)):t.getParameter(Number(r))}return i}function sN(t){Ma(t,Hx)}function mo(t,e,n){if(LM(e))return n(t);const{nocatch:i=!0}=e;iN(t),Ma(t,e);let r;if(i)r=n(t),YE(t);else try{r=n(t)}finally{YE(t)}return r}function ih(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,i="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return i?t.drawingBufferWidth/i:1}return 1}function f0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=ih(t),r=t.drawingBufferWidth,a=t.drawingBufferHeight;return aN(e,i,r,a,n)}function oN(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function aN(t,e,n,i,r){const a=QE(t[0],e,n);let h=eT(t[1],e,i,r),l=QE(t[0]+1,e,n);const y=l===n-1?l:l-1;l=eT(t[1]+1,e,i,r);let x;return r?(l=l===0?l:l+1,x=h,h=l):x=l===i-1?l:l-1,{x:a,y:h,width:Math.max(y-a+1,1),height:Math.max(x-h+1,1)}}function QE(t,e,n){return Math.min(Math.round(t*e),n-1)}function eT(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Wx=Ra(),lN=Wx&&typeof document<"u",DM={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function OM(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Mr(Wx,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},DM,t);const{width:e,height:n}=t;function i(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=i;let r;const{canvas:a}=t,h=dN({canvas:a,width:e,height:n,onError:i});return r=hN(h,t),r?(r=Xx(r,t),fN(r),r):null}function Xx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||pN(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},DM,e);const{manageState:n,debug:i}=e;return n&&RM(t,{copyState:!1,log:function(){for(var r=arguments.length,a=new Array(r),h=0;h<r;h++)a[h]=arguments[h];return _t.log(1,...a)()}}),Wx&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),_t.level=Math.max(_t.level,1)):_t.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function cN(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),r=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),a=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||e,renderer:a||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function uN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=oN(e.useDevicePixels);mN(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function hN(t,e){const{onError:n}=e;let i=null;const r=y=>i=y.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:a=!0,webgl2:h=!0}=e;let l=null;return h&&(l=l||t.getContext("webgl2",e),l=l||t.getContext("experimental-webgl2",e)),a&&(l=l||t.getContext("webgl",e),l=l||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),l?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):n("Failed to create ".concat(h&&!a?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function dN(t){let{canvas:e,width:n=800,height:i=600,onError:r}=t,a;return typeof e=="string"?(lN&&document.readyState==="complete"||r("createGLContext called on canvas '".concat(e,"' before page was loaded")),a=document.getElementById(e)):e?a=e:(a=document.createElement("canvas"),a.id="lumagl-canvas",a.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",a.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(a,document.body.firstChild)),a}function fN(t){const e=$t(t)?"WebGL2":"WebGL1",n=cN(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";_t.info(1,"".concat(e).concat(r," context ").concat(i))()}function pN(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function mN(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,r="height"in n?n.height:t.canvas.clientHeight;(!i||!r)&&(_t.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,r=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const a=t.luma.canvasSizeInfo;if(a.clientWidth!==i||a.clientHeight!==r||a.devicePixelRatio!==e){let h=e;const l=Math.floor(i*h),y=Math.floor(r*h);t.canvas.width=l,t.canvas.height=y,(t.drawingBufferWidth!==l||t.drawingBufferHeight!==y)&&(_t.warn("Device pixel ratio clamped")(),h=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*h),t.canvas.height=Math.floor(r*h)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}function tT(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}let nT=class{constructor(e,n){L(this,"name",void 0),L(this,"type",void 0),L(this,"sampleSize",1),L(this,"time",void 0),L(this,"count",void 0),L(this,"samples",void 0),L(this,"lastTiming",void 0),L(this,"lastSampleTime",void 0),L(this,"lastSampleCount",void 0),L(this,"_count",0),L(this,"_time",0),L(this,"_samples",0),L(this,"_startTime",0),L(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=tT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(tT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},qx=class{constructor(e){L(this,"id",void 0),L(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof nT?this.stats[n]=e:this.stats[n]=new nT(n,i)),this.stats[n]}};const Yd="8.5.20",gN="set luma.log.level=1 (or higher) to trace rendering";class _N{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new qx({id:e})),this.stats.get(e)}}const gc=new _N;if(globalThis.luma&&globalThis.luma.VERSION!==Yd)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Yd));globalThis.luma||(Ra()&&_t.log(1,"luma.gl ".concat(Yd," - ").concat(gN))(),globalThis.luma=globalThis.luma||{VERSION:Yd,version:Yd,log:_t,stats:gc,globals:{modules:{},nodeIO:{}}});function yN(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function vN(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function lt(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function p0(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return lt(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function Tl(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const m0={};function Pa(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";m0[t]=m0[t]||1;const e=m0[t]++;return"".concat(t,"-").concat(e)}function iT(t){return lt(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function rh(t){let e=!0;for(const n in t){e=!1;break}return e}function kM(t,e,n,i){const r="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),a=Object.getPrototypeOf(t);i.forEach(h=>{a.methodName||(a[h]=()=>{throw _t.removed("Calling removed method ".concat(e,".").concat(h,": "),r)(),new Error(h)})})}const mu="Resource subclass must define virtual methods";let Da=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};v_(e);const{id:i,userData:r={}}=n;this.gl=e,this.gl2=e,this.id=i||Pa(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=p0(this.gl,e),lt(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const a=$t(this.gl);if(!((!("webgl2"in r)||a)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const l=r.webgl1,y="webgl2"in r?r.webgl2:r.webgl1;return a?y:l}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,r=this.constructor.PARAMETERS||{},a=$t(this.gl),h={},l=n||Object.keys(r);for(const y of l){const x=r[y];if(x&&(!("webgl2"in x)||a)&&(!("extension"in x)||this.gl.getExtension(x.extension))){const C=i?Tl(this.gl,y):y;h[C]=this.getParameter(y,e),i&&x.type==="GLenum"&&(h[C]=Tl(this.gl,h[C]))}}return h}setParameter(e,n){e=p0(this.gl,e),lt(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const a=$t(this.gl);if(!((!("webgl2"in r)||a)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(n=p0(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return kM(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(mu)}_deleteHandle(){throw new Error(mu)}_bindHandle(e){throw new Error(mu)}_getOptsFromHandle(){throw new Error(mu)}_getParameter(e,n){throw new Error(mu)}_setParameter(e,n){throw new Error(mu)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=gc.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];gc.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const r=gc.get("Memory Usage".concat(i));r.get("GPU Memory").addCount(e),r.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=gc.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const xN="Failed to deduce GL constant from typed array";function i1(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(xN)}}function Ef(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function bN(t){let{data:e,width:n,height:i,bytesPerPixel:r=4,temp:a}=t;const h=n*r;a=a||new Uint8Array(h);for(let l=0;l<i/2;++l){const y=l*h,x=(i-l-1)*h;a.set(e.subarray(y,y+h)),e.copyWithin(y,x,x+h),e.set(a,x)}}function wN(t){let{data:e,width:n,height:i}=t;const r=Math.round(n/2),a=Math.round(i/2),h=new Uint8Array(r*a*4);for(let l=0;l<a;l++)for(let y=0;y<r;y++)for(let x=0;x<4;x++)h[(l*r+y)*4+x]=e[(l*2*n+y*2)*4+x];return{data:h,width:r,height:a}}function r1(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:a={}}=n;for(const l in i)if(l in e){const x=i[l]?"".concat(t,".").concat(i[l]):"N/A";_t.removed("".concat(t,".").concat(l),x)()}for(const l in r)if(l in e){const y=r[l];_t.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(y))()}let h=null;for(const l in a)if(l in e){const y=a[l];_t.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(y))(),h=h||Object.assign({},e),h[y]=e[l],delete h[l]}return h||e}const AN={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},EN={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class jr{static getBytesPerElement(e){return Ef(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return lt(e.size),Ef(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new jr(AN,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return jr.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return jr.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=r1("Accessor",e,EN),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const rT=10,FM={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},TN={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:FM},SN={removedProps:FM};class Sn extends Da{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/jr.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/jr.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=r1("Buffer",e,TN),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=r1("Buffer",e,SN),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new jr(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:r=0}=e,a=e.byteLength||e.length;lt(n);const h=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(h,this.handle),r!==0||a!==void 0?(Pr(this.gl),this.gl.bufferSubData(this.target,i,n,r,a)):this.gl.bufferSubData(h,i,n),this.gl.bindBuffer(h,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:r=0,size:a}=e;const{gl:h}=this;return Pr(h),h.bindBuffer(36662,n.handle),h.bindBuffer(36663,this.handle),h.copyBufferSubData(36662,36663,i,r,a),h.bindBuffer(36662,null),h.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Pr(this.gl);const a=Ef(this.accessor.type||5126,{clamped:!1}),h=this._getAvailableElementCount(n),l=i;let y,x;e?(x=e.length,y=x-l):(y=Math.min(h,r||h),x=l+y);const T=Math.min(h,y);return r=r||T,lt(r<=T),e=e||new a(x),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,r),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?r!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,r):(lt(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(rT,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;lt(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,n,e),this.gl.bindBuffer(r,null),this.debugData=e.slice(0,rT),this.bytesUsed=i,this._trackAllocatedMemory(i);const a=i1(e);return lt(a),this.setAccessor(new jr(this.accessor,{type:a})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;lt(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,n),this.gl.bindBuffer(r,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Ef(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new jr(this.accessor,{type:i1(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return _t.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return _t.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return _t.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return _t.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new jr(this.accessor,e),this}}const $x={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},zM={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},NM={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function CN(t,e){const n=$x[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=$t(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function IN(t,e){const n=$x[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const MN=[9729,9728],sT=globalThis.WebGLBuffer||function(){};class sh extends Da{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:r}=n;let a=!0;return i&&(a=a&&CN(e,i),a=a&&(!r||IN(e,i))),a}constructor(e,n){const{id:i=Pa("texture"),handle:r,target:a}=n;super(e,{id:i,handle:r}),this.target=a,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(j=>this.initialize(Object.assign({},e,{pixels:j,data:j}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:r=null,format:a=6408,border:h=0,recreate:l=!1,parameters:y={},pixelStore:x={},textureUnit:T=void 0}=e;n||(n=r);let{width:C,height:S,dataFormat:z,type:V,compressed:Z=!1,mipmaps:ue=!0}=e;const{depth:q=0}=e;return{width:C,height:S,compressed:Z,dataFormat:z,type:V}=this._deduceParameters({format:a,type:V,dataFormat:z,compressed:Z,data:n,width:C,height:S}),this.width=C,this.height=S,this.depth=q,this.format=a,this.type=V,this.dataFormat=z,this.border=h,this.textureUnit=T,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),ue&&this._isNPOT()&&(_t.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),ue=!1,this._updateForNPOT(y)),this.mipmaps=ue,this.setImageData({data:n,width:C,height:S,depth:q,format:a,type:V,dataFormat:z,border:h,mipmaps:ue,parameters:x,compressed:Z}),ue&&this.generateMipmap(),this.setParameters(y),l&&(this.data=n),i&&(this._video={video:n,parameters:y,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:r=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(_t.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),mo(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:r=0,format:a=this.format,border:h=this.border,offset:l=0,parameters:y={}}=e;let{data:x=null,type:T=this.type,width:C=this.width,height:S=this.height,dataFormat:z=this.dataFormat,compressed:V=!1}=e;x||(x=i),{type:T,dataFormat:z,compressed:V,width:C,height:S}=this._deduceParameters({format:a,type:T,dataFormat:z,compressed:V,data:x,width:C,height:S});const{gl:Z}=this;Z.bindTexture(this.target,this.handle);let ue=null;({data:x,dataType:ue}=this._getDataType({data:x,compressed:V}));let q,j=0;if(mo(this.gl,y,()=>{switch(ue){case"null":Z.texImage2D(n,r,a,C,S,h,z,T,x);break;case"typed-array":Z.texImage2D(n,r,a,C,S,h,z,T,x,l);break;case"buffer":q=Pr(Z),q.bindBuffer(35052,x.handle||x),q.texImage2D(n,r,a,C,S,h,z,T,l),q.bindBuffer(35052,null);break;case"browser-object":$t(Z)?Z.texImage2D(n,r,a,C,S,h,z,T,x):Z.texImage2D(n,r,a,z,T,x);break;case"compressed":for(const[K,de]of x.entries())Z.compressedTexImage2D(n,K,de.format,de.width,de.height,h,de.data),j+=de.levelSize;break;default:lt(!1,"Unknown image data type")}}),ue==="compressed")this._trackAllocatedMemory(j,"Texture");else if(x&&x.byteLength)this._trackAllocatedMemory(x.byteLength,"Texture");else{const K=zM[this.dataFormat]||4,de=NM[this.type]||1;this._trackAllocatedMemory(this.width*this.height*K*de,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:r=null,x:a=0,y:h=0,width:l=this.width,height:y=this.height,level:x=0,format:T=this.format,type:C=this.type,dataFormat:S=this.dataFormat,compressed:z=!1,offset:V=0,border:Z=this.border,parameters:ue={}}=e;if({type:C,dataFormat:S,compressed:z,width:l,height:y}=this._deduceParameters({format:T,type:C,dataFormat:S,compressed:z,data:r,width:l,height:y}),lt(this.depth===0,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const q=r;r=q.data,l=q.shape[0],y=q.shape[1]}r instanceof Sn&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),mo(this.gl,ue,()=>{if(z)this.gl.compressedTexSubImage2D(n,x,a,h,l,y,T,r);else if(r===null)this.gl.texSubImage2D(n,x,a,h,l,y,S,C,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(n,x,a,h,l,y,S,C,r,V);else if(r instanceof sT){const q=Pr(this.gl);q.bindBuffer(35052,r),q.texSubImage2D(n,x,a,h,l,y,S,C,V),q.bindBuffer(35052,null)}else $t(this.gl)?Pr(this.gl).texSubImage2D(n,x,a,h,l,y,S,C,r):this.gl.texSubImage2D(n,x,a,h,S,C,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return _t.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof Sn?{data:n.handle,dataType:"buffer"}:n instanceof sT?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:r,height:a,dataFormat:h,type:l,compressed:y}=e;const x=$x[n];return h=h||x&&x.dataFormat,l=l||x&&x.types[0],y=y||x&&x.compressed,{width:r,height:a}=this._deduceImageSize(i,r,a),{dataFormat:h,type:l,compressed:y,width:r,height:a,format:n,data:i}}_deduceImageSize(e,n,i){let r;return typeof ImageData<"u"&&e instanceof ImageData?r={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?r={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?r={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?r={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?r={width:e.videoWidth,height:e.videoHeight}:e?r={width:n,height:i}:r={width:n>=0?n:1,height:i>=0?i:1},lt(r,"Could not deduced texture size"),lt(n===void 0||r.width===n,"Deduced texture width does not match supplied width"),lt(i===void 0||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:lt(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return $t(this.gl)||!this.width||!this.height?!1:!iT(this.width)||!iT(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:MN.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let PN="";function BN(t,e){return lt(typeof t=="string"),t=PN+t,new Promise((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),r.crossOrigin=e&&e.crossOrigin||"anonymous",r.src=t}catch(r){i(r)}})}class xs extends sh{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return sh.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};v_(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:BN(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const s1=[34069,34070,34071,34072,34073,34074];class UM extends sh{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};v_(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:r=0,y:a=0,mipmapLevel:h=0}=e;return this._subImage({target:n,data:i,x:r,y:a,mipmapLevel:h})}async setCubeMapImageData(e){let{width:n,height:i,pixels:r,data:a,border:h=0,format:l=6408,type:y=5121}=e;const{gl:x}=this,T=r||a,C=await Promise.all(s1.map(S=>{const z=T[S];return Promise.all(Array.isArray(z)?z:[z])}));this.bind(),s1.forEach((S,z)=>{C[z].length>1&&this.opts.mipmaps!==!1&&_t.warn("".concat(this.id," has mipmap and multiple LODs."))(),C[z].forEach((V,Z)=>{n&&i?x.texImage2D(S,Z,l,n,i,h,l,y,V):x.texImage2D(S,Z,l,l,y,V)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:r,pixels:a,data:h,border:l=0,format:y=6408,type:x=5121}=e,{gl:T}=this,C=a||h;return this.bind(),C instanceof Promise?C.then(S=>this.setImageDataForFace(Object.assign({},e,{face:n,data:S,pixels:S}))):this.width||this.height?T.texImage2D(n,0,y,i,r,l,y,x,C):T.texImage2D(n,0,y,y,x,C),this}}UM.FACES=s1;class LN extends sh{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return $t(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Pr(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:r,height:a,depth:h=1,border:l=0,format:y,type:x=5121,offset:T=0,data:C,parameters:S={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),mo(this.gl,S,()=>{ArrayBuffer.isView(C)&&this.gl.texImage3D(this.target,n,i,r,a,h,l,y,x,C),C instanceof Sn&&(this.gl.bindBuffer(35052,C.handle),this.gl.texImage3D(this.target,n,i,r,a,h,l,y,x,T))}),C&&C.byteLength)this._trackAllocatedMemory(C.byteLength,"Texture");else{const z=zM[this.dataFormat]||4,V=NM[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*z*V,"Texture")}return this.loaded=!0,this}}const oc="EXT_color_buffer_float",oT={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:oc,bpp:2},[33327]:{gl2:oc,bpp:4},[34842]:{gl2:oc,bpp:8},[33326]:{gl2:oc,bpp:4},[33328]:{gl2:oc,bpp:8},[34836]:{gl2:oc,bpp:16},[35898]:{gl2:oc,bpp:4}};function RN(t,e,n){const i=n[e];if(!i)return!1;const r=$t(t)&&i.gl2||i.gl1;return typeof r=="string"?t.getExtension(r):r}class ku extends Da{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||RN(e,n,oT)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:r=1,samples:a=0}=e;return lt(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),a!==0&&$t(this.gl)?this.gl.renderbufferStorageMultisample(36161,a,n,i,r):this.gl.renderbufferStorage(36161,n,i,r),this.format=n,this.width=i,this.height=r,this.samples=a,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*oT[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const DN=256,ON=1024,kN=16384,aT=6144,lT=6145,cT=6146,uT=34041,GM="clear: bad arguments";function Zx(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:r=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a={};e&&(a.framebuffer=e);let h=0;n&&(h|=kN,n!==!0&&(a.clearColor=n)),i&&(h|=DN,i!==!0&&(a.clearDepth=i)),r&&(h|=ON,i!==!0&&(a.clearStencil=i)),lt(h!==0,GM),mo(t,a,()=>{t.clear(h)})}function FN(t){let{framebuffer:e=null,buffer:n=aT,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Pr(t),mo(t,{framebuffer:e},()=>{switch(n){case aT:switch(r.constructor){case Int32Array:t.clearBufferiv(n,i,r);break;case Uint32Array:t.clearBufferuiv(n,i,r);break;case Float32Array:default:t.clearBufferfv(n,i,r)}break;case lT:t.clearBufferfv(lT,0,[r]);break;case cT:t.clearBufferiv(cT,0,[r]);break;case uT:const[a,h]=r;t.clearBufferfi(uT,0,a,h);break;default:lt(!1,GM)}})}function zN(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return lt(!1),0}}function x_(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:a=36064,target:h=null,sourceWidth:l,sourceHeight:y,sourceType:x}=e;const{framebuffer:T,deleteFramebuffer:C}=NN(t);lt(T);const{gl:S,handle:z,attachments:V}=T;l=l||T.width,y=y||T.height,a===36064&&z===null&&(a=1028),lt(V[a]),x=x||V[a].type,h=UN(h,x,r,l,y),x=x||i1(h);const Z=S.bindFramebuffer(36160,z);return S.readPixels(n,i,l,y,r,x,h),S.bindFramebuffer(36160,Z||null),C&&T.delete(),h}function hT(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=x_(t,{sourceAttachment:e}),{width:r,height:a}=t;for(;a>n;)({data:i,width:r,height:a}=wN({data:i,width:r,height:a}));bN({data:i,width:r,height:a});const h=document.createElement("canvas");h.width=r,h.height=a;const l=h.getContext("2d"),y=l.createImageData(r,a);return y.data.set(i),l.putImageData(y,0,0),h.toDataURL()}function NN(t){return t instanceof Ri?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:ZN(t),deleteFramebuffer:!0}}function UN(t,e,n,i,r){if(t)return t;e=e||5121;const a=Ef(e,{clamped:!1}),h=zN(n);return new a(i*r*h)}const Dn={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function GN(t){const e=new xs(t,{format:6408,type:5126,dataFormat:6408}),n=new Ri(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const VM={[Dn.WEBGL2]:[!1,!0],[Dn.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Dn.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Dn.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Dn.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Dn.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Dn.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Dn.FLOAT_BLEND]:["EXT_float_blend"],[Dn.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Dn.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Dn.TEXTURE_FLOAT]:["OES_texture_float",!0],[Dn.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Dn.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Dn.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Dn.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Dn.COLOR_ATTACHMENT_RGBA32F]:[GN,"EXT_color_buffer_float"],[Dn.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Dn.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Dn.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Dn.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Dn.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Dn.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},VN=2;function Jx(t,e){return jM(t,e)}function jM(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>HM(t,n))}function jN(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in VM)t.luma.caps[e]===void 0&&(t.luma.caps[e]=HM(t,e));return t.luma.caps}function HM(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=HN(t,e)),t.luma.caps[e]||_t.log(VN,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function HN(t,e){const n=VM[e];lt(n,e);let i;const r=$t(t)&&n[1]||n[0];if(typeof r=="function")i=r(t);else if(Array.isArray(r)){i=!0;for(const a of r)i=i&&!!t.getExtension(a)}else typeof r=="string"?i=!!t.getExtension(r):typeof r=="boolean"?i=r:lt(!1);return i}const dT="Multiple render targets not supported";class Ri extends Da{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:r}=n;let a=!0;return i&&(a=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(a=a&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),a}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Ri(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Pr(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Pr(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:r=null,color:a=!0,depth:h=!0,stencil:l=!1,check:y=!0,readBuffer:x=void 0,drawBuffers:T=void 0}=e;if(lt(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,r)for(const C in r){const S=r[C];(Array.isArray(S)?S[0]:S).resize({width:n,height:i})}else r=this._createDefaultAttachments(a,h,l,n,i);this.update({clearAttachments:!0,attachments:r,readBuffer:x,drawBuffers:T}),r&&y&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:r,clearAttachments:a=!1,resizeAttachments:h=!0}=e;this.attach(n,{clearAttachments:a,resizeAttachments:h});const{gl:l}=this,y=l.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),l.bindFramebuffer(36160,y||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return lt(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&_t.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const r in this.attachments)this.attachments[r].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r={};n&&Object.keys(this.attachments).forEach(h=>{r[h]=null}),Object.assign(r,e);const a=this.gl.bindFramebuffer(36160,this.handle);for(const h in r){lt(h!==void 0,"Misspelled framebuffer binding point?");const l=Number(h),y=r[l];let x=y;if(!x)this._unattach(l);else if(x instanceof ku)this._attachRenderbuffer({attachment:l,renderbuffer:x});else if(Array.isArray(y)){const[T,C=0,S=0]=y;x=T,this._attachTexture({attachment:l,texture:T,layer:C,level:S})}else this._attachTexture({attachment:l,texture:x,layer:0,level:0});i&&x&&x.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,a||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(h=>!this.attachments[h]).forEach(h=>{delete this.attachments[h]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(XN(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:r,drawBuffers:a=[]}=e,h=this.gl.bindFramebuffer(36160,this.handle);return(n||i||r)&&Zx(this.gl,{color:n,depth:i,stencil:r}),a.forEach((l,y)=>{FN(this.gl,{drawBuffer:y,value:l})}),this.gl.bindFramebuffer(36160,h||null),this}readPixels(){return _t.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return _t.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return _t.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return _t.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return _t.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return _t.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:r=0,width:a,height:h}=e;const l=Pr(this.gl),y=l.bindFramebuffer(36008,this.handle);return i===0&&r===0&&a===void 0&&h===void 0?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,i,r,a,h),l.bindFramebuffer(36008,y),this}getAttachmentParameter(e,n,i){let r=this._getAttachmentParameterFallback(n);return r===null&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=Tl(this.gl,r)),r}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const a of i){const h=n?Tl(this.gl,a):a;r[h]=this.getAttachmentParameter(e,a,n)}return r}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const r of n){const a=Number(r),h=e?Tl(this.gl,a):a;i[h]=this.getAttachmentParameters(a,e)}return i}show(){return typeof window<"u"&&window.open(hT(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>_t.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=hT(this,{targetMaxHeight:100});return _t.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,r,a){let h=null;return e&&(h=h||{},h[36064]=new xs(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:a,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(h[36064])),n&&i?(h=h||{},h[33306]=new ku(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(h[33306])):n?(h=h||{},h[36096]=new ku(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:a}),this.ownResources.push(h[36096])):i&&lt(!1),h}_unattach(e){const n=this.attachments[e];n&&(n instanceof ku?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:r}=this;r.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:r,level:a}=e;const{gl:h}=this;switch(h.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:Pr(h).framebufferTextureLayer(36160,n,i.target,a,r);break;case 34067:const y=WN(r);h.framebufferTexture2D(36160,n,y,i.handle,a);break;case 3553:h.framebufferTexture2D(36160,n,3553,i.handle,a);break;default:lt(!1,"Illegal texture type")}h.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=bz(this.gl);n?n.readBuffer(e):lt(e===36064||e===1029,dT),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=Pr(n);if(i)i.drawBuffers(e);else{const r=n.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(e):lt(e.length===1&&(e[0]===36064||e[0]===1029),dT)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=jN(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function WN(t){return t<34069?t+34069:t}function XN(t){return(Ri.STATUS||{})[t]||"Framebuffer error ".concat(t)}const qN=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Ri.ATTACHMENT_PARAMETERS=qN;function $N(t,e){lt(t instanceof xs||t instanceof UM||t instanceof LN);const n=t.constructor,{gl:i,width:r,height:a,format:h,type:l,dataFormat:y,border:x,mipmaps:T}=t,C=Object.assign({width:r,height:a,format:h,type:l,dataFormat:y,border:x,mipmaps:T},e);return new n(i,C)}function ZN(t,e){const{gl:n,width:i,height:r,id:a}=t;return new Ri(n,Object.assign({},e,{id:"framebuffer-for-".concat(a),width:i,height:r,attachments:{[36064]:t}}))}function ig(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const JN=35632,KN=35633;function YN(t){switch(t){case JN:return"fragment";case KN:return"vertex";default:return"unknown type"}}function QN(t,e,n,i){const r=t.split(/\r?\n/),a={},h={},l=i||ig(e)||"(unnamed)",y="".concat(YN(n)," shader ").concat(l);for(let T=0;T<r.length;T++){const C=r[T];if(C.length<=1)continue;const S=C.split(":"),z=S[0],V=parseInt(S[2],10);if(isNaN(V))throw new Error("GLSL compilation error in ".concat(y,": ").concat(t));z!=="WARNING"?a[V]=C:h[V]=C}const x=eU(e);return{shaderName:y,errors:fT(a,x),warnings:fT(h,x)}}function fT(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(r,`
`),t[i+1])){const a=t[i+1],h=a.split(":",3),l=h[0],y=parseInt(h[1],10)||0,x=a.substring(h.join(":").length+1).trim();n+=WM("^^^ ".concat(l,": ").concat(x,`

`),y)}}return n}function eU(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((a,h)=>{const l=String(h+e),y=l.length;return WM(l,r-y)+n+a})}function WM(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function XM(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const tU="Shader: GLSL source code must be a JavaScript string";class Tf extends Da{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return lt(!1),"unknown"}}constructor(e,n){v_(e),lt(typeof n.source=="string",tU);const i=ig(n.source,null)||n.id||Pa("unnamed ".concat(Tf.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=ig(n,null);i&&(this.id=Pa(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Tf.getTypeName(this.shaderType),":").concat(this.id)}getName(){return ig(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:a,warnings:h}=QN(i,this.source,this.shaderType,this.id);throw _t.error("GLSL compilation errors in ".concat(r,`
`).concat(a))(),_t.warn("GLSL compilation warnings in ".concat(r,`
`).concat(h))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class g0 extends Tf{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class _0 extends Tf{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const nU={[5126]:kn.bind(null,"uniform1fv",cs,1,hr),[35664]:kn.bind(null,"uniform2fv",cs,2,hr),[35665]:kn.bind(null,"uniform3fv",cs,3,hr),[35666]:kn.bind(null,"uniform4fv",cs,4,hr),[5124]:kn.bind(null,"uniform1iv",il,1,hr),[35667]:kn.bind(null,"uniform2iv",il,2,hr),[35668]:kn.bind(null,"uniform3iv",il,3,hr),[35669]:kn.bind(null,"uniform4iv",il,4,hr),[35670]:kn.bind(null,"uniform1iv",il,1,hr),[35671]:kn.bind(null,"uniform2iv",il,2,hr),[35672]:kn.bind(null,"uniform3iv",il,3,hr),[35673]:kn.bind(null,"uniform4iv",il,4,hr),[35674]:kn.bind(null,"uniformMatrix2fv",cs,4,da),[35675]:kn.bind(null,"uniformMatrix3fv",cs,9,da),[35676]:kn.bind(null,"uniformMatrix4fv",cs,16,da),[35678]:Ki,[35680]:Ki,[5125]:kn.bind(null,"uniform1uiv",vm,1,hr),[36294]:kn.bind(null,"uniform2uiv",vm,2,hr),[36295]:kn.bind(null,"uniform3uiv",vm,3,hr),[36296]:kn.bind(null,"uniform4uiv",vm,4,hr),[35685]:kn.bind(null,"uniformMatrix2x3fv",cs,6,da),[35686]:kn.bind(null,"uniformMatrix2x4fv",cs,8,da),[35687]:kn.bind(null,"uniformMatrix3x2fv",cs,6,da),[35688]:kn.bind(null,"uniformMatrix3x4fv",cs,12,da),[35689]:kn.bind(null,"uniformMatrix4x2fv",cs,8,da),[35690]:kn.bind(null,"uniformMatrix4x3fv",cs,12,da),[35678]:Ki,[35680]:Ki,[35679]:Ki,[35682]:Ki,[36289]:Ki,[36292]:Ki,[36293]:Ki,[36298]:Ki,[36299]:Ki,[36300]:Ki,[36303]:Ki,[36306]:Ki,[36307]:Ki,[36308]:Ki,[36311]:Ki},iU={},rU={},sU={},pT=[0];function Kx(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(pT[0]=t,t=pT);const r=t.length;if(r%e&&_t.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let a=i[r];a||(a=new n(r),i[r]=a);for(let h=0;h<r;h++)a[h]=t[h];return a}function cs(t,e){return Kx(t,e,Float32Array,iU)}function il(t,e){return Kx(t,e,Int32Array,rU)}function vm(t,e){return Kx(t,e,Uint32Array,sU)}function mT(t,e,n){const i=nU[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function oU(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function aU(t,e,n){for(const i in t){const r=t[i];if((!n||!!n[i])&&!lU(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function lU(t){return Array.isArray(t)||ArrayBuffer.isView(t)?uU(t):isFinite(t)||t===!0||t===!1||t instanceof sh||t instanceof ku?!0:t instanceof Ri?!!t.texture:!1}function cU(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let r=0,a=n.length;r<a;++r)i[r]=n[r]}else t[e]=n.slice();else t[e]=n}function uU(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ki(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function kn(t,e,n,i){let r=null,a=null;return(h,l,y)=>{const x=e(y,n),T=x.length;let C=!1;if(r===null)r=new Float32Array(T),a=T,C=!0;else{lt(a===T,"Uniform length cannot change.");for(let S=0;S<T;++S)if(x[S]!==r[S]){C=!0;break}}return C&&(i(h,t,l,x),r.set(x)),C}}function hr(t,e,n,i){t[e](n,i)}function da(t,e,n,i){t[e](n,!1,i)}const hU=5120,dU=5121,fU=5122,pU=5123,gT=0,xm=1,mU=2,gU=3,bm=4,_U=5,yU=6,Mi=5126,vU=35664,xU=35665,bU=35666,Ed=5124,wU=35667,AU=35668,EU=35669,Td=5125,TU=36294,SU=36295,CU=36296,IU=35670,MU=35671,PU=35672,BU=35673,LU=35674,RU=35675,DU=35676,OU=35685,kU=35686,FU=35687,zU=35688,NU=35689,UU=35690,o1={[Mi]:[Mi,1,"float"],[vU]:[Mi,2,"vec2"],[xU]:[Mi,3,"vec3"],[bU]:[Mi,4,"vec4"],[Ed]:[Ed,1,"int"],[wU]:[Ed,2,"ivec2"],[AU]:[Ed,3,"ivec3"],[EU]:[Ed,4,"ivec4"],[Td]:[Td,1,"uint"],[TU]:[Td,2,"uvec2"],[SU]:[Td,3,"uvec3"],[CU]:[Td,4,"uvec4"],[IU]:[Mi,1,"bool"],[MU]:[Mi,2,"bvec2"],[PU]:[Mi,3,"bvec3"],[BU]:[Mi,4,"bvec4"],[LU]:[Mi,8,"mat2"],[OU]:[Mi,8,"mat2x3"],[kU]:[Mi,8,"mat2x4"],[RU]:[Mi,12,"mat3"],[FU]:[Mi,12,"mat3x2"],[zU]:[Mi,12,"mat3x4"],[DU]:[Mi,16,"mat4"],[NU]:[Mi,16,"mat4x2"],[UU]:[Mi,16,"mat4x3"]};function GU(t){switch(t){case gT:return gT;case xm:return xm;case gU:return xm;case mU:return xm;case bm:return bm;case _U:return bm;case yU:return bm;default:return lt(!1),0}}function _T(t){const e=o1[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function qM(t,e){switch(t){case hU:case dU:case fU:case pU:t=Mi;break}for(const n in o1){const[i,r,a]=o1[n];if(i===t&&r===e)return{glType:n,name:a}}return null}class VU{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let r=0;r<i;r++){const{name:a,type:h,size:l}=n.getActiveAttrib(e.handle,r),y=n.getAttribLocation(e.handle,a);y>=0&&this._addAttribute(y,a,h,l)}this.attributeInfos.sort((r,a)=>r.location-a.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!$t(n))return;const i=n.getProgramParameter(e.handle,35971);for(let r=0;r<i;r++){const{name:a,type:h,size:l}=n.getTransformFeedbackVarying(e.handle,r);this._addVarying(r,a,h,l)}this.varyingInfos.sort((r,a)=>r.location-a.location)}_addAttribute(e,n,i,r){const{type:a,components:h}=_T(i),l={type:a,size:r*h};this._inferProperties(e,n,l);const y={location:e,name:n,accessor:new jr(l)};this.attributeInfos.push(y),this.attributeInfosByLocation[e]=y,this.attributeInfosByName[y.name]=y}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,r){const{type:a,components:h}=_T(i),l=new jr({type:a,size:r*h}),y={location:e,name:n,accessor:l};this.varyingInfos.push(y),this.varyingInfosByName[y.name]=y}}const yT=4,jU=35981,HU=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class $M extends Da{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",HU),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:r,varyings:a,bufferMode:h=jU}=e;return this.hash=n||"",this.vs=typeof i=="string"?new g0(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof r=="string"?new _0(this.gl,{id:"".concat(e.id,"-fs"),source:r}):r,lt(this.vs instanceof g0),lt(this.fs instanceof _0),this.uniforms={},this._textureUniforms={},a&&a.length>0&&(Pr(this.gl),this.varyings=a,this.gl2.transformFeedbackVaryings(this.handle,a,h)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new VU(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:r,offset:a=0,start:h,end:l,isIndexed:y=!1,indexType:x=5123,instanceCount:T=0,isInstanced:C=T>0,vertexArray:S=null,transformFeedback:z,framebuffer:V,parameters:Z={},uniforms:ue,samplers:q}=e;if((ue||q)&&(_t.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(ue||{})),_t.priority>=n){const j=V?V.id:"default",K="mode=".concat(Tl(this.gl,i)," verts=").concat(r," ")+"instances=".concat(T," indexType=").concat(Tl(this.gl,x)," ")+"isInstanced=".concat(C," isIndexed=").concat(y," ")+"Framebuffer=".concat(j);_t.log(n,K)()}return lt(S),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||r===0||C&&T===0?!1:(S.bindForDraw(r,T,()=>{if(V!==void 0&&(Z=Object.assign({},Z,{framebuffer:V})),z){const j=GU(i);z.begin(j)}this._bindTextures(),mo(this.gl,Z,()=>{y&&C?this.gl2.drawElementsInstanced(i,r,x,a,T):y&&$t(this.gl)&&!isNaN(h)&&!isNaN(l)?this.gl2.drawRangeElements(i,h,l,r,x,a):y?this.gl.drawElements(i,r,x,a):C?this.gl2.drawArraysInstanced(i,a,r,T):this.gl.drawArrays(i,a,r)}),z&&z.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_t.priority>=2&&aU(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],r=this._uniformSetters[n];if(r){let a=i,h=!1;if(a instanceof Ri&&(a=a.texture),a instanceof sh)if(h=this.uniforms[n]!==i,h){r.textureIndex===void 0&&(r.textureIndex=this._textureIndexCounter++);const l=a,{textureIndex:y}=r;l.bind(y),a=y,this._textureUniforms[n]=l}else a=r.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(r(a)||h)&&cU(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const r of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new g0({handle:r});break;case 35632:i.fs=new _0({handle:r});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Pa(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),_t.time(yT,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),_t.timeEnd(yT,"linkProgram for ".concat(this._getName()))(),e.debug||_t.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:r}=oU(i.name);let a=e.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=mT(e,a,i),i.size>1)for(let h=0;h<i.size;h++)a=e.getUniformLocation(this.handle,"".concat(r,"[").concat(h,"]")),this._uniformSetters["".concat(r,"[").concat(h,"]")]=mT(e,a,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const WU=34918,XU=34919,qU=35007,$U=36795,ZU=35976,JU=35887,KU=36202;class Gg extends Da{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=$t(e),r=jM(e,Dn.TIMER_QUERY);let a=i||r;for(const h of n)switch(h){case"queries":a=a&&i;break;case"timers":a=a&&r;break;default:lt(!1)}return a}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(qU)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?KU:JU)}beginTransformFeedbackQuery(){return this.begin(ZU)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,XU);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter($U)}getResult(){return this.gl2.getQueryParameter(this.handle,WU)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,r)=>{const a=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}_createHandle(){return Gg.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class ZM extends Da{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return $t(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Pr(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,rh(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:r,byteSize:a,byteOffset:h}=this._getBufferParams(n);return i<0?(this.unused[e]=r,_t.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,r,h,a),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,r;return e instanceof Sn?r=e:(r=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||r.byteLength-n),{buffer:r,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const a=n&&n.handle;return!a||r===void 0?this.gl.bindBufferBase(35982,e,a):this.gl.bindBufferRange(35982,e,a,i,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let wm=null;function YU(t){return(!wm||wm.byteLength<t)&&(wm=new ArrayBuffer(t)),wm}function QU(t,e){const n=YU(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function e4(t){let{target:e,source:n,start:i=0,count:r=1}=t;const a=n.length,h=r*a;let l=0;for(let y=i;l<a;l++)e[y++]=n[l];for(;l<h;)l<h-l?(e.copyWithin(i+l,i,i+l),l*=2):(e.copyWithin(i+l,i,i+h-l),l=h);return e}const t4="elements must be GL.ELEMENT_ARRAY_BUFFER";class ds extends Da{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?$t(e)||IM()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new ds(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return ds.MAX_ATTRIBUTES=ds.MAX_ATTRIBUTES||e.getParameter(34921),ds.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:ds._setConstantFloatArray(e,n,i);break;case Int32Array:ds._setConstantIntArray(e,n,i);break;case Uint32Array:ds._setConstantUintArray(e,n,i);break;default:lt(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return ds.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return lt(!e||e.target===34963,t4),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:r,type:a,stride:h,offset:l,normalized:y,integer:x,divisor:T}=i,{gl:C,gl2:S}=this;return e=Number(e),this.bind(()=>{C.bindBuffer(34962,n.handle),x?(lt($t(C)),S.vertexAttribIPointer(e,r,a,h,l)):C.vertexAttribPointer(e,r,a,y,h,l),C.enableVertexAttribArray(e),S.vertexAttribDivisor(e,T||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!ds.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),r=i.byteLength*e,a=i.length*e;let h=!this.buffer;if(this.buffer=this.buffer||new Sn(this.gl,r),h=h||this.buffer.reallocate(r),h=h||!this._compareConstantArrayValues(i,this.bufferValue),h){const l=QU(n.constructor,a);e4({target:l,source:i,start:0,count:a}),this.buffer.subData(l),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:lt(!1)}}static _setConstantIntArray(e,n,i){switch(lt($t(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:lt(!1)}}static _setConstantUintArray(e,n,i){switch(lt($t(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:lt(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return lt(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const n4="VertexArray: attributes must be Buffers or constants (i.e. typed array)",i4=/^(.+)__LOCATION_([0-9]+)$/,r4=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class s4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new ds(e),kM(this,"VertexArray","v6.0",r4),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:r,accessor:a}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return r>=0&&(this.values[r]=n,this.accessors[r]=a,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,n,a)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:r,accessor:a}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return r>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[r]=n,this.accessors[r]=a,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Sn(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Sn&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof Sn&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),r=i()}),r}_resolveLocationAndAccessor(e,n,i,r){const a={location:-1,accessor:null},{location:h,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(h)||h<0)return this.unused[e]=n,_t.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),a;const y=this._getAttributeInfo(l||h);if(!y)return a;const x=this.accessors[h]||{},T=jr.resolve(y.accessor,x,i,r),{size:C,type:S}=T;return lt(Number.isFinite(C)&&Number.isFinite(S)),{location:h,accessor:T}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=i4.exec(e),r=i?i[1]:e,a=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+a,name:r}:{location:-1}}_setAttribute(e,n){if(n instanceof Sn)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof Sn){const i=n[0],r=n[1];this.setBuffer(e,i,r)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof Sn){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(n4)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let a=1;a<this.vertexArrayObject.MAX_ATTRIBUTES;a++)r=this.values[a],ArrayBuffer.isView(r)&&this._setConstantAttribute(a,r)}_setConstantAttributeZero(e,n){if(ds.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){ds.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],r=this.accessors[n];if(!i)return;const{divisor:a}=r,h=a>0;if(e.isInstanced=e.isInstanced||h,i instanceof Sn){const l=i;if(h){const y=l.getVertexCount(r);e.instanceCount=Math.min(e.instanceCount,y)}else{const y=l.getVertexCount(r);e.vertexCount=Math.min(e.vertexCount,y)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return _t.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function o4(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let h=0;h<t.length&&h<n;++h)h>0&&(r+=",".concat(h%i===0?" ":"")),r+=Sf(t[h],e);const a=t.length>n?"...":"]";return"".concat(r).concat(a)}function Sf(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return o4(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function vT(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:r=!1}=t;lt(n);const a=".*_.*",h=".*Matrix",l=n._uniformSetters,y={},x=Object.keys(l).sort();let T=0;for(const z of x)!z.match(a)&&!z.match(h)&&y0({table:y,header:e,uniforms:i,uniformName:z,undefinedOnly:r})&&T++;for(const z of x)z.match(h)&&y0({table:y,header:e,uniforms:i,uniformName:z,undefinedOnly:r})&&T++;for(const z of x)y[z]||y0({table:y,header:e,uniforms:i,uniformName:z,undefinedOnly:r})&&T++;let C=0;const S={};if(!r)for(const z in i){const V=i[z];y[z]||(C++,S[z]={Type:"NOT USED: ".concat(V),[e]:Sf(V)})}return{table:y,count:T,unusedTable:S,unusedCount:C}}function y0(t){let{table:e,header:n,uniforms:i,uniformName:r,undefinedOnly:a}=t;const h=i[r],l=a4(h);return!a||!l?(e[r]={[n]:l?Sf(h):"N/A","Uniform Type":l?h:"NOT PROVIDED"},!0):!1}function a4(t){return t!=null}function l4(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=xT(e,e.elements,null,n));const r=e.values;for(const a in r){const h=e._getAttributeInfo(a);if(h){let l="".concat(a,": ").concat(h.name);const y=e.accessors[h.location];y&&(l="".concat(a,": ").concat(c4(h.name,y))),i[l]=xT(e,r[a],y,n)}}return i}function xT(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let a="NOT PROVIDED",h=1,l=0,y=0,x,T,C;if(n&&(a=n.type,h=n.size,a=String(a).replace("Array",""),x=a.indexOf("nt")!==-1),e instanceof Sn){const S=e,{data:z,changed:V}=S.getDebugData();T=V?"*":"",C=z,y=S.byteLength,l=y/z.BYTES_PER_ELEMENT/h;let Z;if(n){const ue=n.divisor>0;Z="".concat(ue?"I ":"P "," ").concat(l," (x").concat(h,"=").concat(y," bytes ").concat(Tl(r,a),")")}else x=!0,Z="".concat(y," bytes");return{[i]:"".concat(T).concat(Sf(C,{size:h,isInteger:x})),"Format ":Z}}return C=e,h=e.length,a=String(e.constructor.name).replace("Array",""),x=a.indexOf("nt")!==-1,{[i]:"".concat(Sf(C,{size:h,isInteger:x})," (constant)"),"Format ":"".concat(h,"x").concat(a," (constant)")}}function c4(t,e){const{type:n,size:i}=e,r=qM(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function u4(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const r=bT(i);e["in ".concat(r)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const r=bT(i);e["out ".concat(r)]={[n]:JSON.stringify(i.accessor)}}return e}function bT(t){const{type:e,size:n}=t.accessor,i=qM(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const wT=Ra()&&typeof document<"u";let h4=0;class d4{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=ue=>OM(ue),onAddHTML:i=null,onInitialize:r=()=>{},onRender:a=()=>{},onFinalize:h=()=>{},onError:l,gl:y=null,glOptions:x={},debug:T=!1,createFramebuffer:C=!1,autoResizeViewport:S=!0,autoResizeDrawingBuffer:z=!0,stats:V=gc.get("animation-loop-".concat(h4++))}=e;let{useDevicePixels:Z=!0}=e;"useDevicePixelRatio"in e&&(_t.deprecated("useDevicePixelRatio","useDevicePixels")(),Z=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:r,onRender:a,onFinalize:h,onError:l,gl:y,glOptions:x,debug:T,createFramebuffer:C},this.gl=y,this.needsRedraw=null,this.timeline=null,this.stats=V,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:S,autoResizeDrawingBuffer:z,useDevicePixels:Z}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return lt(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Gg.isSupported(this.gl,["timers"])?new Gg(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return _t.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=wT?new Promise((e,n)=>{if(wT&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):vN(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):yN(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Xx(this.props.gl,e):this.onCreateContext(e),!y_(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");sN(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&uN(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Ri(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Wf="vs",Yx="fs";function ys(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const v0={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function f4(t){const e={};for(const n in t){const i=t[n],r=p4(i);e[n]=r}return e}function p4(t){let e=AT(t);return e==="object"?t?"type"in t?Object.assign({},t,v0[t.type]):"value"in t?(e=AT(t.value),Object.assign({type:e},t,v0[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},v0[e])}function AT(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const m4="vs",g4="fs";class ET{constructor(e){let{name:n,vs:i,fs:r,dependencies:a=[],uniforms:h,getUniforms:l,deprecations:y=[],defines:x={},inject:T={},vertexShader:C,fragmentShader:S}=e;ys(typeof n=="string"),this.name=n,this.vs=i||C,this.fs=r||S,this.getModuleUniforms=l,this.dependencies=a,this.deprecations=this._parseDeprecationDefinitions(y),this.defines=x,this.injections=_4(T),h&&(this.uniforms=f4(h))}getModuleSource(e){let n;switch(e){case m4:n=this.vs||"";break;case g4:n=this.fs||"";break;default:ys(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const r in i){const a=i[r];r in e&&!a.private?(a.validate&&ys(a.validate(e[r],a),"".concat(this.name,": invalid ").concat(r)),n[r]=e[r]):n[r]=a.value}return n}}function _4(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const r=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function y4(t){return v4(KM(t))}function v4(t){const e={},n={};return JM({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,r)=>n[r]-n[i]).map(i=>e[i])}function JM(t){let{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const a of e)i[a.name]=a,(r[a.name]===void 0||r[a.name]<n)&&(r[a.name]=n);for(const a of e)a.dependencies&&JM({modules:a.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function KM(t,e){return t.map(n=>(n instanceof ET||(ys(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),ys(n.name,"shader module has no name"),n=new ET(n),n.dependencies=KM(n.dependencies)),n))}function x4(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r}const b4=7936,w4=7937,A4=7938,E4=35724,Qx={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},dc={};Object.keys(Qx).forEach(t=>{dc[t]=t});function T4(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function S4(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||b4),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||w4);return{gpuVendor:C4(n,i),vendor:n,renderer:i,version:t.getParameter(A4),shadingLanguageVersion:t.getParameter(E4)}}function C4(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const x0={};function TT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=Qx[e];if(ys(i,e),!x4(n))return!0;if(e in x0)return x0[e];const r=i[0],a=n.behavior||"enable",h="#extension GL_".concat(r," : ").concat(a,`
void main(void) {}`),l=t.createShader(35633);t.shaderSource(l,h),t.compileShader(l);const y=t.getShaderParameter(l,35713);return t.deleteShader(l),x0[e]=y,y}function I4(t,e){const n=Qx[e];ys(n,e);const i=T4(t)&&n[1]||n[0],r=typeof i=="string"?!!t.getExtension(i):i;return ys(r===!1||r===!0),r}function Am(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>I4(t,n))}function M4(t){switch(S4(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function P4(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return Am(t,dc.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),Am(t,dc.GLSL_DERIVATIVES)&&TT(t,dc.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),Am(t,dc.GLSL_FRAG_DATA)&&TT(t,dc.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),Am(t,dc.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const B4=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,L4=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,R4={[Wf]:B4,[Yx]:L4},rg="__LUMA_INJECT_DECLARATIONS__",ST=/void\s+main\s*\([^)]*\)\s*\{\n?/,CT=/}\n?[^{}]*$/,b0=[];function IT(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=e===Wf;for(const a in n){const h=n[a];h.sort((y,x)=>y.order-x.order),b0.length=h.length;for(let y=0,x=h.length;y<x;++y)b0[y]=h[y].injection;const l="".concat(b0.join(`
`),`
`);switch(a){case"vs:#decl":r&&(t=t.replace(rg,l));break;case"vs:#main-start":r&&(t=t.replace(ST,y=>y+l));break;case"vs:#main-end":r&&(t=t.replace(CT,y=>l+y));break;case"fs:#decl":r||(t=t.replace(rg,l));break;case"fs:#main-start":r||(t=t.replace(ST,y=>y+l));break;case"fs:#main-end":r||(t=t.replace(CT,y=>l+y));break;default:t=t.replace(a,y=>y+l)}}return t=t.replace(rg,""),i&&(t=t.replace(/\}\s*$/,a=>a+R4[e])),t}function a1(t){const e={};return ys(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function oh(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const YM=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],D4=[...YM,[oh("attribute"),"in $1"],[oh("varying"),"out $1"]],O4=[...YM,[oh("varying"),"in $1"]],QM=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],k4=[...QM,[oh("in"),"attribute $1"],[oh("out"),"varying $1"]],F4=[...QM,[oh("in"),"varying $1"]],l1="gl_FragColor",c1=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,z4=/void\s+main\s*\([^)]*\)\s*\{\n?/;function N4(t,e,n){switch(e){case 300:return n?Vg(t,D4):U4(t);case 100:return n?Vg(t,k4):G4(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Vg(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function U4(t){t=Vg(t,O4);const e=t.match(c1);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(l1,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(z4,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(l1,"\\b"),"g"),n)}return t}function G4(t){t=Vg(t,F4);const e=t.match(c1);if(e){const n=e[1];t=t.replace(c1,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),l1)}return t}const V4=`

`.concat(rg,`

`),eP={[Wf]:"vertex",[Yx]:"fragment"},j4=`precision highp float;

`;function H4(t,e){const{vs:n,fs:i}=e,r=y4(e.modules||[]);return{gl:t,vs:MT(t,Object.assign({},e,{source:n,type:Wf,modules:r})),fs:MT(t,Object.assign({},e,{source:i,type:Yx,modules:r})),getUniforms:W4(r)}}function MT(t,e){let{id:n,source:i,type:r,modules:a,defines:h={},hookFunctions:l=[],inject:y={},transpileToGLSL100:x=!1,prologue:T=!0,log:C}=e;ys(typeof i=="string","shader source must be a string");const S=r===Wf,z=i.split(`
`);let V=100,Z="",ue=i;z[0].indexOf("#version ")===0?(V=300,Z=z[0],ue=z.slice(1).join(`
`)):Z="#version ".concat(V);const q={};a.forEach(De=>{Object.assign(q,De.getDefines())}),Object.assign(q,h);let j=T?"".concat(Z,`
`).concat(q4({id:n,source:i,type:r}),`
`).concat(X4({type:r}),`
`).concat(M4(t),`
`).concat(P4(t),`
`).concat($4(q),`
`).concat(S?"":j4,`
`):"".concat(Z,`
`);const K=J4(l),de={},ve={},Ie={};for(const De in y){const Fe=typeof y[De]=="string"?{injection:y[De],order:0}:y[De],je=De.match(/^(v|f)s:(#)?([\w-]+)$/);if(je){const Ne=je[2],dt=je[3];Ne?dt==="decl"?ve[De]=[Fe]:Ie[De]=[Fe]:de[De]=[Fe]}else Ie[De]=[Fe]}for(const De of a){C&&De.checkDeprecations(ue,C);const Fe=De.getModuleSource(r,V);j+=Fe;const je=De.injections[r];for(const Ne in je){const dt=Ne.match(/^(v|f)s:#([\w-]+)$/);if(dt){const Xt=dt[2]==="decl"?ve:Ie;Xt[Ne]=Xt[Ne]||[],Xt[Ne].push(je[Ne])}else de[Ne]=de[Ne]||[],de[Ne].push(je[Ne])}}return j+=V4,j=IT(j,r,ve),j+=Z4(K[r],de),j+=ue,j=IT(j,r,Ie),j=N4(j,x?100:V,S),j}function W4(t){return function(n){const i={};for(const r of t){const a=r.getUniforms(n,i);Object.assign(i,a)}return i}}function X4(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(eP[e].toUpperCase(),`
`)}function q4(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(eP[i],`

`):""}function $4(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function Z4(t,e){let n="";for(const i in t){const r=t[i];if(n+="void ".concat(r.signature,` {
`),r.header&&(n+="  ".concat(r.header)),e[i]){const a=e[i];a.sort((h,l)=>h.order-l.order);for(const h of a)n+="  ".concat(h.injection,`
`)}r.footer&&(n+="  ".concat(r.footer)),n+=`}
`}return n}function J4(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[r,a]=n.split(":"),h=n.replace(/\(.+/,"");e[r][h]=Object.assign(i,{signature:a})}),e}const K4="void main() {gl_FragColor = vec4(0);}",tP=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,Y4=`#version 300 es
`.concat(tP);function nP(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,a]=n;if(!e.includes(i)||!r||!a)return null;const h=a.split(";")[0];return{qualifier:i,type:r,name:h}}function iP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:r}=t;if(!n)return e===300?Y4:e>300?"#version ".concat(e,`
`).concat(tP):K4;const a=t6(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(r,`;
void main() {
  `).concat(r," = ").concat(a,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(a,`;
}`)}function Q4(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ys(!1),null}}function e6(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ys(!1),null}}function t6(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return ys(!1),null}}const n6=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,i6={name:"fp32",vs:n6,fs:null};function co(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const r6=1/Math.PI*180,s6=1/180*Math.PI,Li={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function o6(t,{precision:e=Li.precision}={}){return t=u6(t),"".concat(parseFloat(t.toPrecision(e)))}function Pl(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function a6(t){return c6(t)}function l6(t){return va(t)}function c6(t,e){return eb(t,n=>n*s6,e)}function va(t,e){return eb(t,n=>n*r6,e)}function xa(t,e,n){return eb(t,i=>Math.max(e,Math.min(n,i)))}function jg(t,e,n){return Pl(t)?t.map((i,r)=>jg(i,e[r],n)):n*e+(1-n)*t}function go(t,e,n){const i=Li.EPSILON;n&&(Li.EPSILON=n);try{if(t===e)return!0;if(Pl(t)&&Pl(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!go(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Li.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Li.EPSILON=i}}function u6(t){return Math.round(t/Li.EPSILON)*Li.EPSILON}function h6(t){return t.clone?t.clone():new Array(t.length)}function eb(t,e,n){if(Pl(t)){const i=t;n=n||h6(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=e(t[r],r,n);return n}return e(t)}function d6(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class tb extends d6(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Pl(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Li)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+o6(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!go(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const a=e[r];this[r]=a+i*(n[r]-a)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Li.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function f6(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function _n(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Qd(t,e,n=""){if(Li.debug&&!f6(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class nb extends tb{get x(){return this[0]}set x(e){this[0]=_n(e)}get y(){return this[1]}set y(e){this[1]=_n(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return _n(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return _n(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return co(e>=0&&e<this.ELEMENTS,"index is out of range"),_n(this[e])}setComponent(e,n){return co(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var ef=1e-6,yo=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function p6(){var t=new yo(2);return yo!=Float32Array&&(t[0]=0,t[1]=0),t}function PT(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function m6(t,e){return t[0]=-e[0],t[1]=-e[1],t}function rP(t,e,n,i){var r=e[0],a=e[1];return t[0]=r+i*(n[0]-r),t[1]=a+i*(n[1]-a),t}function g6(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t}function _6(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t}function sP(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t}function oP(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){var t=p6();return function(e,n,i,r,a,h){var l,y;for(n||(n=2),i||(i=0),r?y=Math.min(r*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],a(t,t,h),e[l]=t[0],e[l+1]=t[1];return e}})();function aP(t,e,n){const i=e[0],r=e[1],a=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/a,t[1]=(n[1]*i+n[5]*r)/a,t}function lP(t,e,n){const i=e[0],r=e[1],a=e[2],h=n[3]*i+n[7]*r+n[11]*a||1;return t[0]=(n[0]*i+n[4]*r+n[8]*a)/h,t[1]=(n[1]*i+n[5]*r+n[9]*a)/h,t[2]=(n[2]*i+n[6]*r+n[10]*a)/h,t}function y6(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function v6(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t[3]=e[3],t}function cP(t,e,n){const i=e[0],r=e[1],a=e[2];return t[0]=n[0]*i+n[3]*r+n[6]*a,t[1]=n[1]*i+n[4]*r+n[7]*a,t[2]=n[2]*i+n[5]*r+n[8]*a,t[3]=e[3],t}class ib extends nb{constructor(e=0,n=0){super(2),Pl(e)&&arguments.length===1?this.copy(e):(Li.debug&&(_n(e),_n(n)),this[0]=e,this[1]=n)}set(e,n){return this[0]=e,this[1]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Li.debug&&(_n(e.x),_n(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return oP(this,this,e),this.check()}transformAsVector(e){return aP(this,this,e),this.check()}transformByMatrix3(e){return sP(this,this,e),this.check()}transformByMatrix2x3(e){return _6(this,this,e),this.check()}transformByMatrix2(e){return g6(this,this,e),this.check()}}function uP(){var t=new yo(3);return yo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function hP(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function BT(t,e,n){var i=new yo(3);return i[0]=t,i[1]=e,i[2]=n,i}function x6(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function b6(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function w6(t,e){var n=e[0],i=e[1],r=e[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function rb(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function sg(t,e,n){var i=e[0],r=e[1],a=e[2],h=n[0],l=n[1],y=n[2];return t[0]=r*y-a*l,t[1]=a*h-i*y,t[2]=i*l-r*h,t}function sb(t,e,n){var i=e[0],r=e[1],a=e[2],h=n[3]*i+n[7]*r+n[11]*a+n[15];return h=h||1,t[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/h,t[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/h,t[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/h,t}function dP(t,e,n){var i=e[0],r=e[1],a=e[2];return t[0]=i*n[0]+r*n[3]+a*n[6],t[1]=i*n[1]+r*n[4]+a*n[7],t[2]=i*n[2]+r*n[5]+a*n[8],t}function fP(t,e,n){var i=n[0],r=n[1],a=n[2],h=n[3],l=e[0],y=e[1],x=e[2],T=r*x-a*y,C=a*l-i*x,S=i*y-r*l,z=r*S-a*C,V=a*T-i*S,Z=i*C-r*T,ue=h*2;return T*=ue,C*=ue,S*=ue,z*=2,V*=2,Z*=2,t[0]=l+T+z,t[1]=y+C+V,t[2]=x+S+Z,t}function A6(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0],a[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),a[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function E6(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),a[1]=r[1],a[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function T6(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),a[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),a[2]=r[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function S6(t,e){var n=t[0],i=t[1],r=t[2],a=e[0],h=e[1],l=e[2],y=Math.sqrt(n*n+i*i+r*r),x=Math.sqrt(a*a+h*h+l*l),T=y*x,C=T&&rb(t,e)/T;return Math.acos(Math.min(Math.max(C,-1),1))}var C6=x6,I6=hP;(function(){var t=uP();return function(e,n,i,r,a,h){var l,y;for(n||(n=3),i||(i=0),r?y=Math.min(r*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],a(t,t,h),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const w0=[0,0,0];let Em;class we extends nb{static get ZERO(){return Em||(Em=new we(0,0,0),Object.freeze(Em)),Em}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&Pl(e)?this.copy(e):(Li.debug&&(_n(e),_n(n),_n(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Li.debug&&(_n(e.x),_n(e.y),_n(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=_n(e)}angle(e){return S6(this,e)}cross(e){return sg(this,this,e),this.check()}rotateX({radians:e,origin:n=w0}){return A6(this,this,n,e),this.check()}rotateY({radians:e,origin:n=w0}){return E6(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=w0}){return T6(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return sb(this,this,e),this.check()}transformAsVector(e){return lP(this,this,e),this.check()}transformByMatrix3(e){return dP(this,this,e),this.check()}transformByMatrix2(e){return y6(this,this,e),this.check()}transformByQuaternion(e){return fP(this,this,e),this.check()}}let Tm;class ob extends nb{static get ZERO(){return Tm||(Tm=new ob(0,0,0,0),Object.freeze(Tm)),Tm}constructor(e=0,n=0,i=0,r=0){super(-0,-0,-0,-0),Pl(e)&&arguments.length===1?this.copy(e):(Li.debug&&(_n(e),_n(n),_n(i),_n(r)),this[0]=e,this[1]=n,this[2]=i,this[3]=r)}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Li.debug&&(_n(e.x),_n(e.y),_n(e.z),_n(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=_n(e)}get w(){return this[3]}set w(e){this[3]=_n(e)}transform(e){return sb(this,this,e),this.check()}transformByMatrix3(e){return cP(this,this,e),this.check()}transformByMatrix2(e){return v6(this,this,e),this.check()}transformByQuaternion(e){return fP(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class pP extends tb{toString(){let e="[";if(Li.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=_n(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function M6(){var t=new yo(9);return yo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function P6(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function B6(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=e[4],l=e[5],y=e[6],x=e[7],T=e[8],C=T*h-l*x,S=-T*a+l*y,z=x*a-h*y,V=n*C+i*S+r*z;return V?(V=1/V,t[0]=C*V,t[1]=(-T*i+r*x)*V,t[2]=(l*i-r*h)*V,t[3]=S*V,t[4]=(T*n-r*y)*V,t[5]=(-l*n+r*a)*V,t[6]=z*V,t[7]=(-x*n+i*y)*V,t[8]=(h*n-i*a)*V,t):null}function L6(t){var e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],h=t[5],l=t[6],y=t[7],x=t[8];return e*(x*a-h*y)+n*(-x*r+h*l)+i*(y*r-a*l)}function LT(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3],l=e[4],y=e[5],x=e[6],T=e[7],C=e[8],S=n[0],z=n[1],V=n[2],Z=n[3],ue=n[4],q=n[5],j=n[6],K=n[7],de=n[8];return t[0]=S*i+z*h+V*x,t[1]=S*r+z*l+V*T,t[2]=S*a+z*y+V*C,t[3]=Z*i+ue*h+q*x,t[4]=Z*r+ue*l+q*T,t[5]=Z*a+ue*y+q*C,t[6]=j*i+K*h+de*x,t[7]=j*r+K*l+de*T,t[8]=j*a+K*y+de*C,t}function R6(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3],l=e[4],y=e[5],x=e[6],T=e[7],C=e[8],S=n[0],z=n[1];return t[0]=i,t[1]=r,t[2]=a,t[3]=h,t[4]=l,t[5]=y,t[6]=S*i+z*h+x,t[7]=S*r+z*l+T,t[8]=S*a+z*y+C,t}function D6(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3],l=e[4],y=e[5],x=e[6],T=e[7],C=e[8],S=Math.sin(n),z=Math.cos(n);return t[0]=z*i+S*h,t[1]=z*r+S*l,t[2]=z*a+S*y,t[3]=z*h-S*i,t[4]=z*l-S*r,t[5]=z*y-S*a,t[6]=x,t[7]=T,t[8]=C,t}function RT(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function O6(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=n+n,l=i+i,y=r+r,x=n*h,T=i*h,C=i*l,S=r*h,z=r*l,V=r*y,Z=a*h,ue=a*l,q=a*y;return t[0]=1-C-V,t[3]=T-q,t[6]=S+ue,t[1]=T+q,t[4]=1-x-V,t[7]=z-Z,t[2]=S-ue,t[5]=z+Z,t[8]=1-x-C,t}var u1;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(u1||(u1={}));const k6=Object.freeze([1,0,0,0,1,0,0,0,1]);class oi extends pP{static get IDENTITY(){return z6()}static get ZERO(){return F6()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return u1}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(k6)}fromObject(e){return this.check()}fromQuaternion(e){return O6(this,e),this.check()}set(e,n,i,r,a,h,l,y,x){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=a,this[5]=h,this[6]=l,this[7]=y,this[8]=x,this.check()}setRowMajor(e,n,i,r,a,h,l,y,x){return this[0]=e,this[1]=r,this[2]=l,this[3]=n,this[4]=a,this[5]=y,this[6]=i,this[7]=h,this[8]=x,this.check()}determinant(){return L6(this)}transpose(){return P6(this,this),this.check()}invert(){return B6(this,this),this.check()}multiplyLeft(e){return LT(this,e,this),this.check()}multiplyRight(e){return LT(this,this,e),this.check()}rotate(e){return D6(this,this,e),this.check()}scale(e){return Array.isArray(e)?RT(this,this,e):RT(this,this,[e,e]),this.check()}translate(e){return R6(this,this,e),this.check()}transform(e,n){let i;switch(e.length){case 2:i=sP(n||[-0,-0],e,this);break;case 3:i=dP(n||[-0,-0,-0],e,this);break;case 4:i=cP(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Qd(i,e.length),i}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let Sm,Cm;function F6(){return Sm||(Sm=new oi([0,0,0,0,0,0,0,0,0]),Object.freeze(Sm)),Sm}function z6(){return Cm||(Cm=new oi,Object.freeze(Cm)),Cm}function N6(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function U6(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],a=e[6],h=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[11]=e[14],t[12]=r,t[13]=h,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function h1(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=e[4],l=e[5],y=e[6],x=e[7],T=e[8],C=e[9],S=e[10],z=e[11],V=e[12],Z=e[13],ue=e[14],q=e[15],j=n*l-i*h,K=n*y-r*h,de=n*x-a*h,ve=i*y-r*l,Ie=i*x-a*l,De=r*x-a*y,Fe=T*Z-C*V,je=T*ue-S*V,Ne=T*q-z*V,dt=C*ue-S*Z,Nt=C*q-z*Z,Xt=S*q-z*ue,Lt=j*Xt-K*Nt+de*dt+ve*Ne-Ie*je+De*Fe;return Lt?(Lt=1/Lt,t[0]=(l*Xt-y*Nt+x*dt)*Lt,t[1]=(r*Nt-i*Xt-a*dt)*Lt,t[2]=(Z*De-ue*Ie+q*ve)*Lt,t[3]=(S*Ie-C*De-z*ve)*Lt,t[4]=(y*Ne-h*Xt-x*je)*Lt,t[5]=(n*Xt-r*Ne+a*je)*Lt,t[6]=(ue*de-V*De-q*K)*Lt,t[7]=(T*De-S*de+z*K)*Lt,t[8]=(h*Nt-l*Ne+x*Fe)*Lt,t[9]=(i*Ne-n*Nt-a*Fe)*Lt,t[10]=(V*Ie-Z*de+q*j)*Lt,t[11]=(C*de-T*Ie-z*j)*Lt,t[12]=(l*je-h*dt-y*Fe)*Lt,t[13]=(n*dt-i*je+r*Fe)*Lt,t[14]=(Z*K-V*ve-ue*j)*Lt,t[15]=(T*ve-C*K+S*j)*Lt,t):null}function G6(t){var e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],h=t[5],l=t[6],y=t[7],x=t[8],T=t[9],C=t[10],S=t[11],z=t[12],V=t[13],Z=t[14],ue=t[15],q=e*h-n*a,j=e*l-i*a,K=e*y-r*a,de=n*l-i*h,ve=n*y-r*h,Ie=i*y-r*l,De=x*V-T*z,Fe=x*Z-C*z,je=x*ue-S*z,Ne=T*Z-C*V,dt=T*ue-S*V,Nt=C*ue-S*Z;return q*Nt-j*dt+K*Ne+de*je-ve*Fe+Ie*De}function bc(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3],l=e[4],y=e[5],x=e[6],T=e[7],C=e[8],S=e[9],z=e[10],V=e[11],Z=e[12],ue=e[13],q=e[14],j=e[15],K=n[0],de=n[1],ve=n[2],Ie=n[3];return t[0]=K*i+de*l+ve*C+Ie*Z,t[1]=K*r+de*y+ve*S+Ie*ue,t[2]=K*a+de*x+ve*z+Ie*q,t[3]=K*h+de*T+ve*V+Ie*j,K=n[4],de=n[5],ve=n[6],Ie=n[7],t[4]=K*i+de*l+ve*C+Ie*Z,t[5]=K*r+de*y+ve*S+Ie*ue,t[6]=K*a+de*x+ve*z+Ie*q,t[7]=K*h+de*T+ve*V+Ie*j,K=n[8],de=n[9],ve=n[10],Ie=n[11],t[8]=K*i+de*l+ve*C+Ie*Z,t[9]=K*r+de*y+ve*S+Ie*ue,t[10]=K*a+de*x+ve*z+Ie*q,t[11]=K*h+de*T+ve*V+Ie*j,K=n[12],de=n[13],ve=n[14],Ie=n[15],t[12]=K*i+de*l+ve*C+Ie*Z,t[13]=K*r+de*y+ve*S+Ie*ue,t[14]=K*a+de*x+ve*z+Ie*q,t[15]=K*h+de*T+ve*V+Ie*j,t}function Hg(t,e,n){var i=n[0],r=n[1],a=n[2],h,l,y,x,T,C,S,z,V,Z,ue,q;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*a+e[12],t[13]=e[1]*i+e[5]*r+e[9]*a+e[13],t[14]=e[2]*i+e[6]*r+e[10]*a+e[14],t[15]=e[3]*i+e[7]*r+e[11]*a+e[15]):(h=e[0],l=e[1],y=e[2],x=e[3],T=e[4],C=e[5],S=e[6],z=e[7],V=e[8],Z=e[9],ue=e[10],q=e[11],t[0]=h,t[1]=l,t[2]=y,t[3]=x,t[4]=T,t[5]=C,t[6]=S,t[7]=z,t[8]=V,t[9]=Z,t[10]=ue,t[11]=q,t[12]=h*i+T*r+V*a+e[12],t[13]=l*i+C*r+Z*a+e[13],t[14]=y*i+S*r+ue*a+e[14],t[15]=x*i+z*r+q*a+e[15]),t}function ab(t,e,n){var i=n[0],r=n[1],a=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function V6(t,e,n,i){var r=i[0],a=i[1],h=i[2],l=Math.hypot(r,a,h),y,x,T,C,S,z,V,Z,ue,q,j,K,de,ve,Ie,De,Fe,je,Ne,dt,Nt,Xt,Lt,jn;return l<ef?null:(l=1/l,r*=l,a*=l,h*=l,y=Math.sin(n),x=Math.cos(n),T=1-x,C=e[0],S=e[1],z=e[2],V=e[3],Z=e[4],ue=e[5],q=e[6],j=e[7],K=e[8],de=e[9],ve=e[10],Ie=e[11],De=r*r*T+x,Fe=a*r*T+h*y,je=h*r*T-a*y,Ne=r*a*T-h*y,dt=a*a*T+x,Nt=h*a*T+r*y,Xt=r*h*T+a*y,Lt=a*h*T-r*y,jn=h*h*T+x,t[0]=C*De+Z*Fe+K*je,t[1]=S*De+ue*Fe+de*je,t[2]=z*De+q*Fe+ve*je,t[3]=V*De+j*Fe+Ie*je,t[4]=C*Ne+Z*dt+K*Nt,t[5]=S*Ne+ue*dt+de*Nt,t[6]=z*Ne+q*dt+ve*Nt,t[7]=V*Ne+j*dt+Ie*Nt,t[8]=C*Xt+Z*Lt+K*jn,t[9]=S*Xt+ue*Lt+de*jn,t[10]=z*Xt+q*Lt+ve*jn,t[11]=V*Xt+j*Lt+Ie*jn,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function mP(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],h=e[5],l=e[6],y=e[7],x=e[8],T=e[9],C=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+x*i,t[5]=h*r+T*i,t[6]=l*r+C*i,t[7]=y*r+S*i,t[8]=x*r-a*i,t[9]=T*r-h*i,t[10]=C*r-l*i,t[11]=S*r-y*i,t}function j6(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],h=e[1],l=e[2],y=e[3],x=e[8],T=e[9],C=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-x*i,t[1]=h*r-T*i,t[2]=l*r-C*i,t[3]=y*r-S*i,t[8]=a*i+x*r,t[9]=h*i+T*r,t[10]=l*i+C*r,t[11]=y*i+S*r,t}function gP(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],h=e[1],l=e[2],y=e[3],x=e[4],T=e[5],C=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+x*i,t[1]=h*r+T*i,t[2]=l*r+C*i,t[3]=y*r+S*i,t[4]=x*r-a*i,t[5]=T*r-h*i,t[6]=C*r-l*i,t[7]=S*r-y*i,t}function H6(t,e){var n=e[0],i=e[1],r=e[2],a=e[4],h=e[5],l=e[6],y=e[8],x=e[9],T=e[10];return t[0]=Math.hypot(n,i,r),t[1]=Math.hypot(a,h,l),t[2]=Math.hypot(y,x,T),t}function W6(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=n+n,l=i+i,y=r+r,x=n*h,T=i*h,C=i*l,S=r*h,z=r*l,V=r*y,Z=a*h,ue=a*l,q=a*y;return t[0]=1-C-V,t[1]=T+q,t[2]=S-ue,t[3]=0,t[4]=T-q,t[5]=1-x-V,t[6]=z+Z,t[7]=0,t[8]=S+ue,t[9]=z-Z,t[10]=1-x-C,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function X6(t,e,n,i,r,a,h){var l=1/(n-e),y=1/(r-i),x=1/(a-h);return t[0]=a*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*y,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(r+i)*y,t[10]=(h+a)*x,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*a*2*x,t[15]=0,t}function q6(t,e,n,i,r){var a=1/Math.tan(e/2),h;return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(h=1/(i-r),t[10]=(r+i)*h,t[14]=2*r*i*h):(t[10]=-1,t[14]=-2*i),t}var $6=q6;function Z6(t,e,n,i,r,a,h){var l=1/(e-n),y=1/(i-r),x=1/(a-h);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*x,t[11]=0,t[12]=(e+n)*l,t[13]=(r+i)*y,t[14]=(h+a)*x,t[15]=1,t}var J6=Z6;function K6(t,e,n,i){var r,a,h,l,y,x,T,C,S,z,V=e[0],Z=e[1],ue=e[2],q=i[0],j=i[1],K=i[2],de=n[0],ve=n[1],Ie=n[2];return Math.abs(V-de)<ef&&Math.abs(Z-ve)<ef&&Math.abs(ue-Ie)<ef?N6(t):(T=V-de,C=Z-ve,S=ue-Ie,z=1/Math.hypot(T,C,S),T*=z,C*=z,S*=z,r=j*S-K*C,a=K*T-q*S,h=q*C-j*T,z=Math.hypot(r,a,h),z?(z=1/z,r*=z,a*=z,h*=z):(r=0,a=0,h=0),l=C*h-S*a,y=S*r-T*h,x=T*a-C*r,z=Math.hypot(l,y,x),z?(z=1/z,l*=z,y*=z,x*=z):(l=0,y=0,x=0),t[0]=r,t[1]=l,t[2]=T,t[3]=0,t[4]=a,t[5]=y,t[6]=C,t[7]=0,t[8]=h,t[9]=x,t[10]=S,t[11]=0,t[12]=-(r*V+a*Z+h*ue),t[13]=-(l*V+y*Z+x*ue),t[14]=-(T*V+C*Z+S*ue),t[15]=1,t)}function Y6(){var t=new yo(4);return yo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Q6(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function _P(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function e5(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.hypot(e,n,i,r)}function t5(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}function n5(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=n*n+i*i+r*r+a*a;return h>0&&(h=1/Math.sqrt(h)),t[0]=n*h,t[1]=i*h,t[2]=r*h,t[3]=a*h,t}function i5(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function r5(t,e,n,i){var r=e[0],a=e[1],h=e[2],l=e[3];return t[0]=r+i*(n[0]-r),t[1]=a+i*(n[1]-a),t[2]=h+i*(n[2]-h),t[3]=l+i*(n[3]-l),t}function Xf(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*h,t[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*h,t[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*h,t[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*h,t}function s5(t,e,n){var i=e[0],r=e[1],a=e[2],h=n[0],l=n[1],y=n[2],x=n[3],T=x*i+l*a-y*r,C=x*r+y*i-h*a,S=x*a+h*r-l*i,z=-h*i-l*r-y*a;return t[0]=T*x+z*-h+C*-y-S*-l,t[1]=C*x+z*-l+S*-h-T*-y,t[2]=S*x+z*-y+T*-l-C*-h,t[3]=e[3],t}(function(){var t=Y6();return function(e,n,i,r,a,h){var l,y;for(n||(n=4),i||(i=0),r?y=Math.min(r*n+i,e.length):y=e.length,l=i;l<y;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],a(t,t,h),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var d1;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(d1||(d1={}));const o5=45*Math.PI/180,a5=1,A0=.1,E0=500,l5=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Yt extends pP{static get IDENTITY(){return u5()}static get ZERO(){return c5()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return d1}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,a,h,l,y,x,T,C,S,z,V,Z,ue){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=a,this[5]=h,this[6]=l,this[7]=y,this[8]=x,this[9]=T,this[10]=C,this[11]=S,this[12]=z,this[13]=V,this[14]=Z,this[15]=ue,this.check()}setRowMajor(e,n,i,r,a,h,l,y,x,T,C,S,z,V,Z,ue){return this[0]=e,this[1]=a,this[2]=x,this[3]=z,this[4]=n,this[5]=h,this[6]=T,this[7]=V,this[8]=i,this[9]=l,this[10]=C,this[11]=Z,this[12]=r,this[13]=y,this[14]=S,this[15]=ue,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(l5)}fromObject(e){return this.check()}fromQuaternion(e){return W6(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:a,near:h=A0,far:l=E0}=e;return l===1/0?h5(this,n,i,r,a,h):X6(this,n,i,r,a,h,l),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return K6(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:a,near:h=A0,far:l=E0}=e;return J6(this,n,i,r,a,h,l),this.check()}orthographic(e){const{fovy:n=o5,aspect:i=a5,focalDistance:r=1,near:a=A0,far:h=E0}=e;DT(n);const l=n/2,y=r*Math.tan(l),x=y*i;return this.ortho({left:-x,right:x,bottom:-y,top:y,near:a,far:h})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:a=500}=e;return DT(n),$6(this,n,i,r,a),this.check()}determinant(){return G6(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],a=1/i[1],h=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*a,e[2]=this[2]*h,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*a,e[6]=this[6]*h,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*a,e[10]=this[10]*h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],a=1/i[1],h=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*a,e[2]=this[2]*h,e[3]=this[4]*r,e[4]=this[5]*a,e[5]=this[6]*h,e[6]=this[8]*r,e[7]=this[9]*a,e[8]=this[10]*h,e}transpose(){return U6(this,this),this.check()}invert(){return h1(this,this),this.check()}multiplyLeft(e){return bc(this,e,this),this.check()}multiplyRight(e){return bc(this,this,e),this.check()}rotateX(e){return mP(this,this,e),this.check()}rotateY(e){return j6(this,this,e),this.check()}rotateZ(e){return gP(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return V6(this,this,e,n),this.check()}scale(e){return ab(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Hg(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Xf(n||[-0,-0,-0,-0],e,this),Qd(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=oP(n||[-0,-0],e,this);break;case 3:r=sb(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Qd(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=aP(n||[-0,-0],e,this);break;case 3:i=lP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Qd(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let Im,Mm;function c5(){return Im||(Im=new Yt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Im)),Im}function u5(){return Mm||(Mm=new Yt,Object.freeze(Mm)),Mm}function DT(t){if(t>Math.PI*2)throw Error("expected radians")}function h5(t,e,n,i,r,a){const h=2*a/(n-e),l=2*a/(r-i),y=(n+e)/(n-e),x=(r+i)/(r-i),T=-1,C=-1,S=-2*a;return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=y,t[9]=x,t[10]=T,t[11]=C,t[12]=0,t[13]=0,t[14]=S,t[15]=0,t}function OT(){var t=new yo(4);return yo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function d5(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function yP(t,e,n){n=n*.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function kT(t,e,n){var i=e[0],r=e[1],a=e[2],h=e[3],l=n[0],y=n[1],x=n[2],T=n[3];return t[0]=i*T+h*l+r*x-a*y,t[1]=r*T+h*y+a*l-i*x,t[2]=a*T+h*x+i*y-r*l,t[3]=h*T-i*l-r*y-a*x,t}function f5(t,e,n){n*=.5;var i=e[0],r=e[1],a=e[2],h=e[3],l=Math.sin(n),y=Math.cos(n);return t[0]=i*y+h*l,t[1]=r*y+a*l,t[2]=a*y-r*l,t[3]=h*y-i*l,t}function p5(t,e,n){n*=.5;var i=e[0],r=e[1],a=e[2],h=e[3],l=Math.sin(n),y=Math.cos(n);return t[0]=i*y-a*l,t[1]=r*y+h*l,t[2]=a*y+i*l,t[3]=h*y-r*l,t}function m5(t,e,n){n*=.5;var i=e[0],r=e[1],a=e[2],h=e[3],l=Math.sin(n),y=Math.cos(n);return t[0]=i*y+r*l,t[1]=r*y-i*l,t[2]=a*y+h*l,t[3]=h*y-a*l,t}function g5(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t}function og(t,e,n,i){var r=e[0],a=e[1],h=e[2],l=e[3],y=n[0],x=n[1],T=n[2],C=n[3],S,z,V,Z,ue;return z=r*y+a*x+h*T+l*C,z<0&&(z=-z,y=-y,x=-x,T=-T,C=-C),1-z>ef?(S=Math.acos(z),V=Math.sin(S),Z=Math.sin((1-i)*S)/V,ue=Math.sin(i*S)/V):(Z=1-i,ue=i),t[0]=Z*r+ue*y,t[1]=Z*a+ue*x,t[2]=Z*h+ue*T,t[3]=Z*l+ue*C,t}function _5(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],h=n*n+i*i+r*r+a*a,l=h?1/h:0;return t[0]=-n*l,t[1]=-i*l,t[2]=-r*l,t[3]=a*l,t}function y5(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function vP(t,e){var n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[r*3+r]&&(r=2);var a=(r+1)%3,h=(r+2)%3;i=Math.sqrt(e[r*3+r]-e[a*3+a]-e[h*3+h]+1),t[r]=.5*i,i=.5/i,t[3]=(e[a*3+h]-e[h*3+a])*i,t[a]=(e[a*3+r]+e[r*3+a])*i,t[h]=(e[h*3+r]+e[r*3+h])*i}return t}var v5=Q6,x5=_P,b5=i5,w5=r5,A5=e5,E5=t5,xP=n5,T5=function(){var t=uP(),e=BT(1,0,0),n=BT(0,1,0);return function(i,r,a){var h=rb(r,a);return h<-.999999?(sg(t,e,r),I6(t)<1e-6&&sg(t,n,r),w6(t,t),yP(i,t,Math.PI),i):h>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(sg(t,r,a),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+h,xP(i,i))}}();(function(){var t=OT(),e=OT();return function(n,i,r,a,h,l){return og(t,i,h,l),og(e,r,a,l),og(n,t,e,2*l*(1-l)),n}})();(function(){var t=M6();return function(e,n,i,r){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],xP(e,vP(e,t))}})();const S5=[0,0,0,1];class Cf extends tb{constructor(e=0,n=0,i=0,r=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,i,r)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,i,r){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return vP(this,e),this.check()}fromAxisRotation(e,n){return yP(this,e,n),this.check()}identity(){return d5(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=_n(e)}get y(){return this[1]}set y(e){this[1]=_n(e)}get z(){return this[2]}set z(e){this[2]=_n(e)}get w(){return this[3]}set w(e){this[3]=_n(e)}len(){return A5(this)}lengthSquared(){return E5(this)}dot(e){return b5(this,e)}rotationTo(e,n){return T5(this,e,n),this.check()}add(e){return v5(this,this,e),this.check()}calculateW(){return g5(this,this),this.check()}conjugate(){return y5(this,this),this.check()}invert(){return _5(this,this),this.check()}lerp(e,n,i){return i===void 0?this.lerp(this,e,n):(w5(this,e,n,i),this.check())}multiplyRight(e){return kT(this,this,e),this.check()}multiplyLeft(e){return kT(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return f5(this,this,e),this.check()}rotateY(e){return p5(this,this,e),this.check()}rotateZ(e){return m5(this,this,e),this.check()}scale(e){return x5(this,this,e),this.check()}slerp(e,n,i){let r,a,h;switch(arguments.length){case 1:({start:r=S5,target:a,ratio:h}=e);break;case 2:r=this,a=e,h=n;break;default:r=e,a=n,h=i}return og(this,r,a,h),this.check()}transformVector4(e,n=new ob){return s5(n,e,this),Qd(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const If={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},FT=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,C5={lightSources:{}};function T0(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function I5(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const r={};return e?r["lighting_uAmbientLight.color"]=T0(e):r["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((a,h)=>{r["lighting_uPointLight[".concat(h,"].color")]=T0(a),r["lighting_uPointLight[".concat(h,"].position")]=a.position,r["lighting_uPointLight[".concat(h,"].attenuation")]=a.attenuation||[1,0,0]}),r.lighting_uPointLightCount=n.length,i.forEach((a,h)=>{r["lighting_uDirectionalLight[".concat(h,"].color")]=T0(a),r["lighting_uDirectionalLight[".concat(h,"].direction")]=a.direction}),r.lighting_uDirectionalLightCount=i.length,r}function bP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:C5;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},I5({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return bP({lightSources:e})}return{}}const lb={name:"lights",vs:FT,fs:FT,getUniforms:bP,defines:{MAX_LIGHTS:3}},M5=new Uint8Array([0,255,255,255]),P5={pickingSelectedColor:null,pickingHighlightColor:M5,pickingActive:!1,pickingAttribute:!1};function B5(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P5;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const L5=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,R5=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,D5={name:"picking",vs:L5,fs:R5,getUniforms:B5},wP=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,O5={};function k5(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map(a=>a/255)}}function AP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:O5;if(!("material"in t))return{};const{material:e}=t;return e?k5(e):{lighting_uEnabled:!1}}const F5={name:"gouraud-lighting",dependencies:[lb],vs:wP,defines:{LIGHTING_VERTEX:1},getUniforms:AP},z5={name:"phong-lighting",dependencies:[lb],fs:wP,defines:{LIGHTING_FRAGMENT:1},getUniforms:AP},N5=`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,U5=`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,cb={name:"pbr",vs:N5,fs:U5,defines:{LIGHTING_FRAGMENT:1},dependencies:[lb]},G5=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,V5={name:"transform",vs:G5,fs:null};class qf{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new qf(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:r={},inject:a={},varyings:h=[],bufferMode:l=35981,transpileToGLSL100:y=!1}=e,x=this._getModuleList(e.modules),T=this._getHash(n),C=this._getHash(i),S=x.map(K=>this._getHash(K.name)).sort(),z=h.map(K=>this._getHash(K)),V=Object.keys(r).sort(),Z=Object.keys(a).sort(),ue=[],q=[];for(const K of V)ue.push(this._getHash(K)),ue.push(this._getHash(r[K]));for(const K of Z)q.push(this._getHash(K)),q.push(this._getHash(a[K]));const j="".concat(T,"/").concat(C,"D").concat(ue.join("/"),"M").concat(S.join("/"),"I").concat(q.join("/"),"V").concat(z.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(y?"T":"");if(!this._programCache[j]){const K=H4(this.gl,{vs:n,fs:i,modules:x,inject:a,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:y});this._programCache[j]=new $M(this.gl,{hash:j,vs:K.vs,fs:K.fs,varyings:h,bufferMode:l}),this._getUniforms[j]=K.getUniforms||(de=>{}),this._useCounts[j]=0}return this._useCounts[j]++,this._programCache[j]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let a=0,h=this._defaultModules.length;a<h;++a){const l=this._defaultModules[a],y=l.name;n[r++]=l,i[y]=!0}for(let a=0,h=e.length;a<h;++a){const l=e[a],y=l.name;i[y]||(n[r++]=l,i[y]=!0)}return n.length=r,n}}const j5={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function H5(t,e,n){const i={};let r=e.indices;for(const a in e.attributes){const h=e.attributes[a],l=W5(a,n);if(a==="indices")r=h;else if(h.constant)i[l]=h.value;else{const y=h.value,x={...h};delete x.value,i[l]=[new Sn(t,y),x],X5(a,x)}}if(r){const a=r.value||r;lt(a instanceof Uint16Array||a instanceof Uint32Array,'attribute array for "indices" must be of integer type');const h={size:1,isIndexed:r.isIndexed===void 0?!0:r.isIndexed};i.indices=[new Sn(t,{data:a,target:34963}),h]}return i}function W5(t,e){const{attributeMap:n=j5}=e||{};return n&&n[t]||t}function X5(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}lt(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const gu=2,q5=1e4,$5="Model needs drawMode and vertexCount",zT=()=>{},Z5={};class ah{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=Pa("model")}=n;lt(y_(e)),this.id=i,this.gl=e,this.id=n.id||Pa("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||qf.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:r,modules:a,defines:h,inject:l,varyings:y,bufferMode:x,transpileToGLSL100:T}=e;this.programProps={program:n,vs:i,fs:r,modules:a,defines:h,inject:l,varyings:y,bufferMode:x,transpileToGLSL100:T},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},lt(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),$5)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:r,modules:a,defines:h,inject:l,varyings:y,bufferMode:x,transpileToGLSL100:T}=e;this.programProps={program:n,vs:i,fs:r,modules:a,defines:h,inject:l,varyings:y,bufferMode:x,transpileToGLSL100:T},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return lt(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return lt(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=H5(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(rh(e))return this;const n={};for(const i in e){const r=e[i];n[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return Zx(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:r={},attributes:a={},transformFeedback:h=this.transformFeedback,parameters:l={},vertexArray:y=this.vertexArray}=e;this.setAttributes(a),this.updateModuleSettings(n),this.setUniforms(r);let x;_t.priority>=gu&&(x=this._logDrawCallStart(gu));const T=this.vertexArray.getDrawParams(),{isIndexed:C=T.isIndexed,indexType:S=T.indexType,indexOffset:z=T.indexOffset,vertexArrayInstanced:V=T.isInstanced}=this.props;V&&!this.isInstanced&&_t.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:Z,instanceCount:ue}=this,{onBeforeRender:q=zT,onAfterRender:j=zT}=this.props;q(),this.program.setUniforms(this.uniforms);const K=this.program.draw(Object.assign(Z5,e,{logPriority:x,uniforms:null,framebuffer:i,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:y,transformFeedback:h,isIndexed:C,indexType:S,isInstanced:Z,instanceCount:ue,offset:C?z:0}));return j(),_t.priority>=gu&&this._logDrawCallEnd(x,y,i),K}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:r=[]}=e;let{parameters:a}=e;i&&this._setFeedbackBuffers(i),n&&(a=Object.assign({},a,{[35977]:n})),r.forEach(h=>h.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:a}))}finally{r.forEach(h=>h.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return _t.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:r,modules:a,inject:h,defines:l,varyings:y,bufferMode:x,transpileToGLSL100:T}=this.programProps;n=this.programManager.get({vs:i,fs:r,modules:a,inject:h,defines:l,varyings:y,bufferMode:x,transpileToGLSL100:T}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}lt(n instanceof $M,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new s4(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof Sn&&n.delete()}}_setAnimationProps(e){this.animated&&lt(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(rh(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new ZM(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:q5;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),_t.group(gu,">>> DRAWING MODEL ".concat(this.id),{collapsed:_t.level<=2})(),e}_logDrawCallEnd(e,n,i,r){if(e===void 0)return;const a=l4({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:h,unusedTable:l,unusedCount:y}=vT({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:x,count:T}=vT({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});T>0&&_t.log("MISSING UNIFORMS",Object.keys(x))(),y>0&&_t.log("UNUSED UNIFORMS",Object.keys(l))();const C=u4(this.vertexArray.configuration);_t.table(e,a)(),_t.table(e,h)(),_t.table(e+1,C)(),r&&r.log({logLevel:gu,message:"Rendered to ".concat(r.id)}),_t.groupEnd(gu)()}}class J5{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:r}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof Sn?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&lt($t(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const a=this.feedbackMap[r];r in n&&(i[a]=r)}Object.assign(i,e.feedbackBuffers);for(const r in i){const a=i[r];if(typeof a=="string"){const h=n[a],{byteLength:l,usage:y,accessor:x}=h;i[r]=this._createNewBuffer(r,{byteLength:l,usage:y,accessor:x})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:r}=i;e.transformFeedback=new ZM(this.gl,{program:r,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const r in this.feedbackMap){const a=this.feedbackMap[r];n[r]=e.feedbackBuffers[a],i[a]=e.sourceBuffers[r],lt(i[a]instanceof Sn)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new Sn(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const K5="transform_uSampler_",Wg="transform_uSize_",NT="transform_position";function Y5(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:r}=t,h=Object.keys(n).length,l=null;const y={};let x=e,T={};if(h>0||i){const C=x.split(`
`),S=C.slice();if(C.forEach((z,V,Z)=>{if(h>0){const ue=iG(z,n);if(ue){const{updatedLine:q,inject:j}=ue;S[V]=q,T=a1([T,j]),Object.assign(y,ue.samplerTextureMap),h--}}i&&!l&&(l=nG(z,i))}),i){lt(r);const z="".concat(Wg).concat(i),V="uniform vec2 ".concat(z,`;
`),Z="     vec2 ".concat(NT," = transform_getPos(").concat(z,`);
     gl_Position = vec4(`).concat(NT,`, 0, 1.);
`);T=a1([T,{"vs:#decl":V,"vs:#main-start":Z}])}x=S.join(`
`)}return{vs:x,targetTextureType:l,inject:T,samplerTextureMap:y}}function Q5(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const r={};let a,h;n&&({width:a,height:h}=i,r["".concat(Wg).concat(n)]=[a,h]);for(const l in e)({width:a,height:h}=e[l]),r["".concat(Wg).concat(l)]=[a,h];return r}function eG(t){return nP(t,["attribute","in"])}function tG(t){const e="".concat(K5).concat(t),n="".concat(Wg).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function nG(t,e){const n=nP(t,["varying","out"]);return n&&n.name===e?n.type:null}function iG(t,e){const n={},i=eG(t);if(!i)return null;const{type:r,name:a}=i;if(a&&e[a]){const h="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:y,uniformDeclerations:x}=tG(a),T=Q4(r),C="  ".concat(r," ").concat(a," = transform_getInput(").concat(l,", ").concat(y,").").concat(T,`;
`);return n[l]=a,{updatedLine:h,inject:{"vs:#decl":x,"vs:#main-start":C},samplerTextureMap:n}}return null}const rG={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},sG="transform_output";class oG{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:r,targetTexture:a}=this.bindings[this.currentIndex],h=Object.assign({},n,e.attributes),l=Object.assign({},e.uniforms),y=Object.assign({},e.parameters);let x=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){h.transform_elementID=this.elementIDBuffer;for(const C in this.samplerTextureMap){const S=this.samplerTextureMap[C];l[C]=i[S]}this._setSourceTextureParameters();const T=Q5({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:a});Object.assign(l,T)}return this.hasTargetTexture&&(x=!1,y.viewport=[0,0,r.width,r.height]),{attributes:h,framebuffer:r,uniforms:l,discard:x,parameters:y}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=x_(n);if(!e)return i;const r=i.constructor,a=e6(this.targetTextureType),h=new r(i.length*a/4);let l=0;for(let y=0;y<i.length;y+=4)for(let x=0;x<a;x++)h[l++]=i[y+x];return h}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof xs)return i;const r=n[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:r}=e,a=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:a}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,r,a)=>{a[r]=r}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new Sn(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:r,targetTexture:a}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,i),a){e.targetTexture=a;const{width:h,height:l}=a,{framebuffer:y}=e;y?(y.update({attachments:{[36064]:a},resizeAttachments:!1}),y.resize({width:h,height:l})):e.framebuffer=new Ri(this.gl,{id:"transform-framebuffer",width:h,height:l,attachments:{[36064]:a}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(rG)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=$N(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:a,targetTextureType:h,inject:l,samplerTextureMap:y}=Y5({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),x=a1([e.inject||{},l]);this.targetTextureType=h,this.samplerTextureMap=y;const T=e._fs||iP({version:XM(r),input:this.targetTextureVarying,inputType:h,output:sG}),C=this.hasSourceTextures||this.targetTextureVarying?[V5].concat(e.modules||[]):e.modules;return{vs:r,fs:T,modules:C,uniforms:a,inject:x}}}class ub{static isSupported(e){return $t(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();lt(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const r=i.getData(e);if(r)return r}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new ah(n,Object.assign({},e,{fs:e.fs||iP({version:XM(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=r.updateModelProps(n);return n}_buildResourceTransforms(e,n){aG(n)&&(this.bufferTransform=new J5(e,n)),lG(n)&&(this.textureTransform=new oG(e,n)),lt(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=Object.assign(n,r.getDrawOptions(n));return n}}function aG(t){return!!(!rh(t.feedbackBuffers)||!rh(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function lG(t){return!!(!rh(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const UT={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class tf{static get DRAW_MODE(){return UT}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Pa("geometry"),drawMode:i=UT.TRIANGLES,attributes:r={},indices:a=null,vertexCount:h=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(r,a),this.vertexCount=h||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let r=e[i];r=ArrayBuffer.isView(r)?{value:r}:r,lt(ArrayBuffer.isView(r.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!r.size&&(r.size=3),i==="indices"?(lt(!this.indices),this.indices=r):this.attributes[i]=r}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r in e){const a=e[r],{value:h,size:l,constant:y}=a;!y&&h&&l>=1&&(i=Math.min(i,h.length/l))}return lt(Number.isFinite(i)),i}}let cG=1,uG=1;class EP{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:a=1}=e,h=cG++,l={time:0,delay:n,duration:i,rate:r,repeat:a};return this._setChannelTime(l,this.time),this.channels.set(h,l),h}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:a,channel:h}=r;a.setTime(this.getTime(h))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=uG++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const hG=[255,255,255],dG=1;let fG=0;class pG{constructor(e={}){L(this,"id",void 0),L(this,"color",void 0),L(this,"intensity",void 0),L(this,"type","ambient");const{color:n=hG}=e,{intensity:i=dG}=e;this.id=e.id||"ambient-".concat(fG++),this.color=n,this.intensity=i}}const mG=[255,255,255],gG=1,_G=[0,0,-1];let yG=0;class GT{constructor(e={}){L(this,"id",void 0),L(this,"color",void 0),L(this,"intensity",void 0),L(this,"type","directional"),L(this,"direction",void 0),L(this,"shadow",void 0);const{color:n=mG}=e,{intensity:i=gG}=e,{direction:r=_G}=e,{_shadow:a=!1}=e;this.id=e.id||"directional-".concat(yG++),this.color=n,this.intensity=i,this.type="directional",this.direction=new we(r).normalize().toArray(),this.shadow=a}getProjectedLight(e){return this}}class vG{constructor(e,n={id:"pass"}){L(this,"id",void 0),L(this,"gl",void 0),L(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class hb extends vG{constructor(...e){super(...e),L(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return Ma(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:r,views:a,onViewportActive:h,clearStack:l=!0,clearCanvas:y=!0}=e;e.pass=e.pass||"unknown";const x=this.gl;y&&bG(x,n),l&&(this._lastRenderIndex=-1);const T=[];for(const C of r){const S=a&&a[C.id];h==null||h(C);const z=this._getDrawLayerParams(C,e),V=C.subViewports||[C];for(const Z of V){const ue=this._drawLayersInViewport(x,{target:n,moduleParameters:i,viewport:Z,view:S,pass:e.pass,layers:e.layers},z);T.push(ue)}}return T}_getDrawLayerParams(e,{layers:n,pass:i,isPicking:r=!1,layerFilter:a,cullRect:h,effects:l,moduleParameters:y},x=!1){const T=[],C=TP(this._lastRenderIndex+1),S={layer:n[0],viewport:e,isPicking:r,renderPass:i,cullRect:h},z={};for(let V=0;V<n.length;V++){const Z=n[V],ue=this._shouldDrawLayer(Z,S,a,z),q={shouldDrawLayer:ue};ue&&!x&&(q.layerRenderIndex=C(Z,ue),q.moduleParameters=this._getModuleParameters(Z,l,i,y),q.layerParameters=this.getLayerParameters(Z,V,e)),T[V]=q}return T}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:r,target:a,viewport:h,view:l},y){const x=xG(e,{moduleParameters:i,target:a,viewport:h});if(l&&l.props.clear){const C=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;mo(e,{scissorTest:!0,scissor:x},()=>Zx(e,C))}const T={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Ma(e,{viewport:x});for(let C=0;C<n.length;C++){const S=n[C],{shouldDrawLayer:z,layerRenderIndex:V,moduleParameters:Z,layerParameters:ue}=y[C];if(z&&S.props.pickable&&T.pickableCount++,S.isComposite)T.compositeCount++;else if(z){T.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,V),Z.viewport=h;try{S._drawLayer({moduleParameters:Z,uniforms:{layerIndex:V},parameters:ue})}catch(q){S.raiseError(q,"drawing ".concat(S," to ").concat(r))}}}return T}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let h=e.parent;for(;h;){if(!h.props.visible||!h.filterSubLayer(n))return!1;n.layer=h,h=h.parent}if(i){const l=n.layer.id;if(l in r||(r[l]=i(n)),!r[l])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,r){var a;const h=Object.assign(Object.create(((a=e.internalState)===null||a===void 0?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:ih(this.gl)});if(n)for(const y of n){var l;Object.assign(h,(l=y.getModuleParameters)===null||l===void 0?void 0:l.call(y,e))}return Object.assign(h,this.getModuleParameters(e,n),r)}}function TP(t=0,e={}){const n={},i=(r,a)=>{const h=r.props._offset,l=r.id,y=r.parent&&r.parent.id;let x;if(y&&!(y in e)&&i(r.parent,!1),y in n){const T=n[y]=n[y]||TP(e[y],e);x=T(r,a),n[l]=T}else Number.isFinite(h)?(x=h+(e[y]||0),n[l]=null):x=t;return a&&x>=t&&(t=x+1),e[l]=x,x};return i}function xG(t,{moduleParameters:e,target:n,viewport:i}){const r=n&&n.id!=="default-framebuffer",a=e&&e.devicePixelRatio||ih(t),h=r?n.height:t.drawingBufferHeight,l=i;return[l.x*a,h-(l.y+l.height)*a,l.width*a,l.height*a]}function bG(t,e){const n=e?e.width:t.drawingBufferWidth,i=e?e.height:t.drawingBufferHeight;Ma(t,{viewport:[0,0,n,i]}),t.clear(16640)}class wG extends hb{constructor(e,n){super(e,n),L(this,"shadowMap",void 0),L(this,"depthBuffer",void 0),L(this,"fbo",void 0),this.shadowMap=new xs(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new ku(e,{format:33189,width:1,height:1}),this.fbo=new Ri(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;mo(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],r=ih(this.gl),a=i.width*r,h=i.height*r;(a!==n.width||h!==n.height)&&n.resize({width:a,height:h}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const SP="#define SMOOTH_EDGE_RADIUS 0.5",AG=`
`.concat(SP,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),EG=`
`.concat(SP,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),TG={name:"geometry",vs:AG,fs:EG},SG=Object.keys(rn).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(rn[t],";")).join(""),CG=Object.keys(Ho).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(Ho[t],";")).join(""),IG=Object.keys(n1).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(n1[t],";")).join(""),MG="".concat(SG,`
`).concat(CG,`
`).concat(IG,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function PG(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function $f(t){let e={},n;return i=>{for(const r in i)if(!PG(i[r],e[r])){n=t(i),e=i;break}return n}}const VT=[0,0,0,0],BG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],CP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],LG=[0,0,0],IP=[0,0,0],RG=$f(kG);function MP(t,e,n=IP){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,a=!0;switch(e===rn.LNGLAT_OFFSETS||e===rn.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Ho.WEB_MERCATOR:(e===rn.LNGLAT||e===rn.CARTESIAN)&&(r=[0,0,0],a=!1);break;case Ho.WEB_MERCATOR_AUTO_OFFSET:e===rn.LNGLAT?i=r:e===rn.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case Ho.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case Ho.GLOBE:a=!1,r=null;break;default:a=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:a}}function DG(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:a,viewProjectionMatrix:h}=t,l=VT,y=VT,x=t.cameraPosition;const{geospatialOrigin:T,shaderCoordinateOrigin:C,offsetMode:S}=MP(t,e,n);return S&&(y=t.projectPosition(T||C),x=[x[0]-y[0],x[1]-y[1],x[2]-y[2]],y[3]=1,l=Xf([],y,h),a=i||a,h=bc([],r,a),h=bc([],h,BG)),{viewMatrix:a,viewProjectionMatrix:h,projectionCenter:l,originCommon:y,cameraPosCommon:x,shaderCoordinateOrigin:C,geospatialOrigin:T}}function OG({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=rn.DEFAULT,coordinateOrigin:r=IP,autoWrapLongitude:a=!1}){i===rn.DEFAULT&&(i=t.isGeospatial?rn.LNGLAT:rn.CARTESIAN);const h=RG({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return h.project_uWrapLongitude=a,h.project_uModelMatrix=n||CP,h}function kG({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:a,originCommon:h,cameraPosCommon:l,shaderCoordinateOrigin:y,geospatialOrigin:x}=DG(t,n,i),T=t.getDistanceScales(),C=[t.width*e,t.height*e],S=Xf([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,z={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:y,project_uCommonOrigin:h.slice(0,3),project_uCenter:r,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:C,project_uDevicePixelRatio:e,project_uFocalDistance:S,project_uCommonUnitsPerMeter:T.unitsPerMeter,project_uCommonUnitsPerWorldUnit:T.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:LG,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:a,project_uModelMatrix:CP,project_uCameraPosition:l};if(x){const V=t.getDistanceScales(x);switch(n){case rn.METER_OFFSETS:z.project_uCommonUnitsPerWorldUnit=V.unitsPerMeter,z.project_uCommonUnitsPerWorldUnit2=V.unitsPerMeter2;break;case rn.LNGLAT:case rn.LNGLAT_OFFSETS:t._pseudoMeters||(z.project_uCommonUnitsPerMeter=V.unitsPerMeter),z.project_uCommonUnitsPerWorldUnit=V.unitsPerDegree,z.project_uCommonUnitsPerWorldUnit2=V.unitsPerDegree2;break;case rn.CARTESIAN:z.project_uCommonUnitsPerWorldUnit=[1,1,V.unitsPerMeter[2]],z.project_uCommonUnitsPerWorldUnit2=[0,0,V.unitsPerMeter2[2]];break}}return z}const FG={};function zG(t=FG){return"viewport"in t?OG(t):{}}const db={name:"project",dependencies:[i6,TG],vs:MG,getUniforms:zG};function NG(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Xu(t,e){const n=Xf([],e,t);return _P(n,n,1/n[3]),n}function jT(t,e){const n=t%e;return n<0?e+n:n}function f1(t,e,n){return t<e?e:t>n?n:t}function UG(t){return Math.log(t)*Math.LOG2E}const fb=Math.log2||UG;function Ba(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const uo=Math.PI,PP=uo/4,Ws=uo/180,p1=180/uo,lh=512,Xg=4003e4,Pm=85.051129,GG=1.5;function VG(t){return fb(t)}function Mf(t){const[e,n]=t;Ba(Number.isFinite(e)),Ba(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*Ws,r=n*Ws,a=lh*(i+uo)/(2*uo),h=lh*(uo+Math.log(Math.tan(PP+r*.5)))/(2*uo);return[a,h]}function ch(t){const[e,n]=t,i=e/lh*(2*uo)-uo,r=2*(Math.atan(Math.exp(n/lh*(2*uo)-uo))-PP);return[i*p1,r*p1]}function jG(t){const{latitude:e}=t;Ba(Number.isFinite(e));const n=Math.cos(e*Ws);return VG(Xg*n)-9}function ag(t){const e=Math.cos(t*Ws);return lh/Xg/e}function m1(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Ba(Number.isFinite(e)&&Number.isFinite(n));const r=lh,a=Math.cos(e*Ws),h=r/360,l=h/a,y=r/Xg/a,x={unitsPerMeter:[y,y,y],metersPerUnit:[1/y,1/y,1/y],unitsPerDegree:[h,l,y],degreesPerUnit:[1/h,1/l,1/y]};if(i){const T=Ws*Math.tan(e*Ws)/a,C=h*T/2,S=r/Xg*T,z=S/l*y;x.unitsPerDegree2=[0,C,S],x.unitsPerMeter2=[z,0,z]}return x}function BP(t,e){const[n,i,r]=t,[a,h,l]=e,{unitsPerMeter:y,unitsPerMeter2:x}=m1({longitude:n,latitude:i,highPrecision:!0}),T=Mf(t);T[0]+=a*(y[0]+x[0]*h),T[1]+=h*(y[1]+x[1]*h);const C=ch(T),S=(r||0)+(l||0);return Number.isFinite(r)||Number.isFinite(l)?[C[0],C[1],S]:C}function HG(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:a,center:h}=t,l=NG();Hg(l,l,[0,0,-r]),mP(l,l,-n*Ws),gP(l,l,i*Ws);const y=a/e;return ab(l,l,[y,y,y]),h&&Hg(l,l,b6([],h)),l}function WG(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:a,center:h,scale:l,nearZMultiplier:y=1,farZMultiplier:x=1}=t;let{fovy:T=qg(GG)}=t;i!==void 0&&(T=qg(i));const C=T*Ws,S=r*Ws,z=LP(T);let V=z;h&&(V+=h[2]*l/Math.cos(S)/n);const Z=C*(.5+(a?a[1]:0)/n),ue=Math.sin(Z)*V/Math.sin(f1(Math.PI/2-S-Z,.01,Math.PI-.01)),q=Math.sin(S)*ue+V,j=V*10,K=Math.min(q*x,j);return{fov:C,aspect:e/n,focalDistance:z,near:y,far:K}}function qg(t){return 2*Math.atan(.5/t)*p1}function LP(t){return .5/Math.tan(.5*t*Ws)}function RP(t,e){const[n,i,r=0]=t;return Ba(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),Xu(e,[n,i,r,1])}function pb(t,e,n=0){const[i,r,a]=t;if(Ba(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(a))return Xu(e,[i,r,a,1]);const h=Xu(e,[i,r,0,1]),l=Xu(e,[i,r,1,1]),y=h[2],x=l[2],T=y===x?0:((n||0)-y)/(x-y);return rP([],h,l,T)}function XG(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:a=24,offset:h=[0,0]}=t,[[l,y],[x,T]]=i,C=qG(t.padding),S=Mf([l,f1(T,-Pm,Pm)]),z=Mf([x,f1(y,-Pm,Pm)]),V=[Math.max(Math.abs(z[0]-S[0]),r),Math.max(Math.abs(z[1]-S[1]),r)],Z=[e-C.left-C.right-Math.abs(h[0])*2,n-C.top-C.bottom-Math.abs(h[1])*2];Ba(Z[0]>0&&Z[1]>0);const ue=Z[0]/V[0],q=Z[1]/V[1],j=(C.right-C.left)/2/ue,K=(C.top-C.bottom)/2/q,de=[(z[0]+S[0])/2+j,(z[1]+S[1])/2+K],ve=ch(de),Ie=Math.min(a,fb(Math.abs(Math.min(ue,q))));return Ba(Number.isFinite(Ie)),{longitude:ve[0],latitude:ve[1],zoom:Ie}}function qG(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Ba(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const HT=Math.PI/180;function $G(t,e=0){const{width:n,height:i,unproject:r}=t,a={targetZ:e},h=r([0,i],a),l=r([n,i],a);let y,x;const T=t.fovy?.5*t.fovy*HT:Math.atan(.5/t.altitude),C=(90-t.pitch)*HT;return T>C-.01?(y=WT(t,0,e),x=WT(t,n,e)):(y=r([0,0],a),x=r([n,0],a)),[h,l,x,y]}function WT(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=Xu(i,[e,0,1,1]),a=Xu(i,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(a[2]-r[2]),y=rP([],r,a,l),x=ch(y);return x.push(n),x}const XT=512;function ZG(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:a,zoom:h,bearing:l=0}=t;(r<-180||r>180)&&(r=jT(r+180,360)-180),(l<-180||l>180)&&(l=jT(l+180,360)-180);const y=fb(n/XT);if(h<=y)h=y,a=0;else{const x=n/2/Math.pow(2,h),T=ch([0,x])[1];if(a<T)a=T;else{const C=ch([0,XT-x])[1];a>C&&(a=C)}}return{width:e,height:n,longitude:r,latitude:a,zoom:h,pitch:i,bearing:l}}const JG=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,KG=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,YG=$f(iV),QG=$f(rV),eV=[0,0,0,1],tV=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function nV(t,e){const[n,i,r]=t,a=pb([n,i,r],e);return Number.isFinite(r)?a:[a[0],a[1],0]}function iV({viewport:t,center:e}){return new Yt(t.viewProjectionMatrix).invert().transform(e)}function rV({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,a=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(h=>nV(h,i));for(const h of e){const l=h.clone().translate(new we(t.center).negate()),y=a.map(T=>l.transform(T)),x=new Yt().ortho({left:Math.min(...y.map(T=>T[0])),right:Math.max(...y.map(T=>T[0])),bottom:Math.min(...y.map(T=>T[1])),top:Math.max(...y.map(T=>T[1])),near:Math.min(...y.map(T=>-T[2])),far:Math.max(...y.map(T=>-T[2]))});n.push(x.multiplyRight(h))}return n}function sV(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||eV,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=YG({viewport:t.viewport,center:e.project_uCenter}),a=[],h=QG({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const y=h[l],x=y.clone().translate(new we(t.viewport.center).negate());e.project_uCoordinateSystem===rn.LNGLAT&&e.project_uProjectionMode===Ho.WEB_MERCATOR?(h[l]=x,a[l]=r):(h[l]=y.clone().multiplyRight(tV),a[l]=x.transform(r))}for(let l=0;l<h.length;l++)i["shadow_uViewProjectionMatrices[".concat(l,"]")]=h[l],i["shadow_uProjectCenters[".concat(l,"]")]=a[l],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(l)]=t.shadowMaps[l]:i["shadow_uShadowMap".concat(l)]=t.dummyShadowMap;return i}const S0={name:"shadow",dependencies:[db],vs:JG,fs:KG,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?sV(t,e):{}},oV={color:[255,255,255],intensity:1},qT=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],aV=[0,0,0,200/255];class DP{constructor(e={}){L(this,"id","lighting-effect"),L(this,"props",void 0),L(this,"shadowColor",aV),L(this,"shadow",void 0),L(this,"ambientLight",void 0),L(this,"directionalLights",void 0),L(this,"pointLights",void 0),L(this,"shadowPasses",[]),L(this,"shadowMaps",[]),L(this,"dummyShadowMap",null),L(this,"programManager",void 0),L(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:a,views:h}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=qf.getDefaultProgramManager(e),S0&&this.programManager.addDefaultModule(S0)),this.dummyShadowMap||(this.dummyShadowMap=new xs(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:n,layerFilter:i,viewports:r,onViewportActive:a,views:h,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(S0),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new Yt().lookAt({eye:new we(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new wG(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new pG(oV),this.directionalLights.push(new GT(qT[0]),new GT(qT[1])))}}class lV{constructor(e={}){L(this,"_pool",[]),L(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:a=0,copy:h=!1,initialize:l=!1,maxCount:y}){const x=r||e&&e.constructor||Float32Array,T=n*i+a;if(ArrayBuffer.isView(e)){if(T<=e.length)return e;if(T*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new x(e.buffer,0,T)}let C=1/0;y&&(C=y*i+a);const S=this._allocate(x,T,l,C);return e&&h?S.set(e):l||S.fill(0,0,4),this._release(e),S}release(e){this._release(e)}_allocate(e,n,i,r){let a=Math.max(Math.ceil(n*this.opts.overAlloc),1);a>r&&(a=r);const h=this._pool,l=e.BYTES_PER_ELEMENT*a,y=h.findIndex(x=>x.byteLength>=l);if(y>=0){const x=new e(h.splice(y,1)[0],0,a);return i&&x.fill(0),x}return new e(a)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,a=n.findIndex(h=>h.byteLength>=r);a<0?n.push(i):(a>0||n.length<this.opts.poolSize)&&n.splice(a,0,i),n.length>this.opts.poolSize&&n.shift()}}const Pf=new lV;function Nd(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function cV(t){return[t[12],t[13],t[14]]}function uV(t){return{left:_u(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:_u(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:_u(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:_u(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:_u(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:_u(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const $T=new we;function _u(t,e,n,i){$T.set(t,e,n);const r=$T.len();return{distance:i/r,normal:new we(-t/r,-e/r,-n/r)}}function hV(t){return t-Math.fround(t)}let Sd;function C0(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,a=(r-i)/n;Sd=Pf.allocate(Sd,a,{type:Float32Array,size:n*2});let h=i,l=0;for(;h<r;){for(let y=0;y<n;y++){const x=t[h++];Sd[l+y]=x,Sd[l+y+n]=hV(x)}l+=n*2}return Sd.subarray(0,a*n*2)}function dV(t){let e=null,n=!1;for(const i of t)i&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const fV=Math.PI/180,pV=Nd(),ZT=[0,0,0],mV={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function gV({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:a,near:h,far:l}){const y=t/e,x=n?new Yt().orthographic({fovy:i,aspect:y,focalDistance:r,near:h,far:l}):new Yt().perspective({fovy:i,aspect:y,near:h,far:l});if(a){const{left:T=0,right:C=0,top:S=0,bottom:z=0}=a,V=xa((T+t-C)/2,0,t)-t/2,Z=xa((S+e-z)/2,0,e)-e/2;x[8]-=V*2/t,x[9]+=Z*2/e}return x}class _h{constructor(e={}){L(this,"id",void 0),L(this,"x",void 0),L(this,"y",void 0),L(this,"width",void 0),L(this,"height",void 0),L(this,"padding",void 0),L(this,"isGeospatial",void 0),L(this,"zoom",void 0),L(this,"focalDistance",void 0),L(this,"position",void 0),L(this,"modelMatrix",void 0),L(this,"distanceScales",void 0),L(this,"scale",void 0),L(this,"center",void 0),L(this,"cameraPosition",void 0),L(this,"projectionMatrix",void 0),L(this,"viewMatrix",void 0),L(this,"viewMatrixUncentered",void 0),L(this,"viewMatrixInverse",void 0),L(this,"viewProjectionMatrix",void 0),L(this,"pixelProjectionMatrix",void 0),L(this,"pixelUnprojectionMatrix",void 0),L(this,"resolution",void 0),L(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||mV,this.focalDistance=e.focalDistance||1,this.position=e.position||ZT,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ho.WEB_MERCATOR:Ho.WEB_MERCATOR_AUTO_OFFSET:Ho.IDENTITY}equals(e){return e instanceof _h?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&go(e.projectionMatrix,this.projectionMatrix)&&go(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=RP(i,this.pixelProjectionMatrix),[a,h]=r,l=n?h:this.height-h;return e.length===2?[a,l]:[a,l,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,a,h]=e,l=n?a:this.height-a,y=i&&i*this.distanceScales.unitsPerMeter[2],x=pb([r,l,h],this.pixelUnprojectionMatrix,y),[T,C,S]=this.unprojectPosition(x);return Number.isFinite(h)?[T,C,S]:Number.isFinite(i)?[T,C,i]:[T,C]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=Mf(e);return n[1]=xa(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?ch(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),a=this.unproject([0,this.height],n),h=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],a[0],h[0]),Math.min(i[1],r[1],a[1],h[1]),Math.max(i[0],r[0],a[0],h[0]),Math.max(i[1],r[1],a[1],h[1])]}getDistanceScales(e){return e?m1({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,uV(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=jG({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||m1({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:a,modelMatrix:h}=e;let l=ZT;if(a&&(l=h?new Yt(h).transformAsVector(a,[]):a),this.isGeospatial){const y=this.projectPosition([n,i,0]);this.center=new we(l).scale(this.distanceScales.unitsPerMeter).add(y)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=pV,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:a,fovy:h=75,near:l=.1,far:y=1e3,padding:x=null,focalDistance:T=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Yt().multiplyRight(n).translate(new we(this.center).negate()),this.projectionMatrix=i||gV({width:this.width,height:this.height,orthographic:r,fovyRadians:a||h*fV,focalDistance:T,padding:x,near:l,far:y});const C=Nd();bc(C,C,this.projectionMatrix),bc(C,C,this.viewMatrix),this.viewProjectionMatrix=C,this.viewMatrixInverse=h1([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=cV(this.viewMatrixInverse);const S=Nd(),z=Nd();ab(S,S,[this.width/2,-this.height/2,1]),Hg(S,S,[1,-1,0]),bc(z,S,this.viewProjectionMatrix),this.pixelProjectionMatrix=z,this.pixelUnprojectionMatrix=h1(Nd(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||dn.warn("Pixel project matrix not invertible")()}}L(_h,"displayName","Viewport");class Cc extends _h{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:a=0,bearing:h=0,nearZMultiplier:l=.1,farZMultiplier:y=1.01,orthographic:x=!1,projectionMatrix:T,repeat:C=!1,worldOffset:S=0,position:z,padding:V,legacyMeterSizes:Z=!1}=e;let{width:ue,height:q,altitude:j=1.5}=e;const K=Math.pow(2,r);ue=ue||1,q=q||1;let de,ve=null;if(T)j=T[5]/2,de=qg(j);else{e.fovy?(de=e.fovy,j=LP(de)):de=qg(j);let De;if(V){const{top:Fe=0,bottom:je=0}=V;De=[0,xa((Fe+q-je)/2,0,q)-q/2]}ve=WG({width:ue,height:q,scale:K,center:z&&[0,0,z[2]*ag(n)],offset:De,pitch:a,fovy:de,nearZMultiplier:l,farZMultiplier:y})}let Ie=HG({height:q,pitch:a,bearing:h,scale:K,altitude:j});S&&(Ie=new Yt().translate([512*S,0,0]).multiplyLeft(Ie)),super({...e,width:ue,height:q,viewMatrix:Ie,longitude:i,latitude:n,zoom:r,...ve,fovy:de,focalDistance:j}),L(this,"longitude",void 0),L(this,"latitude",void 0),L(this,"pitch",void 0),L(this,"bearing",void 0),L(this,"altitude",void 0),L(this,"fovy",void 0),L(this,"orthographic",void 0),L(this,"_subViewports",void 0),L(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=a,this.bearing=h,this.altitude=j,this.fovy=de,this.orthographic=x,this._subViewports=C?[]:null,this._pseudoMeters=Z,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const a=r?new Cc({...this,worldOffset:r}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*ag(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/ag(i);return[n,i,r]}addMetersToLngLat(e,n){return BP(e,n)}panByPosition(e,n){const i=pb(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),a=PT([],r,m6([],i)),h=PT([],this.center,a),[l,y]=this.unprojectFlat(h);return{longitude:l,latitude:y}}getBounds(e={}){const n=$G(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:a,latitude:h,zoom:l}=XG({width:i,height:r,bounds:e,...n});return new Cc({width:i,height:r,longitude:a,latitude:h,zoom:l})}}L(Cc,"displayName","WebMercatorViewport");const JT=[0,0,0];function I0(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof Cc){const[r,a,h=0]=t,l=e.getDistanceScales([r,a]);i[2]=h*l.unitsPerMeter[2]}return i}function _V(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:a,fromCoordinateOrigin:h}=t;return r===rn.DEFAULT&&(r=e.isGeospatial?rn.LNGLAT:rn.CARTESIAN),a===void 0&&(a=r),h===void 0&&(h=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:a,fromCoordinateOrigin:h}}function OP(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:a}){let[h,l,y=0]=t;switch(n&&([h,l,y]=Xf([],[h,l,y,1],n)),i){case rn.LNGLAT:return I0([h,l,y],e,a);case rn.LNGLAT_OFFSETS:return I0([h+r[0],l+r[1],y+(r[2]||0)],e,a);case rn.METER_OFFSETS:return I0(BP(r,[h,l,y]),e,a);case rn.CARTESIAN:default:return e.isGeospatial?[h+r[0],l+r[1],y+r[2]]:e.projectPosition([h,l,y])}}function yV(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:a,fromCoordinateSystem:h,fromCoordinateOrigin:l}=_V(e),{autoOffset:y=!0}=e,{geospatialOrigin:x=JT,shaderCoordinateOrigin:T=JT,offsetMode:C=!1}=y?MP(n,i,r):{},S=OP(t,{viewport:n,modelMatrix:a,coordinateSystem:h,coordinateOrigin:l,offsetMode:C});if(C){const z=n.projectPosition(x||T);C6(S,S,z)}return S}const KT={blendFunc:[1,0,32771,0],blendEquation:32774};class kP extends hb{constructor(...e){super(...e),L(this,"pickZ",void 0),L(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:a,pickingFBO:h,deviceRect:{x:l,y,width:x,height:T},cullRect:C,effects:S,pass:z="picking",pickZ:V,moduleParameters:Z}){const ue=this.gl;this.pickZ=V;const q=this._resetColorEncoder(V),j=mo(ue,{scissorTest:!0,scissor:[l,y,x,T],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...KT,blend:!V},()=>super.render({target:h,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:a,cullRect:C,effects:S==null?void 0:S.filter(de=>de.useInPicking),pass:z,isPicking:!0,moduleParameters:Z}));return this._colorEncoderState=null,{decodePickingColor:q&&xV.bind(null,q),stats:j}}shouldDrawLayer(e){const{pickable:n,operation:i}=e.props;return n&&i.includes("draw")||i.includes("terrain")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const r={...e.props.parameters},{pickable:a,operation:h}=e.props;return this._colorEncoderState?a&&h.includes("draw")&&(Object.assign(r,KT),r.blend=!0,r.blendColor=vV(this._colorEncoderState,e,i)):r.blend=!1,h.includes("terrain")&&(r.blend=!1),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function vV(t,e,n){const{byLayer:i,byAlpha:r}=t;let a,h=i.get(e);return h?(h.viewports.push(n),a=h.a):(a=i.size+1,a<=255?(h={a,layer:e,viewports:[n]},i.set(e,h),r[a]=h):(dn.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function xV(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const wu={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},$g=Symbol.for("component"),Sl=Symbol.for("propTypes"),M0=Symbol.for("deprecatedProps"),qu=Symbol.for("asyncPropDefaults"),Ic=Symbol.for("asyncPropOriginal"),gl=Symbol.for("asyncPropResolved");function uh(t,e=()=>!0){return Array.isArray(t)?FP(t,e,[]):e(t)?[t]:[]}function FP(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?FP(r,e,n):e(r)&&n.push(r)}return n}function bV({target:t,source:e,start:n=0,count:i=1}){const r=e.length,a=i*r;let h=0;for(let l=n;h<r;h++)t[l++]=e[h];for(;h<a;)h<a-h?(t.copyWithin(n+h,n,n+h),h*=2):(t.copyWithin(n+h,n,n+a-h),h=a);return t}class wV{constructor(e,n,i){L(this,"id",void 0),L(this,"context",void 0),L(this,"isLoaded",void 0),L(this,"persistent",void 0),L(this,"_loadCount",0),L(this,"_subscribers",new Set),L(this,"_data",void 0),L(this,"_loader",void 0),L(this,"_error",void 0),L(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=Ml(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const a of this._subscribers)a.onChange(this.getData())}}class AV{constructor({gl:e,protocol:n}){L(this,"protocol",void 0),L(this,"_context",void 0),L(this,"_resources",void 0),L(this,"_consumers",void 0),L(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let a=this._resources[e];a?a.setData(n,i):(a=new wV(e,n,this._context),this._resources[e]=a),a.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],a=this._resources[r.resourceId];a&&a.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:a,protocol:h}=this;e.startsWith(h)&&(e=e.replace(h,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=a[e];if(this._track(i,r,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const a=this._consumers,h=a[e]=a[e]||{},l=h[n]||{},y=l.resourceId&&this._resources[l.resourceId];y&&(y.unsubscribe(l),this.prune()),i&&(h[n]=l,l.onChange=r,l.resourceId=i.id,i.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const EV=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,mb={name:"project32",dependencies:[db],vs:EV},gb={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...D5},TV=[db],SV=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function CV(t){const e=qf.getDefaultProgramManager(t);for(const n of TV)e.addDefaultModule(n);for(const n of SV)e.addShaderHook(n);return e}const IV="layerManager.setLayers",MV="layerManager.activateViewport";class PV{constructor(e,{deck:n,stats:i,viewport:r,timeline:a}={}){L(this,"layers",void 0),L(this,"context",void 0),L(this,"resourceManager",void 0),L(this,"_lastRenderedLayers",[]),L(this,"_needsRedraw",!1),L(this,"_needsUpdate",!1),L(this,"_nextLayers",null),L(this,"_debug",!1),L(this,"activateViewport",h=>{fr(MV,this,h),h&&(this.context.viewport=h)}),this.layers=[],this.resourceManager=new AV({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&CV(e),stats:i||new qx({id:"deck.gl"}),viewport:r||new _h({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new EP,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){fr(IV,this,n,e),this._lastRenderedLayers=e;const i=uh(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const h of e)i[h.id]?dn.warn("Multiple old layers with same id ".concat(h.id))():i[h.id]=h;const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let a=!1;for(const h of r)if(h.hasUniformTransition()){a="Uniform transition in ".concat(h);break}this._needsUpdate=a,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const a=n[r.id];a===null&&dn.warn("Multiple new layers with same id ".concat(r.id))(),n[r.id]=null;let h=null;try{this._debug&&a!==r&&r.validateProps(),a?(this._transferLayerState(a,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),h=r.isComposite?r.getSubLayers():null}catch(l){this._handleError("matching",l,r)}h&&this._updateSublayersRecursively(h,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=wu.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=wu.MATCHED,n!==e&&(e.lifecycle=wu.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=wu.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=wu.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Wo(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Wo(t[i],e[i],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!Wo(t[a],e[a],n-1))return!1;return!0}return!1}class BV{constructor(e){L(this,"width",void 0),L(this,"height",void 0),L(this,"views",void 0),L(this,"viewState",void 0),L(this,"controllers",void 0),L(this,"timeline",void 0),L(this,"_viewports",void 0),L(this,"_viewportMap",void 0),L(this,"_isUpdating",void 0),L(this,"_needsRedraw",void 0),L(this,"_needsUpdate",void 0),L(this,"_eventManager",void 0),L(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let a=i.length-1;a>=0;--a){const h=i[a];if(h.containsPixel(r)){const l=e.slice();return l[0]-=h.x,l[1]-=h.y,h.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=uh(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Wo(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):dn.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>{var h;return(h=this.getView(e.id))===null||h===void 0?void 0:h.makeViewport({viewState:a,width:this.width,height:this.height})}})}_updateController(e,n,i,r){const a=e.controller;if(a&&i){const h={...n,...a,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!r||r.constructor!==e.ControllerType)&&(r=this._createController(e,h)),r&&r.setProps(h),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const a=e[r],h=this.getViewState(a),l=a.makeViewport({viewState:h,width:this.width,height:this.height});let y=n[a.id];const x=!!a.controller;x&&!y&&(i=!0),(i||!x)&&y&&(y.finalize(),y=null),this.controllers[a.id]=this._updateController(a,h,l,y),l&&this._viewports.unshift(l)}for(const r in n){const a=n[r];a&&!this.controllers[r]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const LV=/([0-9]+\.?[0-9]*)(%|px)/;function rl(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=LV.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function sl(t,e){return t.relative?Math.round(t.position*e):t.position}function Ai(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class RV{constructor(e){L(this,"id",void 0),L(this,"viewportInstance",void 0),L(this,"_x",void 0),L(this,"_y",void 0),L(this,"_width",void 0),L(this,"_height",void 0),L(this,"_padding",void 0),L(this,"props",void 0);const{id:n,x:i=0,y:r=0,width:a="100%",height:h="100%",padding:l=null,viewportInstance:y}=e||{};Ai(!y||y instanceof _h),this.viewportInstance=y,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=rl(i),this._y=rl(r),this._width=rl(a),this._height=rl(h),this._padding=l&&{left:rl(l.left||0),right:rl(l.right||0),top:rl(l.top||0),bottom:rl(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Wo(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});return!r.height||!r.width?null:new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:sl(this._x,e),y:sl(this._y,n),width:sl(this._width,e),height:sl(this._height,n)};return this._padding&&(i.padding={left:sl(this._padding.left,e),top:sl(this._padding.top,n),right:sl(this._padding.right,e),bottom:sl(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Zf{constructor(e){L(this,"_inProgress",void 0),L(this,"_handle",void 0),L(this,"_timeline",void 0),L(this,"time",void 0),L(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const YT=()=>{},g1={BREAK:1,SNAP_TO_END:2,IGNORE:3},DV=t=>t,OV=g1.BREAK;class kV{constructor(e){L(this,"getControllerState",void 0),L(this,"props",void 0),L(this,"propsInTransition",void 0),L(this,"transition",void 0),L(this,"onViewStateChange",void 0),L(this,"onStateChange",void 0),L(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:r,startProps:a,endProps:h,duration:l,easing:y}}=n,x=y(i/l),T=r.interpolateProps(a,h,x);this.propsInTransition=this.getControllerState({...this.props,...T}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Zf(e.timeline),this.onViewStateChange=e.onViewStateChange||YT,this.onStateChange=e.onStateChange||YT}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:a,endProps:h}=this.transition.settings;r={...i,...a===g1.SNAP_TO_END?h:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===g1.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),a=n.transitionInterpolator,h=a.getDuration?a.getDuration(e,n):n.transitionDuration;if(h===0)return;const l=a.initializeProps(e,r);this.propsInTransition={};const y={duration:h,easing:n.transitionEasing||DV,interpolator:a,interruption:n.transitionInterruption||OV,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(y),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class FV{constructor(e){L(this,"_propsToCompare",void 0),L(this,"_propsToExtract",void 0),L(this,"_requiredProps",void 0);const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!go(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const a of this._propsToExtract)(a in e||a in n)&&(i[a]=e[a],r[a]=n[a]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const i=e[n];Ai(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const zV=["longitude","latitude","zoom","bearing","pitch"],NV=["longitude","latitude","zoom"];class zP extends FV{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:zV,required:NV},super(i.transitionProps),L(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:a}=this.opts;if(r&&a){const h=r(e),l=r(n),y=h.unproject(a);i.start.around=a,Object.assign(i.end,{around:l.project(y),aroundPosition:y,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const a of this._propsToExtract)r[a]=jg(e[a]||0,n[a]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...n,...r});Object.assign(r,a.panByPosition(n.aroundPosition,jg(e.around,n.around,i)))}return r}}const ol={transitionDuration:0},UV=300,Bm=t=>1-(1-t)*(1-t),yu={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ac={};class GV{constructor(e){L(this,"props",void 0),L(this,"state",{}),L(this,"transitionManager",void 0),L(this,"eventManager",void 0),L(this,"onViewStateChange",void 0),L(this,"onStateChange",void 0),L(this,"makeViewport",void 0),L(this,"_controllerState",void 0),L(this,"_events",{}),L(this,"_interactionState",{isDragging:!1}),L(this,"_customEvents",[]),L(this,"_eventStartBlocked",null),L(this,"_panMove",!1),L(this,"invertPan",!1),L(this,"dragMode","rotate"),L(this,"inertia",0),L(this,"scrollZoom",!0),L(this,"dragPan",!0),L(this,"dragRotate",!0),L(this,"doubleClickZoom",!0),L(this,"touchZoom",!0),L(this,"touchRotate",!1),L(this,"keyboard",!0),this.transitionManager=new kV({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const a=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return a&&n&&n.stopPropagation(),a}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?UV:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:a=!0,doubleClickZoom:h=!0,touchZoom:l=!0,touchRotate:y=!1,keyboard:x=!0}=e,T=!!this.onViewStateChange;this.toggleEvents(yu.WHEEL,T&&i),this.toggleEvents(yu.PAN,T&&(r||a)),this.toggleEvents(yu.PINCH,T&&(l||y)),this.toggleEvents(yu.TRIPLE_PAN,T&&y),this.toggleEvents(yu.DOUBLE_TAP,T&&h),this.toggleEvents(yu.KEYBOARD,T&&x),this.scrollZoom=i,this.dragPan=r,this.dragRotate=a,this.doubleClickZoom=h,this.touchZoom=l,this.touchRotate=y,this.keyboard=x}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},a=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),a){const h=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:h})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,ol,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,ol,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],a=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Bm},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,ol,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],a=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Bm},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=e;let h=2/(1+Math.exp(-Math.abs(a*i)));a<0&&h!==0&&(h=1/h);const l=this.controllerState.zoom({pos:n,scale:h});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,ol,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,ol,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],a=this.controllerState.rotate({pos:r});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Bm},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return ac._startPinchRotation=e.rotation,ac._lastPinchEvent=e,this.updateViewport(i,ol,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:ac._startPinchRotation-i})}return this.updateViewport(n,ol,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ac._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=ac;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let a=this.controllerState.rotateEnd();const h=Math.log2(e.scale),l=(h-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),y=Math.pow(2,h+l*n/2);a=a.zoom({pos:r,scale:y}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:Bm},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ac._startPinchRotation=null,ac._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:a,rotateSpeedY:h}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let y;const x={};switch(e.srcEvent.code){case"Minus":y=n?l.zoomOut(i).zoomOut(i):l.zoomOut(i),x.isZooming=!0;break;case"Equal":y=n?l.zoomIn(i).zoomIn(i):l.zoomIn(i),x.isZooming=!0;break;case"ArrowLeft":n?(y=l.rotateLeft(a),x.isRotating=!0):(y=l.moveLeft(r),x.isPanning=!0);break;case"ArrowRight":n?(y=l.rotateRight(a),x.isRotating=!0):(y=l.moveRight(r),x.isPanning=!0);break;case"ArrowUp":n?(y=l.rotateUp(h),x.isRotating=!0):(y=l.moveUp(r),x.isPanning=!0);break;case"ArrowDown":n?(y=l.rotateDown(h),x.isRotating=!0):(y=l.moveDown(r),x.isPanning=!0);break;default:return!1}return this.updateViewport(y,this._getTransitionProps(),x),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?ol:e?{...n,transitionInterpolator:new zP({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class VV{constructor(e,n){L(this,"_viewportProps",void 0),L(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const QT=5,jV=1.2;class HV extends VV{constructor(e){const{width:n,height:i,latitude:r,longitude:a,zoom:h,bearing:l=0,pitch:y=0,altitude:x=1.5,position:T=[0,0,0],maxZoom:C=20,minZoom:S=0,maxPitch:z=60,minPitch:V=0,startPanLngLat:Z,startZoomLngLat:ue,startRotatePos:q,startBearing:j,startPitch:K,startZoom:de,normalize:ve=!0}=e;Ai(Number.isFinite(a)),Ai(Number.isFinite(r)),Ai(Number.isFinite(h)),super({width:n,height:i,latitude:r,longitude:a,zoom:h,bearing:l,pitch:y,altitude:x,maxZoom:C,minZoom:S,maxPitch:z,minPitch:V,normalize:ve,position:T},{startPanLngLat:Z,startZoomLngLat:ue,startRotatePos:q,startBearing:j,startPitch:K,startZoom:de}),L(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:a,startPitch:h}=this.getState();if(!r||a===void 0||h===void 0)return this;let l;return e?l=this._getNewRotation(e,r,h,a):l={bearing:a+n,pitch:h+i},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:a}=this.getState();if(a||(r=this.getViewportProps().zoom,a=this._unproject(n)||this._unproject(e)),!a)return this;const{maxZoom:h,minZoom:l}=this.getViewportProps();let y=r+Math.log2(i);y=xa(y,l,h);const x=this.makeViewport({...this.getViewportProps(),zoom:y});return this._getUpdatedState({zoom:y,...x.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:a}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(a-n.longitude)>180&&(i.longitude=a<0?a+360:a-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=xa(r,i,n);const{maxPitch:a,minPitch:h,pitch:l}=e;e.pitch=xa(l,h,a);const{normalize:y=!0}=e;return y&&Object.assign(e,ZG(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const a=e[0]-n[0],h=e[1]-n[1],l=e[1],y=n[1],{width:x,height:T}=this.getViewportProps(),C=a/x;let S=0;h>0?Math.abs(T-y)>QT&&(S=h/(y-T)*jV):h<0&&y>QT&&(S=1-l/y),S=xa(S,-1,1);const{minPitch:z,maxPitch:V}=this.getViewportProps(),Z=r+180*C;let ue=i;return S>0?ue=i+S*(V-i):S<0&&(ue=i-S*(z-i)),{pitch:ue,bearing:Z}}}class WV extends GV{constructor(...e){super(...e),L(this,"ControllerState",HV),L(this,"transition",{transitionDuration:300,transitionInterpolator:new zP({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),L(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class _b extends RV{get ViewportType(){return Cc}get ControllerType(){return WV}}L(_b,"displayName","MapView");const XV=new DP;function qV(t,e){var n,i;const r=(n=t.order)!==null&&n!==void 0?n:1/0,a=(i=e.order)!==null&&i!==void 0?i:1/0;return r-a}class $V{constructor(){L(this,"effects",void 0),L(this,"_resolvedEffects",[]),L(this,"_defaultEffects",[]),L(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(i=>i.id===e.id)){const i=n.findIndex(r=>qV(r,e)>0);i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Wo(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const r of this.effects)n[r.id]=r;const i=[];for(const r of e){const a=n[r.id];a&&a!==r?a.setProps?(a.setProps(r.props),i.push(a)):(a.cleanup(),i.push(r)):i.push(r),delete n[r.id]}for(const r in n)n[r].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(r=>r instanceof DP)||this._resolvedEffects.push(XV),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class ZV extends hb{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const JV="deckRenderer.renderLayers";class KV{constructor(e){L(this,"gl",void 0),L(this,"layerFilter",void 0),L(this,"drawPickingColors",void 0),L(this,"drawLayersPass",void 0),L(this,"pickLayersPass",void 0),L(this,"renderCount",void 0),L(this,"_needsRedraw",void 0),L(this,"renderBuffers",void 0),L(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new ZV(e),this.pickLayersPass=new kP(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Ri.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const r=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,a=n.render({...i,target:r});i.effects&&this._postRender(i.effects,i),this.renderCount++,fr(JV,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const i of e)n.preRenderStats[i.id]=i.preRender(this.gl,n),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Ri(this.gl),new Ri(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,r={...n,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const a of e)if(a.postRender){if(a.id===this.lastPostProcessEffect){r.target=n.target,a.postRender(this.gl,r);break}const h=a.postRender(this.gl,r);r.inputBuffer=h,r.swapBuffer=h===i[0]?i[1]:i[0]}}}const YV={pickedColor:null,pickedObjectIndex:-1};function QV({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:a}){const{x:h,y:l,width:y,height:x}=a;let T=r*r,C=-1,S=0;for(let z=0;z<x;z++){const V=z+l-i,Z=V*V;if(Z>T)S+=4*y;else for(let ue=0;ue<y;ue++){if(t[S+3]-1>=0){const j=ue+h-n,K=j*j+Z;K<=T&&(T=K,C=S)}S+=4}}if(C>=0){const z=t.slice(C,C+4),V=e(z);if(V){const Z=Math.floor(C/4/y),ue=C/4-Z*y;return{...V,pickedColor:z,pickedX:h+ue,pickedY:l+Z}}dn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return YV}function e8({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const a=t.slice(i,i+4),h=a.join(",");if(!n.has(h)){const l=e(a);l?n.set(h,{...l,color:a}):dn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function NP({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:a}){let h=e[0];e.length>1&&(h=n8((t==null?void 0:t.pickedViewports)||e,{x:i,y:r}));let l;if(h){const y=[i-h.x,r-h.y];a!==void 0&&(y[2]=a),l=h.unproject(y)}return{color:null,layer:null,viewport:h,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function t8(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:a,pickedLayer:h,pickedObjectIndex:l}=e,y=h?[h]:[];if(i==="hover"){const C=n.index,S=n.layerId,z=h?h.props.id:null;if(z!==S||l!==C){if(z!==S){const V=r.find(Z=>Z.props.id===S);V&&y.unshift(V)}n.layerId=z,n.index=l,n.info=null}}const x=NP(t),T=new Map;return T.set(null,x),y.forEach(C=>{let S={...x};C===h&&(S.color=a,S.index=l,S.picked=!0),S=UP({layer:C,info:S,mode:i});const z=S.layer;C===h&&i==="hover"&&(n.info=S),T.set(z.id,S),i==="hover"&&z.updateAutoHighlight(S)}),T}function UP({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function n8(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class i8{constructor(e){L(this,"gl",void 0),L(this,"pickingFBO",void 0),L(this,"depthFBO",void 0),L(this,"pickLayersPass",void 0),L(this,"layerFilter",void 0),L(this,"lastPickedInfo",void 0),L(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new kP(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},a=this.lastPickedInfo.info){const h=a&&a.layer&&a.layer.id,l=a&&a.viewport&&a.viewport.id,y=h?i.find(S=>S.id===h):null,x=l&&r.find(S=>S.id===l)||r[0],T=x&&x.unproject([e-x.x,n-x.y]);return{...a,...{x:e,y:n,viewport:x,coordinate:T,layer:y}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new Ri(i),Ri.isSupported(i,{colorBufferFloat:!0}))){const r=new Ri(i);r.attach({[36064]:new xs(i,{format:$t(i)?34836:6408,type:5126})}),this.depthFBO=r}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:a,radius:h=0,depth:l=1,mode:y="query",unproject3D:x,onViewportActive:T,effects:C}){const S=this._getPickable(e),z=ih(this.gl);if(!S)return{result:[],emptyInfo:NP({viewports:i,x:r,y:a,pixelRatio:z})};this._resizeBuffer();const V=f0(this.gl,[r,a],!0),Z=[V.x+Math.floor(V.width/2),V.y+Math.floor(V.height/2)],ue=Math.round(h*z),{width:q,height:j}=this.pickingFBO,K=this._getPickingRect({deviceX:Z[0],deviceY:Z[1],deviceRadius:ue,deviceWidth:q,deviceHeight:j}),de={x:r-h,y:a-h,width:h*2+1,height:h*2+1};let ve;const Ie=[],De=new Set;for(let Fe=0;Fe<l;Fe++){let je;if(K){const dt=this._drawAndSample({layers:S,views:n,viewports:i,onViewportActive:T,deviceRect:K,cullRect:de,effects:C,pass:"picking:".concat(y)});je=QV({...dt,deviceX:Z[0],deviceY:Z[1],deviceRadius:ue,deviceRect:K})}else je={pickedColor:null,pickedObjectIndex:-1};let Ne;if(je.pickedLayer&&x&&this.depthFBO){const{pickedColors:dt}=this._drawAndSample({layers:[je.pickedLayer],views:n,viewports:i,onViewportActive:T,deviceRect:{x:je.pickedX,y:je.pickedY,width:1,height:1},cullRect:de,effects:C,pass:"picking:".concat(y,":z")},!0);dt[3]&&(Ne=dt[0])}je.pickedLayer&&Fe+1<l&&(De.add(je.pickedLayer),je.pickedLayer.disablePickingIndex(je.pickedObjectIndex)),ve=t8({pickInfo:je,lastPickedInfo:this.lastPickedInfo,mode:y,layers:S,viewports:i,x:r,y:a,z:Ne,pixelRatio:z});for(const dt of ve.values())dt.layer&&Ie.push(dt);if(!je.pickedColor)break}for(const Fe of De)Fe.restorePickingColors();return{result:Ie,emptyInfo:ve.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:a,width:h=1,height:l=1,mode:y="query",maxObjects:x=null,onViewportActive:T,effects:C}){const S=this._getPickable(e);if(!S)return[];this._resizeBuffer();const z=ih(this.gl),V=f0(this.gl,[r,a],!0),Z=V.x,ue=V.y+V.height,q=f0(this.gl,[r+h,a+l],!0),j=q.x+q.width,K=q.y,de={x:Z,y:K,width:j-Z,height:ue-K},ve=this._drawAndSample({layers:S,views:n,viewports:i,onViewportActive:T,deviceRect:de,cullRect:{x:r,y:a,width:h,height:l},effects:C,pass:"picking:".concat(y)}),Ie=e8(ve),De=new Map,Fe=Number.isFinite(x);for(let je=0;je<Ie.length&&!(Fe&&x&&De.size>=x);je++){const Ne=Ie[je];let dt={color:Ne.pickedColor,layer:null,index:Ne.pickedObjectIndex,picked:!0,x:r,y:a,pixelRatio:z};dt=UP({layer:Ne.pickedLayer,info:dt,mode:y}),De.has(dt.object)||De.set(dt.object,dt)}return Array.from(De.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:a,cullRect:h,effects:l,pass:y},x=!1){const T=x?this.depthFBO:this.pickingFBO,C={layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:T,deviceRect:a,cullRect:h,effects:l,pass:y,pickZ:x,preRenderStats:{}};for(const j of l)j.useInPicking&&(C.preRenderStats[j.id]=j.preRender(this.gl,C));const{decodePickingColor:S}=this.pickLayersPass.render(C),{x:z,y:V,width:Z,height:ue}=a,q=new(x?Float32Array:Uint8Array)(Z*ue*4);return x_(T,{sourceX:z,sourceY:V,sourceWidth:Z,sourceHeight:ue,target:q}),{pickedColors:q,decodePickingColor:S}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:a}){const h=Math.max(0,e-i),l=Math.max(0,n-i),y=Math.min(r,e+i+1)-h,x=Math.min(a,n+i+1)-l;return y<=0||x<=0?null:{x:h,y:l,width:y,height:x}}}const r8={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class s8{constructor(e){L(this,"el",null),L(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,r8),n.appendChild(this.el))}setTooltip(e,n,i){const r=this.el;if(r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(n,"px, ").concat(i,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(r.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var GP={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,r){var a=["","webkit","Moz","MS","ms","o"],h=n.createElement("div"),l="function",y=Math.round,x=Math.abs,T=Date.now;function C(W,Q,ce){return setTimeout(K(W,ce),Q)}function S(W,Q,ce){return Array.isArray(W)?(z(W,ce[Q],ce),!0):!1}function z(W,Q,ce){var Se;if(W)if(W.forEach)W.forEach(Q,ce);else if(W.length!==r)for(Se=0;Se<W.length;)Q.call(ce,W[Se],Se,W),Se++;else for(Se in W)W.hasOwnProperty(Se)&&Q.call(ce,W[Se],Se,W)}function V(W,Q,ce){var Se="DEPRECATED METHOD: "+Q+`
`+ce+` AT 
`;return function(){var Ge=new Error("get-stack-trace"),ct=Ge&&Ge.stack?Ge.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",zt=e.console&&(e.console.warn||e.console.log);return zt&&zt.call(e.console,Se,ct),W.apply(this,arguments)}}var Z;typeof Object.assign!="function"?Z=function(Q){if(Q===r||Q===null)throw new TypeError("Cannot convert undefined or null to object");for(var ce=Object(Q),Se=1;Se<arguments.length;Se++){var Ge=arguments[Se];if(Ge!==r&&Ge!==null)for(var ct in Ge)Ge.hasOwnProperty(ct)&&(ce[ct]=Ge[ct])}return ce}:Z=Object.assign;var ue=V(function(Q,ce,Se){for(var Ge=Object.keys(ce),ct=0;ct<Ge.length;)(!Se||Se&&Q[Ge[ct]]===r)&&(Q[Ge[ct]]=ce[Ge[ct]]),ct++;return Q},"extend","Use `assign`."),q=V(function(Q,ce){return ue(Q,ce,!0)},"merge","Use `assign`.");function j(W,Q,ce){var Se=Q.prototype,Ge;Ge=W.prototype=Object.create(Se),Ge.constructor=W,Ge._super=Se,ce&&Z(Ge,ce)}function K(W,Q){return function(){return W.apply(Q,arguments)}}function de(W,Q){return typeof W==l?W.apply(Q&&Q[0]||r,Q):W}function ve(W,Q){return W===r?Q:W}function Ie(W,Q,ce){z(Ne(Q),function(Se){W.addEventListener(Se,ce,!1)})}function De(W,Q,ce){z(Ne(Q),function(Se){W.removeEventListener(Se,ce,!1)})}function Fe(W,Q){for(;W;){if(W==Q)return!0;W=W.parentNode}return!1}function je(W,Q){return W.indexOf(Q)>-1}function Ne(W){return W.trim().split(/\s+/g)}function dt(W,Q,ce){if(W.indexOf&&!ce)return W.indexOf(Q);for(var Se=0;Se<W.length;){if(ce&&W[Se][ce]==Q||!ce&&W[Se]===Q)return Se;Se++}return-1}function Nt(W){return Array.prototype.slice.call(W,0)}function Xt(W,Q,ce){for(var Se=[],Ge=[],ct=0;ct<W.length;){var zt=Q?W[ct][Q]:W[ct];dt(Ge,zt)<0&&Se.push(W[ct]),Ge[ct]=zt,ct++}return ce&&(Q?Se=Se.sort(function(Dt,Xn){return Dt[Q]>Xn[Q]}):Se=Se.sort()),Se}function Lt(W,Q){for(var ce,Se,Ge=Q[0].toUpperCase()+Q.slice(1),ct=0;ct<a.length;){if(ce=a[ct],Se=ce?ce+Ge:Q,Se in W)return Se;ct++}return r}var jn=1;function yt(){return jn++}function Yn(W){var Q=W.ownerDocument||W;return Q.defaultView||Q.parentWindow||e}var Ke=/mobile|tablet|ip(ad|hone|od)|android/i,vt="ontouchstart"in e,Et=Lt(e,"PointerEvent")!==r,en=vt&&Ke.test(navigator.userAgent),sn="touch",ji="pen",pi="mouse",Di="kinect",mi=25,mn=1,Oi=2,Jt=4,Hn=8,As=1,Hi=2,ai=4,Jr=8,tr=16,Ti=Hi|ai,nr=Jr|tr,xo=Ti|nr,Ht=["x","y"],Wi=["clientX","clientY"];function Wn(W,Q){var ce=this;this.manager=W,this.callback=Q,this.element=W.element,this.target=W.options.inputTarget,this.domHandler=function(Se){de(W.options.enable,[W])&&ce.handler(Se)},this.init()}Wn.prototype={handler:function(){},init:function(){this.evEl&&Ie(this.element,this.evEl,this.domHandler),this.evTarget&&Ie(this.target,this.evTarget,this.domHandler),this.evWin&&Ie(Yn(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&De(this.element,this.evEl,this.domHandler),this.evTarget&&De(this.target,this.evTarget,this.domHandler),this.evWin&&De(Yn(this.element),this.evWin,this.domHandler)}};function Es(W){var Q,ce=W.options.inputClass;return ce?Q=ce:Et?Q=yr:en?Q=kr:vt?Q=ee:Q=Mt,new Q(W,Jo)}function Jo(W,Q,ce){var Se=ce.pointers.length,Ge=ce.changedPointers.length,ct=Q&mn&&Se-Ge===0,zt=Q&(Jt|Hn)&&Se-Ge===0;ce.isFirst=!!ct,ce.isFinal=!!zt,ct&&(W.session={}),ce.eventType=Q,Kr(W,ce),W.emit("hammer.input",ce),W.recognize(ce),W.session.prevInput=ce}function Kr(W,Q){var ce=W.session,Se=Q.pointers,Ge=Se.length;ce.firstInput||(ce.firstInput=Dr(Q)),Ge>1&&!ce.firstMultiple?ce.firstMultiple=Dr(Q):Ge===1&&(ce.firstMultiple=!1);var ct=ce.firstInput,zt=ce.firstMultiple,Bn=zt?zt.center:ct.center,Dt=Q.center=Be(Se);Q.timeStamp=T(),Q.deltaTime=Q.timeStamp-ct.timeStamp,Q.angle=Gt(Bn,Dt),Q.distance=ki(Bn,Dt),Yr(ce,Q),Q.offsetDirection=Ts(Q.deltaX,Q.deltaY);var Xn=$e(Q.deltaTime,Q.deltaX,Q.deltaY);Q.overallVelocityX=Xn.x,Q.overallVelocityY=Xn.y,Q.overallVelocity=x(Xn.x)>x(Xn.y)?Xn.x:Xn.y,Q.scale=zt?Xi(zt.pointers,Se):1,Q.rotation=zt?ir(zt.pointers,Se):0,Q.maxPointers=ce.prevInput?Q.pointers.length>ce.prevInput.maxPointers?Q.pointers.length:ce.prevInput.maxPointers:Q.pointers.length,bo(ce,Q);var vr=W.element;Fe(Q.srcEvent.target,vr)&&(vr=Q.srcEvent.target),Q.target=vr}function Yr(W,Q){var ce=Q.center,Se=W.offsetDelta||{},Ge=W.prevDelta||{},ct=W.prevInput||{};(Q.eventType===mn||ct.eventType===Jt)&&(Ge=W.prevDelta={x:ct.deltaX||0,y:ct.deltaY||0},Se=W.offsetDelta={x:ce.x,y:ce.y}),Q.deltaX=Ge.x+(ce.x-Se.x),Q.deltaY=Ge.y+(ce.y-Se.y)}function bo(W,Q){var ce=W.lastInterval||Q,Se=Q.timeStamp-ce.timeStamp,Ge,ct,zt,Bn;if(Q.eventType!=Hn&&(Se>mi||ce.velocity===r)){var Dt=Q.deltaX-ce.deltaX,Xn=Q.deltaY-ce.deltaY,vr=$e(Se,Dt,Xn);ct=vr.x,zt=vr.y,Ge=x(vr.x)>x(vr.y)?vr.x:vr.y,Bn=Ts(Dt,Xn),W.lastInterval=Q}else Ge=ce.velocity,ct=ce.velocityX,zt=ce.velocityY,Bn=ce.direction;Q.velocity=Ge,Q.velocityX=ct,Q.velocityY=zt,Q.direction=Bn}function Dr(W){for(var Q=[],ce=0;ce<W.pointers.length;)Q[ce]={clientX:y(W.pointers[ce].clientX),clientY:y(W.pointers[ce].clientY)},ce++;return{timeStamp:T(),pointers:Q,center:Be(Q),deltaX:W.deltaX,deltaY:W.deltaY}}function Be(W){var Q=W.length;if(Q===1)return{x:y(W[0].clientX),y:y(W[0].clientY)};for(var ce=0,Se=0,Ge=0;Ge<Q;)ce+=W[Ge].clientX,Se+=W[Ge].clientY,Ge++;return{x:y(ce/Q),y:y(Se/Q)}}function $e(W,Q,ce){return{x:Q/W||0,y:ce/W||0}}function Ts(W,Q){return W===Q?As:x(W)>=x(Q)?W<0?Hi:ai:Q<0?Jr:tr}function ki(W,Q,ce){ce||(ce=Ht);var Se=Q[ce[0]]-W[ce[0]],Ge=Q[ce[1]]-W[ce[1]];return Math.sqrt(Se*Se+Ge*Ge)}function Gt(W,Q,ce){ce||(ce=Ht);var Se=Q[ce[0]]-W[ce[0]],Ge=Q[ce[1]]-W[ce[1]];return Math.atan2(Ge,Se)*180/Math.PI}function ir(W,Q){return Gt(Q[1],Q[0],Wi)+Gt(W[1],W[0],Wi)}function Xi(W,Q){return ki(Q[0],Q[1],Wi)/ki(W[0],W[1],Wi)}var qi={mousedown:mn,mousemove:Oi,mouseup:Jt},Ss="mousedown",qe="mousemove mouseup";function Mt(){this.evEl=Ss,this.evWin=qe,this.pressed=!1,Wn.apply(this,arguments)}j(Mt,Wn,{handler:function(Q){var ce=qi[Q.type];ce&mn&&Q.button===0&&(this.pressed=!0),ce&Oi&&Q.which!==1&&(ce=Jt),this.pressed&&(ce&Jt&&(this.pressed=!1),this.callback(this.manager,ce,{pointers:[Q],changedPointers:[Q],pointerType:pi,srcEvent:Q}))}});var It={pointerdown:mn,pointermove:Oi,pointerup:Jt,pointercancel:Hn,pointerout:Hn},li={2:sn,3:ji,4:pi,5:Di},Qr="pointerdown",Ct="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Qr="MSPointerDown",Ct="MSPointerMove MSPointerUp MSPointerCancel");function yr(){this.evEl=Qr,this.evWin=Ct,Wn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}j(yr,Wn,{handler:function(Q){var ce=this.store,Se=!1,Ge=Q.type.toLowerCase().replace("ms",""),ct=It[Ge],zt=li[Q.pointerType]||Q.pointerType,Bn=zt==sn,Dt=dt(ce,Q.pointerId,"pointerId");ct&mn&&(Q.button===0||Bn)?Dt<0&&(ce.push(Q),Dt=ce.length-1):ct&(Jt|Hn)&&(Se=!0),!(Dt<0)&&(ce[Dt]=Q,this.callback(this.manager,ct,{pointers:ce,changedPointers:[Q],pointerType:zt,srcEvent:Q}),Se&&ce.splice(Dt,1))}});var Qn={touchstart:mn,touchmove:Oi,touchend:Jt,touchcancel:Hn},wo="touchstart",Nn="touchstart touchmove touchend touchcancel";function gi(){this.evTarget=wo,this.evWin=Nn,this.started=!1,Wn.apply(this,arguments)}j(gi,Wn,{handler:function(Q){var ce=Qn[Q.type];if(ce===mn&&(this.started=!0),!!this.started){var Se=on.call(this,Q,ce);ce&(Jt|Hn)&&Se[0].length-Se[1].length===0&&(this.started=!1),this.callback(this.manager,ce,{pointers:Se[0],changedPointers:Se[1],pointerType:sn,srcEvent:Q})}}});function on(W,Q){var ce=Nt(W.touches),Se=Nt(W.changedTouches);return Q&(Jt|Hn)&&(ce=Xt(ce.concat(Se),"identifier",!0)),[ce,Se]}var Ao={touchstart:mn,touchmove:Oi,touchend:Jt,touchcancel:Hn},Or="touchstart touchmove touchend touchcancel";function kr(){this.evTarget=Or,this.targetIds={},Wn.apply(this,arguments)}j(kr,Wn,{handler:function(Q){var ce=Ao[Q.type],Se=$s.call(this,Q,ce);Se&&this.callback(this.manager,ce,{pointers:Se[0],changedPointers:Se[1],pointerType:sn,srcEvent:Q})}});function $s(W,Q){var ce=Nt(W.touches),Se=this.targetIds;if(Q&(mn|Oi)&&ce.length===1)return Se[ce[0].identifier]=!0,[ce,ce];var Ge,ct,zt=Nt(W.changedTouches),Bn=[],Dt=this.target;if(ct=ce.filter(function(Xn){return Fe(Xn.target,Dt)}),Q===mn)for(Ge=0;Ge<ct.length;)Se[ct[Ge].identifier]=!0,Ge++;for(Ge=0;Ge<zt.length;)Se[zt[Ge].identifier]&&Bn.push(zt[Ge]),Q&(Jt|Hn)&&delete Se[zt[Ge].identifier],Ge++;if(Bn.length)return[Xt(ct.concat(Bn),"identifier",!0),Bn]}var Eo=2500,Cs=25;function ee(){Wn.apply(this,arguments);var W=K(this.handler,this);this.touch=new kr(this.manager,W),this.mouse=new Mt(this.manager,W),this.primaryTouch=null,this.lastTouches=[]}j(ee,Wn,{handler:function(Q,ce,Se){var Ge=Se.pointerType==sn,ct=Se.pointerType==pi;if(!(ct&&Se.sourceCapabilities&&Se.sourceCapabilities.firesTouchEvents)){if(Ge)D.call(this,ce,Se);else if(ct&&J.call(this,Se))return;this.callback(Q,ce,Se)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function D(W,Q){W&mn?(this.primaryTouch=Q.changedPointers[0].identifier,N.call(this,Q)):W&(Jt|Hn)&&N.call(this,Q)}function N(W){var Q=W.changedPointers[0];if(Q.identifier===this.primaryTouch){var ce={x:Q.clientX,y:Q.clientY};this.lastTouches.push(ce);var Se=this.lastTouches,Ge=function(){var ct=Se.indexOf(ce);ct>-1&&Se.splice(ct,1)};setTimeout(Ge,Eo)}}function J(W){for(var Q=W.srcEvent.clientX,ce=W.srcEvent.clientY,Se=0;Se<this.lastTouches.length;Se++){var Ge=this.lastTouches[Se],ct=Math.abs(Q-Ge.x),zt=Math.abs(ce-Ge.y);if(ct<=Cs&&zt<=Cs)return!0}return!1}var Y=Lt(h.style,"touchAction"),le=Y!==r,pe="compute",he="auto",ae="manipulation",me="none",Me="pan-x",ze="pan-y",Ce=Qe();function ot(W,Q){this.manager=W,this.set(Q)}ot.prototype={set:function(W){W==pe&&(W=this.compute()),le&&this.manager.element.style&&Ce[W]&&(this.manager.element.style[Y]=W),this.actions=W.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var W=[];return z(this.manager.recognizers,function(Q){de(Q.options.enable,[Q])&&(W=W.concat(Q.getTouchAction()))}),ut(W.join(" "))},preventDefaults:function(W){var Q=W.srcEvent,ce=W.offsetDirection;if(this.manager.session.prevented){Q.preventDefault();return}var Se=this.actions,Ge=je(Se,me)&&!Ce[me],ct=je(Se,ze)&&!Ce[ze],zt=je(Se,Me)&&!Ce[Me];if(Ge){var Bn=W.pointers.length===1,Dt=W.distance<2,Xn=W.deltaTime<250;if(Bn&&Dt&&Xn)return}if(!(zt&&ct)&&(Ge||ct&&ce&Ti||zt&&ce&nr))return this.preventSrc(Q)},preventSrc:function(W){this.manager.session.prevented=!0,W.preventDefault()}};function ut(W){if(je(W,me))return me;var Q=je(W,Me),ce=je(W,ze);return Q&&ce?me:Q||ce?Q?Me:ze:je(W,ae)?ae:he}function Qe(){if(!le)return!1;var W={},Q=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ce){W[ce]=Q?e.CSS.supports("touch-action",ce):!0}),W}var xt=1,pt=2,Rt=4,At=8,St=At,Ft=16,Vt=32;function yn(W){this.options=Z({},this.defaults,W||{}),this.id=yt(),this.manager=null,this.options.enable=ve(this.options.enable,!0),this.state=xt,this.simultaneous={},this.requireFail=[]}yn.prototype={defaults:{},set:function(W){return Z(this.options,W),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(W){if(S(W,"recognizeWith",this))return this;var Q=this.simultaneous;return W=es(W,this),Q[W.id]||(Q[W.id]=W,W.recognizeWith(this)),this},dropRecognizeWith:function(W){return S(W,"dropRecognizeWith",this)?this:(W=es(W,this),delete this.simultaneous[W.id],this)},requireFailure:function(W){if(S(W,"requireFailure",this))return this;var Q=this.requireFail;return W=es(W,this),dt(Q,W)===-1&&(Q.push(W),W.requireFailure(this)),this},dropRequireFailure:function(W){if(S(W,"dropRequireFailure",this))return this;W=es(W,this);var Q=dt(this.requireFail,W);return Q>-1&&this.requireFail.splice(Q,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(W){return!!this.simultaneous[W.id]},emit:function(W){var Q=this,ce=this.state;function Se(Ge){Q.manager.emit(Ge,W)}ce<At&&Se(Q.options.event+vn(ce)),Se(Q.options.event),W.additionalEvent&&Se(W.additionalEvent),ce>=At&&Se(Q.options.event+vn(ce))},tryEmit:function(W){if(this.canEmit())return this.emit(W);this.state=Vt},canEmit:function(){for(var W=0;W<this.requireFail.length;){if(!(this.requireFail[W].state&(Vt|xt)))return!1;W++}return!0},recognize:function(W){var Q=Z({},W);if(!de(this.options.enable,[this,Q])){this.reset(),this.state=Vt;return}this.state&(St|Ft|Vt)&&(this.state=xt),this.state=this.process(Q),this.state&(pt|Rt|At|Ft)&&this.tryEmit(Q)},process:function(W){},getTouchAction:function(){},reset:function(){}};function vn(W){return W&Ft?"cancel":W&At?"end":W&Rt?"move":W&pt?"start":""}function ci(W){return W==tr?"down":W==Jr?"up":W==Hi?"left":W==ai?"right":""}function es(W,Q){var ce=Q.manager;return ce?ce.get(W):W}function Si(){yn.apply(this,arguments)}j(Si,yn,{defaults:{pointers:1},attrTest:function(W){var Q=this.options.pointers;return Q===0||W.pointers.length===Q},process:function(W){var Q=this.state,ce=W.eventType,Se=Q&(pt|Rt),Ge=this.attrTest(W);return Se&&(ce&Hn||!Ge)?Q|Ft:Se||Ge?ce&Jt?Q|At:Q&pt?Q|Rt:pt:Vt}});function Kt(){Si.apply(this,arguments),this.pX=null,this.pY=null}j(Kt,Si,{defaults:{event:"pan",threshold:10,pointers:1,direction:xo},getTouchAction:function(){var W=this.options.direction,Q=[];return W&Ti&&Q.push(ze),W&nr&&Q.push(Me),Q},directionTest:function(W){var Q=this.options,ce=!0,Se=W.distance,Ge=W.direction,ct=W.deltaX,zt=W.deltaY;return Ge&Q.direction||(Q.direction&Ti?(Ge=ct===0?As:ct<0?Hi:ai,ce=ct!=this.pX,Se=Math.abs(W.deltaX)):(Ge=zt===0?As:zt<0?Jr:tr,ce=zt!=this.pY,Se=Math.abs(W.deltaY))),W.direction=Ge,ce&&Se>Q.threshold&&Ge&Q.direction},attrTest:function(W){return Si.prototype.attrTest.call(this,W)&&(this.state&pt||!(this.state&pt)&&this.directionTest(W))},emit:function(W){this.pX=W.deltaX,this.pY=W.deltaY;var Q=ci(W.direction);Q&&(W.additionalEvent=this.options.event+Q),this._super.emit.call(this,W)}});function Ko(){Si.apply(this,arguments)}j(Ko,Si,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[me]},attrTest:function(W){return this._super.attrTest.call(this,W)&&(Math.abs(W.scale-1)>this.options.threshold||this.state&pt)},emit:function(W){if(W.scale!==1){var Q=W.scale<1?"in":"out";W.additionalEvent=this.options.event+Q}this._super.emit.call(this,W)}});function Yo(){yn.apply(this,arguments),this._timer=null,this._input=null}j(Yo,yn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[he]},process:function(W){var Q=this.options,ce=W.pointers.length===Q.pointers,Se=W.distance<Q.threshold,Ge=W.deltaTime>Q.time;if(this._input=W,!Se||!ce||W.eventType&(Jt|Hn)&&!Ge)this.reset();else if(W.eventType&mn)this.reset(),this._timer=C(function(){this.state=St,this.tryEmit()},Q.time,this);else if(W.eventType&Jt)return St;return Vt},reset:function(){clearTimeout(this._timer)},emit:function(W){this.state===St&&(W&&W.eventType&Jt?this.manager.emit(this.options.event+"up",W):(this._input.timeStamp=T(),this.manager.emit(this.options.event,this._input)))}});function Oa(){Si.apply(this,arguments)}j(Oa,Si,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[me]},attrTest:function(W){return this._super.attrTest.call(this,W)&&(Math.abs(W.rotation)>this.options.threshold||this.state&pt)}});function ka(){Si.apply(this,arguments)}j(ka,Si,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ti|nr,pointers:1},getTouchAction:function(){return Kt.prototype.getTouchAction.call(this)},attrTest:function(W){var Q=this.options.direction,ce;return Q&(Ti|nr)?ce=W.overallVelocity:Q&Ti?ce=W.overallVelocityX:Q&nr&&(ce=W.overallVelocityY),this._super.attrTest.call(this,W)&&Q&W.offsetDirection&&W.distance>this.options.threshold&&W.maxPointers==this.options.pointers&&x(ce)>this.options.velocity&&W.eventType&Jt},emit:function(W){var Q=ci(W.offsetDirection);Q&&this.manager.emit(this.options.event+Q,W),this.manager.emit(this.options.event,W)}});function To(){yn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}j(To,yn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ae]},process:function(W){var Q=this.options,ce=W.pointers.length===Q.pointers,Se=W.distance<Q.threshold,Ge=W.deltaTime<Q.time;if(this.reset(),W.eventType&mn&&this.count===0)return this.failTimeout();if(Se&&Ge&&ce){if(W.eventType!=Jt)return this.failTimeout();var ct=this.pTime?W.timeStamp-this.pTime<Q.interval:!0,zt=!this.pCenter||ki(this.pCenter,W.center)<Q.posThreshold;this.pTime=W.timeStamp,this.pCenter=W.center,!zt||!ct?this.count=1:this.count+=1,this._input=W;var Bn=this.count%Q.taps;if(Bn===0)return this.hasRequireFailures()?(this._timer=C(function(){this.state=St,this.tryEmit()},Q.interval,this),pt):St}return Vt},failTimeout:function(){return this._timer=C(function(){this.state=Vt},this.options.interval,this),Vt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==St&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ts(W,Q){return Q=Q||{},Q.recognizers=ve(Q.recognizers,ts.defaults.preset),new Na(W,Q)}ts.VERSION="2.0.7",ts.defaults={domEvents:!1,touchAction:pe,enable:!0,inputTarget:null,inputClass:null,preset:[[Oa,{enable:!1}],[Ko,{enable:!1},["rotate"]],[ka,{direction:Ti}],[Kt,{direction:Ti},["swipe"]],[To],[To,{event:"doubletap",taps:2},["tap"]],[Yo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Fa=1,za=2;function Na(W,Q){this.options=Z({},ts.defaults,Q||{}),this.options.inputTarget=this.options.inputTarget||W,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=W,this.input=Es(this),this.touchAction=new ot(this,this.options.touchAction),Dl(this,!0),z(this.options.recognizers,function(ce){var Se=this.add(new ce[0](ce[1]));ce[2]&&Se.recognizeWith(ce[2]),ce[3]&&Se.requireFailure(ce[3])},this)}Na.prototype={set:function(W){return Z(this.options,W),W.touchAction&&this.touchAction.update(),W.inputTarget&&(this.input.destroy(),this.input.target=W.inputTarget,this.input.init()),this},stop:function(W){this.session.stopped=W?za:Fa},recognize:function(W){var Q=this.session;if(!Q.stopped){this.touchAction.preventDefaults(W);var ce,Se=this.recognizers,Ge=Q.curRecognizer;(!Ge||Ge&&Ge.state&St)&&(Ge=Q.curRecognizer=null);for(var ct=0;ct<Se.length;)ce=Se[ct],Q.stopped!==za&&(!Ge||ce==Ge||ce.canRecognizeWith(Ge))?ce.recognize(W):ce.reset(),!Ge&&ce.state&(pt|Rt|At)&&(Ge=Q.curRecognizer=ce),ct++}},get:function(W){if(W instanceof yn)return W;for(var Q=this.recognizers,ce=0;ce<Q.length;ce++)if(Q[ce].options.event==W)return Q[ce];return null},add:function(W){if(S(W,"add",this))return this;var Q=this.get(W.options.event);return Q&&this.remove(Q),this.recognizers.push(W),W.manager=this,this.touchAction.update(),W},remove:function(W){if(S(W,"remove",this))return this;if(W=this.get(W),W){var Q=this.recognizers,ce=dt(Q,W);ce!==-1&&(Q.splice(ce,1),this.touchAction.update())}return this},on:function(W,Q){if(W!==r&&Q!==r){var ce=this.handlers;return z(Ne(W),function(Se){ce[Se]=ce[Se]||[],ce[Se].push(Q)}),this}},off:function(W,Q){if(W!==r){var ce=this.handlers;return z(Ne(W),function(Se){Q?ce[Se]&&ce[Se].splice(dt(ce[Se],Q),1):delete ce[Se]}),this}},emit:function(W,Q){this.options.domEvents&&Fc(W,Q);var ce=this.handlers[W]&&this.handlers[W].slice();if(!(!ce||!ce.length)){Q.type=W,Q.preventDefault=function(){Q.srcEvent.preventDefault()};for(var Se=0;Se<ce.length;)ce[Se](Q),Se++}},destroy:function(){this.element&&Dl(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Dl(W,Q){var ce=W.element;if(ce.style){var Se;z(W.options.cssProps,function(Ge,ct){Se=Lt(ce.style,ct),Q?(W.oldCssProps[Se]=ce.style[Se],ce.style[Se]=Ge):ce.style[Se]=W.oldCssProps[Se]||""}),Q||(W.oldCssProps={})}}function Fc(W,Q){var ce=n.createEvent("Event");ce.initEvent(W,!0,!0),ce.gesture=Q,Q.target.dispatchEvent(ce)}Z(ts,{INPUT_START:mn,INPUT_MOVE:Oi,INPUT_END:Jt,INPUT_CANCEL:Hn,STATE_POSSIBLE:xt,STATE_BEGAN:pt,STATE_CHANGED:Rt,STATE_ENDED:At,STATE_RECOGNIZED:St,STATE_CANCELLED:Ft,STATE_FAILED:Vt,DIRECTION_NONE:As,DIRECTION_LEFT:Hi,DIRECTION_RIGHT:ai,DIRECTION_UP:Jr,DIRECTION_DOWN:tr,DIRECTION_HORIZONTAL:Ti,DIRECTION_VERTICAL:nr,DIRECTION_ALL:xo,Manager:Na,Input:Wn,TouchAction:ot,TouchInput:kr,MouseInput:Mt,PointerEventInput:yr,TouchMouseInput:ee,SingleTouchInput:gi,Recognizer:yn,AttrRecognizer:Si,Tap:To,Pan:Kt,Swipe:ka,Pinch:Ko,Rotate:Oa,Press:Yo,on:Ie,off:De,each:z,merge:q,extend:ue,assign:Z,inherit:j,bindFn:K,prefixed:Lt});var Zs=typeof e<"u"?e:typeof self<"u"?self:{};Zs.Hammer=ts,typeof r=="function"&&r.amd?r(function(){return ts}):t.exports?t.exports=ts:e[i]=ts})(window,document,"Hammer")})(GP);var Jf=GP.exports;const o8=k1(Jf),Fo=QR({__proto__:null,default:o8},[Jf]),VP=1,jP=2,_1=4,a8={mousedown:VP,mousemove:jP,mouseup:_1};function l8(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function c8(t){const e=t.prototype.handler;t.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(l8(r,a=>a.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}}function u8(t){t.prototype.handler=function(n){let i=a8[n.type];i&VP&&n.button>=0&&(this.pressed=!0),i&jP&&n.which===0&&(i=_1),this.pressed&&(i&_1&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}c8(Jf.PointerEventInput);u8(Jf.MouseInput);const h8=Jf.Manager;class b_{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const d8=Fo?[[Fo.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Fo.Rotate,{enable:!1}],[Fo.Pinch,{enable:!1}],[Fo.Swipe,{enable:!1}],[Fo.Pan,{threshold:0,enable:!1}],[Fo.Press,{enable:!1}],[Fo.Tap,{event:"doubletap",taps:2,enable:!1}],[Fo.Tap,{event:"anytap",enable:!1}],[Fo.Tap,{enable:!1}]]:null,eS={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},f8={doubletap:["tap"]},p8={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},yb={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},m8={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},tS={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},g8=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Fu=typeof window<"u"?window:global;let y1=!1;try{const t={get passive(){return y1=!0,!0}};Fu.addEventListener("test",null,t),Fu.removeEventListener("test",null)}catch{y1=!1}const _8=g8.indexOf("firefox")!==-1,{WHEEL_EVENTS:y8}=yb,nS="wheel",iS=4.000244140625,v8=40,x8=.25;class b8 extends b_{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{if(!this.options.enable)return;let a=r.deltaY;Fu.WheelEvent&&(_8&&r.deltaMode===Fu.WheelEvent.DOM_DELTA_PIXEL&&(a/=Fu.devicePixelRatio),r.deltaMode===Fu.WheelEvent.DOM_DELTA_LINE&&(a*=v8)),a!==0&&a%iS===0&&(a=Math.floor(a/iS)),r.shiftKey&&a&&(a=a*x8),this.callback({type:nS,center:{x:r.clientX,y:r.clientY},delta:-a,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(y8),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,y1?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===nS&&(this.options.enable=n)}}const{MOUSE_EVENTS:w8}=yb,rS="pointermove",sS="pointerover",oS="pointerout",aS="pointerenter",lS="pointerleave";class A8 extends b_{constructor(e,n,i){super(e,n,i),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(w8),this.events.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===rS&&(this.enableMoveEvent=n),e===sS&&(this.enableOverEvent=n),e===oS&&(this.enableOutEvent=n),e===aS&&(this.enableEnterEvent=n),e===lS&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(sS,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(oS,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(aS,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(lS,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(rS,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:E8}=yb,cS="keydown",uS="keyup";class T8 extends b_{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{const a=r.target||r.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:cS,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:uS,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(E8),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===cS&&(this.enableDownEvent=n),e===uS&&(this.enableUpEvent=n)}}const hS="contextmenu";class S8 extends b_{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{this.options.enable&&this.callback({type:hS,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===hS&&(this.options.enable=n)}}const v1=1,Zg=2,x1=4,C8={pointerdown:v1,pointermove:Zg,pointerup:x1,mousedown:v1,mousemove:Zg,mouseup:x1},I8=1,M8=2,P8=3,B8=0,L8=1,R8=2,D8=1,O8=2,k8=4;function F8(t){const e=C8[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let a=!1,h=!1,l=!1;return e===x1||e===Zg&&!Number.isFinite(n)?(a=r===I8,h=r===M8,l=r===P8):e===Zg?(a=!!(n&D8),h=!!(n&k8),l=!!(n&O8)):e===v1&&(a=i===B8,h=i===L8,l=i===R8),{leftButton:a,middleButton:h,rightButton:l}}function z8(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,a=i.height/e.offsetHeight||1,h={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/a};return{center:n,offsetCenter:h}}const P0={srcElement:"root",priority:0};class N8{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,a=!1){const{handlers:h,handlersByElement:l}=this;let y=P0;typeof i=="string"||i&&i.addEventListener?y={...P0,srcElement:i}:i&&(y={...P0,...i});let x=l.get(y.srcElement);x||(x=[],l.set(y.srcElement,x));const T={type:e,handler:n,srcElement:y.srcElement,priority:y.priority};r&&(T.once=!0),a&&(T.passive=!0),h.push(T),this._active=this._active||!T.passive;let C=x.length-1;for(;C>=0&&!(x[C].priority>=T.priority);)C--;x.splice(C+1,0,T)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let a=i.length-1;a>=0;a--){const h=i[a];if(h.type===e&&h.handler===n){i.splice(a,1);const l=r.get(h.srcElement);l.splice(l.indexOf(h),1),l.length===0&&r.delete(h.srcElement)}}this._active=i.some(a=>!a.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const a=()=>{e.handled=!0},h=()=>{e.handled=!0,r=!0},l=[];for(let y=0;y<i.length;y++){const{type:x,handler:T,once:C}=i[y];if(T({...e,type:x,stopPropagation:a,stopImmediatePropagation:h}),C&&l.push(i[y]),r)break}for(let y=0;y<l.length;y++){const{type:x,handler:T}=l[y];this.remove(x,T)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...F8(e),...z8(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const U8={events:null,recognizers:null,recognizerOptions:{},Manager:h8,touchAction:"none",tabIndex:0};class G8{constructor(e=null,n){this._onBasicInput=r=>{const{srcEvent:a}=r,h=p8[a.type];h&&this.manager.emit(h,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...U8,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||d8}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(eS).forEach(r=>{const a=this.manager.get(r);a&&eS[r].forEach(h=>{a.recognizeWith(h)})});for(const r in n.recognizerOptions){const a=this.manager.get(r);if(a){const h=n.recognizerOptions[r];delete h.enable,a.set(h)}}this.wheelInput=new b8(e,this._onOtherEvent,{enable:!1}),this.moveInput=new A8(e,this._onOtherEvent,{enable:!1}),this.keyInput=new T8(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new S8(e,this._onOtherEvent,{enable:!1});for(const[r,a]of this.events)a.isEmpty()||(this._toggleRecognizer(a.recognizerName,!0),this.manager.on(r,a.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);if(r&&r.options.enable!==n){r.set({enable:n});const a=f8[e];a&&!this.options.recognizers&&a.forEach(h=>{const l=i.get(h);n?(l.requireFailure(e),r.dropRequireFailure(h)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,r,a){if(typeof e!="string"){i=n;for(const T in e)this._addEventHandler(T,e[T],i,r,a);return}const{manager:h,events:l}=this,y=tS[e]||e;let x=l.get(y);x||(x=new N8(this),l.set(y,x),x.recognizerName=m8[y]||y,h&&h.on(y,x.handleEvent)),x.add(e,n,i,r,a),x.isEmpty()||this._toggleRecognizer(x.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const h in e)this._removeEventHandler(h,e[h]);return}const{events:i}=this,r=tS[e]||e,a=i.get(r);if(a&&(a.remove(e,n),a.isEmpty())){const{recognizerName:h}=a;let l=!1;for(const y of i.values())if(y.recognizerName===h&&!y.isEmpty()){l=!0;break}l||this._toggleRecognizer(h,!1)}}}function lc(){}const V8=({isDragging:t})=>t?"grabbing":"grab",HP={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:lc,onResize:lc,onViewStateChange:lc,onInteractionStateChange:lc,onBeforeRender:lc,onAfterRender:lc,onLoad:lc,onError:t=>dn.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:V8,getTooltip:null,debug:!1,drawPickingColors:!1};class Bf{constructor(e){L(this,"props",void 0),L(this,"width",0),L(this,"height",0),L(this,"userData",{}),L(this,"canvas",null),L(this,"viewManager",null),L(this,"layerManager",null),L(this,"effectManager",null),L(this,"deckRenderer",null),L(this,"deckPicker",null),L(this,"eventManager",null),L(this,"tooltip",null),L(this,"metrics",void 0),L(this,"animationLoop",void 0),L(this,"stats",void 0),L(this,"viewState",void 0),L(this,"cursorState",void 0),L(this,"_needsRedraw",void 0),L(this,"_pickRequest",void 0),L(this,"_lastPointerDownInfo",null),L(this,"_metricsCounter",void 0),L(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),L(this,"_onEvent",n=>{const i=HE[n.type],r=n.offsetCenter;if(!i||!r||!this.layerManager)return;const a=this.layerManager.getLayers(),h=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:a,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:l}=h,y=l&&(l[i.handler]||l.props[i.handler]),x=this.props[i.handler];let T=!1;y&&(T=y.call(l,h,n)),!T&&x&&x(h,n)}),L(this,"_onPointerDown",n=>{const i=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}),this.props={...HP,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&dn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),IM()==="IE"&&dn.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new qx({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Pf.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,r,a,h,l,y;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(r=this.effectManager)===null||r===void 0||r.finalize(),this.effectManager=null,(a=this.deckRenderer)===null||a===void 0||a.finalize(),this.deckRenderer=null,(h=this.deckPicker)===null||h===void 0||h.finalize(),this.deckPicker=null,(l=this.eventManager)===null||l===void 0||l.destroy(),this.eventManager=null,(y=this.tooltip)===null||y===void 0||y.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var x;(x=this.canvas.parentElement)===null||x===void 0||x.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&dn.removed("onLayerHover","onHover")(),"onLayerClick"in e&&dn.removed("onLayerClick","onClick")(),e.initialViewState&&!Wo(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),a=this.effectManager.needsRedraw(e),h=this.deckRenderer.needsRedraw(e);return n=n||i||r||a||h,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ai(this.viewManager),this.viewManager.views}getViewports(e){return Ai(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,i){Ai(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const a=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),a}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ai(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const a=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=a}if(i||i===0){var r;const a=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((r=e.style)===null||r===void 0?void 0:r.position)||"absolute",this.canvas.style.height=a}}_updateCanvasSize(){var e,n;const{canvas:i}=this;if(!i)return;const r=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,a=(n=i.clientHeight)!==null&&n!==void 0?n:i.height;if(r!==this.width||a!==this.height){var h,l;this.width=r,this.height=a,(h=this.viewManager)===null||h===void 0||h.setProps({width:r,height:a}),(l=this.layerManager)===null||l===void 0||l.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:a})}}_createAnimationLoop(e){const{width:n,height:i,gl:r,glOptions:a,debug:h,onError:l,onBeforeRender:y,onAfterRender:x,useDevicePixels:T}=e;return new d4({width:n,height:i,useDevicePixels:T,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,gl:r,onCreateContext:C=>OM({...a,...C,canvas:this.canvas,debug:h,onContextLost:()=>this._onContextLost()}),onInitialize:C=>this._setGLContext(C.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:y,onAfterRender:x,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new _b({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let a=r,h=!1;for(const l of i){var n;a=l,h=((n=l.layer)===null||n===void 0?void 0:n.onHover(l,e.event))||h}if(!h&&this.props.onHover&&this.props.onHover(a,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(a);this.tooltip.setTooltip(l,a.x,a.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Xx(e,{enable:!0,copyState:!0})),this.tooltip=new s8(this.canvas),Ma(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new EP;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new G8(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in HE)this.eventManager.on(r,this._onEvent);this.viewManager=new BV({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new PV(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new $V,this.deckRenderer=new KV(e),this.deckPicker=new i8(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;Ma(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),dn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=gc.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}L(Bf,"defaultProps",HP);L(Bf,"VERSION",yz);class B0{constructor(e,n){L(this,"opts",void 0),L(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:r}=n;let a=i;if(i&&i.length!==r){a=new Float32Array(r);const h=n.elementOffset||0;for(let l=0;l<r;++l)a[l]=i[h+l]}return a}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function j8(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function lg(t){return t.stride||t.size*t.bytesPerElement}function WP(t,e){e.offset&&dn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=lg(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,a=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:a,stride:n}}function H8(t,e){const n=WP(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class W8{constructor(e,n,i){L(this,"gl",void 0),L(this,"id",void 0),L(this,"size",void 0),L(this,"settings",void 0),L(this,"value",void 0),L(this,"doublePrecision",void 0),L(this,"_buffer",void 0),L(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,a=r===5130;let{defaultValue:h}=n;h=Number.isFinite(h)?[h]:h||new Array(this.size).fill(0);let l;a?l=5126:!r&&n.isIndexed?l=e&&Jx(e,Dn.ELEMENT_INDEX_UINT32)?5125:5123:l=r||5126;let y=j8(r||l||5126);this.doublePrecision=a,a&&n.fp64===!1&&(y=Float32Array),this.value=null,this.settings={...n,defaultType:y,defaultValue:h,logicalType:r,type:l,size:this.size,bytesPerElement:y.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new Sn(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*lg(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Pf.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,a=H8(this.getAccessor(),n||{});return i[e]=new B0(this,a.high),i["".concat(e,"64Low")]=r?new B0(this,a.low):new Float32Array(this.size),i}if(n){const i=WP(this.getAccessor(),n);return{[e]:new B0(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,a=i*r;if(n&&a&&n.length>=a){const h=new Array(r).fill(1/0),l=new Array(r).fill(-1/0);for(let y=0;y<a;)for(let x=0;x<r;x++){const T=n[y++];T<h[x]&&(h[x]=T),T>l[x]&&(l[x]=T)}e=[h,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof Sn?i={buffer:e}:i=e;const r={...this.settings,...i};if(n.bufferAccessor=r,n.bounds=null,i.constant){let a=i.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!n.constant||!this._areValuesEqual(a,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=a}else if(i.buffer){const a=i.buffer;n.externalBuffer=a,n.constant=!1,this.value=i.value||null;const h=i.value instanceof Float64Array;r.type=i.type||a.accessor.type,r.bytesPerElement=a.accessor.BYTES_PER_ELEMENT*(h?2:1),r.stride=lg(r)}else if(i.value){this._checkExternalBuffer(i);let a=i.value;n.externalBuffer=null,n.constant=!1,this.value=a,r.bytesPerElement=a.BYTES_PER_ELEMENT,r.stride=lg(r);const{buffer:h,byteOffset:l}=this;this.doublePrecision&&a instanceof Float64Array&&(a=C0(a,r));const y=a.byteLength+l+r.stride*2;h.byteLength<y&&h.reallocate(y),h.setAccessor(null),h.subData({data:a,offset:l}),r.type=i.type||h.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?C0(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,a=Pf.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=a;const{buffer:h,byteOffset:l}=this;return h.byteLength<a.byteLength+l&&(h.reallocate(a.byteLength+l),n&&r&&h.subData({data:r instanceof Float64Array?C0(r,this):r,offset:l})),i.allocatedValue=a,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&dn.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:a}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e){let h=a;for(;--h>=0;)n[i+h]=r[h];return n}switch(a){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let h=a;for(;--h>=0;)n[i+h]=Number.isFinite(e[h])?e[h]:r[h]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}}const dS=[],fS=[];function XP(t,e=0,n=1/0){let i=dS;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(fS.length=t.length,i=fS):i=dS,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function qP(t){return t&&t[Symbol.asyncIterator]}function X8(t,e){const{size:n,stride:i,offset:r,startIndices:a,nested:h}=e,l=t.BYTES_PER_ELEMENT,y=i?i/l:n,x=r?r/l:0,T=Math.floor((t.length-x)/y);return(C,{index:S,target:z})=>{if(!a){const q=S*y+x;for(let j=0;j<n;j++)z[j]=t[q+j];return z}const V=a[S],Z=a[S+1]||T;let ue;if(h){ue=new Array(Z-V);for(let q=V;q<Z;q++){const j=q*y+x;z=new Array(n);for(let K=0;K<n;K++)z[K]=t[j+K];ue[q-V]=z}}else if(y===n)ue=t.subarray(V*n+x,Z*n+x);else{ue=new t.constructor((Z-V)*n);let q=0;for(let j=V;j<Z;j++){const K=j*y+x;for(let de=0;de<n;de++)ue[q++]=t[K+de]}}return ue}}const q8=[],cg=[[0,1/0]];function $8(t,e){if(t===cg||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let a=0;a<i;a++){const h=t[a];h[1]<e[0]?(n.push(h),r=a+1):h[0]>e[1]?n.push(h):e=[Math.min(h[0],e[0]),Math.max(h[1],e[1])]}return n.splice(r,0,e),n}function L0(t){const{source:e,target:n,start:i=0,size:r,getData:a}=t,h=t.end||n.length,l=e.length,y=h-i;if(l>y){n.set(e.subarray(0,y),i);return}if(n.set(e,i),!a)return;let x=l;for(;x<y;){const T=a(x,e);for(let C=0;C<r;C++)n[i+x]=T[C]||0,x++}}function Z8({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:a}){if(!Array.isArray(a))return L0({source:t,target:e,size:n,getData:i}),e;let h=0,l=0;const y=i&&((T,C)=>i(T+l,C)),x=Math.min(r.length,a.length);for(let T=1;T<x;T++){const C=r[T]*n,S=a[T]*n;L0({source:t.subarray(h,C),target:e,start:l,end:S,size:n,getData:y}),h=C,l=S}return l<e.length&&L0({source:[],target:e,start:l,size:n,getData:y}),e}const J8={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function $P(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...J8[n],...e,...t,type:n}}function ZP(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function JP(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function KP(t){t.push(t.shift())}function vb(t,e){const{doublePrecision:n,settings:i,value:r,size:a}=t,h=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*a)*h}function YP({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:r,getData:a=h=>h}){const h=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*h,y=n.byteOffset,x=n.startIndices,T=r&&x,C=vb(n,e),S=n.isConstant;if(!T&&i>=C)return;const z=S?n.value:n.getBuffer().getData({srcByteOffset:y});if(n.settings.normalized&&!S){const q=a;a=(j,K)=>n.normalizeConstant(q(j,K))}const V=S?(q,j)=>a(z,j):(q,j)=>a(z.subarray(q,q+l),j),Z=t.getData({length:i}),ue=new Float32Array(C);Z8({source:Z,target:ue,sourceStartIndices:r,targetStartIndices:x,size:l,getData:V}),t.byteLength<ue.byteLength+y&&t.reallocate(ue.byteLength+y),t.subData({data:ue,offset:y})}class xb extends W8{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:cg}),L(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(a=>e[a])]:e[n];return $P(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=$8(this.state.updateRanges,[i,r])}else this.state.updateRanges=cg}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=q8}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==cg),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:h,noAlloc:l}}=this;let y=!0;if(h){for(const[x,T]of a)h.call(r,this,{data:n,startRow:x,endRow:T,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[x,T]of a){const C=Number.isFinite(x)?this.getVertexOffset(x):0,S=Number.isFinite(T)?this.getVertexOffset(T):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:C,endOffset:S})}this._checkAttributeArray()}else y=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),y}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const h=e;Ai(ArrayBuffer.isView(h.value),"invalid ".concat(r.accessor));const l=!!h.size&&h.size!==this.size;return i.binaryAccessor=X8(h.value,{size:h.size||this.size,stride:h.stride,offset:h.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:a,numInstances:h}){if(e.constant)return;const{settings:l,state:y,value:x,size:T,startIndices:C}=e,{accessor:S,transform:z}=l,V=y.binaryAccessor||(typeof S=="function"?S:a[S]);Ai(typeof V=="function",'accessor "'.concat(S,'" is not a function'));let Z=e.getVertexOffset(i);const{iterable:ue,objectInfo:q}=XP(n,i,r);for(const j of ue){q.index++;let K=V(j,q);if(z&&(K=z.call(this,K)),C){const de=(q.index<C.length-1?C[q.index+1]:h)-C[q.index];if(K&&Array.isArray(K[0])){let ve=Z;for(const Ie of K)e._normalizeValue(Ie,x,ve),ve+=T}else K&&K.length>T?x.set(K,Z):(e._normalizeValue(K,q.target,0),bV({target:x,source:q.target,start:Z,count:de}));Z+=de*T}else e._normalizeValue(K,x,Z),Z+=T}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class K8{constructor({gl:e,attribute:n,timeline:i}){L(this,"gl",void 0),L(this,"type","interpolation"),L(this,"attributeInTransition",void 0),L(this,"settings",void 0),L(this,"attribute",void 0),L(this,"transition",void 0),L(this,"currentStartIndices",void 0),L(this,"currentLength",void 0),L(this,"transform",void 0),L(this,"buffers",void 0),this.gl=e,this.transition=new Zf(i),this.attribute=n,this.attributeInTransition=new xb(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=Q8(e,n);const r={byteLength:0,usage:35050};this.buffers=[new Sn(e,r),new Sn(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:r,attribute:a}=this;KP(r);const h={numInstances:n,attribute:a,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of r)YP({buffer:l,...h});this.currentStartIndices=a.startIndices,this.currentLength=vb(a,n),this.attributeInTransition.setData({buffer:r[1],value:a.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/a.size),sourceBuffers:{aFrom:r[0],aTo:ZP(i,a)},feedbackBuffers:{vCurrent:r[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:r}=this.transition;let a=r/n;i&&(a=i(a)),this.transform.run({uniforms:{time:a}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const Y8=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function Q8(t,e){const n=JP(e.size);return new ub(t,{vs:Y8,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class e9{constructor({gl:e,attribute:n,timeline:i}){L(this,"gl",void 0),L(this,"type","spring"),L(this,"attributeInTransition",void 0),L(this,"settings",void 0),L(this,"attribute",void 0),L(this,"transition",void 0),L(this,"currentStartIndices",void 0),L(this,"currentLength",void 0),L(this,"texture",void 0),L(this,"framebuffer",void 0),L(this,"transform",void 0),L(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Zf(i),this.attribute=n,this.attributeInTransition=new xb(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=n9(e),this.framebuffer=i9(e,this.texture),this.transform=t9(e,n,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new Sn(e,r),new Sn(e,r),new Sn(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:r,attribute:a}=this,h={numInstances:n,attribute:a,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of r)YP({buffer:l,...h});this.settings=e,this.currentStartIndices=a.startIndices,this.currentLength=vb(a,n),this.attributeInTransition.setData({buffer:r[1],value:a.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/a.size),sourceBuffers:{aTo:ZP(i,a)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this;if(!r.update())return!1;const h=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:h.stiffness,damping:h.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),KP(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),x_(i)[0]>0||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function t9(t,e,n){const i=JP(e.size);return new ub(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function n9(t){return new xs(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function i9(t,e){return new Ri(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const r9={interpolation:K8,spring:e9};class s9{constructor(e,{id:n,timeline:i}){L(this,"id",void 0),L(this,"isSupported",void 0),L(this,"gl",void 0),L(this,"timeline",void 0),L(this,"transitions",void 0),L(this,"needsRedraw",void 0),L(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=ub.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const a=e[r],h=a.getTransitionSetting(n);h&&this._updateAttribute(r,a,h)}for(const r in this.transitions){const a=e[r];(!a||!a.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let a=!r||r.type!==i.type;if(a){if(!this.isSupported){dn.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}r&&this._removeTransition(e);const h=r9[i.type];h?this.transitions[e]=new h({attribute:n,timeline:this.timeline,gl:this.gl}):(dn.error("unsupported transition type '".concat(i.type,"'"))(),a=!1)}(a||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const pS="attributeManager.invalidate",o9="attributeManager.updateStart",a9="attributeManager.updateEnd",l9="attribute.updateStart",c9="attribute.allocate",u9="attribute.updateEnd";class h9{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){L(this,"id",void 0),L(this,"gl",void 0),L(this,"attributes",void 0),L(this,"updateTriggers",void 0),L(this,"needsRedraw",void 0),L(this,"userData",void 0),L(this,"stats",void 0),L(this,"attributeTransitionManager",void 0),L(this,"mergeBoundsMemoized",$f(dV)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new s9(e,{id:"".concat(n,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);fr(pS,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);fr(pS,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:a={},buffers:h={},context:l={}}){let y=!1;fr(o9,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const x in this.attributes){const T=this.attributes[x],C=T.settings.accessor;T.startIndices=i,T.numInstances=n,a[x]&&dn.removed("props.".concat(x),"data.attributes.".concat(x))(),T.setExternalBuffer(h[x])||T.setBinaryValue(typeof C=="string"?h[C]:void 0,e.startIndices)||typeof C=="string"&&!h[C]&&T.setConstantValue(a[C])||T.needsUpdate()&&(y=!0,this._updateAttribute({attribute:T,numInstances:n,data:e,props:a,context:l})),this.needsRedraw=this.needsRedraw||T.needsRedraw()}y&&fr(a9,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(i=>{var r;return(r=this.attributes[i])===null||r===void 0?void 0:r.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const a in n){const h=n[a];h.needsRedraw(e)&&!i.hasAttribute(a)&&(r[a]=h)}return r}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const r in e)n[r]||Object.assign(i,e[r].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const r=e[i];this.attributes[i]=this._createAttribute(i,r,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const r={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new xb(this.gl,r)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,a=r[e];return a&&a.forEach(h=>{const l=i[h];l&&l.setNeedsUpdate(l.id,n)}),a}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(fr(l9,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&fr(c9,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,fr(u9,n,i))}}class d9 extends Zf{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:a}}=this,h=a(e/r);this._value=jg(n,i,h)}}const mS=1e-5;function gS(t,e,n,i,r){const a=e-t,l=(n-e)*r,y=-a*i;return l+y+a+e}function f9(t,e,n,i,r){if(Array.isArray(n)){const a=[];for(let h=0;h<n.length;h++)a[h]=gS(t[h],e[h],n[h],i,r);return a}return gS(t,e,n,i,r)}function _S(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class p9 extends Zf{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:a=e,_currValue:h=e}=this;let l=f9(a,h,n,i,r);const y=_S(l,n),x=_S(l,h);y<mS&&x<mS&&(l=n,this.end()),this._prevValue=h,this._currValue=l}}const m9={interpolation:d9,spring:p9};class g9{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:a}=this;if(a.has(e)){const y=a.get(e),{value:x=y.settings.fromValue}=y;n=x,this.remove(e)}if(r=$P(r),!r)return;const h=m9[r.type];if(!h){dn.error("unsupported transition type '".concat(r.type,"'"))();return}const l=new h(this.timeline);l.start({...r,fromValue:n,toValue:i}),a.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function _9(t){const e=t[Sl];for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function y9(t,e){const n=QP({newProps:t,oldProps:e,propTypes:t[Sl],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=x9(t,e);let r=!1;return i||(r=b9(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:w9(t,e),transitionsChanged:v9(t,e)}}function v9(t,e){if(!t.transitions)return!1;const n={},i=t[Sl];let r=!1;for(const a in t.transitions){const h=i[a],l=h&&h.type;(l==="number"||l==="color"||l==="array")&&b1(t[a],e[a],h)&&(n[a]=!0,r=!0)}return r?n:!1}function QP({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(r," changed shallowly");for(const a of Object.keys(t))if(!(a in n)){if(!(a in e))return"".concat(r,".").concat(a," added");const h=b1(t[a],e[a],i[a]);if(h)return"".concat(r,".").concat(a," ").concat(h)}for(const a of Object.keys(e))if(!(a in n)){if(!(a in t))return"".concat(r,".").concat(a," dropped");if(!Object.hasOwnProperty.call(t,a)){const h=b1(t[a],e[a],i[a]);if(h)return"".concat(r,".").concat(a," ").concat(h)}}return!1}function b1(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function x9(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function b9(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&yS(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&yS(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function w9(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function yS(t,e,n){let i=t.updateTriggers[n];i=i??{};let r=e.updateTriggers[n];return r=r??{},QP({oldProps:r,newProps:i,triggerName:n})}const A9="count(): argument not an object",E9="count(): argument not a container";function T9(t){if(!C9(t))throw new Error(A9);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(S9(t))return Object.keys(t).length;throw new Error(E9)}function S9(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function C9(t){return t!==null&&typeof t=="object"}function I9(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const M9={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},w1={};function P9(t,e,n,i){if(n instanceof xs)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let r=null;n.compressed&&(r={[10241]:n.data.length>1?9985:9729});const a=new xs(e,{...n,parameters:{...M9,...r,...i}});return w1[a.id]=t,a}function B9(t,e){!e||!(e instanceof xs)||w1[e.id]===t&&(e.delete(),delete w1[e.id])}const L9={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||A1(t)&&(t.length===3||t.length===4)},equal(t,e,n){return Wo(t,e,1)}},accessor:{validate(t,e){const n=Jg(t);return n==="function"||n===Jg(e.value)},equal(t,e,n){return typeof e=="function"?!0:Wo(t,e,1)}},array:{validate(t,e){return e.optional&&!t||A1(t)},equal(t,e,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Wo(t,e,r):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Wo(t,e,r):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>{const i=n.context;return!i||!i.gl?null:P9(n.id,i.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{B9(n.id,t)}}};function R9(t){const e={},n={},i={};for(const[r,a]of Object.entries(t)){const h=a==null?void 0:a.deprecatedFor;if(h)i[r]=Array.isArray(h)?h:[h];else{const l=D9(r,a);e[r]=l,n[r]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function D9(t,e){switch(Jg(e)){case"object":return Cd(t,e);case"array":return Cd(t,{type:"array",value:e,compare:!1});case"boolean":return Cd(t,{type:"boolean",value:e});case"number":return Cd(t,{type:"number",value:e});case"function":return Cd(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Cd(t,e){return"type"in e?{name:t,...L9[e.type],...e}:"value"in e?{name:t,type:Jg(e.value),...e}:{name:t,type:"object",value:e}}function A1(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Jg(t){return A1(t)?"array":t===null?"null":typeof t}function O9(t,e){let n;for(let a=e.length-1;a>=0;a--){const h=e[a];"extensions"in h&&(n=h.extensions)}const i=E1(t.constructor,n),r=Object.create(i);r[$g]=t,r[Ic]={},r[gl]={};for(let a=0;a<e.length;++a){const h=e[a];for(const l in h)r[l]=h[l]}return Object.freeze(r),r}const k9="_mergedDefaultProps";function E1(t,e){let n=k9;if(e)for(const r of e){const a=r.constructor;a&&(n+=":".concat(a.extensionName||a.name))}const i=eB(t,n);return i||(t[n]=F9(t,e||[]))}function F9(t,e){if(!t.prototype)return null;const i=Object.getPrototypeOf(t),r=E1(i),a=eB(t,"defaultProps")||{},h=R9(a),l=Object.assign(Object.create(null),r,h.defaultProps),y=Object.assign(Object.create(null),r==null?void 0:r[Sl],h.propTypes),x=Object.assign(Object.create(null),r==null?void 0:r[M0],h.deprecatedProps);for(const T of e){const C=E1(T.constructor);C&&(Object.assign(l,C),Object.assign(y,C[Sl]),Object.assign(x,C[M0]))}return z9(l,t),U9(l,y),N9(l,x),l[Sl]=y,l[M0]=x,e.length===0&&!bb(t,"_propTypes")&&(t._propTypes=y),l}function z9(t,e){const n=V9(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function N9(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r="".concat(this.id,": ").concat(n);for(const a of e[n])bb(this,a)||(this[a]=i);dn.deprecated(r,e[n].join("/"))()}})}function U9(t,e){const n={},i={};for(const r in e){const a=e[r],{name:h,value:l}=a;a.async&&(n[h]=l,i[h]=G9(h))}t[qu]=n,t[Ic]={},Object.defineProperties(t,i)}function G9(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||qP(e)?this[Ic][t]=e:this[gl][t]=e},get(){if(this[gl]){if(t in this[gl])return this[gl][t]||this[qu][t];if(t in this[Ic]){const e=this[$g]&&this[$g].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[qu][t]}}return this[qu][t]}}}function bb(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function eB(t,e){return bb(t,e)&&t[e]}function V9(t){const e=t.componentName;return e||dn.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let j9=0;class wb{constructor(...e){L(this,"id",void 0),L(this,"props",void 0),L(this,"count",void 0),this.props=O9(this,e),this.id=this.props.id,this.count=j9++}clone(e){const{props:n}=this,i={};for(const r in n[qu])r in n[gl]?i[r]=n[gl][r]:r in n[Ic]&&(i[r]=n[Ic][r]);return new this.constructor({...n,...i,...e})}}L(wb,"componentName","Component");L(wb,"defaultProps",{});const H9=Object.freeze({});class W9{constructor(e){L(this,"component",void 0),L(this,"onAsyncPropUpdated",void 0),L(this,"asyncProps",void 0),L(this,"oldProps",void 0),L(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||H9}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[$g]||this.component;const n=e[gl]||{},i=e[Ic]||e,r=e[qu]||{};for(const a in n){const h=n[a];this._createAsyncPropData(a,r[a]),this._updateAsyncProp(a,h),n[a]=this.getAsyncProp(a)}for(const a in i){const h=i[a];this._createAsyncPropData(a,r[a]),this._updateAsyncProp(a,h)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(qP(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(a=>{this.component&&(a=this._postProcessValue(i,a),this._setAsyncPropValue(e,a,r),this._onResolve(e,a))}).catch(a=>{this._onError(e,a)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let a=[],h=0;for await(const l of n){if(!this.component)return;const{dataTransform:y}=this.component.props;y?a=y(l,a):a=a.concat(l),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:h,endRow:a.length}]}),h=a.length,this._setAsyncPropValue(e,a,r)}this._onResolve(e,a)}_postProcessValue(e,n){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.props[Sl];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class X9 extends W9{constructor({attributeManager:e,layer:n}){super(n),L(this,"attributeManager",void 0),L(this,"needsRedraw",void 0),L(this,"needsUpdate",void 0),L(this,"subLayers",void 0),L(this,"usesPickingColorCache",void 0),L(this,"hasPickingBuffer",void 0),L(this,"changeFlags",void 0),L(this,"viewport",void 0),L(this,"uniformTransitions",void 0),L(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const i=this.layer,r=i==null?void 0:i.props.fetch;return r?r(n,{propName:e,layer:i}):super._fetch(e,n)}_onResolve(e,n){const i=this.layer;if(i){const r=i.props.onDataLoad;e==="data"&&r&&r(n,{propName:e,layer:i})}}_onError(e,n){const i=this.layer;i&&i.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const q9="layer.changeFlag",$9="layer.initialize",Z9="layer.update",J9="layer.finalize",K9="layer.matched",vS=2**24-1,Y9=Object.freeze([]),Q9=$f(({oldViewport:t,viewport:e})=>t.equals(e));let zo=new Uint8ClampedArray(0);const ej={data:{type:"data",value:Y9,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:a})=>{const{resourceManager:h}=n.context;if(r=r||n.getLoadOptions(),i=i||n.props.loaders,a){var l;r={...r,fetch:{...(l=r)===null||l===void 0?void 0:l.fetch,signal:a}}}let y=h.contains(t);return!y&&!r&&(h.add({resourceId:t,data:Ml(t,i),persistent:!1}),y=!0),y?h.subscribe({resourceId:t,onChange:x=>{var T;return(T=n.internalState)===null||T===void 0?void 0:T.reloadAsyncProp(e,x)},consumerId:n.id,requestId:e}):Ml(t,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:rn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class yh extends wb{constructor(...e){super(...e),L(this,"internalState",null),L(this,"lifecycle",wu.NO_STATE),L(this,"context",void 0),L(this,"state",void 0),L(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Ai(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=OP(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,a,h]=RP(i,n.pixelProjectionMatrix);return e.length===2?[r,a]:[r,a,h]}unproject(e){return Ai(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ai(this.internalState);const i=this.internalState.viewport||this.context.viewport;return yV(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===rn.DEFAULT||e===rn.LNGLAT||e===rn.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ai(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:T9(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=I9(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const r of i)n.invalidateAll(r);else n.invalidateAll();if(n){const{props:r}=e,a=this.internalState.hasPickingBuffer,h=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(l=>l.getNeedsPickingBuffer.call(this,l));if(a!==h){this.internalState.hasPickingBuffer=h;const{pickingColors:l,instancePickingColors:y}=n.attributes,x=l||y;x&&(h&&x.constant&&(x.constant=!1,n.invalidate(x.id)),!x.value&&!h&&(x.constant=!0,x.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var i,r;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((i=(r=this.props).onError)!==null&&i!==void 0&&i.call(r,e))){var a,h;(a=this.context)===null||a===void 0||(h=a.onError)===null||h===void 0||h.call(a,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!Q9({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const a=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(a)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(zo.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>vS&&dn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),zo=Pf.allocate(zo,n,{size:3,copy:!0,maxCount:Math.max(n,vS)});const r=Math.floor(zo.length/3),a=[];for(let h=i;h<r;h++)this.encodePickingColor(h,a),zo[h*3+0]=a[0],zo[h*3+1]=a[1],zo[h*3+2]=a[2]}e.value=zo.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),r=e.userData.excludeAttributes||{},a=i.getShaderAttributes(n,r);e.setAttributes(a)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,a=i||r,h=a&&n.attributes&&n.attributes[a.id];if(h&&h.value){const l=h.value,y=this.encodePickingColor(e);for(let x=0;x<n.length;x++){const T=a.getVertexOffset(x);l[T]===y[0]&&l[T+1]===y[1]&&l[T+2]===y[2]&&this._disablePickingIndex(x)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const a=r.getVertexOffset(e),h=r.getVertexOffset(e+1);r.buffer.subData({data:new Uint8Array(h-a),offset:a})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==zo.buffer&&(i.value=zo.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Ai(!this.internalState),Ai(Number.isFinite(this.props.coordinateSystem)),fr($9,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new X9({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(dn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new g9(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){fr(K9,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(fr(Z9,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,a=i.viewport,h=this._updateUniformTransition();r.propsInTransition=h,i.viewport=r.viewport||a,this.props=h;try{const l=this._getUpdateParams(),y=this.getModels();if(i.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const T of this.props.extensions)T.updateState.call(this,l,T);const x=this.getModels()[0]!==y[0];this._postUpdate(l,x)}finally{i.viewport=a,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){fr(J9,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,a=this.context;this.props=this.internalState.propsInTransition||r;const h=this.props.opacity;n.opacity=Math.pow(h,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,y=l&&l(n)||[0,0];Ma(a.gl,{polygonOffset:y}),mo(a.gl,i,()=>{const x={moduleParameters:e,uniforms:n,parameters:i,context:a};for(const T of this.props.extensions)T.draw.call(this,x,T);this.draw(x)})}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let a=!1;switch(r){case"dataChanged":const h=e[r],l=n[r];h&&Array.isArray(l)&&(n.dataChanged=Array.isArray(h)?l.concat(h):h,a=!0);default:n[r]||(n[r]=e[r],a=!0)}a&&fr(q9,this,r,e)}const i=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=y9(e,n);if(i.updateTriggersChanged)for(const a in i.updateTriggersChanged)i.updateTriggersChanged[a]&&this.invalidateAttribute(a);if(i.transitionsChanged)for(const a in i.transitionsChanged){var r;this.internalState.uniformTransitions.add(a,n[a],e[a],(r=e.transitions)===null||r===void 0?void 0:r[a])}return this.setChangeFlags(i)}validateProps(){_9(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new h9(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:a}=this.state;a==null||a.setInstanceCount(this.getNumInstances());const{autoHighlight:h,highlightedObjectIndex:l,highlightColor:y}=i;if(n||r.autoHighlight!==h||r.highlightedObjectIndex!==l||r.highlightColor!==y){const x={};h||(x.pickingSelectedColor=null),Array.isArray(y)&&(x.pickingHighlightColor=y),(n||l!==r.highlightedObjectIndex)&&(x.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(x)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;if(n=n||r,n)for(const a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}L(yh,"defaultProps",ej);L(yh,"layerName","Layer");const tj="compositeLayer.renderLayers";class tB extends yh{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:r,visible:a,parameters:h,getPolygonOffset:l,highlightedObjectIndex:y,autoHighlight:x,highlightColor:T,coordinateSystem:C,coordinateOrigin:S,wrapLongitude:z,positionFormat:V,modelMatrix:Z,extensions:ue,fetch:q,operation:j,_subLayerProps:K}=this.props,de={id:"",updateTriggers:{},opacity:i,pickable:r,visible:a,parameters:h,getPolygonOffset:l,highlightedObjectIndex:y,autoHighlight:x,highlightColor:T,coordinateSystem:C,coordinateOrigin:S,wrapLongitude:z,positionFormat:V,modelMatrix:Z,extensions:ue,fetch:q,operation:j},ve=K&&e.id&&K[e.id],Ie=ve&&ve.updateTriggers,De=e.id||"sublayer";if(ve){const Fe=this.props[Sl],je=e.type?e.type._propTypes:{};for(const Ne in ve){const dt=je[Ne]||Fe[Ne];dt&&dt.type==="accessor"&&(ve[Ne]=this.getSubLayerAccessor(ve[Ne]))}}Object.assign(de,e,ve),de.id="".concat(this.props.id,"-").concat(De),de.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...Ie};for(const Fe of ue){const je=Fe.getSubLayerProps.call(this,Fe);je&&Object.assign(de,je,{updateTriggers:Object.assign(de.updateTriggers,je.updateTriggers)})}return de}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const a=this.renderLayers();i=uh(a,Boolean),this.internalState.subLayers=i}fr(tj,this,r,i);for(const a of i)a.parent=this}}L(tB,"layerName","CompositeLayer");const nj=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ij=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,nB=[0,0,0,255],iB=[0,0,1],rj={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:iB},getColor:{type:"accessor",value:nB},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function sj(t){const{header:e,attributes:n}=t;!e||!n||(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}class Ab extends yh{getShaders(){return super.getShaders({vs:nj,fs:ij,modules:[mb,F5,gb]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:iB},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:nB}})}updateState(e){const{changeFlags:n,props:i}=e;if(super.updateState(e),n.extensionsChanged){var r;const{gl:a}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}n.dataChanged&&sj(i.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:i}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:n1[i],radiusPixels:n}).draw()}_getModel(e){const n=[];for(let i=0;i<3;i++){const r=i/3*Math.PI*2;n.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new ah(e,{...this.getShaders(),id:this.props.id,geometry:new tf({drawMode:4,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}L(Ab,"layerName","PointCloudLayer");L(Ab,"defaultProps",rj);const ps={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new we;new we;const Id=new we,xS=new we;class Kf{constructor(e=[0,0,0],n=0){L(this,"center",void 0),L(this,"radius",void 0),this.radius=-0,this.center=new we,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=Id.from(n),this.center=new we().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Kf(this.center,this.radius)}union(e){const n=this.center,i=this.radius,r=e.center,a=e.radius,h=Id.copy(r).subtract(n),l=h.magnitude();if(i>=l+a)return this.clone();if(a>=l+i)return e.clone();const y=(i+l+a)*.5;return xS.copy(h).scale((-i+y)/l).add(n),this.center.copy(xS),this.radius=y,this}expand(e){const i=Id.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const n=H6(Id,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const i=Id.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const n=this.center,i=this.radius,a=e.normal.dot(n)+e.distance;return a<-i?ps.OUTSIDE:a<i?ps.INTERSECTING:ps.INSIDE}}const oj=new we,aj=new we,Lm=new we,Rm=new we,Dm=new we,lj=new we,cj=new we,fa={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Yf{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){L(this,"center",void 0),L(this,"halfAxes",void 0),this.center=new we().from(e),this.halfAxes=new oi(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new we(e).len(),new we(n).len(),new we(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),r=new we(e).normalize(),a=new we(n).normalize(),h=new we(i).normalize();return new Cf().fromMatrix3(new oi([...r,...a,...h]))}fromCenterHalfSizeQuaternion(e,n,i){const r=new Cf(i),a=new oi().fromQuaternion(r);return a[0]=a[0]*n[0],a[1]=a[1]*n[0],a[2]=a[2]*n[0],a[3]=a[3]*n[1],a[4]=a[4]*n[1],a[5]=a[5]*n[1],a[6]=a[6]*n[2],a[7]=a[7]*n[2],a[8]=a[8]*n[2],this.center=new we().from(e),this.halfAxes=a,this}clone(){return new Yf(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Kf){const n=this.halfAxes,i=n.getColumn(0,Lm),r=n.getColumn(1,Rm),a=n.getColumn(2,Dm),h=oj.copy(i).add(r).add(a);return e.center.copy(this.center),e.radius=h.magnitude(),e}intersectPlane(e){const n=this.center,i=e.normal,r=this.halfAxes,a=i.x,h=i.y,l=i.z,y=Math.abs(a*r[fa.COLUMN0ROW0]+h*r[fa.COLUMN0ROW1]+l*r[fa.COLUMN0ROW2])+Math.abs(a*r[fa.COLUMN1ROW0]+h*r[fa.COLUMN1ROW1]+l*r[fa.COLUMN1ROW2])+Math.abs(a*r[fa.COLUMN2ROW0]+h*r[fa.COLUMN2ROW1]+l*r[fa.COLUMN2ROW2]),x=i.dot(n)+e.distance;return x<=-y?ps.OUTSIDE:x>=y?ps.INSIDE:ps.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=aj.from(e).subtract(this.center),i=this.halfAxes,r=i.getColumn(0,Lm),a=i.getColumn(1,Rm),h=i.getColumn(2,Dm),l=r.magnitude(),y=a.magnitude(),x=h.magnitude();r.normalize(),a.normalize(),h.normalize();let T=0,C;return C=Math.abs(n.dot(r))-l,C>0&&(T+=C*C),C=Math.abs(n.dot(a))-y,C>0&&(T+=C*C),C=Math.abs(n.dot(h))-x,C>0&&(T+=C*C),T}computePlaneDistances(e,n,i=[-0,-0]){let r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;const h=this.center,l=this.halfAxes,y=l.getColumn(0,Lm),x=l.getColumn(1,Rm),T=l.getColumn(2,Dm),C=lj.copy(y).add(x).add(T).add(h),S=cj.copy(C).subtract(e);let z=n.dot(S);return r=Math.min(z,r),a=Math.max(z,a),C.copy(h).add(y).add(x).subtract(T),S.copy(C).subtract(e),z=n.dot(S),r=Math.min(z,r),a=Math.max(z,a),C.copy(h).add(y).subtract(x).add(T),S.copy(C).subtract(e),z=n.dot(S),r=Math.min(z,r),a=Math.max(z,a),C.copy(h).add(y).subtract(x).subtract(T),S.copy(C).subtract(e),z=n.dot(S),r=Math.min(z,r),a=Math.max(z,a),h.copy(C).subtract(y).add(x).add(T),S.copy(C).subtract(e),z=n.dot(S),r=Math.min(z,r),a=Math.max(z,a),h.copy(C).subtract(y).add(x).subtract(T),S.copy(C).subtract(e),z=n.dot(S),r=Math.min(z,r),a=Math.max(z,a),h.copy(C).subtract(y).subtract(x).add(T),S.copy(C).subtract(e),z=n.dot(S),r=Math.min(z,r),a=Math.max(z,a),h.copy(C).subtract(y).subtract(x).subtract(T),S.copy(C).subtract(e),z=n.dot(S),r=Math.min(z,r),a=Math.max(z,a),i[0]=r,i[1]=a,i}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,Lm);n.transformAsPoint(e);const i=this.halfAxes.getColumn(1,Rm);i.transformAsPoint(e);const r=this.halfAxes.getColumn(2,Dm);return r.transformAsPoint(e),this.halfAxes=new oi([...n,...i,...r]),this}getTransform(){throw new Error("not implemented")}}const bS=new we,wS=new we;class lo{constructor(e=[0,0,1],n=0){L(this,"normal",void 0),L(this,"distance",void 0),this.normal=new we,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return co(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=bS.from(e),this.normal.from(n).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,n,i,r){return this.normal.set(e,n,i),co(go(this.normal.len(),1)),this.distance=r,this}clone(){return new lo(this.normal,this.distance)}equals(e){return go(this.distance,e.distance)&&go(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=wS.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,n)}projectPointOntoPlane(e,n=[0,0,0]){e=bS.from(e);const i=this.getPointDistance(e),r=wS.copy(this.normal).scale(i);return e.subtract(r).to(n)}}const AS=[new we([1,0,0]),new we([0,1,0]),new we([0,0,1])],ES=new we,uj=new we;new lo(new we(1,0,0),0);class Gs{constructor(e=[]){L(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*AS.length;const n=e.center,i=e.radius;let r=0;for(const a of AS){let h=this.planes[r],l=this.planes[r+1];h||(h=this.planes[r]=new lo),l||(l=this.planes[r+1]=new lo);const y=ES.copy(a).scale(-i).add(n);-a.dot(y),h.fromPointNormal(y,a);const x=ES.copy(a).scale(i).add(n),T=uj.copy(a).negate();-T.dot(x),l.fromPointNormal(x,T),r+=2}return this}computeVisibility(e){let n=ps.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case ps.OUTSIDE:return ps.OUTSIDE;case ps.INTERSECTING:n=ps.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(co(Number.isFinite(n),"parentPlaneMask is required."),n===Gs.MASK_OUTSIDE||n===Gs.MASK_INSIDE)return n;let i=Gs.MASK_INSIDE;const r=this.planes;for(let a=0;a<this.planes.length;++a){const h=a<31?1<<a:0;if(a<31&&!(n&h))continue;const l=r[a],y=e.intersectPlane(l);if(y===ps.OUTSIDE)return Gs.MASK_OUTSIDE;y===ps.INTERSECTING&&(i|=h)}return i}}L(Gs,"MASK_OUTSIDE",4294967295);L(Gs,"MASK_INSIDE",0);L(Gs,"MASK_INDETERMINATE",2147483647);new we;new we;new we;new we;new we;new we;new we;new we;new we;new we;new we;new we;new we;new we;new we;new we;new we;const No=new oi,hj=new oi,dj=new oi,Om=new oi,TS=new oi;function fj(t,e={}){const n=If.EPSILON20,i=10;let r=0,a=0;const h=hj,l=dj;h.identity(),l.copy(t);const y=n*pj(l);for(;a<i&&mj(l)>y;)gj(l,Om),TS.copy(Om).transpose(),l.multiplyRight(Om),l.multiplyLeft(TS),h.multiplyRight(Om),++r>2&&(++a,r=0);return e.unitary=h.toTarget(e.unitary),e.diagonal=l.toTarget(e.diagonal),e}function pj(t){let e=0;for(let n=0;n<9;++n){const i=t[n];e+=i*i}return Math.sqrt(e)}const T1=[1,0,0],S1=[2,2,1];function mj(t){let e=0;for(let n=0;n<3;++n){const i=t[No.getElementIndex(S1[n],T1[n])];e+=2*i*i}return Math.sqrt(e)}function gj(t,e){const n=If.EPSILON15;let i=0,r=1;for(let x=0;x<3;++x){const T=Math.abs(t[No.getElementIndex(S1[x],T1[x])]);T>i&&(r=x,i=T)}const a=T1[r],h=S1[r];let l=1,y=0;if(Math.abs(t[No.getElementIndex(h,a)])>n){const x=t[No.getElementIndex(h,h)],T=t[No.getElementIndex(a,a)],C=t[No.getElementIndex(h,a)],S=(x-T)/2/C;let z;S<0?z=-1/(-S+Math.sqrt(1+S*S)):z=1/(S+Math.sqrt(1+S*S)),l=1/Math.sqrt(1+z*z),y=z*l}return oi.IDENTITY.to(e),e[No.getElementIndex(a,a)]=e[No.getElementIndex(h,h)]=l,e[No.getElementIndex(h,a)]=y,e[No.getElementIndex(a,h)]=-y,e}const al=new we,_j=new we,yj=new we,vj=new we,xj=new we,bj=new oi,wj={diagonal:new oi,unitary:new oi};function Aj(t,e=new Yf){if(!t||t.length===0)return e.halfAxes=new oi([0,0,0,0,0,0,0,0,0]),e.center=new we,e;const n=t.length,i=new we(0,0,0);for(const je of t)i.add(je);const r=1/n;i.multiplyByScalar(r);let a=0,h=0,l=0,y=0,x=0,T=0;for(const je of t){const Ne=al.copy(je).subtract(i);a+=Ne.x*Ne.x,h+=Ne.x*Ne.y,l+=Ne.x*Ne.z,y+=Ne.y*Ne.y,x+=Ne.y*Ne.z,T+=Ne.z*Ne.z}a*=r,h*=r,l*=r,y*=r,x*=r,T*=r;const C=bj;C[0]=a,C[1]=h,C[2]=l,C[3]=h,C[4]=y,C[5]=x,C[6]=l,C[7]=x,C[8]=T;const{unitary:S}=fj(C,wj),z=e.halfAxes.copy(S);let V=z.getColumn(0,yj),Z=z.getColumn(1,vj),ue=z.getColumn(2,xj),q=-Number.MAX_VALUE,j=-Number.MAX_VALUE,K=-Number.MAX_VALUE,de=Number.MAX_VALUE,ve=Number.MAX_VALUE,Ie=Number.MAX_VALUE;for(const je of t)al.copy(je),q=Math.max(al.dot(V),q),j=Math.max(al.dot(Z),j),K=Math.max(al.dot(ue),K),de=Math.min(al.dot(V),de),ve=Math.min(al.dot(Z),ve),Ie=Math.min(al.dot(ue),Ie);V=V.multiplyByScalar(.5*(de+q)),Z=Z.multiplyByScalar(.5*(ve+j)),ue=ue.multiplyByScalar(.5*(Ie+K)),e.center.copy(V).add(Z).add(ue);const De=_j.set(q-de,j-ve,K-Ie).multiplyByScalar(.5),Fe=new oi([De[0],0,0,0,De[1],0,0,0,De[2]]);return e.halfAxes.multiplyRight(Fe),e}const R0=Math.PI/180,km=new Float32Array(16),SS=new Float32Array(12);function CS(t,e,n){const i=e[0]*R0,r=e[1]*R0,a=e[2]*R0,h=Math.sin(a),l=Math.sin(i),y=Math.sin(r),x=Math.cos(a),T=Math.cos(i),C=Math.cos(r),S=n[0],z=n[1],V=n[2];t[0]=S*C*T,t[1]=S*y*T,t[2]=S*-l,t[3]=z*(-y*x+C*l*h),t[4]=z*(C*x+y*l*h),t[5]=z*T*h,t[6]=V*(y*h+C*l*x),t[7]=V*(-C*h+y*l*x),t[8]=V*T*x}function IS(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const rB={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:n}){const{data:i,getOrientation:r,getScale:a,getTranslation:h,getTransformMatrix:l}=this.props,y=Array.isArray(l),x=y&&l.length===16,T=Array.isArray(a),C=Array.isArray(r),S=Array.isArray(h),z=x||!y&&!!l(i[0]);z?t.constant=x:t.constant=C&&T&&S;const V=t.value;if(t.constant){let Z;z?(km.set(l),Z=IS(km)):(Z=SS,CS(Z,r,a),Z.set(h,9)),t.value=new Float32Array(Z)}else{let Z=e*t.size;const{iterable:ue,objectInfo:q}=XP(i,e,n);for(const j of ue){q.index++;let K;if(z)km.set(x?l:l(j,q)),K=IS(km);else{K=SS;const de=C?r:r(j,q),ve=T?a:a(j,q);CS(K,de,ve),K.set(S?h:h(j,q),9)}V[Z++]=K[0],V[Z++]=K[1],V[Z++]=K[2],V[Z++]=K[3],V[Z++]=K[4],V[Z++]=K[5],V[Z++]=K[6],V[Z++]=K[7],V[Z++]=K[8],V[Z++]=K[9],V[Z++]=K[10],V[Z++]=K[11]}}}};function sB(t,e){return e===rn.CARTESIAN||e===rn.METER_OFFSETS||e===rn.DEFAULT&&!t.isGeospatial}const Ej=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Tj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function oB(t){let e=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,h=-1/0;const l=t.POSITION?t.POSITION.value:[],y=l&&l.length;for(let x=0;x<y;x+=3){const T=l[x],C=l[x+1],S=l[x+2];e=T<e?T:e,n=C<n?C:n,i=S<i?S:i,r=T>r?T:r,a=C>a?C:a,h=S>h?S:h}return[[e,n,i],[r,a,h]]}function Sj(t,e){if(!t)throw new Error(e||"loader assertion failed.")}class zu{constructor(e,n){L(this,"fields",void 0),L(this,"metadata",void 0),Sj(Array.isArray(e)),Cj(e),this.fields=e,this.metadata=n||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let n=0;n<this.fields.length;++n)if(!this.fields[n].compareTo(e.fields[n]))return!1;return!0}select(){const e=Object.create(null);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];for(const h of i)e[h]=!0;const a=this.fields.filter(h=>e[h.name]);return new zu(a,this.metadata)}selectAt(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const r=n.map(a=>this.fields[a]).filter(Boolean);return new zu(r,this.metadata)}assign(e){let n,i=this.metadata;if(e instanceof zu){const h=e;n=h.fields,i=MS(MS(new Map,this.metadata),h.metadata)}else n=e;const r=Object.create(null);for(const h of this.fields)r[h.name]=h;for(const h of n)r[h.name]=h;const a=Object.values(r);return new zu(a,i)}}function Cj(t){const e={};for(const n of t)e[n.name]&&console.warn("Schema: duplicated field name",n.name,n),e[n.name]=!0}function MS(t,e){return new Map([...t||new Map,...e||new Map])}class Kg{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;L(this,"name",void 0),L(this,"type",void 0),L(this,"nullable",void 0),L(this,"metadata",void 0),this.name=e,this.type=n,this.nullable=i,this.metadata=r}get typeId(){return this.type&&this.type.typeId}clone(){return new Kg(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let ri=function(t){return t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth",t}({}),aB,lB,cB;class Eb{static isNull(e){return e&&e.typeId===ri.Null}static isInt(e){return e&&e.typeId===ri.Int}static isFloat(e){return e&&e.typeId===ri.Float}static isBinary(e){return e&&e.typeId===ri.Binary}static isUtf8(e){return e&&e.typeId===ri.Utf8}static isBool(e){return e&&e.typeId===ri.Bool}static isDecimal(e){return e&&e.typeId===ri.Decimal}static isDate(e){return e&&e.typeId===ri.Date}static isTime(e){return e&&e.typeId===ri.Time}static isTimestamp(e){return e&&e.typeId===ri.Timestamp}static isInterval(e){return e&&e.typeId===ri.Interval}static isList(e){return e&&e.typeId===ri.List}static isStruct(e){return e&&e.typeId===ri.Struct}static isUnion(e){return e&&e.typeId===ri.Union}static isFixedSizeBinary(e){return e&&e.typeId===ri.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===ri.FixedSizeList}static isMap(e){return e&&e.typeId===ri.Map}static isDictionary(e){return e&&e.typeId===ri.Dictionary}get typeId(){return ri.NONE}compareTo(e){return this===e}}aB=Symbol.toStringTag;class vh extends Eb{constructor(e,n){super(),L(this,"isSigned",void 0),L(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=n}get typeId(){return ri.Int}get[aB](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class Ij extends vh{constructor(){super(!0,8)}}class Mj extends vh{constructor(){super(!0,16)}}class Pj extends vh{constructor(){super(!0,32)}}class Bj extends vh{constructor(){super(!1,8)}}class Lj extends vh{constructor(){super(!1,16)}}class Rj extends vh{constructor(){super(!1,32)}}const uB={HALF:16,SINGLE:32,DOUBLE:64};lB=Symbol.toStringTag;class hB extends Eb{constructor(e){super(),L(this,"precision",void 0),this.precision=e}get typeId(){return ri.Float}get[lB](){return"Float"}toString(){return"Float".concat(this.precision)}}class Dj extends hB{constructor(){super(uB.SINGLE)}}class Oj extends hB{constructor(){super(uB.DOUBLE)}}cB=Symbol.toStringTag;class kj extends Eb{constructor(e,n){super(),L(this,"listSize",void 0),L(this,"children",void 0),this.listSize=e,this.children=[n]}get typeId(){return ri.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[cB](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function Fj(t){switch(t.constructor){case Int8Array:return new Ij;case Uint8Array:return new Bj;case Int16Array:return new Mj;case Uint16Array:return new Lj;case Int32Array:return new Pj;case Uint32Array:return new Rj;case Float32Array:return new Dj;case Float64Array:return new Oj;default:throw new Error("array type not supported")}}function zj(t,e,n){const i=Fj(e.value),r=n||Nj(e);return new Kg(t,new kj(e.size,new Kg("value",i)),!1,r)}function Nj(t){const e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}function PS(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),dn.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function BS(t,e){if(t.attributes)return PS(t.attributes,e),t instanceof tf?t:new tf(t);if(t.positions||t.POSITION)return PS(t,e),new tf({attributes:t});throw Error("Invalid mesh")}const Uj=[0,0,0,255],Gj={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Uj},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class Tb extends yh{constructor(...e){super(...e),L(this,"state",void 0)}getShaders(){const e=!$t(this.context.gl),n={};return Jx(this.context.gl,Dn.GLSL_DERIVATIVES)&&(n.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:Ej,fs:Tj,modules:[mb,z5,gb],transpileToGLSL100:e,defines:n})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let n=this.state.positionBounds;if(n)return n;const{mesh:i}=this.props;if(!i)return null;if(n=(e=i.header)===null||e===void 0?void 0:e.boundingBox,!n){const{attributes:r}=BS(i,this.props._useMeshColors);r.POSITION=r.POSITION||r.positions,n=oB(r)}return this.state.positionBounds=n,n}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:rB}),this.setState({emptyTexture:new xs(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e;if(n.mesh!==i.mesh||r.extensionsChanged){var a;if(this.state.positionBounds=null,(a=this.state.model)===null||a===void 0||a.delete(),n.mesh){this.state.model=this.getModel(n.mesh);const h=n.mesh.attributes||n.mesh;this.setState({hasNormals:!!(h.NORMAL||h.normals)})}this.getAttributeManager().invalidateAll()}n.texture!==i.texture&&this.setTexture(n.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){if(!this.state.model)return;const{viewport:n}=this.context,{sizeScale:i,coordinateSystem:r,_instanced:a}=this.props;this.state.model.setUniforms(e).setUniforms({sizeScale:i,composeModelMatrix:!a||sB(n,r),flatShading:!this.state.hasNormals}).draw()}getModel(e){const n=new ah(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:BS(e,this.props._useMeshColors),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:r}=this.state;return n.setUniforms({sampler:i||r,hasTexture:!!i}),n}setTexture(e){const{emptyTexture:n,model:i}=this.state;i&&i.setUniforms({sampler:e||n,hasTexture:!!e})}}L(Tb,"defaultProps",Gj);L(Tb,"layerName","SimpleMeshLayer");class $u{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n}=e;this.id=n||Pa(this.constructor.name),this.display=!0,this.position=new we,this.rotation=new we,this.scale=new we(1,1,1),this.matrix=new Yt,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return lt(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return lt(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return lt(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:n,rotation:i,scale:r,update:a=!0}=e;return n&&this.setPosition(n),i&&this.setRotation(i),r&&this.setScale(r),a&&this.updateMatrix(),this}updateMatrix(){const e=this.position,n=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(n),this.matrix.scale(i),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:n,rotation:i,scale:r}=e;return n&&this.setPosition(n),i&&this.setRotation(i),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(e,n){lt(e),n=n||this.matrix;const i=new Yt(e).multiplyRight(n),r=i.invert(),a=r.transpose();return{viewMatrix:e,modelMatrix:n,objectMatrix:n,worldMatrix:i,worldInverseMatrix:r,worldInverseTransposeMatrix:a}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class nf extends $u{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:n=[]}=e;_t.assert(n.every(i=>i instanceof $u),"every child must an instance of ScenegraphNode"),super(e),this.children=n}add(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(const r of n)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(e){const n=this.children,i=n.indexOf(e);return i>-1&&n.splice(i,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((n,i)=>{let{worldMatrix:r}=i;const a=n.getBounds();if(!a)return;const[h,l]=a,y=new we(h).add(l).divide([2,2,2]);r.transformAsPoint(y,y);const x=new we(l).subtract(h).divide([2,2,2]);r.transformAsVector(x,x);for(let T=0;T<8;T++){const C=new we(T&1?-1:1,T&2?-1:1,T&4?-1:1).multiply(x).add(y);for(let S=0;S<3;S++)e[0][S]=Math.min(e[0][S],C[S]),e[1][S]=Math.max(e[1][S],C[S])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:n=new Yt}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new Yt(n).multiplyRight(this.matrix);for(const r of this.children)r instanceof nf?r.traverse(e,{worldMatrix:i}):e(r,{worldMatrix:i})}}const Vj={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},jj={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function LS(t){if(!t._animation){const e=jj[t.componentType],n=Vj[t.type],i=n*t.count,{buffer:r,byteOffset:a}=t.bufferView.data,h=new e(r,a+(t.byteOffset||0),i);if(n===1)t._animation=Array.from(h);else{const l=[];for(let y=0;y<h.length;y+=n)l.push(Array.from(h.slice(y,y+n)));t._animation=l}}return t._animation}const Hj=new Yt;function Wj(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){const n=Hj.fromQuaternion(t.rotation);e.matrix.multiplyRight(n)}t.scale&&e.matrix.scale(t.scale)}const D0=new Cf;function Xj(t,e,n,i,r){if(e==="rotation"){D0.slerp({start:n,target:i,ratio:r});for(let a=0;a<D0.length;a++)t[e][a]=D0[a]}else for(let a=0;a<n.length;a++)t[e][a]=r*i[a]+(1-r)*n[a]}function qj(t,e,n){let{p0:i,outTangent0:r,inTangent1:a,p1:h,tDiff:l,ratio:y}=n;for(let x=0;x<t[e].length;x++){const T=r[x]*l,C=a[x]*l;t[e][x]=(2*Math.pow(y,3)-3*Math.pow(y,2)+1)*i[x]+(Math.pow(y,3)-2*Math.pow(y,2)+y)*T+(-2*Math.pow(y,3)+3*Math.pow(y,2))*h[x]+(Math.pow(y,3)-Math.pow(y,2))*C}}function $j(t,e,n){for(let i=0;i<n.length;i++)t[e][i]=n[i]}function Zj(t,e,n,i){let{input:r,interpolation:a,output:h}=e;const l=r[r.length-1],y=t%l,x=r.findIndex(z=>z>=y),T=Math.max(0,x-1);if(!Array.isArray(n[i]))switch(i){case"translation":n[i]=[0,0,0];break;case"rotation":n[i]=[0,0,0,1];break;case"scale":n[i]=[1,1,1];break;default:_t.warn("Bad animation path ".concat(i))()}lt(n[i].length===h[T].length);const C=r[T],S=r[x];switch(a){case"STEP":$j(n,i,h[T]);break;case"LINEAR":if(S>C){const z=(y-C)/(S-C);Xj(n,i,h[T],h[x],z)}break;case"CUBICSPLINE":if(S>C){const z=(y-C)/(S-C),V=S-C,Z=h[3*T+1],ue=h[3*T+2],q=h[3*x+0],j=h[3*x+1];qj(n,i,{p0:Z,outTangent0:ue,inTangent1:q,p1:j,tDiff:V,ratio:z})}break;default:_t.warn("Interpolation ".concat(a," not supported"))();break}}class Jj{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(r=>{let{sampler:a,target:h,path:l}=r;Zj(i,a,h,l),Wj(h,h._node)})}}class Kj{constructor(e){this.animations=e.animations.map((n,i)=>{const r=n.name||"Animation-".concat(i),a=n.samplers.map(l=>{let{input:y,interpolation:x="LINEAR",output:T}=l;return{input:LS(e.accessors[y]),interpolation:x,output:LS(e.accessors[T])}}),h=n.channels.map(l=>{let{sampler:y,target:x}=l;return{sampler:a[y],target:e.nodes[x.node],path:x.path}});return new Jj({name:r,channels:h})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(n=>n.animate(e))}getAnimations(){return this.animations}}class Yj extends $u{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(n),this.onBeforeRender=null,this.AfterRender=null,e instanceof ah?(this.model=e,this._setModelNodeProps(n)):this.model=new ah(e,n),this.bounds=null,this.managedResources=n.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class dB{constructor(e,n){let{attributes:i,material:r,pbrDebug:a,imageBasedLightingEnvironment:h,lights:l,useTangents:y}=n;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Jx(e,Dn.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],h&&(this.uniforms.u_DiffuseEnvSampler=h.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=h.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=h.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),a&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(i.NORMAL,"HAS_NORMALS"),this.defineIfPresent(i.TANGENT&&y,"HAS_TANGENTS"),this.defineIfPresent(i.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(h,"USE_IBL"),this.defineIfPresent(l,"USE_LIGHTS"),this.defineIfPresent(a,"PBR_DEBUG"),r&&this.parseMaterial(r)}defineIfPresent(e,n){e&&(this.defines[n]=1)}parseTexture(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const r=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},a=e.texture.source.image;let h,l={};a.compressed?(h=a,l={[this.gl.TEXTURE_MIN_FILTER]:a.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):h={data:a};const y=new xs(this.gl,{id:e.name||e.id,parameters:{...r,...l},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...h});this.uniforms[n]=y,this.defineIfPresent(i,i),this.generatedTextures.push(y)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:n=1,roughnessFactor:i=1}=e;this.uniforms.u_MetallicRoughnessValues=[n,i]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:n=1}=e.normalTexture;this.uniforms.u_NormalScale=n}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:n=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=n}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:n=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=n}else e.alphaMode==="BLEND"&&(_t.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const Qj=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,eH=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function RS(t,e){return $t(t)?`#version 300 es
`.concat(e):e}function tH(t,e){const{id:n,drawMode:i,vertexCount:r,attributes:a,modelOptions:h}=e,l=new dB(t,e);_t.info(4,"createGLTFModel defines: ",l.defines)();const y=[];y.push(...l.generatedTextures),y.push(...Object.values(a).map(T=>T.buffer));const x=new Yj(t,Object.assign({id:n,drawMode:i,vertexCount:r,modules:[cb],defines:l.defines,parameters:l.parameters,vs:RS(t,Qj),fs:RS(t,eH),managedResources:y},h));return x.setProps({attributes:a}),x.setUniforms(l.uniforms),x}const nH={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},iH={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class rH{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},iH,n)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new Kj(this.gltf):null}createScene(e){const i=(e.nodes||[]).map(a=>this.createNode(a));return new nf({id:e.name||e.id,children:i})}createNode(e){if(!e._node){const i=(e.children||[]).map(a=>this.createNode(a));e.mesh&&i.push(this.createMesh(e.mesh));const r=new nf({id:e.name||e.id,children:i});if(e.matrix)r.setMatrix(e.matrix);else{if(r.matrix.identity(),e.translation&&r.matrix.translate(e.translation),e.rotation){const a=new Yt().fromQuaternion(e.rotation);r.matrix.multiplyRight(a)}e.scale&&r.matrix.scale(e.scale)}e._node=r}return e._node}createMesh(e){if(!e._mesh){const i=(e.primitives||[]).map((a,h)=>this.createPrimitive(a,h,e)),r=new nf({id:e.name||e.id,children:i});e._mesh=r}return e._mesh}getVertexCount(e){_t.warn("getVertexCount() not found")()}createPrimitive(e,n,i){const r=tH(this.gl,Object.assign({id:e.name||"".concat(i.name||i.id,"-primitive-").concat(n),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return r.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],r}createAttributes(e,n){const i={};return Object.keys(e).forEach(r=>{i[r]=this.createAccessor(e[r],this.createBuffer(e[r],this.gl.ARRAY_BUFFER))}),n&&(i.indices=this.createAccessor(n,this.createBuffer(n,this.gl.ELEMENT_ARRAY_BUFFER))),_t.info(4,"glTF Attributes",{attributes:e,indices:n,generated:i})(),i}createBuffer(e,n){e.bufferView||(e.bufferView={});const{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[n]||(i.lumaBuffers[n]=new Sn(this.gl,{id:"from-".concat(i.id),data:i.data||e.value,target:n})),i.lumaBuffers[n]}createAccessor(e,n){return new jr({buffer:n,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:nH[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function sH(t,e,n){const i=new rH(t,n),r=i.instantiate(e),a=i.createAnimator();return{scenes:r,animator:a}}const oH="3.4.4",aH="3.4.4",fB="3.4.4",lH="https://unpkg.com/@loaders.gl/textures@".concat(fB,"/dist/libs/basis_encoder.wasm"),cH="https://unpkg.com/@loaders.gl/textures@".concat(fB,"/dist/libs/basis_encoder.js");let O0;async function DS(t){const e=t.modules||{};return e.basis?e.basis:(O0=O0||uH(t),await O0)}async function uH(t){let e=null,n=null;return[e,n]=await Promise.all([await xc("basis_transcoder.js","textures",t),await xc("basis_transcoder.wasm","textures",t)]),e=e||globalThis.BASIS,await hH(e,n)}function hH(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t(n).then(r=>{const{BasisFile:a,initializeBasis:h}=r;h(),i({BasisFile:a})})})}let k0;async function OS(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(k0=k0||dH(t),await k0)}async function dH(t){let e=null,n=null;return[e,n]=await Promise.all([await xc(cH,"textures",t),await xc(lH,"textures",t)]),e=e||globalThis.BASIS,await fH(e,n)}function fH(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t(n).then(r=>{const{BasisFile:a,KTX2File:h,initializeBasis:l,BasisEncoder:y}=r;l(),i({BasisFile:a,KTX2File:h,BasisEncoder:y})})})}const vu={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},pH=["","WEBKIT_","MOZ_"],kS={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Fm=null;function mH(t){if(!Fm){t=t||gH()||void 0,Fm=new Set;for(const e of pH)for(const n in kS)if(t&&t.getExtension("".concat(e).concat(n))){const i=kS[n];Fm.add(i)}}return Fm}function gH(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var FS,zS,NS,US,GS,VS,jS,HS;(function(t){t[t.NONE=0]="NONE",t[t.BASISLZ=1]="BASISLZ",t[t.ZSTD=2]="ZSTD",t[t.ZLIB=3]="ZLIB"})(FS||(FS={})),function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(zS||(zS={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(NS||(NS={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(US||(US={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(GS||(GS={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(VS||(VS={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(jS||(jS={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(HS||(HS={}));const us=[171,75,84,88,32,50,48,187,13,10,26,10];function _H(t){const e=new Uint8Array(t);return!(e.byteLength<us.length||e[0]!==us[0]||e[1]!==us[1]||e[2]!==us[2]||e[3]!==us[3]||e[4]!==us[4]||e[5]!==us[5]||e[6]!==us[6]||e[7]!==us[7]||e[8]!==us[8]||e[9]!==us[9]||e[10]!==us[10]||e[11]!==us[11])}const yH={etc1:{basisFormat:0,compressed:!0,format:vu.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:vu.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:vu.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:vu.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:vu.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:vu.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function vH(t,e){if(e.basis.containerFormat==="auto"){if(_H(t)){const i=await OS(e);return WS(i.KTX2File,t,e)}const{BasisFile:n}=await DS(e);return F0(n,t,e)}switch(e.basis.module){case"encoder":const n=await OS(e);switch(e.basis.containerFormat){case"ktx2":return WS(n.KTX2File,t,e);case"basis":default:return F0(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:i}=await DS(e);return F0(i,t,e)}}function F0(t,e,n){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const r=i.getNumImages(),a=[];for(let h=0;h<r;h++){const l=i.getNumLevels(h),y=[];for(let x=0;x<l;x++)y.push(xH(i,h,x,n));a.push(y)}return a}finally{i.close(),i.delete()}}function xH(t,e,n,i){const r=t.getImageWidth(e,n),a=t.getImageHeight(e,n),h=t.getHasAlpha(),{compressed:l,format:y,basisFormat:x}=pB(i,h),T=t.getImageTranscodedSizeInBytes(e,n,x),C=new Uint8Array(T);if(!t.transcodeImage(C,e,n,x,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:a,data:C,compressed:l,format:y,hasAlpha:h}}function WS(t,e,n){const i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=i.getLevels(),a=[];for(let h=0;h<r;h++){a.push(bH(i,h,n));break}return[a]}finally{i.close(),i.delete()}}function bH(t,e,n){const{alphaFlag:i,height:r,width:a}=t.getImageLevelInfo(e,0,0),{compressed:h,format:l,basisFormat:y}=pB(n,i),x=t.getImageTranscodedSizeInBytes(e,0,0,y),T=new Uint8Array(x);if(!t.transcodeImage(T,e,0,0,y,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:a,height:r,data:T,compressed:h,levelSize:x,hasAlpha:i,format:l}}function pB(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=mB()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),yH[n]}function mB(){const t=mH();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const wH={name:"Basis",id:Aa?"basis":"basis-nodejs",module:"textures",version:aH,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},AH={...wH,parse:vH};function gs(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function gB(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const i=e.baseUri||e.uri;if(!i)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return i.substr(0,i.lastIndexOf("/")+1)+t}function EH(t,e,n){const i=t.bufferViews[n];gs(i);const r=i.buffer,a=e[r];gs(a);const h=(i.byteOffset||0)+a.byteOffset;return new Uint8Array(a.arrayBuffer,h,i.byteLength)}const XS=["SCALAR","VEC2","VEC3","VEC4"],TH=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],SH=new Map(TH),CH={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},IH={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},MH={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function _B(t){return XS[t-1]||XS[0]}function yB(t){const e=SH.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function Sb(t,e){const n=MH[t.componentType],i=CH[t.type],r=IH[t.componentType],a=t.count*i,h=t.count*i*r;return gs(h>=0&&h<=e.byteLength),{ArrayType:n,length:a,byteLength:h}}function vB(t){let{images:e,bufferViews:n}=t;e=e||[],n=n||[];const i=e.map(h=>h.bufferView);n=n.filter(h=>!i.includes(h));const r=n.reduce((h,l)=>h+l.byteLength,0),a=e.reduce((h,l)=>{const{width:y,height:x}=l.image;return h+y*x},0);return r+Math.ceil(4*a*1.33)}const PH={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Zr{constructor(e){L(this,"gltf",void 0),L(this,"sourceBuffers",void 0),L(this,"byteLength",void 0),this.gltf=e||{json:{...PH},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const n=this.getUsedExtensions().find(r=>r===e),i=this.json.extensions||{};return n?i[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const i=this.json[e]&&this.json[e][n];if(!i)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(n,"]"));return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,i=this.gltf.buffers[n];gs(i);const r=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,r,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),r=this.getBuffer(n.buffer).data,{ArrayType:a,length:h}=Sb(e,n),l=n.byteOffset+e.byteOffset;return new a(r,l,h)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),r=this.getBuffer(n.buffer).data,a=n.byteOffset||0;return new Uint8Array(r,a,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,i){return e.extensions=e.extensions||{},e.extensions[n]=i,this.registerUsedExtension(n),this}setObjectExtension(e,n,i){const r=e.extensions||{};r[n]=i}removeObjectExtension(e,n){const i=e.extensions||{},r=i[n];return delete i[n],r}addExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return gs(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return gs(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:i}=e;this.json.nodes=this.json.nodes||[];const r={mesh:n};return i&&(r.matrix=i),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:i,material:r,mode:a=4}=e,l={primitives:[{attributes:this._addAttributes(n),mode:a}]};if(i){const y=this._addIndices(i);l.primitives[0].indices=y}return Number.isFinite(r)&&(l.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(l),this.json.meshes.length-1}addPointCloud(e){const i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,n){const i=Vx(e),r=n||(i==null?void 0:i.mimeType),h={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(h),this.json.images.length-1}addBufferView(e){const n=e.byteLength;gs(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:0,byteOffset:this.byteLength,byteLength:n};return this.byteLength+=Uf(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,n){const i={bufferView:e,type:_B(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const i=this.addBufferView(e);let r={min:n.min,max:n.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(e,n.size));const a={size:n.size,componentType:yB(e),count:Math.round(e.length/n.size),min:r.min,max:r.max};return this.addAccessor(i,Object.assign(a,n))}addTexture(e){const{imageIndex:n}=e,i={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,n;this.gltf.buffers=[];const i=this.byteLength,r=new ArrayBuffer(i),a=new Uint8Array(r);let h=0;for(const l of this.sourceBuffers||[])h=QO(l,a,h);(e=this.json)!==null&&e!==void 0&&(n=e.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(e,n){let i=!0;for(;i;){const r=e.indexOf(n);r>-1?e.splice(r,1):i=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={};for(const i in e){const r=e[i],a=this._getGltfAttributeName(i),h=this.addBinaryBuffer(r.value,r);n[a]=h}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const i={min:null,max:null};if(e.length<n)return i;i.min=[],i.max=[];const r=e.subarray(0,n);for(const a of r)i.min.push(a),i.max.push(a);for(let a=n;a<e.length;a+=n)for(let h=0;h<n;h++)i.min[0+h]=Math.min(i.min[0+h],e[a+h]),i.max[0+h]=Math.max(i.max[0+h],e[a+h]);return i}}const BH="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",LH="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",RH=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),DH=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),OH={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},kH={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function FH(t,e,n,i,r){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const h=await zH();GH(h,h.exports[kH[r]],t,e,n,i,h.exports[OH[a||"NONE"]])}let z0;async function zH(){return z0||(z0=NH()),z0}async function NH(){let t=BH;WebAssembly.validate(RH)&&(t=LH,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(UH(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function UH(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;++i){const r=t.charCodeAt(i);e[i]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let n=0;for(let i=0;i<t.length;++i)e[n++]=e[i]<60?DH[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,n)}function GH(t,e,n,i,r,a,h){const l=t.exports.sbrk,y=i+3&-4,x=l(y*r),T=l(a.length),C=new Uint8Array(t.exports.memory.buffer);C.set(a,T);const S=e(x,i,r,T,a.length);if(S===0&&h&&h(x,y,r),n.set(C.subarray(x,x+i*r)),l(x-l(0)),S!==0)throw new Error("Malformed buffer data: ".concat(S))}const Cb="EXT_meshopt_compression",VH=Cb;async function jH(t,e){var n;const i=new Zr(t);if(!(e!=null&&(n=e.gltf)!==null&&n!==void 0&&n.decompressMeshes))return;const r=[];for(const a of t.json.bufferViews||[])r.push(HH(i,a));await Promise.all(r),i.removeExtension(Cb)}async function HH(t,e){const n=t.getObjectExtension(e,Cb);if(n){const{byteOffset:i=0,byteLength:r=0,byteStride:a,count:h,mode:l,filter:y="NONE",buffer:x}=n,T=t.gltf.buffers[x],C=new Uint8Array(T.arrayBuffer,T.byteOffset+i,r),S=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await FH(S,h,a,C,l,y),S}return null}const WH=Object.freeze(Object.defineProperty({__proto__:null,decode:jH,name:VH},Symbol.toStringTag,{value:"Module"})),Au="EXT_texture_webp",XH=Au;function qH(t,e){const n=new Zr(t);if(!QF("image/webp")){if(n.getRequiredExtensions().includes(Au))throw new Error("gltf: Required extension ".concat(Au," not supported by browser"));return}const{json:i}=n;for(const r of i.textures||[]){const a=n.getObjectExtension(r,Au);a&&(r.source=a.source),n.removeObjectExtension(r,Au)}n.removeExtension(Au)}const $H=Object.freeze(Object.defineProperty({__proto__:null,name:XH,preprocess:qH},Symbol.toStringTag,{value:"Module"})),ug="KHR_texture_basisu",ZH=ug;function JH(t,e){const n=new Zr(t),{json:i}=n;for(const r of i.textures||[]){const a=n.getObjectExtension(r,ug);a&&(r.source=a.source),n.removeObjectExtension(r,ug)}n.removeExtension(ug)}const KH=Object.freeze(Object.defineProperty({__proto__:null,name:ZH,preprocess:JH},Symbol.toStringTag,{value:"Module"})),YH="3.4.4",QH={draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},e7={name:"Draco",id:Aa?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:YH,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:QH};function t7(t,e,n){const i=xB(e.metadata),r=[],a=n7(e.attributes);for(const h in t){const l=t[h],y=qS(h,l,a[h]);r.push(y)}if(n){const h=qS("indices",n);r.push(h)}return new zu(r,i)}function n7(t){const e={};for(const n in t){const i=t[n];e[i.name||"undefined"]=i}return e}function qS(t,e,n){const i=n?xB(n.metadata):void 0;return zj(t,e,i)}function xB(t){const e=new Map;for(const n in t)e.set("".concat(n,".string"),JSON.stringify(t[n]));return e}const $S={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},i7={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},r7=4;class s7{constructor(e){L(this,"draco",void 0),L(this,"decoder",void 0),L(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const r=this.decoder.GetEncodedGeometryType(i),a=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let h;switch(r){case this.draco.TRIANGULAR_MESH:h=this.decoder.DecodeBufferToMesh(i,a);break;case this.draco.POINT_CLOUD:h=this.decoder.DecodeBufferToPointCloud(i,a);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!h.ok()||!a.ptr){const S="DRACO decompression failed: ".concat(h.error_msg());throw new Error(S)}const l=this._getDracoLoaderData(a,r,n),y=this._getMeshData(a,l,n),x=oB(y.attributes),T=t7(y.attributes,l,y.indices);return{loader:"draco",loaderData:l,header:{vertexCount:a.num_points(),boundingBox:x},...y,schema:T}}finally{this.draco.destroy(i),a&&this.draco.destroy(a)}}_getDracoLoaderData(e,n,i){const r=this._getTopLevelMetadata(e),a=this._getDracoAttributes(e,i);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:a}}_getDracoAttributes(e,n){const i={};for(let r=0;r<e.num_attributes();r++){const a=this.decoder.GetAttribute(e,r),h=this._getAttributeMetadata(e,r);i[a.unique_id()]={unique_id:a.unique_id(),attribute_type:a.attribute_type(),data_type:a.data_type(),num_components:a.num_components(),byte_offset:a.byte_offset(),byte_stride:a.byte_stride(),normalized:a.normalized(),attribute_index:r,metadata:h};const l=this._getQuantizationTransform(a,n);l&&(i[a.unique_id()].quantization_transform=l);const y=this._getOctahedronTransform(a,n);y&&(i[a.unique_id()].octahedron_transform=y)}return i}_getMeshData(e,n,i){const r=this._getMeshAttributes(n,e,i);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(e,n,i){const r={};for(const a of Object.values(e.attributes)){const h=this._deduceAttributeName(a,i);a.name=h;const{value:l,size:y}=this._getAttributeValues(n,a);r[h]={value:l,size:y,byteOffset:a.byte_offset,byteStride:a.byte_stride,normalized:a.normalized}}return r}_getTriangleListIndices(e){const i=e.num_faces()*3,r=i*r7,a=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,a),new Uint32Array(this.draco.HEAPF32.buffer,a,i).slice()}finally{this.draco._free(a)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),l7(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const i=i7[n.data_type],r=n.num_components,h=e.num_points()*r,l=h*i.BYTES_PER_ELEMENT,y=o7(this.draco,i);let x;const T=this.draco._malloc(l);try{const C=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,C,y,l,T),x=new i(this.draco.HEAPF32.buffer,T,h).slice()}finally{this.draco._free(T)}return{value:x,size:r}}_deduceAttributeName(e,n){const i=e.unique_id;for(const[h,l]of Object.entries(n.extraAttributes||{}))if(l===i)return h;const r=e.attribute_type;for(const h in $S)if(this.draco[h]===r)return $S[h];const a=n.attributeNameEntry||"name";return e.metadata[a]?e.metadata[a].string:"CUSTOM_ATTRIBUTE_".concat(i)}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const i=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},i=this.metadataQuerier.NumEntries(e);for(let r=0;r<i;r++){const a=this.metadataQuerier.GetEntryName(e,r);n[a]=this._getDracoMetadataField(e,a)}return n}_getDracoMetadataField(e,n){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,i);const r=a7(i);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:r}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:i=[]}=e,r=[...n,...i];for(const a of r)this.decoder.SkipAttributeTransform(this.draco[a])}_getQuantizationTransform(e,n){const{quantizedAttributes:i=[]}=n,r=e.attribute_type();if(i.map(h=>this.decoder[h]).includes(r)){const h=new this.draco.AttributeQuantizationTransform;try{if(h.InitFromAttribute(e))return{quantization_bits:h.quantization_bits(),range:h.range(),min_values:new Float32Array([1,2,3]).map(l=>h.min_value(l))}}finally{this.draco.destroy(h)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:i=[]}=n,r=e.attribute_type();if(i.map(h=>this.decoder[h]).includes(r)){const h=new this.draco.AttributeQuantizationTransform;try{if(h.InitFromAttribute(e))return{quantization_bits:h.quantization_bits()}}finally{this.draco.destroy(h)}}return null}}function o7(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function a7(t){const e=t.size(),n=new Int32Array(e);for(let i=0;i<e;i++)n[i]=t.GetValue(i);return n}function l7(t){const e=t.size(),n=new Int32Array(e);for(let i=0;i<e;i++)n[i]=t.GetValue(i);return n}const c7="1.5.5",Ib="https://www.gstatic.com/draco/versioned/decoders/".concat(c7),u7="".concat(Ib,"/draco_decoder.js"),h7="".concat(Ib,"/draco_wasm_wrapper.js"),d7="".concat(Ib,"/draco_decoder.wasm");let Md;async function f7(t){const e=t.modules||{};return e.draco3d?Md=Md||e.draco3d.createDecoderModule({}).then(n=>({draco:n})):Md=Md||p7(t),await Md}async function p7(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await xc(u7,"draco",t);break;case"wasm":default:[e,n]=await Promise.all([await xc(h7,"draco",t),await xc(d7,"draco",t)])}return e=e||globalThis.DracoDecoderModule,await m7(e,n)}function m7(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(i=>{t({...n,onModuleLoaded:r=>i({draco:r})})})}const bB={...e7,parse:g7};async function g7(t,e){const{draco:n}=await f7(e),i=new s7(n);try{return i.parseSync(t,e==null?void 0:e.draco)}finally{i.destroy()}}function _7(t){const e={};for(const n in t){const i=t[n];if(n!=="indices"){const r=wB(i);e[n]=r}}return e}function wB(t){const{buffer:e,size:n,count:i}=y7(t);return{value:e,size:n,byteOffset:0,count:i,type:_B(n),componentType:yB(e)}}function y7(t){let e=t,n=1,i=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=v7(e,Float32Array)),i=e.length/n),{buffer:e,size:n,count:i}}function v7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const Mc="KHR_draco_mesh_compression",x7=Mc;function b7(t,e,n){const i=new Zr(t);for(const r of AB(i))i.getObjectExtension(r,Mc)}async function w7(t,e,n){var i;if(!(e!=null&&(i=e.gltf)!==null&&i!==void 0&&i.decompressMeshes))return;const r=new Zr(t),a=[];for(const h of AB(r))r.getObjectExtension(h,Mc)&&a.push(E7(r,h,e,n));await Promise.all(a),r.removeExtension(Mc)}function A7(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new Zr(t);for(const i of n.json.meshes||[])T7(i,e),n.addRequiredExtension(Mc)}async function E7(t,e,n,i){const r=t.getObjectExtension(e,Mc);if(!r)return;const a=t.getTypedArrayForBufferView(r.bufferView),h=Rx(a.buffer,a.byteOffset),{parse:l}=i,y={...n};delete y["3d-tiles"];const x=await l(h,bB,y,i),T=_7(x.attributes);for(const[C,S]of Object.entries(T))if(C in e.attributes){const z=e.attributes[C],V=t.getAccessor(z);V!=null&&V.min&&V!==null&&V!==void 0&&V.max&&(S.min=V.min,S.max=V.max)}e.attributes=T,x.indices&&(e.indices=wB(x.indices)),S7(e)}function T7(t,e){var n;let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const h=r.DracoWriter.encodeSync({attributes:t}),l=a==null||(n=a.parseSync)===null||n===void 0?void 0:n.call(a,{attributes:t}),y=r._addFauxAttributes(l.attributes),x=r.addBufferView(h);return{primitives:[{attributes:y,mode:i,extensions:{[Mc]:{bufferView:x,attributes:y}}}]}}function S7(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*AB(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const C7=Object.freeze(Object.defineProperty({__proto__:null,decode:w7,encode:A7,name:x7,preprocess:b7},Symbol.toStringTag,{value:"Module"})),I7={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},M7={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Mb="KHR_texture_transform",P7=Mb,zm=new we,B7=new oi,L7=new oi;async function R7(t,e){if(!new Zr(t).getExtension(Mb))return;const r=t.json.materials||[];for(let a=0;a<r.length;a++)D7(a,t)}function D7(t,e){var n,i,r;const a=[],h=(n=e.json.materials)===null||n===void 0?void 0:n[t],l=h==null||(i=h.pbrMetallicRoughness)===null||i===void 0?void 0:i.baseColorTexture;l&&Pd(e,t,l,a);const y=h==null?void 0:h.emissiveTexture;y&&Pd(e,t,y,a);const x=h==null?void 0:h.normalTexture;x&&Pd(e,t,x,a);const T=h==null?void 0:h.occlusionTexture;T&&Pd(e,t,T,a);const C=h==null||(r=h.pbrMetallicRoughness)===null||r===void 0?void 0:r.metallicRoughnessTexture;C&&Pd(e,t,C,a)}function Pd(t,e,n,i){const r=O7(n,i);if(!r)return;const a=t.json.meshes||[];for(const h of a)for(const l of h.primitives){const y=l.material;Number.isFinite(y)&&e===y&&k7(t,l,r)}}function O7(t,e){var n;const i=(n=t.extensions)===null||n===void 0?void 0:n[Mb],{texCoord:r=0}=t,{texCoord:a=r}=i;if(!(e.findIndex(l=>{let[y,x]=l;return y===r&&x===a})!==-1)){const l=N7(i);return r!==a&&(t.texCoord=a),e.push([r,a]),{originalTexCoord:r,texCoord:a,matrix:l}}return null}function k7(t,e,n){const{originalTexCoord:i,texCoord:r,matrix:a}=n,h=e.attributes["TEXCOORD_".concat(i)];if(Number.isFinite(h)){var l;const x=(l=t.json.accessors)===null||l===void 0?void 0:l[h];if(x&&x.bufferView){var y;const T=(y=t.json.bufferViews)===null||y===void 0?void 0:y[x.bufferView];if(T){const{arrayBuffer:C,byteOffset:S}=t.buffers[T.buffer],z=(S||0)+(x.byteOffset||0)+(T.byteOffset||0),{ArrayType:V,length:Z}=Sb(x,T),ue=M7[x.componentType],q=I7[x.type],j=T.byteStride||ue*q,K=new Float32Array(Z);for(let de=0;de<x.count;de++){const ve=new V(C,z+de*j,2);zm.set(ve[0],ve[1],1),zm.transformByMatrix3(a),K.set([zm[0],zm[1]],de*q)}i===r?F7(x,T,t.buffers,K):z7(r,x,e,t,K)}}}}function F7(t,e,n,i){t.componentType=5126,n.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function z7(t,e,n,i,r){i.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const a=i.json.bufferViews;if(!a)return;a.push({buffer:i.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const h=i.json.accessors;h&&(h.push({bufferView:(a==null?void 0:a.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes["TEXCOORD_".concat(t)]=h.length-1)}function N7(t){const{offset:e=[0,0],rotation:n=0,scale:i=[1,1]}=t,r=new oi().set(1,0,0,0,1,0,e[0],e[1],1),a=B7.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),h=L7.set(i[0],0,0,0,i[1],0,0,0,1);return r.multiplyRight(a).multiplyRight(h)}const U7=Object.freeze(Object.defineProperty({__proto__:null,decode:R7,name:P7},Symbol.toStringTag,{value:"Module"})),_c="KHR_lights_punctual",G7=_c;async function V7(t){const e=new Zr(t),{json:n}=e,i=e.getExtension(_c);i&&(e.json.lights=i.lights,e.removeExtension(_c));for(const r of n.nodes||[]){const a=e.getObjectExtension(r,_c);a&&(r.light=a.light),e.removeObjectExtension(r,_c)}}async function j7(t){const e=new Zr(t),{json:n}=e;if(n.lights){const i=e.addExtension(_c);gs(!i.lights),i.lights=n.lights,delete n.lights}if(e.json.lights){for(const i of e.json.lights){const r=i.node;e.addObjectExtension(r,_c,i)}delete e.json.lights}}const H7=Object.freeze(Object.defineProperty({__proto__:null,decode:V7,encode:j7,name:G7},Symbol.toStringTag,{value:"Module"})),Lf="KHR_materials_unlit",W7=Lf;async function X7(t){const e=new Zr(t),{json:n}=e;for(const i of n.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,Lf);e.removeExtension(Lf)}function q7(t){const e=new Zr(t),{json:n}=e;if(e.materials)for(const i of n.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,Lf,{}),e.addExtension(Lf))}const $7=Object.freeze(Object.defineProperty({__proto__:null,decode:X7,encode:q7,name:W7},Symbol.toStringTag,{value:"Module"})),Ud="KHR_techniques_webgl",Z7=Ud;async function J7(t){const e=new Zr(t),{json:n}=e,i=e.getExtension(Ud);if(i){const r=Y7(i,e);for(const a of n.materials||[]){const h=e.getObjectExtension(a,Ud);h&&(a.technique=Object.assign({},h,r[h.technique]),a.technique.values=Q7(a.technique,e)),e.removeObjectExtension(a,Ud)}e.removeExtension(Ud)}}async function K7(t,e){}function Y7(t,e){const{programs:n=[],shaders:i=[],techniques:r=[]}=t,a=new TextDecoder;return i.forEach(h=>{if(Number.isFinite(h.bufferView))h.code=a.decode(e.getTypedArrayForBufferView(h.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(h=>{h.fragmentShader=i[h.fragmentShader],h.vertexShader=i[h.vertexShader]}),r.forEach(h=>{h.program=n[h.program]}),r}function Q7(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(i=>{t.uniforms[i].value&&!(i in n)&&(n[i]=t.uniforms[i].value)}),Object.keys(n).forEach(i=>{typeof n[i]=="object"&&n[i].index!==void 0&&(n[i].texture=e.getTexture(n[i].index))}),n}const eW=Object.freeze(Object.defineProperty({__proto__:null,decode:J7,encode:K7,name:Z7},Symbol.toStringTag,{value:"Module"})),EB="EXT_feature_metadata",tW=EB;async function nW(t){const e=new Zr(t);iW(e)}function iW(t){var e;const n=t.getExtension(EB),i=n==null||(e=n.schema)===null||e===void 0?void 0:e.classes,r=n==null?void 0:n.featureTables;if((n==null?void 0:n.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),i&&r)for(const h in i){const l=i[h],y=oW(r,h);y&&rW(t,y,l)}}function rW(t,e,n){for(const r in n.properties){var i;const a=n.properties[r],h=e==null||(i=e.properties)===null||i===void 0?void 0:i[r],l=e.count;if(h){const y=sW(t,a,l,h);h.data=y}}}function sW(t,e,n,i){const r=i.bufferView;let a=t.getTypedArrayForBufferView(r);switch(e.type){case"STRING":{const h=i.stringOffsetBufferView,l=t.getTypedArrayForBufferView(h);a=aW(a,l,n);break}}return a}function oW(t,e){for(const n in t){const i=t[n];if(i.class===e)return i}return null}function aW(t,e,n){const i=[],r=new TextDecoder("utf8");let a=0;const h=4;for(let l=0;l<n;l++){const y=e[(l+1)*h]-e[l*h],x=t.subarray(a,y+a),T=r.decode(x);i.push(T),a+=y}return i}const lW=Object.freeze(Object.defineProperty({__proto__:null,decode:nW,name:tW},Symbol.toStringTag,{value:"Module"})),TB=[WH,$H,KH,C7,H7,$7,eW,U7,lW];function cW(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=TB.filter(a=>SB(a.name,e));for(const a of i){var r;(r=a.preprocess)===null||r===void 0||r.call(a,t,e,n)}}async function uW(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=TB.filter(a=>SB(a.name,e));for(const a of i){var r;await((r=a.decode)===null||r===void 0?void 0:r.call(a,t,e,n))}}function SB(t,e){var n;const i=(e==null||(n=e.gltf)===null||n===void 0?void 0:n.excludeExtensions)||{};return!(t in i&&!i[t])}const N0="KHR_binary_glTF";function hW(t){const e=new Zr(t),{json:n}=e;for(const i of n.images||[]){const r=e.getObjectExtension(i,N0);r&&Object.assign(i,r),e.removeObjectExtension(i,N0)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(N0)}const ZS={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},dW={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class fW{constructor(){L(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),L(this,"json",void 0)}normalize(e,n){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(i.asset.version));return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),hW(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in ZS)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const i=e[n];if(!(!i||Array.isArray(i))){e[n]=[];for(const r in i){const a=i[r];a.id=a.id||r;const h=e[n].length;e[n].push(a),this.idToIndexMap[n][r]=h}}}_convertObjectIdsToArrayIndices(e){for(const n in ZS)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:i,indices:r,material:a}=n;for(const h in i)i[h]=this._convertIdToIndex(i[h],"accessor");r&&(n.indices=this._convertIdToIndex(r,"accessor")),a&&(n.material=this._convertIdToIndex(a,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn("gltf v1: json doesn't contain attribute ".concat(n)),e[n]=[]);for(const i of e[n])for(const r in i){const a=i[r],h=this._convertIdToIndex(a,r);i[r]=h}}_convertIdToIndex(e,n){const i=dW[n];if(i in this.idToIndexMap){const r=this.idToIndexMap[i][e];if(!Number.isFinite(r))throw new Error("gltf v1: failed to resolve ".concat(n," with id ").concat(e));return r}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){for(const a of e.materials){var n,i,r;a.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const h=((n=a.values)===null||n===void 0?void 0:n.tex)||((i=a.values)===null||i===void 0?void 0:i.texture2d_0)||((r=a.values)===null||r===void 0?void 0:r.diffuseTex),l=e.textures.findIndex(y=>y.id===h);l!==-1&&(a.pbrMetallicRoughness.baseColorTexture={index:l})}}}function pW(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new fW().normalize(t,e)}const mW={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gW={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Os={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},_W={magFilter:Os.TEXTURE_MAG_FILTER,minFilter:Os.TEXTURE_MIN_FILTER,wrapS:Os.TEXTURE_WRAP_S,wrapT:Os.TEXTURE_WRAP_T},yW={[Os.TEXTURE_MAG_FILTER]:Os.LINEAR,[Os.TEXTURE_MIN_FILTER]:Os.NEAREST_MIPMAP_LINEAR,[Os.TEXTURE_WRAP_S]:Os.REPEAT,[Os.TEXTURE_WRAP_T]:Os.REPEAT};function vW(t){return gW[t]}function xW(t){return mW[t]}class bW{constructor(){L(this,"baseUri",""),L(this,"json",{}),L(this,"buffers",[]),L(this,"images",[])}postProcess(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:i,buffers:r=[],images:a=[],baseUri:h=""}=e;return gs(i),this.baseUri=h,this.json=i,this.buffers=r,this.images=a,this._resolveTree(this.json,n),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((n,i)=>this._resolveBufferView(n,i))),e.images&&(e.images=e.images.map((n,i)=>this._resolveImage(n,i))),e.samplers&&(e.samplers=e.samplers.map((n,i)=>this._resolveSampler(n,i))),e.textures&&(e.textures=e.textures.map((n,i)=>this._resolveTexture(n,i))),e.accessors&&(e.accessors=e.accessors.map((n,i)=>this._resolveAccessor(n,i))),e.materials&&(e.materials=e.materials.map((n,i)=>this._resolveMaterial(n,i))),e.meshes&&(e.meshes=e.meshes.map((n,i)=>this._resolveMesh(n,i))),e.nodes&&(e.nodes=e.nodes.map((n,i)=>this._resolveNode(n,i))),e.skins&&(e.skins=e.skins.map((n,i)=>this._resolveSkin(n,i))),e.scenes&&(e.scenes=e.scenes.map((n,i)=>this._resolveScene(n,i))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,n){if(typeof n=="object")return n;const i=this.json[e]&&this.json[e][n];return i||console.warn("glTF file error: Could not find ".concat(e,"[").concat(n,"]")),i}_resolveScene(e,n){return e.id=e.id||"scene-".concat(n),e.nodes=(e.nodes||[]).map(i=>this.getNode(i)),e}_resolveNode(e,n){return e.id=e.id||"node-".concat(n),e.children&&(e.children=e.children.map(i=>this.getNode(i))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((i,r)=>{const a=this.getMesh(r);return i.id=a.id,i.primitives=i.primitives.concat(a.primitives),i},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,n){return e.id=e.id||"skin-".concat(n),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,n){return e.id=e.id||"mesh-".concat(n),e.primitives&&(e.primitives=e.primitives.map(i=>{i={...i};const r=i.attributes;i.attributes={};for(const a in r)i.attributes[a]=this.getAccessor(r[a]);return i.indices!==void 0&&(i.indices=this.getAccessor(i.indices)),i.material!==void 0&&(i.material=this.getMaterial(i.material)),i})),e}_resolveMaterial(e,n){if(e.id=e.id||"material-".concat(n),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const i=e.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,n){if(e.id=e.id||"accessor-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=vW(e.componentType),e.components=xW(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const i=e.bufferView.buffer,{ArrayType:r,byteLength:a}=Sb(e,e.bufferView),h=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+i.byteOffset;let l=i.arrayBuffer.slice(h,h+a);e.bufferView.byteStride&&(l=this._getValueFromInterleavedBuffer(i,h,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new r(l)}return e}_getValueFromInterleavedBuffer(e,n,i,r,a){const h=new Uint8Array(a*r);for(let l=0;l<a;l++){const y=n+l*i;h.set(new Uint8Array(e.arrayBuffer.slice(y,y+r)),l*r)}return h.buffer}_resolveTexture(e,n){return e.id=e.id||"texture-".concat(n),e.sampler="sampler"in e?this.getSampler(e.sampler):yW,e.source=this.getImage(e.source),e}_resolveSampler(e,n){e.id=e.id||"sampler-".concat(n),e.parameters={};for(const i in e){const r=this._enumSamplerParameter(i);r!==void 0&&(e.parameters[r]=e[i])}return e}_enumSamplerParameter(e){return _W[e]}_resolveImage(e,n){e.id=e.id||"image-".concat(n),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const i=this.images[n];return i&&(e.image=i),e}_resolveBufferView(e,n){const i=e.buffer,r={id:"bufferView-".concat(n),...e,buffer:this.buffers[i]},a=this.buffers[i].arrayBuffer;let h=this.buffers[i].byteOffset||0;return"byteOffset"in e&&(h+=e.byteOffset),r.data=new Uint8Array(a,h,e.byteLength),r}_resolveCamera(e,n){return e.id=e.id||"camera-".concat(n),e.perspective,e.orthographic,e}}function wW(t,e){return new bW().postProcess(t,e)}const JS=1735152710,Pb=12,Yg=8,AW=1313821514,EW=5130562,TW=0,SW=1,CW=0,hh=!0;function IW(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}function MW(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=new DataView(t),{magic:r=JS}=n,a=i.getUint32(e,!1);return a===r||a===JS}function PW(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(e),r=IW(i,n+0),a=i.getUint32(n+4,hh),h=i.getUint32(n+8,hh);switch(Object.assign(t,{header:{byteOffset:n,byteLength:h,hasBinChunk:!1},type:r,version:a,json:{},binChunks:[]}),n+=Pb,t.version){case 1:return BW(t,i,n);case 2:return LW(t,i,n,{});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function BW(t,e,n){xn(t.header.byteLength>Pb+Yg);const i=e.getUint32(n+0,hh),r=e.getUint32(n+4,hh);return n+=Yg,xn(r===CW),C1(t,e,n,i),n+=i,n+=I1(t,e,n,t.header.byteLength),n}function LW(t,e,n,i){return xn(t.header.byteLength>Pb+Yg),RW(t,e,n,i),n+t.header.byteLength}function RW(t,e,n,i){for(;n+8<=t.header.byteLength;){const r=e.getUint32(n+0,hh),a=e.getUint32(n+4,hh);switch(n+=Yg,a){case AW:C1(t,e,n,r);break;case EW:I1(t,e,n,r);break;case TW:i.strict||C1(t,e,n,r);break;case SW:i.strict||I1(t,e,n,r);break}n+=Uf(r,4)}return n}function C1(t,e,n,i){const r=new Uint8Array(e.buffer,n,i),h=new TextDecoder("utf8").decode(r);return t.json=JSON.parse(h),Uf(i,4)}function I1(t,e,n,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:i,arrayBuffer:e.buffer}),Uf(i,4)}async function DW(t,e){var n,i,r,a;let h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=arguments.length>3?arguments[3]:void 0,y=arguments.length>4?arguments[4]:void 0;OW(t,e,h,l),pW(t,{normalize:l==null||(n=l.gltf)===null||n===void 0?void 0:n.normalize}),cW(t,l,y);const x=[];if(l!=null&&(i=l.gltf)!==null&&i!==void 0&&i.loadBuffers&&t.json.buffers&&await kW(t,l,y),l!=null&&(r=l.gltf)!==null&&r!==void 0&&r.loadImages){const C=FW(t,l,y);x.push(C)}const T=uW(t,l,y);return x.push(T),await Promise.all(x),l!=null&&(a=l.gltf)!==null&&a!==void 0&&a.postProcess?wW(t,l):t}function OW(t,e,n,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!MW(e,n,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=JO(e);else if(e instanceof ArrayBuffer){const h={};n=PW(h,e,n,i.glb),gs(h.type==="glTF","Invalid GLB magic string ".concat(h.type)),t._glb=h,t.json=h.json}else gs(!1,"GLTF: must be ArrayBuffer or string");const r=t.json.buffers||[];if(t.buffers=new Array(r.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:h}=t._glb;t.buffers[0]={arrayBuffer:h[0].arrayBuffer,byteOffset:h[0].byteOffset,byteLength:h[0].byteLength}}const a=t.json.images||[];t.images=new Array(a.length).fill({})}async function kW(t,e,n){const i=t.json.buffers||[];for(let h=0;h<i.length;++h){const l=i[h];if(l.uri){var r,a;const{fetch:y}=n;gs(y);const x=gB(l.uri,e),T=await(n==null||(r=n.fetch)===null||r===void 0?void 0:r.call(n,x)),C=await(T==null||(a=T.arrayBuffer)===null||a===void 0?void 0:a.call(T));t.buffers[h]={arrayBuffer:C,byteOffset:0,byteLength:C.byteLength},delete l.uri}else t.buffers[h]===null&&(t.buffers[h]={arrayBuffer:new ArrayBuffer(l.byteLength),byteOffset:0,byteLength:l.byteLength})}}async function FW(t,e,n){const i=zW(t),r=t.json.images||[],a=[];for(const h of i)a.push(NW(t,r[h],h,e,n));return await Promise.all(a)}function zW(t){const e=new Set,n=t.json.textures||[];for(const i of n)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function NW(t,e,n,i,r){const{fetch:a,parse:h}=r;let l;if(e.uri&&!e.hasOwnProperty("bufferView")){const x=gB(e.uri,i);l=await(await a(x)).arrayBuffer(),e.bufferView={data:l}}if(Number.isFinite(e.bufferView)){const x=EH(t.json,t.buffers,e.bufferView);l=Rx(x.buffer,x.byteOffset,x.byteLength)}gs(l,"glTF image has no data");let y=await h(l,[TM,AH],{mimeType:e.mimeType,basis:i.basis||{format:mB()}},r);y&&y[0]&&(y={compressed:!0,mipmaps:!1,width:y[0].width,height:y[0].height,data:y[0]}),t.images=t.images||[],t.images[n]=y}const Rf={name:"glTF",id:"gltf",module:"gltf",version:oH,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:UW,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function UW(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;e={...Rf.options,...e},e.gltf={...Rf.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await DW({},t,i,e,n)}async function GW(t){const e=[];return t.scenes.forEach(n=>{n.traverse(i=>{Object.values(i.model.getUniforms()).forEach(r=>{r.loaded===!1&&e.push(r)})})}),await VW(()=>e.some(n=>!n.loaded))}async function VW(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}const jW=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,HW=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,CB=[255,255,255,255],WW={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:CB},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Rf]};class Bb extends yh{constructor(...e){super(...e),L(this,"state",void 0)}getShaders(){const e=[mb,gb];return this.props._lighting==="pbr"&&e.push(cb),{vs:jW,fs:HW,modules:e}}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:CB,transition:!0},instanceModelMatrix:rB})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;n.scenegraph!==i.scenegraph?this._updateScenegraph():n._animations!==i._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,n._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}_updateScenegraph(){const e=this.props,{gl:n}=this.context;let i=null;if(e.scenegraph instanceof $u)i={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const l=e.scenegraph,y=sH(n,l,this._getModelOptions());i={gltf:l,...y},GW(y).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(dn.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),i=e.scenegraph);const r={layer:this,gl:n},a=e.getScene(i,r),h=e.getAnimator(i,r);a instanceof $u?(this._deleteScenegraph(),this._applyAllAttributes(a),this._applyAnimationsProp(a,h,e._animations),this.setState({scenegraph:a,animator:h})):a!==null&&dn.warn("invalid scenegraph:",a)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const n=this.getAttributeManager().getAttributes();e.traverse(i=>{this._setModelAttributes(i.model,n)})}}_applyAnimationsProp(e,n,i){if(!e||!n||!i)return;const r=n.getAnimations();Object.keys(i).sort().forEach(a=>{const h=i[a];if(a==="*")r.forEach(l=>{Object.assign(l,h)});else if(Number.isFinite(Number(a))){const l=Number(a);l>=0&&l<r.length?Object.assign(r[l],h):dn.warn("animation ".concat(a," not found"))()}else{const l=r.find(({name:y})=>y===a);l?Object.assign(l,h):dn.warn("animation ".concat(a," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof $u&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let n=null;return e&&(typeof e=="function"?n=e({gl:this.context.gl,layer:this}):n=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:n,modelOptions:{isInstanced:!0,transpileToGLSL100:!$t(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(n=>{this._setModelAttributes(n.model,e)})}draw({moduleParameters:e=null,parameters:n={},context:i}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(i.timeline.getTime()),this.setNeedsRedraw());const{viewport:r}=this.context,{sizeScale:a,sizeMinPixels:h,sizeMaxPixels:l,opacity:y,coordinateSystem:x}=this.props,T=this.getNumInstances();this.state.scenegraph.traverse((C,{worldMatrix:S})=>{C.model.setInstanceCount(T),C.updateModuleSettings(e),C.draw({parameters:n,uniforms:{sizeScale:a,opacity:y,sizeMinPixels:h,sizeMaxPixels:l,composeModelMatrix:sB(r,x),sceneModelMatrix:S,u_Camera:C.model.getUniforms().project_uCameraPosition}})})}}L(Bb,"defaultProps",WW);L(Bb,"layerName","ScenegraphLayer");const XW=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,qW=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function $W(t){t.COLOR_0||t.colors||(t.colors={constant:!0,value:new Float32Array([1,1,1])})}const ZW={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Lb extends Tb{getShaders(){const e=super.getShaders();return e.modules.push(cb),{...e,vs:XW,fs:qW}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const n=this.getAttributeManager();e&&n.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;n.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(n.pbrMaterial)}draw(e){const{featureIds:n}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!n}),super.draw(e))}getModel(e){const{id:n,pbrMaterial:i}=this.props,r=this.parseMaterial(i,e);this.setState({materialParser:r});const a=this.getShaders();return $W(e.attributes),new ah(this.context.gl,{...this.getShaders(),id:n,geometry:e,defines:{...a.defines,...r==null?void 0:r.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:r==null?void 0:r.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:n}=this.state;if(n){const{mesh:i}=this.props,r=this.parseMaterial(e,i);this.setState({materialParser:r}),n.setUniforms(r.uniforms)}}parseMaterial(e,n){var i;const r=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(i=this.state.materialParser)===null||i===void 0||i.delete(),new dB(this.context.gl,{attributes:{NORMAL:n.attributes.normals,TEXCOORD_0:n.attributes.texCoords},material:{unlit:r,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const n=this.props.featureIds,i=new Uint8ClampedArray(n.length*e.size),r=[];for(let a=0;a<n.length;a++)this.encodePickingColor(n[a],r),i[a*3]=r[0],i[a*3+1]=r[1],i[a*3+2]=r[2];e.value=i}finalizeState(e){var n;super.finalizeState(e),(n=this.state.materialParser)===null||n===void 0||n.delete(),this.setState({materialParser:null})}}L(Lb,"layerName","MeshLayer");L(Lb,"defaultProps",ZW);const JW=6378137,KW=6378137,YW=6356752314245179e-9;function w_(t){return t}new we;function QW(t,e=[],n=w_){return"longitude"in t?(e[0]=n(t.longitude),e[1]=n(t.latitude),e[2]=t.height):"x"in t?(e[0]=n(t.x),e[1]=n(t.y),e[2]=t.z):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function eX(t,e=[]){return QW(t,e,Li._cartographicRadians?w_:a6)}function tX(t,e,n=w_){return"longitude"in e?(e.longitude=n(t[0]),e.latitude=n(t[1]),e.height=t[2]):"x"in e?(e.x=n(t[0]),e.y=n(t[1]),e.z=t[2]):(e[0]=n(t[0]),e[1]=n(t[1]),e[2]=t[2]),e}function nX(t,e){return tX(t,e,Li._cartographicRadians?w_:l6)}const xu=new we,iX=new we,rX=new we;function sX(t,e,n=[]){const{oneOverRadii:i,oneOverRadiiSquared:r,centerToleranceSquared:a}=e;xu.from(t);const h=xu.x,l=xu.y,y=xu.z,x=i.x,T=i.y,C=i.z,S=h*h*x*x,z=l*l*T*T,V=y*y*C*C,Z=S+z+V,ue=Math.sqrt(1/Z);if(!Number.isFinite(ue))return;const q=iX;if(q.copy(t).scale(ue),Z<a)return q.to(n);const j=r.x,K=r.y,de=r.z,ve=rX;ve.set(q.x*j*2,q.y*K*2,q.z*de*2);let Ie=(1-ue)*xu.len()/(.5*ve.len()),De=0,Fe,je,Ne,dt;do{Ie-=De,Fe=1/(1+Ie*j),je=1/(1+Ie*K),Ne=1/(1+Ie*de);const Nt=Fe*Fe,Xt=je*je,Lt=Ne*Ne,jn=Nt*Fe,yt=Xt*je,Yn=Lt*Ne;dt=S*Nt+z*Xt+V*Lt-1;const vt=-2*(S*jn*j+z*yt*K+V*Yn*de);De=dt/vt}while(Math.abs(dt)>If.EPSILON12);return xu.scale([Fe,je,Ne]).to(n)}const KS=1e-14,oX=new we,YS={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},U0={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Bd={east:new we,north:new we,up:new we,west:new we,south:new we,down:new we},aX=new we,lX=new we,cX=new we;function QS(t,e,n,i,r,a){const h=YS[e]&&YS[e][n];co(h&&(!i||i===h));let l,y,x;const T=oX.copy(r);if(go(T.x,0,KS)&&go(T.y,0,KS)){const S=Math.sign(T.z);l=aX.fromArray(U0[e]),e!=="east"&&e!=="west"&&l.scale(S),y=lX.fromArray(U0[n]),n!=="east"&&n!=="west"&&y.scale(S),x=cX.fromArray(U0[i]),i!=="east"&&i!=="west"&&x.scale(S)}else{const{up:S,east:z,north:V}=Bd;z.set(-T.y,T.x,0).normalize(),t.geodeticSurfaceNormal(T,S),V.copy(S).cross(z);const{down:Z,west:ue,south:q}=Bd;Z.copy(S).scale(-1),ue.copy(z).scale(-1),q.copy(V).scale(-1),l=Bd[e],y=Bd[n],x=Bd[i]}return a[0]=l.x,a[1]=l.y,a[2]=l.z,a[3]=0,a[4]=y.x,a[5]=y.y,a[6]=y.z,a[7]=0,a[8]=x.x,a[9]=x.y,a[10]=x.z,a[11]=0,a[12]=T.x,a[13]=T.y,a[14]=T.z,a[15]=1,a}const Nm=new we,e2=new we,uX=new we,ro=new we,hX=new we,Um=new we;class Zn{constructor(e=0,n=0,i=0){L(this,"radii",void 0),L(this,"radiiSquared",void 0),L(this,"radiiToTheFourth",void 0),L(this,"oneOverRadii",void 0),L(this,"oneOverRadiiSquared",void 0),L(this,"minimumRadius",void 0),L(this,"maximumRadius",void 0),L(this,"centerToleranceSquared",If.EPSILON1),L(this,"squaredXOverSquaredZ",void 0),co(e>=0),co(n>=0),co(i>=0),this.radii=new we(e,n,i),this.radiiSquared=new we(e*e,n*n,i*i),this.radiiToTheFourth=new we(e*e*e*e,n*n*n*n,i*i*i*i),this.oneOverRadii=new we(e===0?0:1/e,n===0?0:1/n,i===0?0:1/i),this.oneOverRadiiSquared=new we(e===0?0:1/(e*e),n===0?0:1/(n*n),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,n,i),this.maximumRadius=Math.max(e,n,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,n=[0,0,0]){const i=e2,r=uX,[,,a]=e;this.geodeticSurfaceNormalCartographic(e,i),r.copy(this.radiiSquared).scale(i);const h=Math.sqrt(i.dot(r));return r.scale(1/h),i.scale(a),r.add(i),r.to(n)}cartesianToCartographic(e,n=[0,0,0]){Um.from(e);const i=this.scaleToGeodeticSurface(Um,ro);if(!i)return;const r=this.geodeticSurfaceNormal(i,e2),a=hX;a.copy(Um).subtract(i);const h=Math.atan2(r.y,r.x),l=Math.asin(r.z),y=Math.sign(rb(a,Um))*hP(a);return nX([h,l,y],n)}eastNorthUpToFixedFrame(e,n=new Yt){return QS(this,"east","north","up",e,n)}localFrameToFixedFrame(e,n,i,r,a=new Yt){return QS(this,e,n,i,r,a)}geocentricSurfaceNormal(e,n=[0,0,0]){return Nm.from(e).normalize().to(n)}geodeticSurfaceNormalCartographic(e,n=[0,0,0]){const i=eX(e),r=i[0],a=i[1],h=Math.cos(a);return Nm.set(h*Math.cos(r),h*Math.sin(r),Math.sin(a)).normalize(),Nm.to(n)}geodeticSurfaceNormal(e,n=[0,0,0]){return Nm.from(e).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(e,n){return sX(e,this,n)}scaleToGeocentricSurface(e,n=[0,0,0]){ro.from(e);const i=ro.x,r=ro.y,a=ro.z,h=this.oneOverRadiiSquared,l=1/Math.sqrt(i*i*h.x+r*r*h.y+a*a*h.z);return ro.multiplyScalar(l).to(n)}transformPositionToScaledSpace(e,n=[0,0,0]){return ro.from(e).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(e,n=[0,0,0]){return ro.from(e).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(e,n=0,i=[0,0,0]){co(go(this.radii.x,this.radii.y,If.EPSILON15)),co(this.radii.z>0),ro.from(e);const r=ro.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-n))return ro.set(0,0,r).to(i)}}L(Zn,"WGS84",new Zn(JW,KW,YW));function t2(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class n2{constructor(e,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=t2(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(t2()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class dX{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:i}=e;let r=this.stats[n];return r||(e instanceof n2?r=e:r=new n2(n,i),this.stats[n]=r),r}}class fX{constructor(e,n,i){L(this,"item",void 0),L(this,"previous",void 0),L(this,"next",void 0),this.item=e,this.previous=n,this.next=i}}class pX{constructor(){L(this,"head",null),L(this,"tail",null),L(this,"_length",0)}get length(){return this._length}add(e){const n=new fX(e,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,n){e!==n&&(this.remove(n),this._insert(e,n))}_insert(e,n){const i=e.next;e.next=n,this.tail===e?this.tail=n:i.previous=n,n.next=i,n.previous=e,++this._length}}class mX{constructor(){L(this,"_list",void 0),L(this,"_sentinel",void 0),L(this,"_trimTiles",void 0),this._list=new pX,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const n=e._cacheNode;n&&this._list.splice(this._sentinel,n)}add(e,n,i){n._cacheNode||(n._cacheNode=this._list.add(n),i&&i(e,n))}unloadTile(e,n,i){const r=n._cacheNode;r&&(this._list.remove(r),n._cacheNode=null,i&&i(e,n))}unloadTiles(e,n){const i=this._trimTiles;this._trimTiles=!1;const r=this._list,a=e.maximumMemoryUsage*1024*1024,h=this._sentinel;let l=r.head;for(;l!==h&&(e.gpuMemoryUsageInBytes>a||i);){const y=l.item;l=l.next,this.unloadTile(e,y,n)}}trim(){this._trimTiles=!0}}function gX(t,e){xn(t),xn(e);const{rtcCenter:n,gltfUpAxis:i}=e,{computedTransform:r,boundingVolume:{center:a}}=t;let h=new Yt(r);switch(n&&h.translate(n),i){case"Z":break;case"Y":const C=new Yt().rotateX(Math.PI/2);h=h.multiplyRight(C);break;case"X":const S=new Yt().rotateY(-Math.PI/2);h=h.multiplyRight(S);break}e.isQuantized&&h.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const l=new we(a);e.cartesianModelMatrix=h,e.cartesianOrigin=l;const y=Zn.WGS84.cartesianToCartographic(l,new we),T=Zn.WGS84.eastNorthUpToFixedFrame(l).invert();e.cartographicModelMatrix=T.multiplyRight(h),e.cartographicOrigin=y,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const i2=new we,G0=new we,M1=new Gs([new lo,new lo,new lo,new lo,new lo,new lo]);function _X(t,e){const{cameraDirection:n,cameraUp:i,height:r}=t,{metersPerUnit:a}=t.distanceScales,h=hg(t,t.center),l=Zn.WGS84.eastNorthUpToFixedFrame(h),y=t.unprojectPosition(t.cameraPosition),x=Zn.WGS84.cartographicToCartesian(y,new we),T=new we(l.transformAsVector(new we(n).scale(a))).normalize(),C=new we(l.transformAsVector(new we(i).scale(a))).normalize();vX(t);const S=t.constructor,{longitude:z,latitude:V,width:Z,bearing:ue,zoom:q}=t,j=new S({longitude:z,latitude:V,height:r,width:Z,bearing:ue,zoom:q,pitch:0});return{camera:{position:x,direction:T,up:C},viewport:t,topDownViewport:j,height:r,cullingVolume:M1,frameNumber:e,sseDenominator:1.15}}function yX(t,e,n){if(n===0||t.length<=n)return[t,[]];const i=[],{longitude:r,latitude:a}=e.viewport;for(const[x,T]of t.entries()){const[C,S]=T.header.mbs,z=Math.abs(r-C),V=Math.abs(a-S),Z=Math.sqrt(V*V+z*z);i.push([x,Z])}const h=i.sort((x,T)=>x[1]-T[1]),l=[];for(let x=0;x<n;x++)l.push(t[h[x][0]]);const y=[];for(let x=n;x<h.length;x++)y.push(t[h[x][0]]);return[l,y]}function vX(t){const e=t.getFrustumPlanes(),n=r2(e.near,t.cameraPosition),i=hg(t,n),r=hg(t,t.cameraPosition,G0);let a=0;M1.planes[a++].fromPointNormal(i,i2.copy(i).subtract(r));for(const h in e){if(h==="near")continue;const l=e[h],y=r2(l,n,G0),x=hg(t,y,G0);M1.planes[a++].fromPointNormal(x,i2.copy(i).subtract(x))}}function r2(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new we;const i=t.normal.dot(e);return n.copy(t.normal).scale(t.distance-i).add(e),n}function hg(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new we;const i=t.unprojectPosition(e);return Zn.WGS84.cartographicToCartesian(i,n)}const xX=6378137,bX=6378137,P1=6356752314245179e-9,s2=new we;function wX(t,e){if(t instanceof Yf){const{halfAxes:n}=t,i=EX(n);return Math.log2(P1/(i+e[2]))}else if(t instanceof Kf){const{radius:n}=t;return Math.log2(P1/(n+e[2]))}else if(t.width&&t.height){const{width:n,height:i}=t,r=Math.log2(xX/n),a=Math.log2(bX/i);return(r+a)/2}return 1}function IB(t,e,n){const i=Zn.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],new we),r=Math.sqrt(Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2)+Math.pow(i[2]-n[2],2));return Math.log2(P1/(r+e[2]))}function AX(t,e,n){const[i,r,a,h]=t;return IB({xmin:i,xmax:a,ymin:r,ymax:h,zmin:0,zmax:0},e,n)}function EX(t){t.getColumn(0,s2);const e=t.getColumn(1),n=t.getColumn(2);return s2.add(e).add(n).len()}const hs={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Ea={ADD:1,REPLACE:2},Zu={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Ds={I3S:"I3S",TILES3D:"TILES3D"},A_={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},TX={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function MB(t){return t!=null}const pr=new we,dg=new we,SX=new we,CX=new we;function V0(t,e,n){if(xn(t,"3D Tile: boundingVolume must be defined"),t.box)return MX(t.box,e,n);if(t.region){const[i,r,a,h,l,y]=t.region,x=Zn.WGS84.cartographicToCartesian([va(i),va(h),l],SX),T=Zn.WGS84.cartographicToCartesian([va(a),va(r),y],CX),C=new we().addVectors(x,T).multiplyScalar(.5),S=new we().subVectors(x,T).len()/2;return o2([C[0],C[1],C[2],S],new Yt)}if(t.sphere)return o2(t.sphere,e,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function IX(t,e){if(t.box)return PX(e);if(t.region){const[n,i,r,a,h,l]=t.region;return[[va(n),va(i),h],[va(r),va(a),l]]}if(t.sphere)return BX(e);throw new Error("Unkown boundingVolume type")}function MX(t,e,n){const i=new we(t[0],t[1],t[2]);e.transform(i,i);let r=[];if(t.length===10){const x=t.slice(3,6),T=new Cf;T.fromArray(t,6);const C=new we([1,0,0]),S=new we([0,1,0]),z=new we([0,0,1]);C.transformByQuaternion(T),C.scale(x[0]),S.transformByQuaternion(T),S.scale(x[1]),z.transformByQuaternion(T),z.scale(x[2]),r=[...C.toArray(),...S.toArray(),...z.toArray()]}else r=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];const a=e.transformAsVector(r.slice(0,3)),h=e.transformAsVector(r.slice(3,6)),l=e.transformAsVector(r.slice(6,9)),y=new oi([a[0],a[1],a[2],h[0],h[1],h[2],l[0],l[1],l[2]]);return MB(n)?(n.center=i,n.halfAxes=y,n):new Yf(i,y)}function o2(t,e,n){const i=new we(t[0],t[1],t[2]);e.transform(i,i);const r=e.getScale(dg),a=Math.max(Math.max(r[0],r[1]),r[2]),h=t[3]*a;return MB(n)?(n.center=i,n.radius=h,n):new Kf(i,h)}function PX(t){const e=PB(),{halfAxes:n}=t,i=new we(n.getColumn(0)),r=new we(n.getColumn(1)),a=new we(n.getColumn(2));for(let h=0;h<2;h++){for(let l=0;l<2;l++){for(let y=0;y<2;y++)pr.copy(t.center),pr.add(i),pr.add(r),pr.add(a),BB(e,pr),a.negate();r.negate()}i.negate()}return e}function BX(t){const e=PB(),{center:n,radius:i}=t,r=Zn.WGS84.scaleToGeodeticSurface(n,pr);let a;r?a=Zn.WGS84.geodeticSurfaceNormal(r):a=new we(0,0,1);let h=new we(a[2],-a[1],0);h.len()>0?h.normalize():h=new we(0,1,0);const l=h.clone().cross(a);for(const y of[h,l,a]){dg.copy(y).scale(i);for(let x=0;x<2;x++)pr.copy(n),pr.add(dg),BB(e,pr),dg.negate()}return e}function PB(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function BB(t,e){Zn.WGS84.cartesianToCartographic(e,pr),t[0][0]=Math.min(t[0][0],pr[0]),t[0][1]=Math.min(t[0][1],pr[1]),t[0][2]=Math.min(t[0][2],pr[2]),t[1][0]=Math.max(t[1][0],pr[0]),t[1][1]=Math.max(t[1][1],pr[1]),t[1][2]=Math.max(t[1][2],pr[2])}new we;new we;new Yt;new we;new we;new we;function LX(t,e){const n=t*e;return 1-Math.exp(-(n*n))}function RX(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){const n=t.dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor;return LX(e,n)*i}return 0}function DX(t,e,n){const i=t.tileset,r=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,a=n?r:t.lodMetricValue;if(a===0)return 0;const h=Math.max(t._distanceToCamera,1e-7),{height:l,sseDenominator:y}=e,{viewDistanceScale:x}=i.options;let T=a*l*(x||1)/(h*y);return T-=RX(i,h),T}const j0=new we,a2=new we,ll=new we,l2=new we,OX=new we,H0=new Yt,c2=new Yt;function kX(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";const n=2*LB(t,e);return n<2?"OUT":!t.header.children||n<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function LB(t,e){const{topDownViewport:n}=e,i=t.header.mbs[1],r=t.header.mbs[0],a=t.header.mbs[2],h=t.header.mbs[3],l=[...t.boundingVolume.center],y=n.unprojectPosition(n.cameraPosition);Zn.WGS84.cartographicToCartesian(y,j0),a2.copy(j0).subtract(l).normalize(),Zn.WGS84.eastNorthUpToFixedFrame(l,H0),c2.copy(H0).invert(),ll.copy(j0).transform(c2);const x=Math.sqrt(ll[0]*ll[0]+ll[1]*ll[1]),T=x*x/ll[2];l2.copy([ll[0],ll[1],T]);const S=l2.transform(H0).subtract(l).normalize(),V=a2.cross(S).normalize().scale(h).add(l),Z=Zn.WGS84.cartesianToCartographic(V),ue=n.project([r,i,a]),q=n.project(Z);return OX.copy(ue).subtract(q).magnitude()}function FX(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}class u2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;L(this,"_map",new Map),L(this,"_array",void 0),L(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return xn(e<this._array.length),this._array[e]}set(e,n){xn(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=n,this._map.set(n,e)}delete(e){const n=this._map.get(e);n>=0&&(this._array.splice(n,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const n=this.length++;this._array[n]=e,this._map.set(e,n)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){xn(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){xn(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const zX={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class E_{traversalFinished(e){return!0}constructor(e){L(this,"options",void 0),L(this,"root",null),L(this,"selectedTiles",{}),L(this,"requestedTiles",{}),L(this,"emptyTiles",{}),L(this,"lastUpdate",new Date().getTime()),L(this,"updateDebounceTime",1e3),L(this,"_traversalStack",new u2),L(this,"_emptyTraversalStack",new u2),L(this,"_frameNumber",null),this.options={...zX,...e}}traverse(e,n,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,n),this._frameNumber=n.frameNumber,this.executeTraversal(e,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,n){const i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){const a=i.pop();let h=!1;this.canTraverse(a,n)&&(this.updateChildTiles(a,n),h=this.updateAndPushChildren(a,n,i,a.hasRenderContent?a._selectionDepth+1:a._selectionDepth));const l=a.parent,y=!!(!l||l._shouldRefine),x=!h;a.hasRenderContent?a.refine===Ea.ADD?(this.loadTile(a,n),this.selectTile(a,n)):a.refine===Ea.REPLACE&&(this.loadTile(a,n),x&&this.selectTile(a,n)):(this.emptyTiles[a.id]=a,this.loadTile(a,n),x&&this.selectTile(a,n)),this.touchTile(a,n),a._shouldRefine=h&&y}const r=new Date().getTime();(this.traversalFinished(n)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(n))}updateChildTiles(e,n){const i=e.children;for(const r of i)this.updateTile(r,n)}updateAndPushChildren(e,n,i,r){const{loadSiblings:a,skipLevelOfDetail:h}=this.options,l=e.children;l.sort(this.compareDistanceToCamera.bind(this));const y=e.refine===Ea.REPLACE&&e.hasRenderContent&&!h;let x=!1,T=!0;for(const C of l)if(C._selectionDepth=r,C.isVisibleAndInRequestVolume?(i.find(C)&&i.delete(C),i.push(C),x=!0):(y||a)&&(this.loadTile(C,n),this.touchTile(C,n)),y){let S;if(C._inRequestVolume?C.hasRenderContent?S=C.contentAvailable:S=this.executeEmptyTraversal(C,n):S=!1,T=T&&S,!T)return!1}return x||(T=!1),T}updateTile(e,n){this.updateTileVisibility(e,n)}selectTile(e,n){this.shouldSelectTile(e)&&(e._selectedFrame=n.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,n){this.shouldLoadTile(e)&&(e._requestedFrame=n.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,n){e.tileset._cache.touch(e),e._touchedFrame=n.frameNumber}canTraverse(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!r&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,n,i):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=e._screenSpaceError;return i&&(r=e.getScreenSpaceError(n,!0)),r>this.options.maximumScreenSpaceError}updateTileVisibility(e,n){const i=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===n.viewport.id&&i.push(r);else i.push(n.viewport.id);e.updateVisibility(n,i)}compareDistanceToCamera(e,n){return e._distanceToCamera-n._distanceToCamera}anyChildrenVisible(e,n){let i=!1;for(const r of e.children)r.updateVisibility(n),i=i||r.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,n){let i=!0;const r=this._emptyTraversalStack;for(r.push(e);r.length>0&&i;){const a=r.pop();if(this.updateTile(a,n),a.isVisibleAndInRequestVolume||this.loadTile(a,n),this.touchTile(a,n),!a.hasRenderContent&&this.canTraverse(a,n,!1,!0)){const l=a.children;for(const y of l)r.find(y)&&r.delete(y),r.push(y)}else a.contentAvailable||(i=!1)}return i}}const h2=new we;function NX(t){return t!=null}class B1{constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";L(this,"tileset",void 0),L(this,"header",void 0),L(this,"id",void 0),L(this,"url",void 0),L(this,"parent",void 0),L(this,"refine",void 0),L(this,"type",void 0),L(this,"contentUrl",void 0),L(this,"lodMetricType","geometricError"),L(this,"lodMetricValue",0),L(this,"boundingVolume",null),L(this,"content",null),L(this,"contentState",hs.UNLOADED),L(this,"gpuMemoryUsageInBytes",0),L(this,"children",[]),L(this,"depth",0),L(this,"viewportIds",[]),L(this,"transform",new Yt),L(this,"extensions",null),L(this,"implicitTiling",null),L(this,"userData",{}),L(this,"computedTransform",void 0),L(this,"hasEmptyContent",!1),L(this,"hasTilesetContent",!1),L(this,"traverser",new E_({})),L(this,"_cacheNode",null),L(this,"_frameNumber",null),L(this,"_expireDate",null),L(this,"_expiredContent",null),L(this,"_boundingBox",void 0),L(this,"_distanceToCamera",0),L(this,"_screenSpaceError",0),L(this,"_visibilityPlaneMask",void 0),L(this,"_visible",void 0),L(this,"_contentBoundingVolume",void 0),L(this,"_viewerRequestVolume",void 0),L(this,"_initialTransform",new Yt),L(this,"_priority",0),L(this,"_selectedFrame",0),L(this,"_requestedFrame",0),L(this,"_selectionDepth",0),L(this,"_touchedFrame",0),L(this,"_centerZDepth",0),L(this,"_shouldRefine",!1),L(this,"_stackLength",0),L(this,"_visitedFrame",0),L(this,"_inRequestVolume",!1),L(this,"_lodJudge",null),this.header=n,this.tileset=e,this.id=r||n.id,this.url=n.url,this.parent=i,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===hs.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===hs.UNLOADED}get contentExpired(){return this.contentState===hs.EXPIRED}get contentFailed(){return this.contentState===hs.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=IX(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,n){switch(this.tileset.type){case Ds.I3S:return LB(this,e);case Ds.TILES3D:return DX(this,e,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:n}=e.options,i=this.refine===Ea.ADD||n;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===hs.UNLOADED)return-1;const r=this.parent,h=r&&(!i||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,l=e.root?e.root._screenSpaceError:0;return Math.max(l-h,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=hs.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=hs.UNLOADED,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,a={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await Ml(i,r,a),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=hs.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=hs.FAILED,i}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=hs.UNLOADED,!0}updateVisibility(e,n){if(this._frameNumber===e.frameNumber)return;const i=this.parent,r=i?i._visibilityPlaneMask:Gs.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const a=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(a)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==Gs.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=n}visibility(e,n){const{cullingVolume:i}=e,{boundingVolume:r}=this;return i.computeVisibilityWithPlaneMask(r,n)}contentVisibility(){return!0}distanceToTile(e){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:n}=e;const i=this.boundingVolume;return h2.subVectors(i.center,n.position),n.direction.dot(h2)}insideViewerRequestVolume(e){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(NX(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=hs.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Yt(e.transform):new Yt;const n=this.parent,i=this.tileset,r=n&&n.computedTransform?n.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new Yt(r).multiplyRight(this.transform);const a=n&&n._initialTransform?n._initialTransform.clone():new Yt;this._initialTransform=new Yt(a).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=hs.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Gs.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Ea.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=V0(e.boundingVolume,this.computedTransform,this.boundingVolume);const n=e.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=V0(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=V0(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Yt).clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return FX(this.tileset.tileset)}}}class UX extends E_{compareDistanceToCamera(e,n){return n._distanceToCamera===0&&e._distanceToCamera===0?n._centerZDepth-e._centerZDepth:n._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,n){if(super.updateTileVisibility(e,n),!e.isVisibleAndInRequestVolume)return;const i=e.children.length>0;if(e.hasTilesetContent&&i){const h=e.children[0];this.updateTileVisibility(h,n),e._visible=h._visible;return}if(this.meetsScreenSpaceErrorEarly(e,n)){e._visible=!1;return}const r=e.refine===Ea.REPLACE,a=e._optimChildrenWithinParent===TX.USE_OPTIMIZATION;if(r&&a&&i&&!this.anyChildrenVisible(e,n)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,n){const{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==Ea.ADD?!1:!this.shouldRefine(e,n,!0)}}class GX{constructor(){L(this,"frameNumberMap",new Map)}register(e,n){const i=this.frameNumberMap.get(e)||new Map,r=i.get(n)||0;i.set(n,r+1),this.frameNumberMap.set(e,i)}deregister(e,n){const i=this.frameNumberMap.get(e);if(!i)return;const r=i.get(n)||1;i.set(n,r-1)}isZero(e,n){var i;return(((i=this.frameNumberMap.get(e))===null||i===void 0?void 0:i.get(n))||0)===0}}const W0={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class VX{constructor(){L(this,"_statusMap",void 0),L(this,"pendingTilesRegister",new GX),this._statusMap={}}add(e,n,i,r){if(!this._statusMap[n]){const{frameNumber:a,viewport:{id:h}}=r;this._statusMap[n]={request:e,callback:i,key:n,frameState:r,status:W0.REQUESTED},this.pendingTilesRegister.register(h,a),e().then(l=>{this._statusMap[n].status=W0.COMPLETED;const{frameNumber:y,viewport:{id:x}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(x,y),this._statusMap[n].callback(l,r)}).catch(l=>{this._statusMap[n].status=W0.ERROR;const{frameNumber:y,viewport:{id:x}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(x,y),i(l)})}}update(e,n){if(this._statusMap[e]){const{frameNumber:i,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,i);const{frameNumber:a,viewport:{id:h}}=n;this.pendingTilesRegister.register(h,a),this._statusMap[e].frameState=n}}find(e){return this._statusMap[e]}hasPendingTiles(e,n){return!this.pendingTilesRegister.isZero(e,n)}}class jX extends E_{constructor(e){super(e),L(this,"_tileManager",void 0),this._tileManager=new VX}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,n){return e._lodJudge=kX(e,n),e._lodJudge==="DIG"}updateChildTiles(e,n){const i=e.header.children||[],r=e.children,a=e.tileset;for(const h of i){const l="".concat(h.id,"-").concat(n.viewport.id),y=r&&r.find(x=>x.id===l);if(y)y&&this.updateTile(y,n);else{let x=()=>this._loadTile(h.id,a);this._tileManager.find(l)?this._tileManager.update(l,n):(a.tileset.nodePages&&(x=()=>a.tileset.nodePagesTile.formTileFromNodePages(h.id)),this._tileManager.add(x,l,C=>this._onTileLoad(C,e,l),n))}}return!1}async _loadTile(e,n){const{loader:i}=n,r=n.getTileUrl("".concat(n.url,"/nodes/").concat(e)),a={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await Ml(r,i,a)}_onTileLoad(e,n,i){const r=new B1(n.tileset,e,n,i);n.children.push(r);const a=this._tileManager.find(r.id).frameState;this.updateTile(r,a),this._frameNumber===a.frameNumber&&(this.traversalFinished(a)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,a)}}const HX={description:"",ellipsoid:Zn.WGS84,modelMatrix:new Yt,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Gm="Tiles In Tileset(s)",X0="Tiles In Memory",d2="Tiles In View",f2="Tiles To Render",p2="Tiles Loaded",q0="Tiles Loading",m2="Tiles Unloaded",g2="Failed Tile Loads",_2="Points/Vertices",$0="Tile Memory Use";class WX{constructor(e,n){L(this,"options",void 0),L(this,"loadOptions",void 0),L(this,"type",void 0),L(this,"tileset",void 0),L(this,"loader",void 0),L(this,"url",void 0),L(this,"basePath",void 0),L(this,"modelMatrix",void 0),L(this,"ellipsoid",void 0),L(this,"lodMetricType",void 0),L(this,"lodMetricValue",void 0),L(this,"refine",void 0),L(this,"root",null),L(this,"roots",{}),L(this,"asset",{}),L(this,"description",""),L(this,"properties",void 0),L(this,"extras",null),L(this,"attributions",{}),L(this,"credits",{}),L(this,"stats",void 0),L(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),L(this,"cartographicCenter",null),L(this,"cartesianCenter",null),L(this,"zoom",1),L(this,"boundingVolume",null),L(this,"dynamicScreenSpaceErrorComputedDensity",0),L(this,"maximumMemoryUsage",32),L(this,"gpuMemoryUsageInBytes",0),L(this,"_frameNumber",0),L(this,"_queryParams",{}),L(this,"_extensionsUsed",[]),L(this,"_tiles",{}),L(this,"_pendingCount",0),L(this,"selectedTiles",[]),L(this,"traverseCounter",0),L(this,"geometricError",0),L(this,"lastUpdatedVieports",null),L(this,"_requestedTiles",[]),L(this,"_emptyTiles",[]),L(this,"frameStateData",{}),L(this,"_traverser",void 0),L(this,"_cache",new mX),L(this,"_requestScheduler",void 0),L(this,"updatePromise",null),L(this,"tilesetInitializationPromise",void 0),this.options={...HX,...n},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Dx(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new lk({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new dX({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const i=[];for(const r of n){const a=r.id;this._needTraverse(a)?i.push(a):this.traverseCounter--}for(const r of n){const a=r.id;if(this.roots[a]||(this.roots[a]=this._initializeTileHeaders(this.tileset,null)),!i.includes(a))continue;const h=_X(r,this._frameNumber);this._traverser.traverse(this.roots[a],h,this.options)}}_needTraverse(e){let n=e;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[e]),n===e}_onTraversalEnd(e){const n=e.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[n],r=Object.values(this._traverser.selectedTiles),[a,h]=yX(r,e,this.options.maximumTilesSelected);i.selectedTiles=a;for(const l of h)l.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const n=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,n){if(e.length!==n.length)return!0;const i=new Set(e.map(h=>h.id)),r=new Set(n.map(h=>h.id));let a=e.filter(h=>!r.has(h.id)).length>0;return a=a||n.filter(h=>!i.has(h.id)).length>0,a}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,n)=>e._unloadTile(n))}_updateStats(){let e=0,n=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?n+=i.content.pointCount:n+=i.content.vertexCount);this.stats.get(d2).count=this.selectedTiles.length,this.stats.get(f2).count=e,this.stats.get(_2).count=n}async _initializeTileSet(e){this.type===Ds.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Ds.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Ds.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const n=this.tileset.fullExtent;if(n){const{xmin:r,xmax:a,ymin:h,ymax:l,zmin:y,zmax:x}=n;this.cartographicCenter=new we(r+(a-r)/2,h+(l-h)/2,y+(x-y)/2),this.cartesianCenter=Zn.WGS84.cartographicToCartesian(this.cartographicCenter,new we),this.zoom=IB(n,this.cartographicCenter,this.cartesianCenter);return}const i=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(i){const[r,a,h,l]=i;this.cartographicCenter=new we(r+(h-r)/2,a+(l-a)/2,0),this.cartesianCenter=Zn.WGS84.cartographicToCartesian(this.cartographicCenter,new we),this.zoom=AX(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new we,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:n}=e.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new we,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?this.cartographicCenter=Zn.WGS84.cartesianToCartographic(n,new we):this.cartographicCenter=new we(0,0,-Zn.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=wX(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Gm),this.stats.get(q0),this.stats.get(X0),this.stats.get(d2),this.stats.get(f2),this.stats.get(p2),this.stats.get(m2),this.stats.get(g2),this.stats.get(_2),this.stats.get($0,"memory")}_initializeTileHeaders(e,n){const i=new B1(this,e.root,n);if(n&&(n.children.push(i),i.depth=n.depth+1),this.type===Ds.TILES3D){const a=[];for(a.push(i);a.length>0;){const h=a.pop();this.stats.get(Gm).incrementCount();const l=h.header.children||[];for(const y of l){var r;const x=new B1(this,y,h);if((r=x.contentUrl)!==null&&r!==void 0&&r.includes("?session=")){const C=new URL(x.contentUrl).searchParams.get("session");C&&(this._queryParams.session=C)}h.children.push(x),x.depth=h.depth+1,a.push(x)}}}return i}_initializeTraverser(){let e;switch(this.type){case Ds.TILES3D:e=UX;break;case Ds.I3S:e=jX;break;default:e=E_}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let n;try{this._onStartTileLoading(),n=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,n)}}_onTileLoadError(e,n){this.stats.get(g2).incrementCount();const i=n.message||n.toString(),r=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(i)),this.options.onTileError(e,i,r)}_onTileLoad(e,n){if(n){if(this.type===Ds.I3S){var i,r;const a=((i=this.tileset)===null||i===void 0||(r=i.nodePagesTile)===null||r===void 0?void 0:r.nodesInNodePages)||0;this.stats.get(Gm).reset(),this.stats.get(Gm).addCount(a)}e&&e.content&&gX(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Ds.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Ds.TILES3D){var n;const{extensionsRemoved:i=[]}=((n=e.content)===null||n===void 0?void 0:n.gltf)||{};i.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),i.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),i.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(q0).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(q0).decrementCount()}_addTileToCache(e){this._cache.add(this,e,n=>n._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(p2).incrementCount(),this.stats.get(X0).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get($0).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(X0).decrementCount(),this.stats.get(m2).incrementCount(),this.stats.get($0).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const n=e.pop();for(const i of n.children)e.push(i);this._destroyTile(n)}this.root=null}_destroySubtree(e){const n=e,i=[];for(i.push(n);i.length>0;){e=i.pop();for(const r of e.children)i.push(r);e!==n&&this._destroyTile(e)}n.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const n=new URLSearchParams(e.queryString),i=Object.fromEntries(n.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const RB="3.4.4",Ld={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function DB(t,e,n){xn(t instanceof ArrayBuffer);const i=new TextDecoder("utf8"),r=new Uint8Array(t,e,n);return i.decode(r)}function XX(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=new DataView(t);return"".concat(String.fromCharCode(n.getUint8(e+0))).concat(String.fromCharCode(n.getUint8(e+1))).concat(String.fromCharCode(n.getUint8(e+2))).concat(String.fromCharCode(n.getUint8(e+3)))}const qX={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},wi={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},un={...qX,...wi},Z0={[wi.DOUBLE]:Float64Array,[wi.FLOAT]:Float32Array,[wi.UNSIGNED_SHORT]:Uint16Array,[wi.UNSIGNED_INT]:Uint32Array,[wi.UNSIGNED_BYTE]:Uint8Array,[wi.BYTE]:Int8Array,[wi.SHORT]:Int16Array,[wi.INT]:Int32Array},$X={DOUBLE:wi.DOUBLE,FLOAT:wi.FLOAT,UNSIGNED_SHORT:wi.UNSIGNED_SHORT,UNSIGNED_INT:wi.UNSIGNED_INT,UNSIGNED_BYTE:wi.UNSIGNED_BYTE,BYTE:wi.BYTE,SHORT:wi.SHORT,INT:wi.INT},J0="Failed to convert GL type";class Xo{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const n in Z0)if(Z0[n]===e)return n;throw new Error(J0)}static fromName(e){const n=$X[e];if(!n)throw new Error(J0);return n}static getArrayType(e){switch(e){case wi.UNSIGNED_SHORT_5_6_5:case wi.UNSIGNED_SHORT_4_4_4_4:case wi.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=Z0[e];if(!n)throw new Error(J0);return n}}static getByteSize(e){return Xo.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Xo.getArrayType(e)}static createTypedArray(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;r===void 0&&(r=(n.byteLength-i)/Xo.getByteSize(e));const a=Xo.getArrayType(e);return new a(n,i,r)}}function ZX(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(e))}function JX(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=t>>11&31,i=t>>5&63,r=t&31;return e[0]=n<<3,e[1]=i<<2,e[2]=r<<3,e}new ib;new we;new ib;new ib;function y2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return xa(t,0,e)/e*2-1}function v2(t){return t<0?-1:1}function KX(t,e,n,i){if(ZX(i),t<0||t>n||e<0||e>n)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(n));if(i.x=y2(t,n),i.y=y2(e,n),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const r=i.x;i.x=(1-Math.abs(i.y))*v2(r),i.y=(1-Math.abs(r))*v2(i.y)}return i.normalize()}function YX(t,e,n){return KX(t,e,255,n)}class Rb{constructor(e,n){L(this,"json",void 0),L(this,"buffer",void 0),L(this,"featuresLength",0),L(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=n}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:un.UNSIGNED_INT,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,n,i,1,r.byteOffset):r}getPropertyArray(e,n,i){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(n=Xo.fromName(r.componentType)),this._getTypedArrayFromBinary(e,n,i,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,n,r)}getProperty(e,n,i,r,a){const h=this.json[e];if(!h)return h;const l=this.getPropertyArray(e,n,i);if(i===1)return l[r];for(let y=0;y<i;++y)a[y]=l[i*r+y];return a}_getTypedArrayFromBinary(e,n,i,r,a){const h=this._cachedTypedArrays;let l=h[e];return l||(l=Xo.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+a,r*i),h[e]=l),l}_getTypedArrayFromArray(e,n,i){const r=this._cachedTypedArrays;let a=r[e];return a||(a=Xo.createTypedArray(n,i),r[e]=a),a}}const QX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},eq={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},tq={SCALAR:(t,e,n)=>{e[n]=t},VEC2:(t,e,n)=>{e[2*n+0]=t[0],e[2*n+1]=t[1]},VEC3:(t,e,n)=>{e[3*n+0]=t[0],e[3*n+1]=t[1],e[3*n+2]=t[2]},VEC4:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT2:(t,e,n)=>{e[4*n+0]=t[0],e[4*n+1]=t[1],e[4*n+2]=t[2],e[4*n+3]=t[3]},MAT3:(t,e,n)=>{e[9*n+0]=t[0],e[9*n+1]=t[1],e[9*n+2]=t[2],e[9*n+3]=t[3],e[9*n+4]=t[4],e[9*n+5]=t[5],e[9*n+6]=t[6],e[9*n+7]=t[7],e[9*n+8]=t[8],e[9*n+9]=t[9]},MAT4:(t,e,n)=>{e[16*n+0]=t[0],e[16*n+1]=t[1],e[16*n+2]=t[2],e[16*n+3]=t[3],e[16*n+4]=t[4],e[16*n+5]=t[5],e[16*n+6]=t[6],e[16*n+7]=t[7],e[16*n+8]=t[8],e[16*n+9]=t[9],e[16*n+10]=t[10],e[16*n+11]=t[11],e[16*n+12]=t[12],e[16*n+13]=t[13],e[16*n+14]=t[14],e[16*n+15]=t[15]}};function nq(t,e,n,i){const{componentType:r}=t;xn(t.componentType);const a=typeof r=="string"?Xo.fromName(r):r,h=QX[t.type],l=eq[t.type],y=tq[t.type];return n+=t.byteOffset,{values:Xo.createTypedArray(a,e,n,h*i),type:a,size:h,unpacker:l,packer:y}}const jo=t=>t!==void 0;function iq(t,e,n){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy");const r=e.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=r,i=r),i?rq(i,n):null}function rq(t,e){let n,i,r;const a=t.instancesLength,h=t.classes;let l=t.classIds,y=t.parentCounts,x=t.parentIds,T=a;jo(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,a));let C;if(jo(y))for(jo(y.byteOffset)&&(y.componentType=defaultValue(y.componentType,GL.UNSIGNED_SHORT),y.type=AttributeType.SCALAR,r=getBinaryAccessor(y),y=r.createArrayBufferView(e.buffer,e.byteOffset+y.byteOffset,a)),C=new Uint16Array(a),T=0,n=0;n<a;++n)C[n]=T,T+=y[n];jo(x)&&jo(x.byteOffset)&&(x.componentType=defaultValue(x.componentType,GL.UNSIGNED_SHORT),x.type=AttributeType.SCALAR,r=getBinaryAccessor(x),x=r.createArrayBufferView(e.buffer,e.byteOffset+x.byteOffset,T));const S=h.length;for(n=0;n<S;++n){const ue=h[n].length,q=h[n].instances,j=getBinaryProperties(ue,q,e);h[n].instances=combine(j,q)}const z=new Array(S).fill(0),V=new Uint16Array(a);for(n=0;n<a;++n)i=l[n],V[n]=z[i],++z[i];const Z={classes:h,classIds:l,classIndexes:V,parentCounts:y,parentIndexes:C,parentIds:x};return aq(Z),Z}function Rd(t,e,n){if(!t)return;const i=t.parentCounts;return t.parentIds?n(t,e):i>0?sq(t,e,n):oq(t,e,n)}function sq(t,e,n){const i=t.classIds,r=t.parentCounts,a=t.parentIds,h=t.parentIndexes,l=i.length,y=scratchVisited;y.length=Math.max(y.length,l);const x=++marker,T=scratchStack;for(T.length=0,T.push(e);T.length>0;){if(e=T.pop(),y[e]===x)continue;y[e]=x;const C=n(t,e);if(jo(C))return C;const S=r[e],z=h[e];for(let V=0;V<S;++V){const Z=a[z+V];Z!==e&&T.push(Z)}}return null}function oq(t,e,n){let i=!0;for(;i;){const r=n(t,e);if(jo(r))return r;const a=t.parentIds[e];i=a!==e,e=a}throw new Error("traverseHierarchySingleParent")}function aq(t){const n=t.classIds.length;for(let i=0;i<n;++i)OB(t,i,stack)}function OB(t,e,n){const i=t.parentCounts,r=t.parentIds,a=t.parentIndexes,l=t.classIds.length;if(!jo(r))return;assert(e<l,"Parent index ".concat(e," exceeds the total number of instances: ").concat(l)),assert(n.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(e);const y=jo(i)?i[e]:1,x=jo(i)?a[e]:e;for(let T=0;T<y;++T){const C=r[x+T];C!==e&&OB(t,C,n)}n.pop(e)}function Gr(t){return t!=null}const Vm=(t,e)=>t,lq={HIERARCHY:!0,extensions:!0,extras:!0};class kB{constructor(e,n,i){var r;let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};L(this,"json",void 0),L(this,"binary",void 0),L(this,"featureCount",void 0),L(this,"_extensions",void 0),L(this,"_properties",void 0),L(this,"_binaryProperties",void 0),L(this,"_hierarchy",void 0),xn(i>=0),this.json=e||{},this.binary=n,this.featureCount=i,this._extensions=((r=this.json)===null||r===void 0?void 0:r.extensions)||{},this._properties={};for(const h in this.json)lq[h]||(this._properties[h]=this.json[h]);this._binaryProperties=this._initializeBinaryProperties(),a["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=iq(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,n){if(this._checkBatchId(e),xn(typeof n=="string",n),this._hierarchy){const i=Rd(this._hierarchy,e,(r,a)=>{const h=r.classIds[a];return r.classes[h].name===n});return Gr(i)}return!1}isExactClass(e,n){return xn(typeof n=="string",n),this.getExactClassName(e)===n}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const n=this._hierarchy.classIds[e];return this._hierarchy.classes[n].name}}hasProperty(e,n){return this._checkBatchId(e),xn(typeof n=="string",n),Gr(this._properties[n])||this._hasPropertyInHierarchy(e,n)}getPropertyNames(e,n){this._checkBatchId(e),n=Gr(n)?n:[],n.length=0;const i=Object.keys(this._properties);return n.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,n),n}getProperty(e,n){if(this._checkBatchId(e),xn(typeof n=="string",n),this._binaryProperties){const r=this._binaryProperties[n];if(Gr(r))return this._getBinaryProperty(r,e)}const i=this._properties[n];if(Gr(i))return Vm(i[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,n);if(Gr(r))return r}}setProperty(e,n,i){const r=this.featureCount;if(this._checkBatchId(e),xn(typeof n=="string",n),this._binaryProperties){const h=this._binaryProperties[n];if(h){this._setBinaryProperty(h,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,n,i))return;let a=this._properties[n];Gr(a)||(this._properties[n]=new Array(r),a=this._properties[n]),a[e]=Vm(i)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,n){return e.unpack(e.typedArray,n)}_setBinaryProperty(e,n,i){e.pack(i,e.typedArray,n)}_initializeBinaryProperties(){let e=null;for(const n in this._properties){const i=this._properties[n],r=this._initializeBinaryProperty(n,i);r&&(e=e||{},e[n]=r)}return e}_initializeBinaryProperty(e,n){if("byteOffset"in n){const i=n;xn(this.binary,"Property ".concat(e," requires a batch table binary.")),xn(i.type,"Property ".concat(e," requires a type."));const r=nq(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(e,n){if(!this._hierarchy)return!1;const i=Rd(this._hierarchy,e,(r,a)=>{const h=r.classIds[a],l=r.classes[h].instances;return Gr(l[n])});return Gr(i)}_getPropertyNamesInHierarchy(e,n){Rd(this._hierarchy,e,(i,r)=>{const a=i.classIds[r],h=i.classes[a].instances;for(const l in h)h.hasOwnProperty(l)&&n.indexOf(l)===-1&&n.push(l)})}_getHierarchyProperty(e,n){return Rd(this._hierarchy,e,(i,r)=>{const a=i.classIds[r],h=i.classes[a],l=i.classIndexes[r],y=h.instances[n];return Gr(y)?Gr(y.typedArray)?this._getBinaryProperty(y,l):Vm(y[l]):null})}_setHierarchyProperty(e,n,i,r){const a=Rd(this._hierarchy,n,(h,l)=>{const y=h.classIds[l],x=h.classes[y],T=h.classIndexes[l],C=x.instances[i];return Gr(C)?(xn(l===n,'Inherited property "'.concat(i,'" is read-only.')),Gr(C.typedArray)?this._setBinaryProperty(C,T,r):C[T]=Vm(r),!0):!1});return Gr(a)}}const K0=4;function T_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(e);if(t.magic=i.getUint32(n,!0),n+=K0,t.version=i.getUint32(n,!0),n+=K0,t.byteLength=i.getUint32(n,!0),n+=K0,t.version!==1)throw new Error("3D Tile Version ".concat(t.version," not supported"));return n}const bu=4,x2="b3dm tile in legacy format.";function Db(t,e,n){const i=new DataView(e);let r;t.header=t.header||{};let a=i.getUint32(n,!0);n+=bu;let h=i.getUint32(n,!0);n+=bu;let l=i.getUint32(n,!0);n+=bu;let y=i.getUint32(n,!0);return n+=bu,l>=570425344?(n-=bu*2,r=a,l=h,y=0,a=0,h=0,console.warn(x2)):y>=570425344&&(n-=bu,r=l,l=a,y=h,a=0,h=0,console.warn(x2)),t.header.featureTableJsonByteLength=a,t.header.featureTableBinaryByteLength=h,t.header.batchTableJsonByteLength=l,t.header.batchTableBinaryByteLength=y,t.header.batchLength=r,n}function Ob(t,e,n,i){return n=cq(t,e,n),n=uq(t,e,n),n}function cq(t,e,n,i){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:a,batchLength:h}=t.header;if(t.featureTableJson={BATCH_LENGTH:h||0},r>0){const l=DB(e,n,r);t.featureTableJson=JSON.parse(l)}return n+=r,t.featureTableBinary=new Uint8Array(e,n,a),n+=a,n}function uq(t,e,n,i){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:a}=t.header;if(r>0){const h=DB(e,n,r);t.batchTableJson=JSON.parse(h),n+=r,a>0&&(t.batchTableBinary=new Uint8Array(e,n,a),t.batchTableBinary=new Uint8Array(t.batchTableBinary),n+=a)}return n}function FB(t,e,n){if(!e&&(!t||!t.batchIds||!n))return null;const{batchIds:i,isRGB565:r,pointCount:a}=t;if(i&&n){const h=new Uint8ClampedArray(a*3);for(let l=0;l<a;l++){const y=i[l],T=n.getProperty(y,"dimensions").map(C=>C*255);h[l*3]=T[0],h[l*3+1]=T[1],h[l*3+2]=T[2]}return{type:un.UNSIGNED_BYTE,value:h,size:3,normalized:!0}}if(r){const h=new Uint8ClampedArray(a*3);for(let l=0;l<a;l++){const y=JX(e[l]);h[l*3]=y[0],h[l*3+1]=y[1],h[l*3+2]=y[2]}return{type:un.UNSIGNED_BYTE,value:h,size:3,normalized:!0}}return e&&e.length===a*3?{type:un.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:un.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const b2=new we;function hq(t,e){if(!e)return null;if(t.isOctEncoded16P){const n=new Float32Array(t.pointsLength*3);for(let i=0;i<t.pointsLength;i++)YX(e[i*2],e[i*2+1],b2),b2.toArray(n,i*3);return{type:un.FLOAT,size:2,value:n}}return{type:un.FLOAT,size:2,value:e}}function dq(t,e,n){return t.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,fq(t,e)):{type:un.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function fq(t,e){const n=new we,i=new Float32Array(t.pointCount*3);for(let r=0;r<t.pointCount;r++)n.set(e[r*3],e[r*3+1],e[r*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,r*3);return i}async function pq(t,e,n,i,r){n=T_(t,e,n),n=Db(t,e,n),n=Ob(t,e,n),mq(t);const{featureTable:a,batchTable:h}=gq(t);return await bq(t,a,h,i,r),_q(t,a,i),yq(t,a,h),vq(t,a),n}function mq(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function gq(t){const e=new Rb(t.featureTableJson,t.featureTableBinary),n=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=n,t.featuresLength=n,t.pointsLength=n,t.pointCount=n,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",un.FLOAT,3);const i=xq(t,e);return{featureTable:e,batchTable:i}}function _q(t,e,n){if(!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",un.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",un.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65536-1,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",un.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",un.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=dq(t,i,n)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function yq(t,e,n){if(!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",un.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",un.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",un.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=FB(t,i,n)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",un.UNSIGNED_BYTE,4))}function vq(t,e){if(!t.attributes.normals){let n=null;e.hasProperty("NORMAL")?n=e.getPropertyArray("NORMAL",un.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(n=e.getPropertyArray("NORMAL_OCT16P",un.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=hq(t,n)}}function xq(t,e){let n=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",un.UNSIGNED_SHORT,1),t.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:a}=t;n=new kB(r,a,i)}return n}async function bq(t,e,n,i,r){let a,h,l;const y=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];y&&(l=y.properties);const x=e.getExtension("3DTILES_draco_point_compression");if(x){h=x.properties;const C=x.byteOffset,S=x.byteLength;if(!h||!Number.isFinite(C)||!S)throw new Error("Draco properties, byteOffset, and byteLength must be defined");a=t.featureTableBinary.slice(C,C+S),t.hasPositions=Number.isFinite(h.POSITION),t.hasColors=Number.isFinite(h.RGB)||Number.isFinite(h.RGBA),t.hasNormals=Number.isFinite(h.NORMAL),t.hasBatchIds=Number.isFinite(h.BATCH_ID),t.isTranslucent=Number.isFinite(h.RGBA)}if(!a)return!0;const T={buffer:a,properties:{...h,...l},featureTableProperties:h,batchTableProperties:l,dequantizeInShader:!1};return await wq(t,T,i,r)}async function wq(t,e,n,i){const{parse:r}=i,a={...n,draco:{...n.draco,extraAttributes:e.batchTableProperties||{}}};delete a["3d-tiles"];const h=await r(e.buffer,bB,a),l=h.attributes.POSITION&&h.attributes.POSITION.value,y=h.attributes.COLOR_0&&h.attributes.COLOR_0.value,x=h.attributes.NORMAL&&h.attributes.NORMAL.value,T=h.attributes.BATCH_ID&&h.attributes.BATCH_ID.value,C=l&&h.attributes.POSITION.value.quantization,S=x&&h.attributes.NORMAL.value.quantization;if(C){const V=h.POSITION.data.quantization,Z=V.range;t.quantizedVolumeScale=new we(Z,Z,Z),t.quantizedVolumeOffset=new we(V.minValues),t.quantizedRange=(1<<V.quantizationBits)-1,t.isQuantizedDraco=!0}S&&(t.octEncodedRange=(1<<h.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);const z={};if(e.batchTableProperties)for(const V of Object.keys(e.batchTableProperties))h.attributes[V]&&h.attributes[V].value&&(z[V.toLowerCase()]=h.attributes[V].value);t.attributes={positions:l,colors:FB(t,y,void 0),normals:x,batchIds:T,...z}}const L1={URI:0,EMBEDDED:1};function zB(t,e,n,i){t.rotateYtoZ=!0;const r=t.byteOffset+t.byteLength-n;if(r===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=Rx(e,n,r),t.gltfByteOffset=0,t.gltfByteLength=r,n%4===0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}async function NB(t,e,n,i){const r=n["3d-tiles"]||{};if(Aq(t,e),r.loadGLTF){const{parse:a,fetch:h}=i;t.gltfUrl&&(t.gltfArrayBuffer=await h(t.gltfUrl,n),t.gltfByteOffset=0),t.gltfArrayBuffer&&(t.gltf=await a(t.gltfArrayBuffer,Rf,n,i),t.gpuMemoryUsageInBytes=vB(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength)}}function Aq(t,e,n){switch(e){case L1.URI:const i=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),a=new TextDecoder().decode(i);t.gltfUrl=a.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case L1.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function Eq(t,e,n,i,r){var a;n=Tq(t,e,n,i),await NB(t,L1.EMBEDDED,i,r);const h=t==null||(a=t.gltf)===null||a===void 0?void 0:a.extensions;return h&&h.CESIUM_RTC&&(t.rtcCenter=h.CESIUM_RTC.center),n}function Tq(t,e,n,i,r){n=T_(t,e,n),n=Db(t,e,n),n=Ob(t,e,n),n=zB(t,e,n,i);const a=new Rb(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=a.getGlobalProperty("RTC_CENTER",un.FLOAT,3),n}async function Sq(t,e,n,i,r){return n=Cq(t,e,n,i),await NB(t,t.gltfFormat,i,r),n}function Cq(t,e,n,i,r){if(n=T_(t,e,n),t.version!==1)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));n=Db(t,e,n);const a=new DataView(e);if(t.gltfFormat=a.getUint32(n,!0),n+=4,n=Ob(t,e,n),n=zB(t,e,n,i),t.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const h=new Rb(t.featureTableJson,t.featureTableBinary),l=h.getGlobalProperty("INSTANCES_LENGTH");if(h.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=h.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=h.getGlobalProperty("RTC_CENTER",un.FLOAT,3);const y=new kB(t.batchTableJson,t.batchTableBinary,l);return Iq(t,h,y,l),n}function Iq(t,e,n,i){const a={instances:new Array(i),batchTable:t._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,h=new we;new we,new we,new we;const l=new oi,y=new Cf,x=new we,T={},C=new Yt,S=[],z=[],V=new we,Z=new we;for(let ue=0;ue<i;ue++){let q;if(e.hasProperty("POSITION"))q=e.getProperty("POSITION",un.FLOAT,3,ue,h);else if(e.hasProperty("POSITION_QUANTIZED")){q=e.getProperty("POSITION_QUANTIZED",un.UNSIGNED_SHORT,3,ue,h);const De=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",un.FLOAT,3,V);if(!De)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Fe=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",un.FLOAT,3,Z);if(!Fe)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const je=65535;for(let Ne=0;Ne<3;Ne++)q[Ne]=q[Ne]/je*Fe[Ne]+De[Ne]}if(!q)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(h.copy(q),T.translation=h,t.normalUp=e.getProperty("NORMAL_UP",un.FLOAT,3,ue,S),t.normalRight=e.getProperty("NORMAL_RIGHT",un.FLOAT,3,ue,z),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",un.UNSIGNED_SHORT,2,S),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",un.UNSIGNED_SHORT,2,z),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(Zn.WGS84.eastNorthUpToFixedFrame(h,C),C.getRotationMatrix3(l)):l.identity()}y.fromMatrix3(l),T.rotation=y,x.set(1,1,1);const j=e.getProperty("SCALE",un.FLOAT,1,ue);Number.isFinite(j)&&x.multiplyByScalar(j);const K=e.getProperty("SCALE_NON_UNIFORM",un.FLOAT,3,ue,S);K&&x.scale(K),T.scale=x;let de=e.getProperty("BATCH_ID",un.UNSIGNED_SHORT,1,ue);de===void 0&&(de=ue);const ve=new Yt().fromQuaternion(T.rotation);C.identity(),C.translate(T.translation),C.multiplyRight(ve),C.scale(T.scale);const Ie=C.clone();a[ue]={modelMatrix:Ie,batchId:de}}t.instances=a}async function Mq(t,e,n,i,r,a){n=T_(t,e,n);const h=new DataView(e);for(t.tilesLength=h.getUint32(n,!0),n+=4,t.tiles=[];t.tiles.length<t.tilesLength&&t.byteLength-n>12;){const l={};t.tiles.push(l),n=await a(e,n,i,r,l)}return n}async function Pq(t,e,n,i){t.rotateYtoZ=!0,t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y";const{parse:r}=i;t.gltf=await r(e,Rf,n,i),t.gpuMemoryUsageInBytes=vB(t.gltf)}async function UB(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(r.byteOffset=e,r.type=XX(t,e),r.type){case Ld.COMPOSITE:return await Mq(r,t,e,n,i,UB);case Ld.BATCHED_3D_MODEL:return await Eq(r,t,e,n,i);case Ld.GLTF:return await Pq(r,t,n,i);case Ld.INSTANCED_3D_MODEL:return await Sq(r,t,e,n,i);case Ld.POINT_CLOUD:return await pq(r,t,e,n,i);default:throw new Error("3DTileLoader: unknown type ".concat(r.type))}}const Bq=1952609651,Lq=1;async function Rq(t,e,n){if(new Uint32Array(t.slice(0,4))[0]!==Bq)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==Lq)throw new Error("Wrong subtree file verson, must be 1");const a=w2(t.slice(8,16)),h=new Uint8Array(t,24,a),y=new TextDecoder("utf8").decode(h),x=JSON.parse(y),T=w2(t.slice(16,24));let C=new ArrayBuffer(0);return T&&(C=t.slice(24+a)),"bufferView"in x.tileAvailability&&(x.tileAvailability.explicitBitstream=await Y0(x,"tileAvailability",C,n)),"bufferView"in x.contentAvailability&&(x.contentAvailability.explicitBitstream=await Y0(x,"contentAvailability",C,n)),"bufferView"in x.childSubtreeAvailability&&(x.childSubtreeAvailability.explicitBitstream=await Y0(x,"childSubtreeAvailability",C,n)),x}function Dq(t,e){if(e.startsWith("http")){const a=new URL(t,e);return decodeURI(a.toString())}const i="http://".concat(e),r=new URL(t,i);return"/".concat(r.host).concat(r.pathname)}async function Y0(t,e,n,i){const r=t[e].bufferView,a=t.bufferViews[r],h=t.buffers[a.buffer];if(!(i!=null&&i.url)||!i.fetch)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(h.uri){const l=Dq(h.uri,i==null?void 0:i.url),x=await(await i.fetch(l)).arrayBuffer();return new Uint8Array(x,a.byteOffset,a.byteLength)}return new Uint8Array(n,a.byteOffset,a.byteLength)}function w2(t){const e=new DataView(t),n=e.getUint32(0,!0),i=e.getUint32(4,!0);return n+2**32*i}const GB={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:RB,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Rq,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Vs=null;try{Vs=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function An(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}An.prototype.__isLong__;Object.defineProperty(An.prototype,"__isLong__",{value:!0});function _r(t){return(t&&t.__isLong__)===!0}function A2(t){var e=Math.clz32(t&-t);return t?31-e:e}An.isLong=_r;var E2={},T2={};function Oc(t,e){var n,i,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(i=T2[t],i)?i:(n=pn(t,0,!0),r&&(T2[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(i=E2[t],i)?i:(n=pn(t,t<0?-1:0,!1),r&&(E2[t]=n),n))}An.fromInt=Oc;function js(t,e){if(isNaN(t))return e?ba:ho;if(e){if(t<0)return ba;if(t>=VB)return WB}else{if(t<=-C2)return Wr;if(t+1>=C2)return HB}return t<0?js(-t,e).neg():pn(t%dh|0,t/dh|0,e)}An.fromNumber=js;function pn(t,e,n){return new An(t,e,n)}An.fromBits=pn;var Qg=Math.pow;function kb(t,e,n){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(n=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?ba:ho;if(n=n||10,n<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return kb(t.substring(1),e,n).neg();for(var r=js(Qg(n,8)),a=ho,h=0;h<t.length;h+=8){var l=Math.min(8,t.length-h),y=parseInt(t.substring(h,h+l),n);if(l<8){var x=js(Qg(n,l));a=a.mul(x).add(js(y))}else a=a.mul(r),a=a.add(js(y))}return a.unsigned=e,a}An.fromString=kb;function vo(t,e){return typeof t=="number"?js(t,e):typeof t=="string"?kb(t,e):pn(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}An.fromValue=vo;var S2=65536,Oq=1<<24,dh=S2*S2,VB=dh*dh,C2=VB/2,I2=Oc(Oq),ho=Oc(0);An.ZERO=ho;var ba=Oc(0,!0);An.UZERO=ba;var Nu=Oc(1);An.ONE=Nu;var jB=Oc(1,!0);An.UONE=jB;var R1=Oc(-1);An.NEG_ONE=R1;var HB=pn(-1,2147483647,!1);An.MAX_VALUE=HB;var WB=pn(-1,-1,!0);An.MAX_UNSIGNED_VALUE=WB;var Wr=pn(0,-2147483648,!1);An.MIN_VALUE=Wr;var Xe=An.prototype;Xe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Xe.toNumber=function(){return this.unsigned?(this.high>>>0)*dh+(this.low>>>0):this.high*dh+(this.low>>>0)};Xe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Wr)){var n=js(e),i=this.div(n),r=i.mul(n).sub(this);return i.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var a=js(Qg(e,6),this.unsigned),h=this,l="";;){var y=h.div(a),x=h.sub(y.mul(a)).toInt()>>>0,T=x.toString(e);if(h=y,h.isZero())return T+l;for(;T.length<6;)T="0"+T;l=""+T+l}};Xe.getHighBits=function(){return this.high};Xe.getHighBitsUnsigned=function(){return this.high>>>0};Xe.getLowBits=function(){return this.low};Xe.getLowBitsUnsigned=function(){return this.low>>>0};Xe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Wr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};Xe.isZero=function(){return this.high===0&&this.low===0};Xe.eqz=Xe.isZero;Xe.isNegative=function(){return!this.unsigned&&this.high<0};Xe.isPositive=function(){return this.unsigned||this.high>=0};Xe.isOdd=function(){return(this.low&1)===1};Xe.isEven=function(){return(this.low&1)===0};Xe.equals=function(e){return _r(e)||(e=vo(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Xe.eq=Xe.equals;Xe.notEquals=function(e){return!this.eq(e)};Xe.neq=Xe.notEquals;Xe.ne=Xe.notEquals;Xe.lessThan=function(e){return this.comp(e)<0};Xe.lt=Xe.lessThan;Xe.lessThanOrEqual=function(e){return this.comp(e)<=0};Xe.lte=Xe.lessThanOrEqual;Xe.le=Xe.lessThanOrEqual;Xe.greaterThan=function(e){return this.comp(e)>0};Xe.gt=Xe.greaterThan;Xe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Xe.gte=Xe.greaterThanOrEqual;Xe.ge=Xe.greaterThanOrEqual;Xe.compare=function(e){if(_r(e)||(e=vo(e)),this.eq(e))return 0;var n=this.isNegative(),i=e.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Xe.comp=Xe.compare;Xe.negate=function(){return!this.unsigned&&this.eq(Wr)?Wr:this.not().add(Nu)};Xe.neg=Xe.negate;Xe.add=function(e){_r(e)||(e=vo(e));var n=this.high>>>16,i=this.high&65535,r=this.low>>>16,a=this.low&65535,h=e.high>>>16,l=e.high&65535,y=e.low>>>16,x=e.low&65535,T=0,C=0,S=0,z=0;return z+=a+x,S+=z>>>16,z&=65535,S+=r+y,C+=S>>>16,S&=65535,C+=i+l,T+=C>>>16,C&=65535,T+=n+h,T&=65535,pn(S<<16|z,T<<16|C,this.unsigned)};Xe.subtract=function(e){return _r(e)||(e=vo(e)),this.add(e.neg())};Xe.sub=Xe.subtract;Xe.multiply=function(e){if(this.isZero())return this;if(_r(e)||(e=vo(e)),Vs){var n=Vs.mul(this.low,this.high,e.low,e.high);return pn(n,Vs.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?ba:ho;if(this.eq(Wr))return e.isOdd()?Wr:ho;if(e.eq(Wr))return this.isOdd()?Wr:ho;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(I2)&&e.lt(I2))return js(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=this.high&65535,a=this.low>>>16,h=this.low&65535,l=e.high>>>16,y=e.high&65535,x=e.low>>>16,T=e.low&65535,C=0,S=0,z=0,V=0;return V+=h*T,z+=V>>>16,V&=65535,z+=a*T,S+=z>>>16,z&=65535,z+=h*x,S+=z>>>16,z&=65535,S+=r*T,C+=S>>>16,S&=65535,S+=a*x,C+=S>>>16,S&=65535,S+=h*y,C+=S>>>16,S&=65535,C+=i*T+r*x+a*y+h*l,C&=65535,pn(z<<16|V,C<<16|S,this.unsigned)};Xe.mul=Xe.multiply;Xe.divide=function(e){if(_r(e)||(e=vo(e)),e.isZero())throw Error("division by zero");if(Vs){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?Vs.div_u:Vs.div_s)(this.low,this.high,e.low,e.high);return pn(n,Vs.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ba:ho;var i,r,a;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ba;if(e.gt(this.shru(1)))return jB;a=ba}else{if(this.eq(Wr)){if(e.eq(Nu)||e.eq(R1))return Wr;if(e.eq(Wr))return Nu;var h=this.shr(1);return i=h.div(e).shl(1),i.eq(ho)?e.isNegative()?Nu:R1:(r=this.sub(e.mul(i)),a=i.add(r.div(e)),a)}else if(e.eq(Wr))return this.unsigned?ba:ho;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();a=ho}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var l=Math.ceil(Math.log(i)/Math.LN2),y=l<=48?1:Qg(2,l-48),x=js(i),T=x.mul(e);T.isNegative()||T.gt(r);)i-=y,x=js(i,this.unsigned),T=x.mul(e);x.isZero()&&(x=Nu),a=a.add(x),r=r.sub(T)}return a};Xe.div=Xe.divide;Xe.modulo=function(e){if(_r(e)||(e=vo(e)),Vs){var n=(this.unsigned?Vs.rem_u:Vs.rem_s)(this.low,this.high,e.low,e.high);return pn(n,Vs.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Xe.mod=Xe.modulo;Xe.rem=Xe.modulo;Xe.not=function(){return pn(~this.low,~this.high,this.unsigned)};Xe.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};Xe.clz=Xe.countLeadingZeros;Xe.countTrailingZeros=function(){return this.low?A2(this.low):A2(this.high)+32};Xe.ctz=Xe.countTrailingZeros;Xe.and=function(e){return _r(e)||(e=vo(e)),pn(this.low&e.low,this.high&e.high,this.unsigned)};Xe.or=function(e){return _r(e)||(e=vo(e)),pn(this.low|e.low,this.high|e.high,this.unsigned)};Xe.xor=function(e){return _r(e)||(e=vo(e)),pn(this.low^e.low,this.high^e.high,this.unsigned)};Xe.shiftLeft=function(e){return _r(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?pn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):pn(0,this.low<<e-32,this.unsigned)};Xe.shl=Xe.shiftLeft;Xe.shiftRight=function(e){return _r(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?pn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):pn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Xe.shr=Xe.shiftRight;Xe.shiftRightUnsigned=function(e){return _r(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?pn(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?pn(this.high,0,this.unsigned):pn(this.high>>>e-32,0,this.unsigned)};Xe.shru=Xe.shiftRightUnsigned;Xe.shr_u=Xe.shiftRightUnsigned;Xe.rotateLeft=function(e){var n;return _r(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?pn(this.high,this.low,this.unsigned):e<32?(n=32-e,pn(this.low<<e|this.high>>>n,this.high<<e|this.low>>>n,this.unsigned)):(e-=32,n=32-e,pn(this.high<<e|this.low>>>n,this.low<<e|this.high>>>n,this.unsigned))};Xe.rotl=Xe.rotateLeft;Xe.rotateRight=function(e){var n;return _r(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?pn(this.high,this.low,this.unsigned):e<32?(n=32-e,pn(this.high<<n|this.low>>>e,this.low<<n|this.high>>>e,this.unsigned)):(e-=32,n=32-e,pn(this.low<<n|this.high>>>e,this.high<<n|this.low>>>e,this.unsigned))};Xe.rotr=Xe.rotateRight;Xe.toSigned=function(){return this.unsigned?pn(this.low,this.high,!1):this};Xe.toUnsigned=function(){return this.unsigned?this:pn(this.low,this.high,!0)};Xe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Xe.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Xe.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};An.fromBytes=function(e,n,i){return i?An.fromBytesLE(e,n):An.fromBytesBE(e,n)};An.fromBytesLE=function(e,n){return new An(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};An.fromBytesBE=function(e,n){return new An(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const kq=16;function XB(t){t==="X"&&(t="");const e=t.padEnd(kq,"0");return An.fromString(e,!0,16)}function Fq(t){if(t.isZero())return"X";let e=t.countTrailingZeros();const n=e%4;e=(e-n)/4;const i=e;e*=4;const a=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-i-a.length).join("0")+a}function zq(t,e){const n=Nq(t).shiftRightUnsigned(2);return t.add(An.fromNumber(2*e+1-4).multiply(n))}function Nq(t){return t.and(t.not().add(1))}const Uq=3,Gq=30,Vq=2*Gq+1,M2=180/Math.PI;function jq(t){if(t.length===0)throw new Error("Invalid Hilbert quad key ".concat(t));const e=t.split("/"),n=parseInt(e[0],10),i=e[1],r=i.length;let a=0;const h=[0,0];for(let l=r-1;l>=0;l--){a=r-l;const y=i[l];let x=0,T=0;y==="1"?T=1:y==="2"?(x=1,T=1):y==="3"&&(x=1);const C=Math.pow(2,a-1);Wq(C,h,x,T),h[0]+=C*x,h[1]+=C*T}if(n%2===1){const l=h[0];h[0]=h[1],h[1]=l}return{face:n,ij:h,level:a}}function Hq(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<Uq+Vq;)e="0"+e;const n=e.lastIndexOf("1"),i=e.substring(0,3),r=e.substring(3,n),a=r.length/2,h=An.fromString(i,!0,2).toString(10);let l="";if(a!==0)for(l=An.fromString(r,!0,2).toString(4);l.length<a;)l="0"+l;return"".concat(h,"/").concat(l)}function qB(t,e,n){const i=1<<e;return[(t[0]+n[0])/i,(t[1]+n[1])/i]}function P2(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function $B(t){return[P2(t[0]),P2(t[1])]}function ZB(t,e){let[n,i]=e;switch(t){case 0:return[1,n,i];case 1:return[-n,1,i];case 2:return[-n,-i,1];case 3:return[-1,-i,-n];case 4:return[i,-1,-n];case 5:return[i,n,-1];default:throw new Error("Invalid face")}}function JB(t){let[e,n,i]=t;const r=Math.atan2(i,Math.sqrt(e*e+n*n));return[Math.atan2(n,e)*M2,r*M2]}function Wq(t,e,n,i){if(i===0){n===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);const r=e[0];e[0]=e[1],e[1]=r}}function Xq(t){const e=qB(t.ij,t.level,[.5,.5]),n=$B(e),i=ZB(t.face,n);return JB(i)}const qq=100;function B2(t){const{face:e,ij:n,level:i}=t,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],a=Math.max(1,Math.ceil(qq*Math.pow(2,-i))),h=new Float64Array(4*a*2+2);let l=0,y=0;for(let x=0;x<4;x++){const T=r[x].slice(0),C=r[x+1],S=(C[0]-T[0])/a,z=(C[1]-T[1])/a;for(let V=0;V<a;V++){T[0]+=S,T[1]+=z;const Z=qB(n,i,T),ue=$B(Z),q=ZB(e,ue),j=JB(q);Math.abs(j[1])>89.999&&(j[0]=y);const K=j[0]-y;j[0]+=K>180?-360:K<-180?360:0,h[l++]=j[0],h[l++]=j[1],y=j[0]}}return h[l++]=h[0],h[l++]=h[1],h}function Fb(t){const e=$q(t);return jq(e)}function $q(t){if(t.indexOf("/")>0)return t;const e=XB(t);return Hq(e)}function Zq(t){const e=Fb(t);return Xq(e)}function Jq(t){let e;if(t.face===2||t.face===5){let n=null,i=0;for(let r=0;r<4;r++){const a="".concat(t.face,"/").concat(r),h=Fb(a),l=B2(h);(typeof n>"u"||n===null)&&(n=new Float64Array(4*l.length)),n.set(l,i),i+=l.length}e=L2(n)}else{const n=B2(t);e=L2(n)}return e}function L2(t){if(t.length%2!==0)throw new Error("Invalid corners");const e=[],n=[];for(let i=0;i<t.length;i+=2)e.push(t[i]),n.push(t[i+1]);return e.sort((i,r)=>i-r),n.sort((i,r)=>i-r),{west:e[0],east:e[e.length-1],north:n[n.length-1],south:n[0]}}function Kq(t,e){const n=(e==null?void 0:e.minimumHeight)||0,i=(e==null?void 0:e.maximumHeight)||0,r=Fb(t),a=Jq(r),h=a.west,l=a.south,y=a.east,x=a.north,T=[];return T.push(new we(h,x,n)),T.push(new we(y,x,n)),T.push(new we(y,l,n)),T.push(new we(h,l,n)),T.push(new we(h,x,i)),T.push(new we(y,x,i)),T.push(new we(y,l,i)),T.push(new we(h,l,i)),T}function KB(t){const e=t.token,n={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},i=Kq(e,n),r=Zq(e),a=r[0],h=r[1],l=Zn.WGS84.cartographicToCartesian([a,h,n.maximumHeight]),y=new we(l[0],l[1],l[2]);i.push(y);const x=Aj(i);return[...x.center,...x.halfAxes]}const Yq=4,Qq=8,e$={QUADTREE:Yq,OCTREE:Qq};function t$(t,e,n){if(t!=null&&t.box){const i=XB(t.s2VolumeInfo.token),r=zq(i,e),a=Fq(r),h={...t.s2VolumeInfo};switch(h.token=a,n){case"OCTREE":const x=t.s2VolumeInfo,T=x.maximumHeight-x.minimumHeight,C=T/2,S=x.minimumHeight+T/2;x.minimumHeight=S-C,x.maximumHeight=S+C;break}return{box:KB(h),s2VolumeInfo:h}}}async function YB(t){const{options:e,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,globalData:r={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:a}=t;let{subtree:h,level:l=0}=t;const{subdivisionScheme:y,subtreeLevels:x,maximumLevel:T,contentUrlTemplate:C,subtreesUriTemplate:S,basePath:z}=e,V={children:[],lodMetricValue:0,contentUrl:""},Z=e$[y],ue=i&1,q=i>>1&1,j=i>>2&1,K=(Z**l-1)/(Z-1);let de=cc(n.mortonIndex,i),ve=K+de,Ie=cc(n.x,ue),De=cc(n.y,q),Fe=cc(n.z,j),je=!1;l+1>x&&(je=Q0(h.childSubtreeAvailability,de));const Ne=cc(r.x,Ie),dt=cc(r.y,De),Nt=cc(r.z,Fe),Xt=l+r.level;if(je){const Ke="".concat(z,"/").concat(S),vt=D1(Ke,Xt,Ne,dt,Nt);h=await Ml(vt,GB),r.mortonIndex=de,r.x=Ie,r.y=De,r.z=Fe,r.level=l,de=0,ve=0,Ie=0,De=0,Fe=0,l=0}if(!Q0(h.tileAvailability,ve)||l>T)return V;Q0(h.contentAvailability,ve)&&(V.contentUrl=D1(C,Xt,Ne,dt,Nt));const yt=l+1,Yn={mortonIndex:de,x:Ie,y:De,z:Fe};for(let Ke=0;Ke<Z;Ke++){const vt=t$(a,Ke,y),Et=await YB({subtree:h,options:e,parentData:Yn,childIndex:Ke,level:yt,globalData:r,s2VolumeBox:vt});if(Et.contentUrl||Et.children.length){const en=Xt+1,ji=n$(Et,en,{childTileX:Ie,childTileY:De,childTileZ:Fe},e,a);V.children.push(ji)}}return V}function Q0(t,e){return"constant"in t?!!t.constant:t.explicitBitstream?s$(e,t.explicitBitstream):!1}function n$(t,e,n,i,r){const{basePath:a,refine:h,getRefine:l,lodMetricType:y,getTileType:x,rootLodMetricValue:T,rootBoundingVolume:C}=i,S=t.contentUrl&&t.contentUrl.replace("".concat(a,"/"),""),z=T/2**e,V=r!=null&&r.box?{box:r.box}:C,Z=i$(e,V,n);return{children:t.children,contentUrl:t.contentUrl,content:{uri:S},id:t.contentUrl,refine:l(h),type:x(t),lodMetricType:y,lodMetricValue:z,geometricError:z,transform:t.transform,boundingVolume:Z}}function i$(t,e,n){if(e.region){const{childTileX:i,childTileY:r,childTileZ:a}=n,[h,l,y,x,T,C]=e.region,S=2**t,z=(y-h)/S,V=(x-l)/S,Z=(C-T)/S,[ue,q]=[h+z*i,h+z*(i+1)],[j,K]=[l+V*r,l+V*(r+1)],[de,ve]=[T+Z*a,T+Z*(a+1)];return{region:[ue,j,q,K,de,ve]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function cc(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function D1(t,e,n,i,r){const a=r$({level:e,x:n,y:i,z:r});return t.replace(/{level}|{x}|{y}|{z}/gi,h=>a[h])}function r$(t){const e={};for(const n in t)e["{".concat(n,"}")]=t[n];return e}function s$(t,e){const n=Math.floor(t/8),i=t%8;return(e[n]>>i&1)===1}function zb(t){if(!t.contentUrl)return Zu.EMPTY;const n=t.contentUrl.split("?")[0].split(".").pop();switch(n){case"pnts":return Zu.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Zu.SCENEGRAPH;default:return n}}function Nb(t){switch(t){case"REPLACE":case"replace":return Ea.REPLACE;case"ADD":case"add":return Ea.ADD;default:return t}}function O1(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const i=new URL(t,"".concat(e,"/"));return decodeURI(i.toString())}else if(t.startsWith("/"))return t;return"".concat(e,"/").concat(t)}function R2(t,e){if(!t)return null;if(t.content){const n=t.content.uri||t.content.url;t.contentUrl=O1(n,e.basePath)}return t.id=t.contentUrl,t.lodMetricType=A_.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=zb(t),t.refine=Nb(t.refine),t}async function o$(t,e){const n=t.basePath;let i;const r=O2(t==null?void 0:t.root);r&&t.root?i=await D2(t.root,t,r,e):i=R2(t.root,t);const a=[];for(a.push(i);a.length>0;){const l=(a.pop()||{}).children||[];for(let y of l){const x=O2(y);x?y=await D2(y,t,x,e):R2(y,{basePath:n}),a.push(y)}}return i}async function D2(t,e,n,i){var r,a;const h=e.basePath,{subdivisionScheme:l,maximumLevel:y,subtreeLevels:x,subtrees:{uri:T}}=n,C=D1(T,0,0,0,0),S=O1(C,h),z=await Ml(S,GB,i),V=O1(t.content.uri,h),Z=e==null||(r=e.root)===null||r===void 0?void 0:r.refine,ue=t.geometricError,q=(a=t.boundingVolume.extensions)===null||a===void 0?void 0:a["3DTILES_bounding_volume_S2"];if(q){const ve={box:KB(q),s2VolumeInfo:q};t.boundingVolume=ve}const j=t.boundingVolume,K={contentUrlTemplate:V,subtreesUriTemplate:T,subdivisionScheme:l,subtreeLevels:x,maximumLevel:y,refine:Z,basePath:h,lodMetricType:A_.GEOMETRIC_ERROR,rootLodMetricValue:ue,rootBoundingVolume:j,getTileType:zb,getRefine:Nb};return await a$(t,z,K)}async function a$(t,e,n){if(!t)return null;t.lodMetricType=A_.GEOMETRIC_ERROR,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform;const{children:i,contentUrl:r}=await YB({subtree:e,options:n,s2VolumeBox:t});return r&&(t.contentUrl=r,t.content={uri:r.replace("".concat(n.basePath,"/"),"")}),t.refine=Nb(t.refine),t.type=zb(t),t.children=i,t.id=t.contentUrl,t}function O2(t){var e;return(t==null||(e=t.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(t==null?void 0:t.implicitTiling)}const rf={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:RB,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:h$,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function l$(t){return Dx(t.url)}async function c$(t,e,n){const i={content:{featureIds:null}};return await UB(t,0,e,n,i.content),i.content}async function u$(t,e,n){var i;const r=JSON.parse(new TextDecoder().decode(t));return r.loader=e.loader||rf,r.url=n.url,r.queryString=n.queryString,r.basePath=l$(r),r.root=await o$(r,e),r.type=Ds.TILES3D,r.lodMetricType=A_.GEOMETRIC_ERROR,r.lodMetricValue=((i=r.root)===null||i===void 0?void 0:i.lodMetricValue)||0,r}async function h$(t,e,n){const i=e["3d-tiles"]||{};let r;return i.isTileset==="auto"?r=n.url&&n.url.indexOf(".json")!==-1:r=i.isTileset,r?t=await u$(t,e,n):t=await c$(t,e,n),t}const QB="https://api.cesium.com/v1/assets";async function d$(t,e){if(!e){const a=await f$(t);for(const h of a.items)h.type==="3DTILES"&&(e=h.id)}const n=await p$(t,e),{type:i,url:r}=n;return xn(i==="3DTILES"&&r),n.headers={Authorization:"Bearer ".concat(n.accessToken)},n}async function f$(t){xn(t);const e=QB,n={Authorization:"Bearer ".concat(t)},i=await Af(e,{fetch:{headers:n}});if(!i.ok)throw new Error(i.statusText);return await i.json()}async function p$(t,e){xn(t,e);const n={Authorization:"Bearer ".concat(t)},i="".concat(QB,"/").concat(e);let r=await Af("".concat(i),{fetch:{headers:n}});if(!r.ok)throw new Error(r.statusText);let a=await r.json();if(r=await Af("".concat(i,"/endpoint"),{fetch:{headers:n}}),!r.ok)throw new Error(r.statusText);const h=await r.json();return a={...a,...h},a}async function m$(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=e["cesium-ion"]||{};const{accessToken:n}=e;let i=e.assetId;if(!Number.isFinite(i)){const r=t.match(/\/([0-9]+)\/tileset.json/);i=r&&r[1]}return d$(n,i)}const eL={...rf,id:"cesium-ion",name:"Cesium Ion",preload:m$,parse:async(t,e,n)=>(e={...e},e["3d-tiles"]=e["cesium-ion"],e.loader=eL,rf.parse(t,e,n)),options:{"cesium-ion":{...rf.options["3d-tiles"],accessToken:null}}},k2=[0],g$={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:rf,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,n)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}};class Ub extends tB{constructor(...e){super(...e),L(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&dn.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){const{tileset3d:e}=this.state;return e!==null&&e.isLoaded()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:n,changeFlags:i}){if(e.data&&e.data!==n.data&&this._loadTileset(e.data),i.viewportChanged){const{activeViewports:r}=this.state;Object.keys(r).length&&(this._updateTileset(r),this.state.lastUpdatedViewports=r,this.state.activeViewports={})}if(i.propsChanged){const{layerMap:r}=this.state;for(const a in r)r[a].needsUpdate=!0}}activateViewport(e){const{activeViewports:n,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,n[e.id]=e;const r=i==null?void 0:i[e.id];(!r||!e.equals(r))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:n}){const i=n&&n.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer({layer:e,viewport:n}){const{tile:i}=e.props,{id:r}=n;return i.selected&&i.viewportIds.includes(r)}_updateAutoHighlight(e){const n=e.sourceTile,i=this.state.layerMap[n==null?void 0:n.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:n={}}=this.props;let i=this.props.loader||this.props.loaders;Array.isArray(i)&&(i=i[0]);const r={loadOptions:{...n}};if(i.preload){const l=await i.preload(e,n);l.headers&&(r.loadOptions.fetch={...r.loadOptions.fetch,headers:l.headers}),Object.assign(r,l)}const a=await Ml(e,i,r.loadOptions),h=new WX(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...r});this.setState({tileset3d:h,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(h)}_onTileLoad(e){const{lastUpdatedViewports:n}=this.state;this.props.onTileLoad(e),this._updateTileset(n),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:n}=this.state,{timeline:i}=this.context,r=Object.keys(e).length;!i||!r||!n||n.selectTiles(Object.values(e)).then(a=>{this.state.frameNumber!==a&&this.setState({frameNumber:a})})}_getSubLayer(e,n){if(!e.content)return null;switch(e.type){case Zu.POINTCLOUD:return this._makePointCloudLayer(e,n);case Zu.SCENEGRAPH:return this._make3DModelLayer(e);case Zu.MESH:return this._makeSimpleMeshLayer(e,n);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,n){const{attributes:i,pointCount:r,constantRGBA:a,cartographicOrigin:h,modelMatrix:l}=e.content,{positions:y,normals:x,colors:T}=i;if(!y)return null;const C=n&&n.props.data||{header:{vertexCount:r},attributes:{POSITION:y,NORMAL:x,COLOR_0:T}},{pointSize:S,getPointColor:z}=this.props,V=this.getSubLayerClass("pointcloud",Ab);return new V({pointSize:S},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:C,coordinateSystem:rn.METER_OFFSETS,coordinateOrigin:h,modelMatrix:l,getColor:a||z,_offset:0})}_make3DModelLayer(e){const{gltf:n,instances:i,cartographicOrigin:r,modelMatrix:a}=e.content,h=this.getSubLayerClass("scenegraph",Bb);return new h({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:i||k2,scenegraph:n,coordinateSystem:rn.METER_OFFSETS,coordinateOrigin:r,modelMatrix:a,getTransformMatrix:l=>l.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,n){const i=e.content,{attributes:r,indices:a,modelMatrix:h,cartographicOrigin:l,coordinateSystem:y=rn.METER_OFFSETS,material:x,featureIds:T}=i,{_getMeshColor:C}=this.props,S=n&&n.props.mesh||new tf({drawMode:4,attributes:_$(r),indices:a}),z=this.getSubLayerClass("mesh",Lb);return new z(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:S,data:k2,getColor:C(e),pbrMaterial:x,modelMatrix:h,coordinateOrigin:l,coordinateSystem:y,featureIds:T,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:n}=this.state;return e?e.tiles.map(i=>{const r=n[i.id]=n[i.id]||{tile:i};let{layer:a}=r;return i.selected&&(a?r.needsUpdate&&(a=this._getSubLayer(i,a),r.needsUpdate=!1):a=this._getSubLayer(i)),r.layer=a,a}).filter(Boolean):null}}L(Ub,"defaultProps",g$);L(Ub,"layerName","Tile3DLayer");function _$(t){const e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}const ev=512,y$=Math.PI/180;function tL({map:t,gl:e,deck:n}){if(t.__deck)return t.__deck;const i=n==null?void 0:n.props._customRender,r=n==null?void 0:n.props.onLoad,a=iL({...n==null?void 0:n.props,_customRender:()=>{t.triggerRepaint(),i==null||i("")}});let h;return(!n||n.props.gl===e)&&(Object.assign(a,{gl:e,width:null,height:null,touchAction:"unset",viewState:Df(t)}),n!=null&&n.isInitialized?F2(n,t):a.onLoad=()=>{r==null||r(),F2(h,t)}),n?(h=n,n.setProps(a),n.userData.isExternal=!0):(h=new Bf(a),t.on("remove",()=>{nL(t)})),h.userData.mapboxLayers=new Set,t.__deck=h,t.on("render",()=>{h.isInitialized&&E$(h,t)}),h}function F2(t,e){const n=()=>{t.isInitialized?T$(t,e):e.off("move",n)};e.on("move",n)}function nL(t){var e;(e=t.__deck)===null||e===void 0||e.finalize(),t.__deck=null}function iL(t){return{...t,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...t.parameters},views:t.views||[new _b({id:"mapbox"})]}}function v$(t,e){t.userData.mapboxLayers.add(e),Gb(t)}function x$(t,e){t.userData.mapboxLayers.delete(e),Gb(t)}function b$(t,e){Gb(t)}function w$(t,e,n){let{currentViewport:i}=t.userData,r=!1;i||(i=rL(t,e,!0),t.userData.currentViewport=i,r=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:({layer:a})=>n.id===a.id,clearStack:r,clearCanvas:!1})}function Df(t){var e;const{lng:n,lat:i}=t.getCenter(),r={longitude:(n+540)%360-180,latitude:i,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return(e=t.getTerrain)!==null&&e!==void 0&&e.call(t)&&A$(t,r),r}function A$(t,e){if(t.getFreeCameraOptions){const{position:n}=t.getFreeCameraOptions();if(!n||n.z===void 0)return;const i=t.transform.height,{longitude:r,latitude:a,pitch:h}=e,l=n.x*ev,y=(1-n.y)*ev,x=n.z*ev,T=Mf([r,a]),C=l-T[0],S=y-T[1],z=Math.sqrt(C*C+S*S),V=h*y$,Z=1.5*i,ue=V<.001?Z*Math.cos(V)/x:Z*Math.sin(V)/z;e.zoom=Math.log2(ue);const q=Z*Math.cos(V)/ue,j=x-q;e.position=[0,0,j/ag(a)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function rL(t,e,n=!0){return new Cc({id:"mapbox",x:0,y:0,width:t.width,height:t.height,...Df(e),nearZMultiplier:n?.02:.1})}function E$(t,e){const{mapboxLayers:n,isExternal:i}=t.userData;if(i){const r=Array.from(n,T=>T.id),h=uh(t.props.layers,Boolean).some(T=>T&&!r.includes(T.id));let l=t.getViewports();const y=l.findIndex(T=>T.id==="mapbox"),x=l.length>1||y<0;(h||x)&&(y>=0&&(l=l.slice(),l[y]=rL(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:l,layerFilter:T=>(!t.props.layerFilter||t.props.layerFilter(T))&&(T.viewport.id!=="mapbox"||!r.includes(T.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function T$(t,e){t.setProps({viewState:Df(e)}),t.needsRedraw({clearRedrawFlags:!0})}function Gb(t){if(t.userData.isExternal)return;const e=[];t.userData.mapboxLayers.forEach(n=>{const i=n.props.type,r=new i(n.props);e.push(r)}),t.setProps({layers:e})}class S${constructor(e){if(L(this,"id",void 0),L(this,"type",void 0),L(this,"renderingMode",void 0),L(this,"map",void 0),L(this,"deck",void 0),L(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,n){this.map=e,this.deck=tL({map:e,gl:n,deck:this.props.deck}),v$(this.deck,this)}onRemove(){this.deck&&x$(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&b$(this.deck)}render(){w$(this.deck,this.map,this)}}const tv="__UNDEFINED__";function jm(t,e,n,i){if(!t||!e||!t.style||!t.style._loaded)return;const r=uh(i,Boolean);if(n!==i){const l=uh(n,Boolean),y=new Set(l.map(x=>x.id));for(const x of r)y.delete(x.id);for(const x of y)t.getLayer(x)&&t.removeLayer(x)}for(const l of r){const y=t.getLayer(l.id);y?y.implementation.setProps(l.props):t.addLayer(new S$({id:l.id,deck:e}),l.props.beforeId)}const a=t.style._order,h={};for(const l of r){let{beforeId:y}=l.props;(!y||!a.includes(y))&&(y=tv),h[y]=h[y]||[],h[y].push(l.id)}for(const l in h){const y=h[l];let x=l===tv?a.length:a.indexOf(l),T=l===tv?void 0:l;for(let C=y.length-1;C>=0;C--){const S=y[C],z=a.indexOf(S);z!==x-1&&(t.moveLayer(S,T),z>x&&x++),x--,T=S}}}class C${constructor(e){L(this,"_props",void 0),L(this,"_deck",void 0),L(this,"_map",void 0),L(this,"_container",void 0),L(this,"_interleaved",void 0),L(this,"_lastMouseDownPoint",void 0),L(this,"_handleStyleChange",()=>{jm(this._map,this._deck,this._props.layers,this._props.layers)}),L(this,"_updateContainerSize",()=>{if(this._map&&this._container){const{clientWidth:r,clientHeight:a}=this._map.getContainer();Object.assign(this._container.style,{width:"".concat(r,"px"),height:"".concat(a,"px")})}}),L(this,"_updateViewState",()=>{const r=this._deck;r&&(r.setProps({viewState:Df(this._map)}),r.isInitialized&&r.redraw())}),L(this,"_handleMouseEvent",r=>{const a=this._deck;if(!a||!a.isInitialized)return;const h={type:r.type,offsetCenter:r.point,srcEvent:r},l=this._lastMouseDownPoint;switch(!r.point&&l&&(h.deltaX=r.originalEvent.clientX-l.clientX,h.deltaY=r.originalEvent.clientY-l.clientY,h.offsetCenter={x:l.x+h.deltaX,y:l.y+h.deltaY}),h.type){case"mousedown":a._onPointerDown(h),this._lastMouseDownPoint={...r.point,clientX:r.originalEvent.clientX,clientY:r.originalEvent.clientY};break;case"dragstart":h.type="panstart",a._onEvent(h);break;case"drag":h.type="panmove",a._onEvent(h);break;case"dragend":h.type="panend",a._onEvent(h);break;case"click":h.tapCount=1,a._onEvent(h);break;case"dblclick":h.type="click",h.tapCount=2,a._onEvent(h);break;case"mousemove":h.type="pointermove",a._onPointerMove(h);break;case"mouseout":h.type="pointerleave",a._onPointerMove(h);break;default:return}});const{interleaved:n=!1,...i}=e;this._interleaved=n,this._props=i}setProps(e){this._interleaved&&e.layers&&jm(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._deck.setProps(this._interleaved?iL(this._props):this._props)}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const n=document.createElement("div");return Object.assign(n.style,{position:"absolute",left:0,top:0,pointerEvents:"none"}),this._container=n,this._deck=new Bf({...this._props,parent:n,viewState:Df(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),n}_onAddInterleaved(e){return this._deck=tL({map:e,gl:e.painter.context.gl,deck:new Bf({...this._props,gl:e.painter.context.gl})}),e.on("styledata",this._handleStyleChange),jm(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){var n;e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),(n=this._deck)===null||n===void 0||n.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),jm(e,this._deck,this._props.layers,[]),nL(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Ai(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Ai(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Ai(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}}const I$="modulepreload",M$=function(t){return"/"+t},z2={},P$=function(e,n,i){if(!n||n.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(n.map(a=>{if(a=M$(a),a in z2)return;z2[a]=!0;const h=a.endsWith(".css"),l=h?'[rel="stylesheet"]':"";if(!!i)for(let T=r.length-1;T>=0;T--){const C=r[T];if(C.href===a&&(!h||C.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${l}`))return;const x=document.createElement("link");if(x.rel=h?"stylesheet":I$,h||(x.as="script",x.crossOrigin=""),x.href=a,document.head.appendChild(x),h)return new Promise((T,C)=>{x.addEventListener("load",T),x.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e())},B$=Pt.createContext(null);function L$(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function N2(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function U2(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const r=t.center;t.center=new r.constructor(n.longitude,n.latitude),i=i||r!==t.center}if("zoom"in n){const r=t.zoom;t.zoom=n.zoom,i=i||r!==t.zoom}if("bearing"in n){const r=t.bearing;t.bearing=n.bearing,i=i||r!==t.bearing}if("pitch"in n){const r=t.pitch;t.pitch=n.pitch,i=i||r!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const R$=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function G2(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{const r=e[i.ref];let a=null;if("interactive"in i&&(a={...i},delete a.interactive),r){a=a||{...i},delete a.ref;for(const h of R$)h in r&&(a[h]=r[h])}return a||i});return{...t,layers:n}}function D$(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,r=Array.isArray(e)?e[0]:e?e.x:0,a=Array.isArray(e)?e[1]:e?e.y:0;return n===r&&i===a}function fl(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!fl(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const r of n)if(!e.hasOwnProperty(r)||!fl(t[r],e[r]))return!1;return!0}return!1}const V2={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},nv={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},j2={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},O$=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],k$=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class fh{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=r=>{const a=this.props[j2[r.type]];a&&a(r)},this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const a=this.props[V2[r.type]];a&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),a(r),delete r.features)},this._onCameraEvent=r=>{if(!this._internalUpdate){const a=this.props[nv[r.type]];a&&a(r)}r.type in this._deferredEvents&&(this._deferredEvents[r.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const r=this._updateSize(e),a=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||r||a&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=fh.savedMaps.pop();if(!i)return null;const r=i.map,a=r.getContainer();for(n.className=a.className;a.childNodes.length>0;)n.appendChild(a.childNodes[0]);r._container=n;const h=r._resizeObserver;h&&(h.disconnect(),h.observe(n)),i.setProps({...e,styleDiffing:!1}),r.resize();const{initialViewState:l}=e;return l&&(l.bounds?r.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):i._updateViewState(l,!1)),r.isStyleLoaded()?r.fire("load"):r.once("styledata",()=>r.fire("load")),r._update(),i}_initialize(e){const{props:n}=this,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||F$()||null,container:e,style:G2(n.mapStyle)},r=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),n.gl){const x=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=x,n.gl)}const a=new this._MapClass(i);r.padding&&a.setPadding(r.padding),n.cursor&&(a.getCanvas().style.cursor=n.cursor),this._createShadowTransform(a);const h=a._render;a._render=x=>{this._inRender=!0,h.call(a,x),this._inRender=!1};const l=a._renderTaskQueue.run;a._renderTaskQueue.run=x=>{l.call(a._renderTaskQueue,x),this._onBeforeRepaint()},a.on("render",()=>this._onAfterRepaint());const y=a.fire;a.fire=this._fireEvent.bind(this,y),a.on("resize",()=>{this._renderTransform.resize(a.transform.width,a.transform.height)}),a.on("styledata",()=>this._updateStyleComponents(this.props,{})),a.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const x in V2)a.on(x,this._onPointerEvent);for(const x in nv)a.on(x,this._onCameraEvent);for(const x in j2)a.on(x,this._onEvent);this._map=a}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),fh.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=L$(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,r=this._renderTransform,{zoom:a,pitch:h,bearing:l}=r,y=i.isMoving();y&&(r.cameraElevationReference="sea");const x=U2(r,{...N2(i.transform),...e});if(y&&(r.cameraElevationReference="ground"),x&&n){const T=this._deferredEvents;T.move=!0,T.zoom||(T.zoom=a!==r.zoom),T.rotate||(T.rotate=l!==r.bearing),T.pitch||(T.pitch=h!==r.pitch)}return y||U2(i.transform,e),x}_updateSettings(e,n){const i=this._map;let r=!1;for(const a of O$)a in e&&!fl(e[a],n[a])&&(r=!0,i[`set${a[0].toUpperCase()}${a.slice(1)}`](e[a]));return r}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor),e.mapStyle!==n.mapStyle){const i={diff:e.styleDiffing};return"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(G2(e.mapStyle),i),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let r=!1;return i.style.loaded()&&("light"in e&&!fl(e.light,n.light)&&(r=!0,i.setLight(e.light)),"fog"in e&&!fl(e.fog,n.fog)&&(r=!0,i.setFog(e.fog)),"terrain"in e&&!fl(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(r=!0,i.setTerrain(e.terrain))),r}_updateHandlers(e,n){const i=this._map;let r=!1;for(const a of k$){const h=e[a];fl(h,n[a])||(r=!0,h?i[a].enable(h):i[a].disable())}return r}_queryRenderedFeatures(e){const n=this._map,{interactiveLayerIds:i=[]}=this.props;try{return n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const a=e.type,h=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,l=this._queryRenderedFeatures(e.point),y=l.length>0;!y&&h&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,y&&!h&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=a}else this._hoveredFeatures=null}_fireEvent(e,n,i){const r=this._map,a=r.transform,h=typeof n=="string"?n:n.type;return h==="move"&&this._updateViewState(this.props,!1),h in nv&&(typeof n=="object"&&(n.viewState=N2(a)),this._map.isMoving())?(r.transform=this._renderTransform,e.call(r,n,i),r.transform=a,r):(e.call(r,n,i),r)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=n}}}fh.savedMaps=[];function F$(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const z$=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function N$(t,e){if(!t)return null;const n=t.map,i={getMap:()=>n,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>t.transform.locationPoint(e.LngLat.convert(r)),unproject:r=>t.transform.pointLocation(e.Point.convert(r)),queryTerrainElevation:(r,a)=>{const h=n.transform;n.transform=t.transform;const l=n.queryTerrainElevation(r,a);return n.transform=h,l}};for(const r of U$(n))!(r in i)&&!z$.includes(r)&&(i[r]=n[r].bind(n));return i}function U$(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const G$=typeof document<"u"?Pt.useLayoutEffect:Pt.useEffect,V$=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function j$(t,e){for(const n of V$)n in e&&(t[n]=e[n]);e.RTLTextPlugin&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(e.RTLTextPlugin,n=>{n&&console.error(n)},!1)}const S_=Pt.createContext(null),H$={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:t=>console.error(t.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},Vb=Pt.forwardRef((t,e)=>{const n=Pt.useContext(B$),[i,r]=Pt.useState(null),a=Pt.useRef(),{current:h}=Pt.useRef({mapLib:null,map:null});Pt.useEffect(()=>{const x=t.mapLib;let T=!0,C;return Promise.resolve(x||P$(()=>import("./mapbox-gl-28cef3f4.js").then(S=>S.m),[])).then(S=>{if(T){if(S.Map||(S=S.default),!S||!S.Map)throw new Error("Invalid mapLib");if(j$(S,t),!S.supported||S.supported(t))t.reuseMaps&&(C=fh.reuse(t,a.current)),C||(C=new fh(S.Map,t,a.current)),h.map=N$(C,S),h.mapLib=S,r(C),n==null||n.onMapMount(h.map,t.id);else throw new Error("Map is not supported by this browser")}}).catch(S=>{t.onError({type:"error",target:null,originalEvent:null,error:S})}),()=>{T=!1,C&&(n==null||n.onMapUnmount(t.id),t.reuseMaps?C.recycle():C.destroy())}},[]),G$(()=>{i&&i.setProps(t)}),Pt.useImperativeHandle(e,()=>h.map,[i]);const l=Pt.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),y={height:"100%"};return Pt.createElement("div",{id:t.id,ref:a,style:l},i&&Pt.createElement(S_.Provider,{value:h},Pt.createElement("div",{"mapboxgl-children":"",style:y},t.children)))});Vb.displayName="Map";Vb.defaultProps=H$;const W$=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function kc(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const r=e[i];Number.isFinite(r)&&!W$.test(i)?n[i]=`${r}px`:n[i]=r}}const X$={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function sL(t){const{map:e,mapLib:n}=Pt.useContext(S_),i=Pt.useRef({props:t});i.current.props=t;const r=Pt.useMemo(()=>{let a=!1;Pt.Children.forEach(t.children,y=>{y&&(a=!0)});const h={...t,element:a?document.createElement("div"):null},l=new n.Marker(h).setLngLat([t.longitude,t.latitude]);return l.getElement().addEventListener("click",y=>{var x,T;(T=(x=i.current.props).onClick)===null||T===void 0||T.call(x,{type:"click",target:l,originalEvent:y})}),l.on("dragstart",y=>{var x,T;const C=y;C.lngLat=r.getLngLat(),(T=(x=i.current.props).onDragStart)===null||T===void 0||T.call(x,C)}),l.on("drag",y=>{var x,T;const C=y;C.lngLat=r.getLngLat(),(T=(x=i.current.props).onDrag)===null||T===void 0||T.call(x,C)}),l.on("dragend",y=>{var x,T;const C=y;C.lngLat=r.getLngLat(),(T=(x=i.current.props).onDragEnd)===null||T===void 0||T.call(x,C)}),l},[]);return Pt.useEffect(()=>(r.addTo(e.getMap()),()=>{r.remove()}),[]),Pt.useEffect(()=>{kc(r.getElement(),t.style)},[t.style]),(r.getLngLat().lng!==t.longitude||r.getLngLat().lat!==t.latitude)&&r.setLngLat([t.longitude,t.latitude]),t.offset&&!D$(r.getOffset(),t.offset)&&r.setOffset(t.offset),r.isDraggable()!==t.draggable&&r.setDraggable(t.draggable),r.getRotation()!==t.rotation&&r.setRotation(t.rotation),r.getRotationAlignment()!==t.rotationAlignment&&r.setRotationAlignment(t.rotationAlignment),r.getPitchAlignment()!==t.pitchAlignment&&r.setPitchAlignment(t.pitchAlignment),r.getPopup()!==t.popup&&r.setPopup(t.popup),Bx.createPortal(t.children,r.getElement())}sL.defaultProps=X$;Pt.memo(sL);function H2(t){return new Set(t?t.trim().split(/\s+/):[])}function q$(t){const{map:e,mapLib:n}=Pt.useContext(S_),i=Pt.useMemo(()=>document.createElement("div"),[]),r=Pt.useRef({props:t});r.current.props=t;const a=Pt.useMemo(()=>{const h={...t},l=new n.Popup(h).setLngLat([t.longitude,t.latitude]);return l.once("open",y=>{var x,T;(T=(x=r.current.props).onOpen)===null||T===void 0||T.call(x,y)}),l},[]);if(Pt.useEffect(()=>{const h=l=>{var y,x;(x=(y=r.current.props).onClose)===null||x===void 0||x.call(y,l)};return a.on("close",h),a.setDOMContent(i).addTo(e.getMap()),()=>{a.off("close",h),a.isOpen()&&a.remove()}},[]),Pt.useEffect(()=>{kc(a.getElement(),t.style)},[t.style]),a.isOpen()&&((a.getLngLat().lng!==t.longitude||a.getLngLat().lat!==t.latitude)&&a.setLngLat([t.longitude,t.latitude]),t.offset&&!fl(a.options.offset,t.offset)&&a.setOffset(t.offset),(a.options.anchor!==t.anchor||a.options.maxWidth!==t.maxWidth)&&(a.options.anchor=t.anchor,a.setMaxWidth(t.maxWidth)),a.options.className!==t.className)){const h=H2(a.options.className),l=H2(t.className);for(const y of h)l.has(y)||a.removeClassName(y);for(const y of l)h.has(y)||a.addClassName(y);a.options.className=t.className}return Bx.createPortal(t.children,i)}Pt.memo(q$);function xh(t,e,n,i){const r=Pt.useContext(S_),a=Pt.useMemo(()=>t(r),[]);return Pt.useEffect(()=>{const h=i||n||e,l=typeof e=="function"&&typeof n=="function"?e:null,y=typeof n=="function"?n:typeof e=="function"?e:null,{map:x}=r;return x.hasControl(a)||(x.addControl(a,h==null?void 0:h.position),l&&l(r)),()=>{y&&y(r),x.hasControl(a)&&x.removeControl(a)}},[]),a}function $$(t){const e=xh(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return Pt.useEffect(()=>{kc(e._container,t.style)},[t.style]),null}Pt.memo($$);function Z$(t){const e=xh(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return Pt.useEffect(()=>{kc(e._controlContainer,t.style)},[t.style]),null}Pt.memo(Z$);const oL=Pt.forwardRef((t,e)=>{const n=Pt.useRef({props:t}),i=xh(({mapLib:r})=>{const a=new r.GeolocateControl(t),h=a._setupUI;return a._setupUI=l=>{a._container.hasChildNodes()||h(l)},a.on("geolocate",l=>{var y,x;(x=(y=n.current.props).onGeolocate)===null||x===void 0||x.call(y,l)}),a.on("error",l=>{var y,x;(x=(y=n.current.props).onError)===null||x===void 0||x.call(y,l)}),a.on("outofmaxbounds",l=>{var y,x;(x=(y=n.current.props).onOutOfMaxBounds)===null||x===void 0||x.call(y,l)}),a.on("trackuserlocationstart",l=>{var y,x;(x=(y=n.current.props).onTrackUserLocationStart)===null||x===void 0||x.call(y,l)}),a.on("trackuserlocationend",l=>{var y,x;(x=(y=n.current.props).onTrackUserLocationEnd)===null||x===void 0||x.call(y,l)}),a},{position:t.position});return n.current.props=t,Pt.useImperativeHandle(e,()=>({trigger:()=>i.trigger()}),[]),Pt.useEffect(()=>{kc(i._container,t.style)},[t.style]),null});oL.displayName="GeolocateControl";Pt.memo(oL);function J$(t){const e=xh(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return Pt.useEffect(()=>{kc(e._container,t.style)},[t.style]),null}const K$=Pt.memo(J$),Y$={unit:"metric",maxWidth:100};function aL(t){const e=xh(({mapLib:n})=>new n.ScaleControl(t),{position:t.position});return(e.options.unit!==t.unit||e.options.maxWidth!==t.maxWidth)&&(e.options.maxWidth=t.maxWidth,e.setUnit(t.unit)),Pt.useEffect(()=>{kc(e._container,t.style)},[t.style]),null}aL.defaultProps=Y$;Pt.memo(aL);var lL={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(eD,function(){var n,i,r;function a(l,y){if(!n)n=y;else if(!i)i=y;else{var x="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",T={};n(T),r=y(T),typeof window<"u"&&(r.workerUrl=window.URL.createObjectURL(new Blob([x],{type:"text/javascript"})))}}a(["exports"],function(l){var y=x;function x(c,s,u,f){this.cx=3*c,this.bx=3*(u-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(f-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=s,this.p2x=u,this.p2y=f}function T(c,s,u,f){const g=new y(c,s,u,f);return function(v){return g.solve(v)}}x.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,s){if(s===void 0&&(s=1e-6),c<0)return 0;if(c>1)return 1;for(var u=c,f=0;f<8;f++){var g=this.sampleCurveX(u)-c;if(Math.abs(g)<s)return u;var v=this.sampleCurveDerivativeX(u);if(Math.abs(v)<1e-6)break;u-=g/v}var w=0,E=1;for(u=c,f=0;f<20&&(g=this.sampleCurveX(u),!(Math.abs(g-c)<s));f++)c>g?w=u:E=u,u=.5*(E-w)+w;return u},solve:function(c,s){return this.sampleCurveY(this.solveCurveX(c,s))}};const C=T(.25,.1,.25,1);function S(c,s,u){return Math.min(u,Math.max(s,c))}function z(c,s,u){const f=u-s,g=((c-s)%f+f)%f+s;return g===s?u:g}function V(c,...s){for(const u of s)for(const f in u)c[f]=u[f];return c}let Z=1;function ue(c,s){c.forEach(u=>{s[u]&&(s[u]=s[u].bind(s))})}function q(c,s,u){const f={};for(const g in c)f[g]=s.call(u||this,c[g],g,c);return f}function j(c,s,u){const f={};for(const g in c)s.call(u||this,c[g],g,c)&&(f[g]=c[g]);return f}function K(c){return Array.isArray(c)?c.map(K):typeof c=="object"&&c?q(c,K):c}const de={};function ve(c){de[c]||(typeof console<"u"&&console.warn(c),de[c]=!0)}function Ie(c,s,u){return(u.y-c.y)*(s.x-c.x)>(s.y-c.y)*(u.x-c.x)}function De(c){let s=0;for(let u,f,g=0,v=c.length,w=v-1;g<v;w=g++)u=c[g],f=c[w],s+=(f.x-u.x)*(u.y+f.y);return s}function Fe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function je(c){const s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,g,v)=>{const w=g||v;return s[f]=!w||w.toLowerCase(),""}),s["max-age"]){const u=parseInt(s["max-age"],10);isNaN(u)?delete s["max-age"]:s["max-age"]=u}return s}let Ne,dt,Nt=null;function Xt(c){if(Nt==null){const s=c.navigator?c.navigator.userAgent:null;Nt=!!c.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Nt}function Lt(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const jn={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(c){const s=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(c,s=0){const u=window.document.createElement("canvas"),f=u.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return u.width=c.width,u.height=c.height,f.drawImage(c,0,0,c.width,c.height),f.getImageData(-s,-s,c.width+2*s,c.height+2*s)},resolveURL:c=>(Ne||(Ne=document.createElement("a")),Ne.href=c,Ne.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(dt==null&&(dt=matchMedia("(prefers-reduced-motion: reduce)")),dt.matches)}};var yt=Yn;function Yn(c,s){this.x=c,this.y=s}Yn.prototype={clone:function(){return new Yn(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,s){return this.clone()._rotateAround(c,s)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var s=c.x-this.x,u=c.y-this.y;return s*s+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,s){return Math.atan2(this.x*s-this.y*c,this.x*c+this.y*s)},_matMult:function(c){var s=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=s,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var s=Math.cos(c),u=Math.sin(c),f=u*this.x+s*this.y;return this.x=s*this.x-u*this.y,this.y=f,this},_rotateAround:function(c,s){var u=Math.cos(c),f=Math.sin(c),g=s.y+f*(this.x-s.x)+u*(this.y-s.y);return this.x=s.x+u*(this.x-s.x)-f*(this.y-s.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Yn.convert=function(c){return c instanceof Yn?c:Array.isArray(c)?new Yn(c[0],c[1]):c};const Ke={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},vt="mapbox-tiles";let Et,en,sn=500,ji=50;function pi(){typeof caches>"u"||Et||(Et=caches.open(vt))}let Di=1/0;const mi={supported:!1,testSupport:function(c){!Jt&&Oi&&(Hn?As(c):mn=c)}};let mn,Oi,Jt=!1,Hn=!1;function As(c){const s=c.createTexture();c.bindTexture(c.TEXTURE_2D,s);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Oi),c.isContextLost())return;mi.supported=!0}catch{}c.deleteTexture(s),Jt=!0}typeof document<"u"&&(Oi=document.createElement("img"),Oi.onload=function(){mn&&As(mn),mn=null,Hn=!0},Oi.onerror=function(){Jt=!0,mn=null},Oi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Hi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Hi);class ai extends Error{constructor(s,u,f,g){super(`AJAXError: ${u} (${s}): ${f}`),this.status=s,this.statusText=u,this.url=f,this.body=g}}const Jr=Fe()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function tr(c,s){const u=new AbortController,f=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Jr(),signal:u.signal});let g=!1,v=!1;return c.type==="json"&&f.headers.set("Accept","application/json"),((w,E,I)=>{if(v)return;const B=Date.now();fetch(f).then(O=>O.ok?((F,G,X)=>{(c.type==="arrayBuffer"?F.arrayBuffer():c.type==="json"?F.json():F.text()).then($=>{v||(G&&X&&function(oe,se,ye){if(pi(),!Et)return;const Te={status:se.status,statusText:se.statusText,headers:new Headers};se.headers.forEach((Ae,ke)=>Te.headers.set(ke,Ae));const _e=je(se.headers.get("Cache-Control")||"");_e["no-store"]||(_e["max-age"]&&Te.headers.set("Expires",new Date(ye+1e3*_e["max-age"]).toUTCString()),new Date(Te.headers.get("Expires")).getTime()-ye<42e4||function(Ae,ke){if(en===void 0)try{new Response(new ReadableStream),en=!0}catch{en=!1}en?ke(Ae.body):Ae.blob().then(ke)}(se,Ae=>{const ke=new Response(Ae,Te);pi(),Et&&Et.then(Oe=>Oe.put(function(st){const ht=st.indexOf("?");return ht<0?st:st.slice(0,ht)}(oe.url),ke)).catch(Oe=>ve(Oe.message))}))}(f,G,X),g=!0,s(null,$,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch($=>{v||s(new Error($.message))})})(O,null,B):O.blob().then(F=>s(new ai(O.status,O.statusText,c.url,F)))).catch(O=>{O.code!==20&&s(new Error(O.message))})})(),{cancel:()=>{v=!0,g||u.abort()}}}const Ti=function(c,s){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){if(Fe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s);if(!Fe()){const f=c.url.substring(0,c.url.indexOf("://"));return(Ke.REGISTERED_PROTOCOLS[f]||tr)(c,s)}}if(!(/^file:/.test(u=c.url)||/^file:/.test(Jr())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return tr(c,s);if(Fe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,s,void 0,!0)}var u;return function(f,g){const v=new XMLHttpRequest;v.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(v.responseType="arraybuffer");for(const w in f.headers)v.setRequestHeader(w,f.headers[w]);return f.type==="json"&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials=f.credentials==="include",v.onerror=()=>{g(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let w=v.response;if(f.type==="json")try{w=JSON.parse(v.response)}catch(E){return g(E)}g(null,w,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else{const w=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});g(new ai(v.status,v.statusText,f.url,w))}},v.send(f.body),{cancel:()=>v.abort()}}(c,s)},nr=function(c,s){return Ti(V(c,{type:"arrayBuffer"}),s)};function xo(c){const s=window.document.createElement("a");return s.href=c,s.protocol===window.document.location.protocol&&s.host===window.document.location.host}const Ht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Wi,Wn;Wi=[],Wn=0;const Es=function(c,s){if(mi.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Wn>=Ke.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:c,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return Wi.push(v),v}Wn++;let u=!1;const f=()=>{if(!u)for(u=!0,Wn--;Wi.length&&Wn<Ke.MAX_PARALLEL_IMAGE_REQUESTS;){const v=Wi.shift(),{requestParameters:w,callback:E,cancelled:I}=v;I||(v.cancel=Es(w,E).cancel)}},g=nr(c,(v,w,E,I)=>{f(),v?s(v):w&&function(B,O){typeof createImageBitmap=="function"?function(F,G){const X=new Blob([new Uint8Array(F)],{type:"image/png"});createImageBitmap(X).then($=>{G(null,$)}).catch($=>{G(new Error(`Could not load image because of ${$.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(B,O):function(F,G){const X=new Image;X.onload=()=>{G(null,X),URL.revokeObjectURL(X.src),X.onload=null,window.requestAnimationFrame(()=>{X.src=Ht})},X.onerror=()=>G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const $=new Blob([new Uint8Array(F)],{type:"image/png"});X.src=F.byteLength?URL.createObjectURL($):Ht}(B,O)}(w,(B,O)=>{B!=null?s(B):O!=null&&s(null,O,{cacheControl:E,expires:I})})});return{cancel:()=>{g.cancel(),f()}}};function Jo(c,s,u){u[c]&&u[c].indexOf(s)!==-1||(u[c]=u[c]||[],u[c].push(s))}function Kr(c,s,u){if(u&&u[c]){const f=u[c].indexOf(s);f!==-1&&u[c].splice(f,1)}}class Yr{constructor(s,u={}){V(this,u),this.type=s}}class bo extends Yr{constructor(s,u={}){super("error",V({error:s},u))}}class Dr{on(s,u){return this._listeners=this._listeners||{},Jo(s,u,this._listeners),this}off(s,u){return Kr(s,u,this._listeners),Kr(s,u,this._oneTimeListeners),this}once(s,u){return this._oneTimeListeners=this._oneTimeListeners||{},Jo(s,u,this._oneTimeListeners),this}fire(s,u){typeof s=="string"&&(s=new Yr(s,u||{}));const f=s.type;if(this.listens(f)){s.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const E of g)E.call(this,s);const v=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const E of v)Kr(f,E,this._oneTimeListeners),E.call(this,s);const w=this._eventedParent;w&&(V(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(s))}else s instanceof bo&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,u){return this._eventedParent=s,this._eventedParentData=u,this}}var Be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class $e{constructor(s,u,f,g){this.message=(s?`${s}: `:"")+f,g&&(this.identifier=g),u!=null&&u.__line__&&(this.line=u.__line__)}}function Ts(c){const s=c.value;return s?[new $e(c.key,s,"constants have been deprecated as of v8")]:[]}function ki(c,...s){for(const u of s)for(const f in u)c[f]=u[f];return c}function Gt(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function ir(c){if(Array.isArray(c))return c.map(ir);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const s={};for(const u in c)s[u]=ir(c[u]);return s}return Gt(c)}class Xi extends Error{constructor(s,u){super(u),this.message=u,this.key=s}}class qi{constructor(s,u=[]){this.parent=s,this.bindings={};for(const[f,g]of u)this.bindings[f]=g}concat(s){return new qi(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const Ss={kind:"null"},qe={kind:"number"},Mt={kind:"string"},It={kind:"boolean"},li={kind:"color"},Qr={kind:"object"},Ct={kind:"value"},yr={kind:"collator"},Qn={kind:"formatted"},wo={kind:"padding"},Nn={kind:"resolvedImage"};function gi(c,s){return{kind:"array",itemType:c,N:s}}function on(c){if(c.kind==="array"){const s=on(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}const Ao=[Ss,qe,Mt,It,li,Qn,Qr,gi(Ct),wo,Nn];function Or(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Or(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(const u of Ao)if(!Or(u,s))return null}}return`Expected ${on(c)} but found ${on(s)} instead.`}function kr(c,s){return s.some(u=>u.kind===c.kind)}function $s(c,s){return s.some(u=>u==="null"?c===null:u==="array"?Array.isArray(c):u==="object"?c&&!Array.isArray(c)&&typeof c=="object":u===typeof c)}var Eo,Cs={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ee(c){return(c=Math.round(c))<0?0:c>255?255:c}function D(c){return ee(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function N(c){return(s=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:s>1?1:s;var s}function J(c,s,u){return u<0?u+=1:u>1&&(u-=1),6*u<1?c+(s-c)*u*6:2*u<1?s:3*u<2?c+(s-c)*(2/3-u)*6:c}try{Eo={}.parseCSSColor=function(c){var s,u=c.replace(/ /g,"").toLowerCase();if(u in Cs)return Cs[u].slice();if(u[0]==="#")return u.length===4?(s=parseInt(u.substr(1),16))>=0&&s<=4095?[(3840&s)>>4|(3840&s)>>8,240&s|(240&s)>>4,15&s|(15&s)<<4,1]:null:u.length===7&&(s=parseInt(u.substr(1),16))>=0&&s<=16777215?[(16711680&s)>>16,(65280&s)>>8,255&s,1]:null;var f=u.indexOf("("),g=u.indexOf(")");if(f!==-1&&g+1===u.length){var v=u.substr(0,f),w=u.substr(f+1,g-(f+1)).split(","),E=1;switch(v){case"rgba":if(w.length!==4)return null;E=N(w.pop());case"rgb":return w.length!==3?null:[D(w[0]),D(w[1]),D(w[2]),E];case"hsla":if(w.length!==4)return null;E=N(w.pop());case"hsl":if(w.length!==3)return null;var I=(parseFloat(w[0])%360+360)%360/360,B=N(w[1]),O=N(w[2]),F=O<=.5?O*(B+1):O+B-O*B,G=2*O-F;return[ee(255*J(G,F,I+1/3)),ee(255*J(G,F,I)),ee(255*J(G,F,I-1/3)),E];default:return null}}return null}}catch{}class Y{constructor(s,u,f,g=1){this.r=s,this.g=u,this.b=f,this.a=g}static parse(s){if(!s)return;if(s instanceof Y)return s;if(typeof s!="string")return;const u=Eo(s);return u?new Y(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3]):void 0}toString(){const[s,u,f,g]=this.toArray();return`rgba(${Math.round(s)},${Math.round(u)},${Math.round(f)},${g})`}toArray(){const{r:s,g:u,b:f,a:g}=this;return g===0?[0,0,0,0]:[255*s/g,255*u/g,255*f/g,g]}}Y.black=new Y(0,0,0,1),Y.white=new Y(1,1,1,1),Y.transparent=new Y(0,0,0,0),Y.red=new Y(1,0,0,1);class le{constructor(s,u,f){this.sensitivity=s?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,u){return this.collator.compare(s,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class pe{constructor(s,u,f,g,v){this.text=s,this.image=u,this.scale=f,this.fontStack=g,this.textColor=v}}class he{constructor(s){this.sections=s}static fromString(s){return new he([new pe(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof he?s:he.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class ae{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof ae)return s;if(typeof s=="number")return new ae([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const u of s)if(typeof u!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new ae(s)}}toString(){return JSON.stringify(this.values)}}class me{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new me({name:s,available:!1}):null}}function Me(c,s,u,f){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[c,s,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[c,s,u,f]:[c,s,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ze(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Y||c instanceof le||c instanceof he||c instanceof ae||c instanceof me)return!0;if(Array.isArray(c)){for(const s of c)if(!ze(s))return!1;return!0}if(typeof c=="object"){for(const s in c)if(!ze(c[s]))return!1;return!0}return!1}function Ce(c){if(c===null)return Ss;if(typeof c=="string")return Mt;if(typeof c=="boolean")return It;if(typeof c=="number")return qe;if(c instanceof Y)return li;if(c instanceof le)return yr;if(c instanceof he)return Qn;if(c instanceof ae)return wo;if(c instanceof me)return Nn;if(Array.isArray(c)){const s=c.length;let u;for(const f of c){const g=Ce(f);if(u){if(u===g)continue;u=Ct;break}u=g}return gi(u||Ct,s)}return Qr}function ot(c){const s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof Y||c instanceof he||c instanceof ae||c instanceof me?c.toString():JSON.stringify(c)}class ut{constructor(s,u){this.type=s,this.value=u}static parse(s,u){if(s.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!ze(s[1]))return u.error("invalid value");const f=s[1];let g=Ce(f);const v=u.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new ut(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Qe{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const xt={string:Mt,number:qe,boolean:It,object:Qr};class pt{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");let f,g=1;const v=s[0];if(v==="array"){let E,I;if(s.length>2){const B=s[1];if(typeof B!="string"||!(B in xt)||B==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=xt[B],g++}else E=Ct;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return u.error('The length argument to "array" must be a positive integer literal',2);I=s[2],g++}f=gi(E,I)}else{if(!xt[v])throw new Error(`Types doesn't contain name = ${v}`);f=xt[v]}const w=[];for(;g<s.length;g++){const E=u.parse(s[g],g,Ct);if(!E)return null;w.push(E)}return new pt(f,w)}evaluate(s){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(s);if(!Or(this.type,Ce(f)))return f;if(u===this.args.length-1)throw new Qe(`Expected value to be of type ${on(this.type)}, but found ${on(Ce(f))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Rt={"to-boolean":It,"to-color":li,"to-number":qe,"to-string":Mt};class At{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const f=s[0];if(!Rt[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&s.length!==2)return u.error("Expected one argument.");const g=Rt[f],v=[];for(let w=1;w<s.length;w++){const E=u.parse(s[w],w,Ct);if(!E)return null;v.push(E)}return new At(g,v)}evaluate(s){if(this.type.kind==="boolean")return!!this.args[0].evaluate(s);if(this.type.kind==="color"){let u,f;for(const g of this.args){if(u=g.evaluate(s),f=null,u instanceof Y)return u;if(typeof u=="string"){const v=s.parseColor(u);if(v)return v}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Me(u[0],u[1],u[2],u[3]),!f))return new Y(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Qe(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="padding"){let u;for(const f of this.args){u=f.evaluate(s);const g=ae.parse(u);if(g)return g}throw new Qe(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}if(this.type.kind==="number"){let u=null;for(const f of this.args){if(u=f.evaluate(s),u===null)return 0;const g=Number(u);if(!isNaN(g))return g}throw new Qe(`Could not convert ${JSON.stringify(u)} to number.`)}return this.type.kind==="formatted"?he.fromString(ot(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?me.fromString(ot(this.args[0].evaluate(s))):ot(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const St=["Unknown","Point","LineString","Polygon"];class Ft{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?St[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let u=this._parseColorCache[s];return u||(u=this._parseColorCache[s]=Y.parse(s)),u}}class Vt{constructor(s,u,f,g){this.name=s,this.type=u,this._evaluate=f,this.args=g}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,u){const f=s[0],g=Vt.definitions[f];if(!g)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,w=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,E=w.filter(([B])=>!Array.isArray(B)||B.length===s.length-1);let I=null;for(const[B,O]of E){I=new Ge(u.registry,u.path,null,u.scope);const F=[];let G=!1;for(let X=1;X<s.length;X++){const $=s[X],oe=Array.isArray(B)?B[X-1]:B.type,se=I.parse($,1+F.length,oe);if(!se){G=!0;break}F.push(se)}if(!G)if(Array.isArray(B)&&B.length!==F.length)I.error(`Expected ${B.length} arguments, but found ${F.length} instead.`);else{for(let X=0;X<F.length;X++){const $=Array.isArray(B)?B[X]:B.type,oe=F[X];I.concat(X+1).checkSubtype($,oe.type)}if(I.errors.length===0)return new Vt(f,v,O,F)}}if(E.length===1)u.errors.push(...I.errors);else{const B=(E.length?E:w).map(([F])=>{return G=F,Array.isArray(G)?`(${G.map(on).join(", ")})`:`(${on(G.type)}...)`;var G}).join(" | "),O=[];for(let F=1;F<s.length;F++){const G=u.parse(s[F],1+O.length);if(!G)return null;O.push(on(G.type))}u.error(`Expected arguments of type ${B}, but found (${O.join(", ")}) instead.`)}return null}static register(s,u){Vt.definitions=u;for(const f in u)s[f]=Vt}}class yn{constructor(s,u,f){this.type=yr,this.locale=f,this.caseSensitive=s,this.diacriticSensitive=u}static parse(s,u){if(s.length!==2)return u.error("Expected one argument.");const f=s[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const g=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,It);if(!g)return null;const v=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,It);if(!v)return null;let w=null;return f.locale&&(w=u.parse(f.locale,1,Mt),!w)?null:new yn(g,v,w)}evaluate(s){return new le(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const vn=8192;function ci(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function es(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function Si(c,s){const u=(180+c[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,g=Math.pow(2,s.z);return[Math.round(u*g*vn),Math.round(f*g*vn)]}function Kt(c,s,u){const f=c[0]-s[0],g=c[1]-s[1],v=c[0]-u[0],w=c[1]-u[1];return f*w-v*g==0&&f*v<=0&&g*w<=0}function Ko(c,s){let u=!1;for(let w=0,E=s.length;w<E;w++){const I=s[w];for(let B=0,O=I.length;B<O-1;B++){if(Kt(c,I[B],I[B+1]))return!1;(g=I[B])[1]>(f=c)[1]!=(v=I[B+1])[1]>f[1]&&f[0]<(v[0]-g[0])*(f[1]-g[1])/(v[1]-g[1])+g[0]&&(u=!u)}}var f,g,v;return u}function Yo(c,s){for(let u=0;u<s.length;u++)if(Ko(c,s[u]))return!0;return!1}function Oa(c,s,u,f){const g=f[0]-u[0],v=f[1]-u[1],w=(c[0]-u[0])*v-g*(c[1]-u[1]),E=(s[0]-u[0])*v-g*(s[1]-u[1]);return w>0&&E<0||w<0&&E>0}function ka(c,s,u){for(const B of u)for(let O=0;O<B.length-1;++O)if((E=[(w=B[O+1])[0]-(v=B[O])[0],w[1]-v[1]])[0]*(I=[(g=s)[0]-(f=c)[0],g[1]-f[1]])[1]-E[1]*I[0]!=0&&Oa(f,g,v,w)&&Oa(v,w,f,g))return!0;var f,g,v,w,E,I;return!1}function To(c,s){for(let u=0;u<c.length;++u)if(!Ko(c[u],s))return!1;for(let u=0;u<c.length-1;++u)if(ka(c[u],c[u+1],s))return!1;return!0}function ts(c,s){for(let u=0;u<s.length;u++)if(To(c,s[u]))return!0;return!1}function Fa(c,s,u){const f=[];for(let g=0;g<c.length;g++){const v=[];for(let w=0;w<c[g].length;w++){const E=Si(c[g][w],u);ci(s,E),v.push(E)}f.push(v)}return f}function za(c,s,u){const f=[];for(let g=0;g<c.length;g++){const v=Fa(c[g],s,u);f.push(v)}return f}function Na(c,s,u,f){if(c[0]<u[0]||c[0]>u[2]){const g=.5*f;let v=c[0]-u[0]>g?-f:u[0]-c[0]>g?f:0;v===0&&(v=c[0]-u[2]>g?-f:u[2]-c[0]>g?f:0),c[0]+=v}ci(s,c)}function Dl(c,s,u,f){const g=Math.pow(2,f.z)*vn,v=[f.x*vn,f.y*vn],w=[];for(const E of c)for(const I of E){const B=[I.x+v[0],I.y+v[1]];Na(B,s,u,g),w.push(B)}return w}function Fc(c,s,u,f){const g=Math.pow(2,f.z)*vn,v=[f.x*vn,f.y*vn],w=[];for(const I of c){const B=[];for(const O of I){const F=[O.x+v[0],O.y+v[1]];ci(s,F),B.push(F)}w.push(B)}if(s[2]-s[0]<=g/2){(E=s)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const I of w)for(const B of I)Na(B,s,u,g)}var E;return w}class Zs{constructor(s,u){this.type=It,this.geojson=s,this.geometries=u}static parse(s,u){if(s.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(ze(s[1])){const f=s[1];if(f.type==="FeatureCollection")for(let g=0;g<f.features.length;++g){const v=f.features[g].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Zs(f,f.features[g].geometry)}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Zs(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Zs(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=u.canonicalID();if(f.type==="Polygon"){const E=Fa(f.coordinates,v,w),I=Dl(u.geometry(),g,v,w);if(!es(g,v))return!1;for(const B of I)if(!Ko(B,E))return!1}if(f.type==="MultiPolygon"){const E=za(f.coordinates,v,w),I=Dl(u.geometry(),g,v,w);if(!es(g,v))return!1;for(const B of I)if(!Yo(B,E))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],w=u.canonicalID();if(f.type==="Polygon"){const E=Fa(f.coordinates,v,w),I=Fc(u.geometry(),g,v,w);if(!es(g,v))return!1;for(const B of I)if(!To(B,E))return!1}if(f.type==="MultiPolygon"){const E=za(f.coordinates,v,w),I=Fc(u.geometry(),g,v,w);if(!es(g,v))return!1;for(const B of I)if(!ts(B,E))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function W(c){if(c instanceof Vt&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Zs)return!1;let s=!0;return c.eachChild(u=>{s&&!W(u)&&(s=!1)}),s}function Q(c){if(c instanceof Vt&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(u=>{s&&!Q(u)&&(s=!1)}),s}function ce(c,s){if(c instanceof Vt&&s.indexOf(c.name)>=0)return!1;let u=!0;return c.eachChild(f=>{u&&!ce(f,s)&&(u=!1)}),u}class Se{constructor(s,u){this.type=u.type,this.name=s,this.boundExpression=u}static parse(s,u){if(s.length!==2||typeof s[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=s[1];return u.scope.has(f)?new Se(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Ge{constructor(s,u=[],f,g=new qi,v=[]){this.registry=s,this.path=u,this.key=u.map(w=>`[${w}]`).join(""),this.scope=g,this.errors=v,this.expectedType=f}parse(s,u,f,g,v={}){return u?this.concat(u,f,g)._parse(s,v):this._parse(s,v)}_parse(s,u){function f(g,v,w){return w==="assert"?new pt(v,[g]):w==="coerce"?new At(v,[g]):g}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=s[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let w=v.parse(s,this);if(!w)return null;if(this.expectedType){const E=this.expectedType,I=w.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||I.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(E.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array"){if(this.checkSubtype(E,I))return null}else w=f(w,E,u.typeAnnotation||"coerce");else w=f(w,E,u.typeAnnotation||"coerce");else w=f(w,E,u.typeAnnotation||"assert")}if(!(w instanceof ut)&&w.type.kind!=="resolvedImage"&&ct(w)){const E=new Ft;try{w=new ut(w.type,w.evaluate(E))}catch(I){return this.error(I.message),null}}return w}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,u,f){const g=typeof s=="number"?this.path.concat(s):this.path,v=f?this.scope.concat(f):this.scope;return new Ge(this.registry,g,u||null,v,this.errors)}error(s,...u){const f=`${this.key}${u.map(g=>`[${g}]`).join("")}`;this.errors.push(new Xi(f,s))}checkSubtype(s,u){const f=Or(s,u);return f&&this.error(f),f}}function ct(c){if(c instanceof Se)return ct(c.boundExpression);if(c instanceof Vt&&c.name==="error"||c instanceof yn||c instanceof Zs)return!1;const s=c instanceof At||c instanceof pt;let u=!0;return c.eachChild(f=>{u=s?u&&ct(f):u&&f instanceof ut}),!!u&&W(c)&&ce(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function zt(c,s){const u=c.length-1;let f,g,v=0,w=u,E=0;for(;v<=w;)if(E=Math.floor((v+w)/2),f=c[E],g=c[E+1],f<=s){if(E===u||s<g)return E;v=E+1}else{if(!(f>s))throw new Qe("Input is not a number.");w=E-1}return 0}class Bn{constructor(s,u,f){this.type=s,this.input=u,this.labels=[],this.outputs=[];for(const[g,v]of f)this.labels.push(g),this.outputs.push(v)}static parse(s,u){if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(s[1],1,qe);if(!f)return null;const g=[];let v=null;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);for(let w=1;w<s.length;w+=2){const E=w===1?-1/0:s[w],I=s[w+1],B=w,O=w+1;if(typeof E!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(g.length&&g[g.length-1][0]>=E)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);const F=u.parse(I,O,v);if(!F)return null;v=v||F.type,g.push([E,F])}return new Bn(v,f,g)}evaluate(s){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);const g=this.input.evaluate(s);if(g<=u[0])return f[0].evaluate(s);const v=u.length;return g>=u[v-1]?f[v-1].evaluate(s):f[zt(u,g)].evaluate(s)}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Dt(c,s,u){return c*(1-u)+s*u}var Xn=Object.freeze({__proto__:null,number:Dt,color:function(c,s,u){return new Y(Dt(c.r,s.r,u),Dt(c.g,s.g,u),Dt(c.b,s.b,u),Dt(c.a,s.a,u))},array:function(c,s,u){return c.map((f,g)=>Dt(f,s[g],u))},padding:function(c,s,u){const f=c.values,g=s.values;return new ae([Dt(f[0],g[0],u),Dt(f[1],g[1],u),Dt(f[2],g[2],u),Dt(f[3],g[3],u)])}});const vr=.95047,Qf=1.08883,bh=4/29,zc=6/29,ep=3*zc*zc,C_=Math.PI/180,I_=180/Math.PI;function wh(c){return c>.008856451679035631?Math.pow(c,1/3):c/ep+bh}function Ah(c){return c>zc?c*c*c:ep*(c-bh)}function Eh(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function Th(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function tn(c){const s=Th(c.r),u=Th(c.g),f=Th(c.b),g=wh((.4124564*s+.3575761*u+.1804375*f)/vr),v=wh((.2126729*s+.7151522*u+.072175*f)/1);return{l:116*v-16,a:500*(g-v),b:200*(v-wh((.0193339*s+.119192*u+.9503041*f)/Qf)),alpha:c.a}}function tp(c){let s=(c.l+16)/116,u=isNaN(c.a)?s:s+c.a/500,f=isNaN(c.b)?s:s-c.b/200;return s=1*Ah(s),u=vr*Ah(u),f=Qf*Ah(f),new Y(Eh(3.2404542*u-1.5371385*s-.4985314*f),Eh(-.969266*u+1.8760108*s+.041556*f),Eh(.0556434*u-.2040259*s+1.0572252*f),c.alpha)}function M_(c,s,u){const f=s-c;return c+u*(f>180||f<-180?f-360*Math.round(f/360):f)}const Ol={forward:tn,reverse:tp,interpolate:function(c,s,u){return{l:Dt(c.l,s.l,u),a:Dt(c.a,s.a,u),b:Dt(c.b,s.b,u),alpha:Dt(c.alpha,s.alpha,u)}}},kl={forward:function(c){const{l:s,a:u,b:f}=tn(c),g=Math.atan2(f,u)*I_;return{h:g<0?g+360:g,c:Math.sqrt(u*u+f*f),l:s,alpha:c.a}},reverse:function(c){const s=c.h*C_,u=c.c;return tp({l:c.l,a:Math.cos(s)*u,b:Math.sin(s)*u,alpha:c.alpha})},interpolate:function(c,s,u){return{h:M_(c.h,s.h,u),c:Dt(c.c,s.c,u),l:Dt(c.l,s.l,u),alpha:Dt(c.alpha,s.alpha,u)}}};var np=Object.freeze({__proto__:null,lab:Ol,hcl:kl});class xr{constructor(s,u,f,g,v){this.type=s,this.operator=u,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[w,E]of v)this.labels.push(w),this.outputs.push(E)}static interpolationFactor(s,u,f,g){let v=0;if(s.name==="exponential")v=Sh(u,s.base,f,g);else if(s.name==="linear")v=Sh(u,1,f,g);else if(s.name==="cubic-bezier"){const w=s.controlPoints;v=new y(w[0],w[1],w[2],w[3]).solve(Sh(u,1,f,g))}return v}static parse(s,u){let[f,g,v,...w]=s;if(!Array.isArray(g)||g.length===0)return u.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const B=g[1];if(typeof B!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:B}}else{if(g[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const B=g.slice(1);if(B.length!==4||B.some(O=>typeof O!="number"||O<0||O>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:B}}}if(s.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(v=u.parse(v,2,qe),!v)return null;const E=[];let I=null;f==="interpolate-hcl"||f==="interpolate-lab"?I=li:u.expectedType&&u.expectedType.kind!=="value"&&(I=u.expectedType);for(let B=0;B<w.length;B+=2){const O=w[B],F=w[B+1],G=B+3,X=B+4;if(typeof O!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(E.length&&E[E.length-1][0]>=O)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const $=u.parse(F,X,I);if(!$)return null;I=I||$.type,E.push([O,$])}return I.kind==="number"||I.kind==="color"||I.kind==="padding"||I.kind==="array"&&I.itemType.kind==="number"&&typeof I.N=="number"?new xr(I,f,g,v,E):u.error(`Type ${on(I)} is not interpolatable.`)}evaluate(s){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);const g=this.input.evaluate(s);if(g<=u[0])return f[0].evaluate(s);const v=u.length;if(g>=u[v-1])return f[v-1].evaluate(s);const w=zt(u,g),E=xr.interpolationFactor(this.interpolation,g,u[w],u[w+1]),I=f[w].evaluate(s),B=f[w+1].evaluate(s);return this.operator==="interpolate"?Xn[this.type.kind.toLowerCase()](I,B,E):this.operator==="interpolate-hcl"?kl.reverse(kl.interpolate(kl.forward(I),kl.forward(B),E)):Ol.reverse(Ol.interpolate(Ol.forward(I),Ol.forward(B),E))}eachChild(s){s(this.input);for(const u of this.outputs)s(u)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Sh(c,s,u,f){const g=f-u,v=c-u;return g===0?0:s===1?v/g:(Math.pow(s,v)-1)/(Math.pow(s,g)-1)}class Nc{constructor(s,u){this.type=s,this.args=u}static parse(s,u){if(s.length<2)return u.error("Expectected at least one argument.");let f=null;const g=u.expectedType;g&&g.kind!=="value"&&(f=g);const v=[];for(const E of s.slice(1)){const I=u.parse(E,1+v.length,f,void 0,{typeAnnotation:"omit"});if(!I)return null;f=f||I.type,v.push(I)}if(!f)throw new Error("No output type");const w=g&&v.some(E=>Or(g,E.type));return new Nc(w?Ct:f,v)}evaluate(s){let u,f=null,g=0;for(const v of this.args)if(g++,f=v.evaluate(s),f&&f instanceof me&&!f.available&&(u||(u=f.name),f=null,g===this.args.length&&(f=u)),f!==null)break;return f}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class Uc{constructor(s,u){this.type=u.type,this.bindings=[].concat(s),this.result=u}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const u of this.bindings)s(u[1]);s(this.result)}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const f=[];for(let v=1;v<s.length-1;v+=2){const w=s[v];if(typeof w!="string")return u.error(`Expected string, but found ${typeof w} instead.`,v);if(/[^a-zA-Z0-9_]/.test(w))return u.error("Variable names must contain only alphanumeric characters or '_'.",v);const E=u.parse(s[v+1],v+1);if(!E)return null;f.push([w,E])}const g=u.parse(s[s.length-1],s.length-1,u.expectedType,f);return g?new Uc(f,g):null}outputDefined(){return this.result.outputDefined()}}class Ch{constructor(s,u,f){this.type=s,this.index=u,this.input=f}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,qe),g=u.parse(s[2],2,gi(u.expectedType||Ct));return f&&g?new Ch(g.type.itemType,f,g):null}evaluate(s){const u=this.index.evaluate(s),f=this.input.evaluate(s);if(u<0)throw new Qe(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new Qe(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new Qe(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class Ih{constructor(s,u){this.type=It,this.needle=s,this.haystack=u}static parse(s,u){if(s.length!==3)return u.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,Ct),g=u.parse(s[2],2,Ct);return f&&g?kr(f.type,[It,Mt,qe,Ss,Ct])?new Ih(f,g):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(f.type)} instead`):null}evaluate(s){const u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!f)return!1;if(!$s(u,["boolean","string","number","null"]))throw new Qe(`Expected first argument to be of type boolean, string, number or null, but found ${on(Ce(u))} instead.`);if(!$s(f,["string","array"]))throw new Qe(`Expected second argument to be of type array or string, but found ${on(Ce(f))} instead.`);return f.indexOf(u)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Gc{constructor(s,u,f){this.type=qe,this.needle=s,this.haystack=u,this.fromIndex=f}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,Ct),g=u.parse(s[2],2,Ct);if(!f||!g)return null;if(!kr(f.type,[It,Mt,qe,Ss,Ct]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(f.type)} instead`);if(s.length===4){const v=u.parse(s[3],3,qe);return v?new Gc(f,g,v):null}return new Gc(f,g)}evaluate(s){const u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!$s(u,["boolean","string","number","null"]))throw new Qe(`Expected first argument to be of type boolean, string, number or null, but found ${on(Ce(u))} instead.`);if(!$s(f,["string","array"]))throw new Qe(`Expected second argument to be of type array or string, but found ${on(Ce(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(s);return f.indexOf(u,g)}return f.indexOf(u)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Mh{constructor(s,u,f,g,v,w){this.inputType=s,this.type=u,this.input=f,this.cases=g,this.outputs=v,this.otherwise=w}static parse(s,u){if(s.length<5)return u.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return u.error("Expected an even number of arguments.");let f,g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const v={},w=[];for(let B=2;B<s.length-1;B+=2){let O=s[B];const F=s[B+1];Array.isArray(O)||(O=[O]);const G=u.concat(B);if(O.length===0)return G.error("Expected at least one branch label.");for(const $ of O){if(typeof $!="number"&&typeof $!="string")return G.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return G.error("Numeric branch labels must be integer values.");if(f){if(G.checkSubtype(f,Ce($)))return null}else f=Ce($);if(v[String($)]!==void 0)return G.error("Branch labels must be unique.");v[String($)]=w.length}const X=u.parse(F,B,g);if(!X)return null;g=g||X.type,w.push(X)}const E=u.parse(s[1],1,Ct);if(!E)return null;const I=u.parse(s[s.length-1],s.length-1,g);return I?E.type.kind!=="value"&&u.concat(1).checkSubtype(f,E.type)?null:new Mh(f,g,E,v,w,I):null}evaluate(s){const u=this.input.evaluate(s);return(Ce(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class Ph{constructor(s,u,f){this.type=s,this.branches=u,this.otherwise=f}static parse(s,u){if(s.length<4)return u.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const g=[];for(let w=1;w<s.length-1;w+=2){const E=u.parse(s[w],w,It);if(!E)return null;const I=u.parse(s[w+1],w+1,f);if(!I)return null;g.push([E,I]),f=f||I.type}const v=u.parse(s[s.length-1],s.length-1,f);if(!v)return null;if(!f)throw new Error("Can't infer output type");return new Ph(f,g,v)}evaluate(s){for(const[u,f]of this.branches)if(u.evaluate(s))return f.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[u,f]of this.branches)s(u),s(f);s(this.otherwise)}outputDefined(){return this.branches.every(([s,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class Vc{constructor(s,u,f,g){this.type=s,this.input=u,this.beginIndex=f,this.endIndex=g}static parse(s,u){if(s.length<=2||s.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const f=u.parse(s[1],1,Ct),g=u.parse(s[2],2,qe);if(!f||!g)return null;if(!kr(f.type,[gi(Ct),Mt,Ct]))return u.error(`Expected first argument to be of type array or string, but found ${on(f.type)} instead`);if(s.length===4){const v=u.parse(s[3],3,qe);return v?new Vc(f.type,f,g,v):null}return new Vc(f.type,f,g)}evaluate(s){const u=this.input.evaluate(s),f=this.beginIndex.evaluate(s);if(!$s(u,["string","array"]))throw new Qe(`Expected first argument to be of type array or string, but found ${on(Ce(u))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(s);return u.slice(f,g)}return u.slice(f)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function ip(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function rp(c,s,u,f){return f.compare(s,u)===0}function Ua(c,s,u){const f=c!=="=="&&c!=="!=";return class cL{constructor(v,w,E){this.type=It,this.lhs=v,this.rhs=w,this.collator=E,this.hasUntypedArgument=v.type.kind==="value"||w.type.kind==="value"}static parse(v,w){if(v.length!==3&&v.length!==4)return w.error("Expected two or three arguments.");const E=v[0];let I=w.parse(v[1],1,Ct);if(!I)return null;if(!ip(E,I.type))return w.concat(1).error(`"${E}" comparisons are not supported for type '${on(I.type)}'.`);let B=w.parse(v[2],2,Ct);if(!B)return null;if(!ip(E,B.type))return w.concat(2).error(`"${E}" comparisons are not supported for type '${on(B.type)}'.`);if(I.type.kind!==B.type.kind&&I.type.kind!=="value"&&B.type.kind!=="value")return w.error(`Cannot compare types '${on(I.type)}' and '${on(B.type)}'.`);f&&(I.type.kind==="value"&&B.type.kind!=="value"?I=new pt(B.type,[I]):I.type.kind!=="value"&&B.type.kind==="value"&&(B=new pt(I.type,[B])));let O=null;if(v.length===4){if(I.type.kind!=="string"&&B.type.kind!=="string"&&I.type.kind!=="value"&&B.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(O=w.parse(v[3],3,yr),!O)return null}return new cL(I,B,O)}evaluate(v){const w=this.lhs.evaluate(v),E=this.rhs.evaluate(v);if(f&&this.hasUntypedArgument){const I=Ce(w),B=Ce(E);if(I.kind!==B.kind||I.kind!=="string"&&I.kind!=="number")throw new Qe(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${I.kind}, ${B.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const I=Ce(w),B=Ce(E);if(I.kind!=="string"||B.kind!=="string")return s(v,w,E)}return this.collator?u(v,w,E,this.collator.evaluate(v)):s(v,w,E)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const P_=Ua("==",function(c,s,u){return s===u},rp),B_=Ua("!=",function(c,s,u){return s!==u},function(c,s,u,f){return!rp(0,s,u,f)}),L_=Ua("<",function(c,s,u){return s<u},function(c,s,u,f){return f.compare(s,u)<0}),R_=Ua(">",function(c,s,u){return s>u},function(c,s,u,f){return f.compare(s,u)>0}),D_=Ua("<=",function(c,s,u){return s<=u},function(c,s,u,f){return f.compare(s,u)<=0}),O_=Ua(">=",function(c,s,u){return s>=u},function(c,s,u,f){return f.compare(s,u)>=0});class Bh{constructor(s,u,f,g,v){this.type=Mt,this.number=s,this.locale=u,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(s,u){if(s.length!==3)return u.error("Expected two arguments.");const f=u.parse(s[1],1,qe);if(!f)return null;const g=s[2];if(typeof g!="object"||Array.isArray(g))return u.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=u.parse(g.locale,1,Mt),!v))return null;let w=null;if(g.currency&&(w=u.parse(g.currency,1,Mt),!w))return null;let E=null;if(g["min-fraction-digits"]&&(E=u.parse(g["min-fraction-digits"],1,qe),!E))return null;let I=null;return g["max-fraction-digits"]&&(I=u.parse(g["max-fraction-digits"],1,qe),!I)?null:new Bh(f,v,w,E,I)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class jc{constructor(s){this.type=Qn,this.sections=s}static parse(s,u){if(s.length<2)return u.error("Expected at least one argument.");const f=s[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const g=[];let v=!1;for(let w=1;w<=s.length-1;++w){const E=s[w];if(v&&typeof E=="object"&&!Array.isArray(E)){v=!1;let I=null;if(E["font-scale"]&&(I=u.parse(E["font-scale"],1,qe),!I))return null;let B=null;if(E["text-font"]&&(B=u.parse(E["text-font"],1,gi(Mt)),!B))return null;let O=null;if(E["text-color"]&&(O=u.parse(E["text-color"],1,li),!O))return null;const F=g[g.length-1];F.scale=I,F.font=B,F.textColor=O}else{const I=u.parse(s[w],1,Ct);if(!I)return null;const B=I.type.kind;if(B!=="string"&&B!=="value"&&B!=="null"&&B!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:I,scale:null,font:null,textColor:null})}}return new jc(g)}evaluate(s){return new he(this.sections.map(u=>{const f=u.content.evaluate(s);return Ce(f)===Nn?new pe("",f,null,null,null):new pe(ot(f),null,u.scale?u.scale.evaluate(s):null,u.font?u.font.evaluate(s).join(","):null,u.textColor?u.textColor.evaluate(s):null)}))}eachChild(s){for(const u of this.sections)s(u.content),u.scale&&s(u.scale),u.font&&s(u.font),u.textColor&&s(u.textColor)}outputDefined(){return!1}}class Lh{constructor(s){this.type=Nn,this.input=s}static parse(s,u){if(s.length!==2)return u.error("Expected two arguments.");const f=u.parse(s[1],1,Mt);return f?new Lh(f):u.error("No image name provided.")}evaluate(s){const u=this.input.evaluate(s),f=me.fromString(u);return f&&s.availableImages&&(f.available=s.availableImages.indexOf(u)>-1),f}eachChild(s){s(this.input)}outputDefined(){return!1}}class Rh{constructor(s){this.type=qe,this.input=s}static parse(s,u){if(s.length!==2)return u.error(`Expected 1 argument, but found ${s.length-1} instead.`);const f=u.parse(s[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${on(f.type)} instead.`):new Rh(f):null}evaluate(s){const u=this.input.evaluate(s);if(typeof u=="string"||Array.isArray(u))return u.length;throw new Qe(`Expected value to be of type string or array, but found ${on(Ce(u))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const Ga={"==":P_,"!=":B_,">":R_,"<":L_,">=":O_,"<=":D_,array:pt,at:Ch,boolean:pt,case:Ph,coalesce:Nc,collator:yn,format:jc,image:Lh,in:Ih,"index-of":Gc,interpolate:xr,"interpolate-hcl":xr,"interpolate-lab":xr,length:Rh,let:Uc,literal:ut,match:Mh,number:pt,"number-format":Bh,object:pt,slice:Vc,step:Bn,string:pt,"to-boolean":At,"to-color":At,"to-number":At,"to-string":At,var:Se,within:Zs};function sp(c,[s,u,f,g]){s=s.evaluate(c),u=u.evaluate(c),f=f.evaluate(c);const v=g?g.evaluate(c):1,w=Me(s,u,f,v);if(w)throw new Qe(w);return new Y(s/255*v,u/255*v,f/255*v,v)}function op(c,s){return c in s}function Hc(c,s){const u=s[c];return u===void 0?null:u}function Qo(c){return{type:c}}function ap(c){return{result:"success",value:c}}function Va(c){return{result:"error",value:c}}function En(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function lp(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Wt(c){return!!c.expression&&c.expression.interpolated}function nn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function bn(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Cn(c){return c}function Fl(c,s){const u=s.type==="color",f=c.stops&&typeof c.stops[0][0]=="object",g=f||!(f||c.property!==void 0),v=c.type||(Wt(s)?"exponential":"interval");if(u||s.type==="padding"){const B=u?Y.parse:ae.parse;(c=ki({},c)).stops&&(c.stops=c.stops.map(O=>[O[0],B(O[1])])),c.default=B(c.default?c.default:s.default)}if(c.colorSpace&&c.colorSpace!=="rgb"&&!np[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let w,E,I;if(v==="exponential")w=cp;else if(v==="interval")w=F_;else if(v==="categorical"){w=k_,E=Object.create(null);for(const B of c.stops)E[B[0]]=B[1];I=typeof c.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);w=z_}if(f){const B={},O=[];for(let X=0;X<c.stops.length;X++){const $=c.stops[X],oe=$[0].zoom;B[oe]===void 0&&(B[oe]={zoom:oe,type:c.type,property:c.property,default:c.default,stops:[]},O.push(oe)),B[oe].stops.push([$[0].value,$[1]])}const F=[];for(const X of O)F.push([B[X].zoom,Fl(B[X],s)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:xr.interpolationFactor.bind(void 0,G),zoomStops:F.map(X=>X[0]),evaluate:({zoom:X},$)=>cp({stops:F,base:c.base},s,X).evaluate(X,$)}}if(g){const B=v==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:B,interpolationFactor:xr.interpolationFactor.bind(void 0,B),zoomStops:c.stops.map(O=>O[0]),evaluate:({zoom:O})=>w(c,s,O,E,I)}}return{kind:"source",evaluate(B,O){const F=O&&O.properties?O.properties[c.property]:void 0;return F===void 0?ja(c.default,s.default):w(c,s,F,E,I)}}}function ja(c,s,u){return c!==void 0?c:s!==void 0?s:u!==void 0?u:void 0}function k_(c,s,u,f,g){return ja(typeof u===g?f[u]:void 0,c.default,s.default)}function F_(c,s,u){if(nn(u)!=="number")return ja(c.default,s.default);const f=c.stops.length;if(f===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[f-1][0])return c.stops[f-1][1];const g=zt(c.stops.map(v=>v[0]),u);return c.stops[g][1]}function cp(c,s,u){const f=c.base!==void 0?c.base:1;if(nn(u)!=="number")return ja(c.default,s.default);const g=c.stops.length;if(g===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[g-1][0])return c.stops[g-1][1];const v=zt(c.stops.map(O=>O[0]),u),w=function(O,F,G,X){const $=X-G,oe=O-G;return $===0?0:F===1?oe/$:(Math.pow(F,oe)-1)/(Math.pow(F,$)-1)}(u,f,c.stops[v][0],c.stops[v+1][0]),E=c.stops[v][1],I=c.stops[v+1][1];let B=Xn[s.type]||Cn;if(c.colorSpace&&c.colorSpace!=="rgb"){const O=np[c.colorSpace];B=(F,G)=>O.reverse(O.interpolate(O.forward(F),O.forward(G),w))}return typeof E.evaluate=="function"?{evaluate(...O){const F=E.evaluate.apply(void 0,O),G=I.evaluate.apply(void 0,O);if(F!==void 0&&G!==void 0)return B(F,G,w)}}:B(E,I,w)}function z_(c,s,u){switch(s.type){case"color":u=Y.parse(u);break;case"formatted":u=he.fromString(u.toString());break;case"resolvedImage":u=me.fromString(u.toString());break;case"padding":u=ae.parse(u);break;default:nn(u)===s.type||s.type==="enum"&&s.values[u]||(u=void 0)}return ja(u,c.default,s.default)}Vt.register(Ga,{error:[{kind:"error"},[Mt],(c,[s])=>{throw new Qe(s.evaluate(c))}],typeof:[Mt,[Ct],(c,[s])=>on(Ce(s.evaluate(c)))],"to-rgba":[gi(qe,4),[li],(c,[s])=>s.evaluate(c).toArray()],rgb:[li,[qe,qe,qe],sp],rgba:[li,[qe,qe,qe,qe],sp],has:{type:It,overloads:[[[Mt],(c,[s])=>op(s.evaluate(c),c.properties())],[[Mt,Qr],(c,[s,u])=>op(s.evaluate(c),u.evaluate(c))]]},get:{type:Ct,overloads:[[[Mt],(c,[s])=>Hc(s.evaluate(c),c.properties())],[[Mt,Qr],(c,[s,u])=>Hc(s.evaluate(c),u.evaluate(c))]]},"feature-state":[Ct,[Mt],(c,[s])=>Hc(s.evaluate(c),c.featureState||{})],properties:[Qr,[],c=>c.properties()],"geometry-type":[Mt,[],c=>c.geometryType()],id:[Ct,[],c=>c.id()],zoom:[qe,[],c=>c.globals.zoom],"heatmap-density":[qe,[],c=>c.globals.heatmapDensity||0],"line-progress":[qe,[],c=>c.globals.lineProgress||0],accumulated:[Ct,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[qe,Qo(qe),(c,s)=>{let u=0;for(const f of s)u+=f.evaluate(c);return u}],"*":[qe,Qo(qe),(c,s)=>{let u=1;for(const f of s)u*=f.evaluate(c);return u}],"-":{type:qe,overloads:[[[qe,qe],(c,[s,u])=>s.evaluate(c)-u.evaluate(c)],[[qe],(c,[s])=>-s.evaluate(c)]]},"/":[qe,[qe,qe],(c,[s,u])=>s.evaluate(c)/u.evaluate(c)],"%":[qe,[qe,qe],(c,[s,u])=>s.evaluate(c)%u.evaluate(c)],ln2:[qe,[],()=>Math.LN2],pi:[qe,[],()=>Math.PI],e:[qe,[],()=>Math.E],"^":[qe,[qe,qe],(c,[s,u])=>Math.pow(s.evaluate(c),u.evaluate(c))],sqrt:[qe,[qe],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[qe,[qe],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[qe,[qe],(c,[s])=>Math.log(s.evaluate(c))],log2:[qe,[qe],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[qe,[qe],(c,[s])=>Math.sin(s.evaluate(c))],cos:[qe,[qe],(c,[s])=>Math.cos(s.evaluate(c))],tan:[qe,[qe],(c,[s])=>Math.tan(s.evaluate(c))],asin:[qe,[qe],(c,[s])=>Math.asin(s.evaluate(c))],acos:[qe,[qe],(c,[s])=>Math.acos(s.evaluate(c))],atan:[qe,[qe],(c,[s])=>Math.atan(s.evaluate(c))],min:[qe,Qo(qe),(c,s)=>Math.min(...s.map(u=>u.evaluate(c)))],max:[qe,Qo(qe),(c,s)=>Math.max(...s.map(u=>u.evaluate(c)))],abs:[qe,[qe],(c,[s])=>Math.abs(s.evaluate(c))],round:[qe,[qe],(c,[s])=>{const u=s.evaluate(c);return u<0?-Math.round(-u):Math.round(u)}],floor:[qe,[qe],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[qe,[qe],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[It,[Mt,Ct],(c,[s,u])=>c.properties()[s.value]===u.value],"filter-id-==":[It,[Ct],(c,[s])=>c.id()===s.value],"filter-type-==":[It,[Mt],(c,[s])=>c.geometryType()===s.value],"filter-<":[It,[Mt,Ct],(c,[s,u])=>{const f=c.properties()[s.value],g=u.value;return typeof f==typeof g&&f<g}],"filter-id-<":[It,[Ct],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u<f}],"filter->":[It,[Mt,Ct],(c,[s,u])=>{const f=c.properties()[s.value],g=u.value;return typeof f==typeof g&&f>g}],"filter-id->":[It,[Ct],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u>f}],"filter-<=":[It,[Mt,Ct],(c,[s,u])=>{const f=c.properties()[s.value],g=u.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[It,[Ct],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u<=f}],"filter->=":[It,[Mt,Ct],(c,[s,u])=>{const f=c.properties()[s.value],g=u.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[It,[Ct],(c,[s])=>{const u=c.id(),f=s.value;return typeof u==typeof f&&u>=f}],"filter-has":[It,[Ct],(c,[s])=>s.value in c.properties()],"filter-has-id":[It,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[It,[gi(Mt)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[It,[gi(Ct)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[It,[Mt,gi(Ct)],(c,[s,u])=>u.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[It,[Mt,gi(Ct)],(c,[s,u])=>function(f,g,v,w){for(;v<=w;){const E=v+w>>1;if(g[E]===f)return!0;g[E]>f?w=E-1:v=E+1}return!1}(c.properties()[s.value],u.value,0,u.value.length-1)],all:{type:It,overloads:[[[It,It],(c,[s,u])=>s.evaluate(c)&&u.evaluate(c)],[Qo(It),(c,s)=>{for(const u of s)if(!u.evaluate(c))return!1;return!0}]]},any:{type:It,overloads:[[[It,It],(c,[s,u])=>s.evaluate(c)||u.evaluate(c)],[Qo(It),(c,s)=>{for(const u of s)if(u.evaluate(c))return!0;return!1}]]},"!":[It,[It],(c,[s])=>!s.evaluate(c)],"is-supported-script":[It,[Mt],(c,[s])=>{const u=c.globals&&c.globals.isSupportedScript;return!u||u(s.evaluate(c))}],upcase:[Mt,[Mt],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[Mt,[Mt],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[Mt,Qo(Ct),(c,s)=>s.map(u=>ot(u.evaluate(c))).join("")],"resolved-locale":[Mt,[yr],(c,[s])=>s.evaluate(c).resolvedLocale()]});class Wc{constructor(s,u){this.expression=s,this._warningHistory={},this._evaluator=new Ft,this._defaultValue=u?function(f){return f.type==="color"&&bn(f.default)?new Y(0,0,0,0):f.type==="color"?Y.parse(f.default)||null:f.type==="padding"?ae.parse(f.default)||null:f.default===void 0?null:f.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(s,u,f,g,v,w){return this._evaluator.globals=s,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(s,u,f,g,v,w){this._evaluator.globals=s,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Qe(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function zl(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Ga}function Nl(c,s){const u=new Ge(Ga,[],s?function(g){const v={color:li,string:Mt,number:qe,enum:Mt,boolean:It,formatted:Qn,padding:wo,resolvedImage:Nn};return g.type==="array"?gi(v[g.value]||Ct,g.length):v[g.type]}(s):void 0),f=u.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?ap(new Wc(f,s)):Va(u.errors)}class Ul{constructor(s,u){this.kind=s,this._styleExpression=u,this.isStateDependent=s!=="constant"&&!Q(u.expression)}evaluateWithoutErrorHandling(s,u,f,g,v,w){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,g,v,w)}evaluate(s,u,f,g,v,w){return this._styleExpression.evaluate(s,u,f,g,v,w)}}class Dh{constructor(s,u,f,g){this.kind=s,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=s!=="camera"&&!Q(u.expression),this.interpolationType=g}evaluateWithoutErrorHandling(s,u,f,g,v,w){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,g,v,w)}evaluate(s,u,f,g,v,w){return this._styleExpression.evaluate(s,u,f,g,v,w)}interpolationFactor(s,u,f){return this.interpolationType?xr.interpolationFactor(this.interpolationType,s,u,f):0}}function up(c,s){const u=Nl(c,s);if(u.result==="error")return u;const f=u.value.expression,g=W(f);if(!g&&!En(s))return Va([new Xi("","data expressions not supported")]);const v=ce(f,["zoom"]);if(!v&&!lp(s))return Va([new Xi("","zoom expressions not supported")]);const w=qc(f);return w||v?w instanceof Xi?Va([w]):w instanceof xr&&!Wt(s)?Va([new Xi("",'"interpolate" expressions cannot be used with this property')]):ap(w?new Dh(g?"camera":"composite",u.value,w.labels,w instanceof xr?w.interpolation:void 0):new Ul(g?"constant":"source",u.value)):Va([new Xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Xc{constructor(s,u){this._parameters=s,this._specification=u,ki(this,Fl(this._parameters,this._specification))}static deserialize(s){return new Xc(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function qc(c){let s=null;if(c instanceof Uc)s=qc(c.result);else if(c instanceof Nc){for(const u of c.args)if(s=qc(u),s)break}else(c instanceof Bn||c instanceof xr)&&c.input instanceof Vt&&c.input.name==="zoom"&&(s=c);return s instanceof Xi||c.eachChild(u=>{const f=qc(u);f instanceof Xi?s=f:!s&&f?s=new Xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&f&&s!==f&&(s=new Xi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function ns(c){const s=c.key,u=c.value,f=c.valueSpec||{},g=c.objectElementValidators||{},v=c.style,w=c.styleSpec;let E=[];const I=nn(u);if(I!=="object")return[new $e(s,u,`object expected, ${I} found`)];for(const B in u){const O=B.split(".")[0],F=f[O]||f["*"];let G;if(g[O])G=g[O];else if(f[O])G=wr;else if(g["*"])G=g["*"];else{if(!f["*"]){E.push(new $e(s,u[B],`unknown property "${B}"`));continue}G=wr}E=E.concat(G({key:(s&&`${s}.`)+B,value:u[B],valueSpec:F,style:v,styleSpec:w,object:u,objectKey:B},u))}for(const B in f)g[B]||f[B].required&&f[B].default===void 0&&u[B]===void 0&&E.push(new $e(s,u,`missing required property "${B}"`));return E}function hp(c){const s=c.value,u=c.valueSpec,f=c.style,g=c.styleSpec,v=c.key,w=c.arrayElementValidator||wr;if(nn(s)!=="array")return[new $e(v,s,`array expected, ${nn(s)} found`)];if(u.length&&s.length!==u.length)return[new $e(v,s,`array length ${u.length} expected, length ${s.length} found`)];if(u["min-length"]&&s.length<u["min-length"])return[new $e(v,s,`array length at least ${u["min-length"]} expected, length ${s.length} found`)];let E={type:u.value,values:u.values};g.$version<7&&(E.function=u.function),nn(u.value)==="object"&&(E=u.value);let I=[];for(let B=0;B<s.length;B++)I=I.concat(w({array:s,arrayIndex:B,value:s[B],valueSpec:E,style:f,styleSpec:g,key:`${v}[${B}]`}));return I}function Oh(c){const s=c.key,u=c.value,f=c.valueSpec;let g=nn(u);return g==="number"&&u!=u&&(g="NaN"),g!=="number"?[new $e(s,u,`number expected, ${g} found`)]:"minimum"in f&&u<f.minimum?[new $e(s,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new $e(s,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function dp(c){const s=c.valueSpec,u=Gt(c.value.type);let f,g,v,w={};const E=u!=="categorical"&&c.value.property===void 0,I=!E,B=nn(c.value.stops)==="array"&&nn(c.value.stops[0])==="array"&&nn(c.value.stops[0][0])==="object",O=ns({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(X){if(u==="identity")return[new $e(X.key,X.value,'identity function may not have a "stops" property')];let $=[];const oe=X.value;return $=$.concat(hp({key:X.key,value:oe,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:F})),nn(oe)==="array"&&oe.length===0&&$.push(new $e(X.key,oe,"array must have at least one stop")),$},default:function(X){return wr({key:X.key,value:X.value,valueSpec:s,style:X.style,styleSpec:X.styleSpec})}}});return u==="identity"&&E&&O.push(new $e(c.key,c.value,'missing required property "property"')),u==="identity"||c.value.stops||O.push(new $e(c.key,c.value,'missing required property "stops"')),u==="exponential"&&c.valueSpec.expression&&!Wt(c.valueSpec)&&O.push(new $e(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(I&&!En(c.valueSpec)?O.push(new $e(c.key,c.value,"property functions not supported")):E&&!lp(c.valueSpec)&&O.push(new $e(c.key,c.value,"zoom functions not supported"))),u!=="categorical"&&!B||c.value.property!==void 0||O.push(new $e(c.key,c.value,'"property" property is required')),O;function F(X){let $=[];const oe=X.value,se=X.key;if(nn(oe)!=="array")return[new $e(se,oe,`array expected, ${nn(oe)} found`)];if(oe.length!==2)return[new $e(se,oe,`array length 2 expected, length ${oe.length} found`)];if(B){if(nn(oe[0])!=="object")return[new $e(se,oe,`object expected, ${nn(oe[0])} found`)];if(oe[0].zoom===void 0)return[new $e(se,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new $e(se,oe,"object stop key must have value")];if(v&&v>Gt(oe[0].zoom))return[new $e(se,oe[0].zoom,"stop zoom values must appear in ascending order")];Gt(oe[0].zoom)!==v&&(v=Gt(oe[0].zoom),g=void 0,w={}),$=$.concat(ns({key:`${se}[0]`,value:oe[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:Oh,value:G}}))}else $=$.concat(G({key:`${se}[0]`,value:oe[0],valueSpec:{},style:X.style,styleSpec:X.styleSpec},oe));return zl(ir(oe[1]))?$.concat([new $e(`${se}[1]`,oe[1],"expressions are not allowed in function stops.")]):$.concat(wr({key:`${se}[1]`,value:oe[1],valueSpec:s,style:X.style,styleSpec:X.styleSpec}))}function G(X,$){const oe=nn(X.value),se=Gt(X.value),ye=X.value!==null?X.value:$;if(f){if(oe!==f)return[new $e(X.key,ye,`${oe} stop domain type must match previous stop domain type ${f}`)]}else f=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new $e(X.key,ye,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&u!=="categorical"){let Te=`number expected, ${oe} found`;return En(s)&&u===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $e(X.key,ye,Te)]}return u!=="categorical"||oe!=="number"||isFinite(se)&&Math.floor(se)===se?u!=="categorical"&&oe==="number"&&g!==void 0&&se<g?[new $e(X.key,ye,"stop domain values must appear in ascending order")]:(g=se,u==="categorical"&&se in w?[new $e(X.key,ye,"stop domain values must be unique")]:(w[se]=!0,[])):[new $e(X.key,ye,`integer expected, found ${se}`)]}}function ea(c){const s=(c.expressionContext==="property"?up:Nl)(ir(c.value),c.valueSpec);if(s.result==="error")return s.value.map(f=>new $e(`${c.key}${f.key}`,c.value,f.message));const u=s.value.expression||s.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!u.outputDefined())return[new $e(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Q(u))return[new $e(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Q(u))return[new $e(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!ce(u,["zoom","feature-state"]))return[new $e(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!W(u))return[new $e(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Gl(c){const s=c.key,u=c.value,f=c.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(Gt(u))===-1&&g.push(new $e(s,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(Gt(u))===-1&&g.push(new $e(s,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),g}function Ha(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const s of c.slice(1))if(!Ha(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const N_={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function $c(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Ha(c)||(c=Vl(c));const s=Nl(c,N_);if(s.result==="error")throw new Error(s.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,g)=>s.value.evaluate(u,f,{},g),needGeometry:pp(c)}}function fp(c,s){return c<s?-1:c>s?1:0}function pp(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let s=1;s<c.length;s++)if(pp(c[s]))return!0;return!1}function Vl(c){if(!c)return!0;const s=c[0];return c.length<=1?s!=="any":s==="=="?kh(c[1],c[2],"=="):s==="!="?Wa(kh(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?kh(c[1],c[2],s):s==="any"?(u=c.slice(1),["any"].concat(u.map(Vl))):s==="all"?["all"].concat(c.slice(1).map(Vl)):s==="none"?["all"].concat(c.slice(1).map(Vl).map(Wa)):s==="in"?Zc(c[1],c.slice(2)):s==="!in"?Wa(Zc(c[1],c.slice(2))):s==="has"?jl(c[1]):s==="!has"?Wa(jl(c[1])):s!=="within"||c;var u}function kh(c,s,u){switch(c){case"$type":return[`filter-type-${u}`,s];case"$id":return[`filter-id-${u}`,s];default:return[`filter-${u}`,c,s]}}function Zc(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(u=>typeof u!=typeof s[0])?["filter-in-large",c,["literal",s.sort(fp)]]:["filter-in-small",c,["literal",s]]}}function jl(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Wa(c){return["!",c]}function Hl(c){return Ha(ir(c.value))?ea(ki({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):mp(c)}function mp(c){const s=c.value,u=c.key;if(nn(s)!=="array")return[new $e(u,s,`array expected, ${nn(s)} found`)];const f=c.styleSpec;let g,v=[];if(s.length<1)return[new $e(u,s,"filter array must have at least 1 element")];switch(v=v.concat(Gl({key:`${u}[0]`,value:s[0],valueSpec:f.filter_operator,style:c.style,styleSpec:c.styleSpec})),Gt(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&Gt(s[1])==="$type"&&v.push(new $e(u,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&v.push(new $e(u,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(g=nn(s[1]),g!=="string"&&v.push(new $e(`${u}[1]`,s[1],`string expected, ${g} found`)));for(let w=2;w<s.length;w++)g=nn(s[w]),Gt(s[1])==="$type"?v=v.concat(Gl({key:`${u}[${w}]`,value:s[w],valueSpec:f.geometry_type,style:c.style,styleSpec:c.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new $e(`${u}[${w}]`,s[w],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let w=1;w<s.length;w++)v=v.concat(mp({key:`${u}[${w}]`,value:s[w],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":g=nn(s[1]),s.length!==2?v.push(new $e(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new $e(`${u}[1]`,s[1],`string expected, ${g} found`));break;case"within":g=nn(s[1]),s.length!==2?v.push(new $e(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):g!=="object"&&v.push(new $e(`${u}[1]`,s[1],`object expected, ${g} found`))}return v}function Wl(c,s){const u=c.key,f=c.style,g=c.styleSpec,v=c.value,w=c.objectKey,E=g[`${s}_${c.layerType}`];if(!E)return[];const I=w.match(/^(.*)-transition$/);if(s==="paint"&&I&&E[I[1]]&&E[I[1]].transition)return wr({key:u,value:v,valueSpec:g.transition,style:f,styleSpec:g});const B=c.valueSpec||E[w];if(!B)return[new $e(u,v,`unknown property "${w}"`)];let O;if(nn(v)==="string"&&En(B)&&!B.tokens&&(O=/^{([^}]+)}$/.exec(v)))return[new $e(u,v,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const F=[];return c.layerType==="symbol"&&(w==="text-field"&&f&&!f.glyphs&&F.push(new $e(u,v,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&bn(ir(v))&&Gt(v.type)==="identity"&&F.push(new $e(u,v,'"text-font" does not support identity functions'))),F.concat(wr({key:c.key,value:v,valueSpec:B,style:f,styleSpec:g,expressionContext:"property",propertyType:s,propertyKey:w}))}function gp(c){return Wl(c,"paint")}function _p(c){return Wl(c,"layout")}function yp(c){let s=[];const u=c.value,f=c.key,g=c.style,v=c.styleSpec;u.type||u.ref||s.push(new $e(f,u,'either "type" or "ref" is required'));let w=Gt(u.type);const E=Gt(u.ref);if(u.id){const I=Gt(u.id);for(let B=0;B<c.arrayIndex;B++){const O=g.layers[B];Gt(O.id)===I&&s.push(new $e(f,u.id,`duplicate layer id "${u.id}", previously used at line ${O.id.__line__}`))}}if("ref"in u){let I;["type","source","source-layer","filter","layout"].forEach(B=>{B in u&&s.push(new $e(f,u[B],`"${B}" is prohibited for ref layers`))}),g.layers.forEach(B=>{Gt(B.id)===E&&(I=B)}),I?I.ref?s.push(new $e(f,u.ref,"ref cannot reference another ref layer")):w=Gt(I.type):s.push(new $e(f,u.ref,`ref layer "${E}" not found`))}else if(w!=="background")if(u.source){const I=g.sources&&g.sources[u.source],B=I&&Gt(I.type);I?B==="vector"&&w==="raster"?s.push(new $e(f,u.source,`layer "${u.id}" requires a raster source`)):B==="raster"&&w!=="raster"?s.push(new $e(f,u.source,`layer "${u.id}" requires a vector source`)):B!=="vector"||u["source-layer"]?B==="raster-dem"&&w!=="hillshade"?s.push(new $e(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!u.paint||!u.paint["line-gradient"]||B==="geojson"&&I.lineMetrics||s.push(new $e(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new $e(f,u,`layer "${u.id}" must specify a "source-layer"`)):s.push(new $e(f,u.source,`source "${u.source}" not found`))}else s.push(new $e(f,u,'missing required property "source"'));return s=s.concat(ns({key:f,value:u,valueSpec:v.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>wr({key:`${f}.type`,value:u.type,valueSpec:v.layer.type,style:c.style,styleSpec:c.styleSpec,object:u,objectKey:"type"}),filter:Hl,layout:I=>ns({layer:u,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":B=>_p(ki({layerType:w},B))}}),paint:I=>ns({layer:u,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":B=>gp(ki({layerType:w},B))}})}})),s}function Xa(c){const s=c.value,u=c.key,f=nn(s);return f!=="string"?[new $e(u,s,`string expected, ${f} found`)]:[]}const vp={promoteId:function({key:c,value:s}){if(nn(s)==="string")return Xa({key:c,value:s});{const u=[];for(const f in s)u.push(...Xa({key:`${c}.${f}`,value:s[f]}));return u}}};function Xl(c){const s=c.value,u=c.key,f=c.styleSpec,g=c.style;if(!s.type)return[new $e(u,s,'"type" is required')];const v=Gt(s.type);let w;switch(v){case"vector":case"raster":case"raster-dem":return w=ns({key:u,value:s,valueSpec:f[`source_${v.replace("-","_")}`],style:c.style,styleSpec:f,objectElementValidators:vp}),w;case"geojson":if(w=ns({key:u,value:s,valueSpec:f.source_geojson,style:g,styleSpec:f,objectElementValidators:vp}),s.cluster)for(const E in s.clusterProperties){const[I,B]=s.clusterProperties[E],O=typeof I=="string"?[I,["accumulated"],["get",E]]:I;w.push(...ea({key:`${u}.${E}.map`,value:B,expressionContext:"cluster-map"})),w.push(...ea({key:`${u}.${E}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return w;case"video":return ns({key:u,value:s,valueSpec:f.source_video,style:g,styleSpec:f});case"image":return ns({key:u,value:s,valueSpec:f.source_image,style:g,styleSpec:f});case"canvas":return[new $e(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gl({key:`${u}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:f})}}function ql(c){const s=c.value,u=c.styleSpec,f=u.light,g=c.style;let v=[];const w=nn(s);if(s===void 0)return v;if(w!=="object")return v=v.concat([new $e("light",s,`object expected, ${w} found`)]),v;for(const E in s){const I=E.match(/^(.*)-transition$/);v=v.concat(I&&f[I[1]]&&f[I[1]].transition?wr({key:E,value:s[E],valueSpec:u.transition,style:g,styleSpec:u}):f[E]?wr({key:E,value:s[E],valueSpec:f[E],style:g,styleSpec:u}):[new $e(E,s[E],`unknown property "${E}"`)])}return v}function br(c){const s=c.value,u=c.styleSpec,f=u.terrain,g=c.style;let v=[];const w=nn(s);if(s===void 0)return v;if(w!=="object")return v=v.concat([new $e("terrain",s,`object expected, ${w} found`)]),v;for(const E in s)v=v.concat(f[E]?wr({key:E,value:s[E],valueSpec:f[E],style:g,styleSpec:u}):[new $e(E,s[E],`unknown property "${E}"`)]);return v}const $l={"*":()=>[],array:hp,boolean:function(c){const s=c.value,u=c.key,f=nn(s);return f!=="boolean"?[new $e(u,s,`boolean expected, ${f} found`)]:[]},number:Oh,color:function(c){const s=c.key,u=c.value,f=nn(u);return f!=="string"?[new $e(s,u,`color expected, ${f} found`)]:Eo(u)===null?[new $e(s,u,`color expected, "${u}" found`)]:[]},constants:Ts,enum:Gl,filter:Hl,function:dp,layer:yp,object:ns,source:Xl,light:ql,terrain:br,string:Xa,formatted:function(c){return Xa(c).length===0?[]:ea(c)},resolvedImage:function(c){return Xa(c).length===0?[]:ea(c)},padding:function(c){const s=c.key,u=c.value;if(nn(u)==="array"){if(u.length<1||u.length>4)return[new $e(s,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let g=[];for(let v=0;v<u.length;v++)g=g.concat(wr({key:`${s}[${v}]`,value:u[v],valueSpec:f}));return g}return Oh({key:s,value:u,valueSpec:{}})}};function wr(c){const s=c.value,u=c.valueSpec,f=c.styleSpec;return u.expression&&bn(Gt(s))?dp(c):u.expression&&zl(ir(s))?ea(c):u.type&&$l[u.type]?$l[u.type](c):ns(ki({},c,{valueSpec:u.type?f[u.type]:u}))}function U_(c){const s=c.value,u=c.key,f=Xa(c);return f.length||(s.indexOf("{fontstack}")===-1&&f.push(new $e(u,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&f.push(new $e(u,s,'"glyphs" url must include a "{range}" token'))),f}function So(c,s=Be){let u=[];return u=u.concat(wr({key:"",value:c,valueSpec:s.$root,styleSpec:s,style:c,objectElementValidators:{glyphs:U_,"*":()=>[]}})),c.constants&&(u=u.concat(Ts({key:"constants",value:c.constants,style:c,styleSpec:s}))),xp(u)}function xp(c){return[].concat(c).sort((s,u)=>s.line-u.line)}function Js(c){return function(...s){return xp(c.apply(this,s))}}So.source=Js(Xl),So.light=Js(ql),So.terrain=Js(br),So.layer=Js(yp),So.filter=Js(Hl),So.paintProperty=Js(gp),So.layoutProperty=Js(_p);const Zl=So,Fh=Zl.light,G_=Zl.paintProperty,V_=Zl.layoutProperty;function Jc(c,s){let u=!1;if(s&&s.length)for(const f of s)c.fire(new bo(new Error(f.message))),u=!0;return u}class Jl{constructor(s,u,f){const g=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const w=new Int32Array(this.arrayBuffer);s=w[0],this.d=(u=w[1])+2*(f=w[2]);for(let I=0;I<this.d*this.d;I++){const B=w[3+I],O=w[3+I+1];g.push(B===O?null:w.subarray(B,O))}const E=w[3+g.length+1];this.keys=w.subarray(w[3+g.length],E),this.bboxes=w.subarray(E),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let w=0;w<this.d*this.d;w++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=f,this.scale=u/s,this.uid=0;const v=f/u*s;this.min=-v,this.max=s+v}insert(s,u,f,g,v){this._forEachCell(u,f,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,u,f,g,v,w){this.cells[v].push(w)}query(s,u,f,g,v){const w=this.min,E=this.max;if(s<=w&&u<=w&&E<=f&&E<=g&&!v)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(s,u,f,g,this._queryCell,I,{},v),I}}_queryCell(s,u,f,g,v,w,E,I){const B=this.cells[v];if(B!==null){const O=this.keys,F=this.bboxes;for(let G=0;G<B.length;G++){const X=B[G];if(E[X]===void 0){const $=4*X;(I?I(F[$+0],F[$+1],F[$+2],F[$+3]):s<=F[$+2]&&u<=F[$+3]&&f>=F[$+0]&&g>=F[$+1])?(E[X]=!0,w.push(O[X])):E[X]=!1}}}}_forEachCell(s,u,f,g,v,w,E,I){const B=this._convertToCellCoord(s),O=this._convertToCellCoord(u),F=this._convertToCellCoord(f),G=this._convertToCellCoord(g);for(let X=B;X<=F;X++)for(let $=O;$<=G;$++){const oe=this.d*$+X;if((!I||I(this._convertFromCellCoord(X),this._convertFromCellCoord($),this._convertFromCellCoord(X+1),this._convertFromCellCoord($+1)))&&v.call(this,s,u,f,g,oe,w,E,I))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,u=3+this.cells.length+1+1;let f=0;for(let w=0;w<this.cells.length;w++)f+=this.cells[w].length;const g=new Int32Array(u+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=u;for(let w=0;w<s.length;w++){const E=s[w];g[3+w]=v,g.set(E,v),v+=E.length}return g[3+s.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+s.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(s,u){const f=s.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(s){return new Jl(s.buffer)}}const Ks={};function at(c,s,u={}){if(Ks[c])throw new Error(`${c} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:c,writeable:!1}),Ks[c]={klass:s,omit:u.omit||[],shallow:u.shallow||[]}}at("Object",Object),at("TransferableGridIndex",Jl),at("Color",Y),at("Error",Error),at("AJAXError",ai),at("ResolvedImage",me),at("StylePropertyFunction",Xc),at("StyleExpression",Wc,{omit:["_evaluator"]}),at("ZoomDependentExpression",Dh),at("ZoomConstantExpression",Ul),at("CompoundExpression",Vt,{omit:["_evaluate"]});for(const c in Ga)Ga[c]._classRegistryKey||at(`Expression_${c}`,Ga[c]);function bp(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function ta(c,s){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob)return c;if(bp(c)||Lt(c))return s&&s.push(c),c;if(ArrayBuffer.isView(c)){const u=c;return s&&s.push(u.buffer),u}if(c instanceof ImageData)return s&&s.push(c.data.buffer),c;if(Array.isArray(c)){const u=[];for(const f of c)u.push(ta(f,s));return u}if(typeof c=="object"){const u=c.constructor,f=u._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");if(!Ks[f])throw new Error(`${f} is not registered.`);const g=u.serialize?u.serialize(c,s):{};if(u.serialize){if(s&&g===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in c){if(!c.hasOwnProperty(v)||Ks[f].omit.indexOf(v)>=0)continue;const w=c[v];g[v]=Ks[f].shallow.indexOf(v)>=0?w:ta(w,s)}c instanceof Error&&(g.message=c.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof c)}function Co(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||bp(c)||Lt(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Co);if(typeof c=="object"){const s=c.$name||"Object";if(!Ks[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:u}=Ks[s];if(!u)throw new Error(`can't deserialize unregistered class ${s}`);if(u.deserialize)return u.deserialize(c);const f=Object.create(u.prototype);for(const g of Object.keys(c)){if(g==="$name")continue;const v=c[g];f[g]=Ks[s].shallow.indexOf(g)>=0?v:Co(v)}return f}throw new Error("can't deserialize object of type "+typeof c)}class zh{constructor(){this.first=!0}update(s,u){const f=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=f,!0))}}const et={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Kc(c){for(const s of c)if(Uh(s.charCodeAt(0)))return!0;return!1}function j_(c){for(const s of c)if(!Nh(s.charCodeAt(0)))return!1;return!0}function Nh(c){return!(et.Arabic(c)||et["Arabic Supplement"](c)||et["Arabic Extended-A"](c)||et["Arabic Presentation Forms-A"](c)||et["Arabic Presentation Forms-B"](c))}function Uh(c){return!(c!==746&&c!==747&&(c<4352||!(et["Bopomofo Extended"](c)||et.Bopomofo(c)||et["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||et["CJK Compatibility Ideographs"](c)||et["CJK Compatibility"](c)||et["CJK Radicals Supplement"](c)||et["CJK Strokes"](c)||!(!et["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||et["CJK Unified Ideographs Extension A"](c)||et["CJK Unified Ideographs"](c)||et["Enclosed CJK Letters and Months"](c)||et["Hangul Compatibility Jamo"](c)||et["Hangul Jamo Extended-A"](c)||et["Hangul Jamo Extended-B"](c)||et["Hangul Jamo"](c)||et["Hangul Syllables"](c)||et.Hiragana(c)||et["Ideographic Description Characters"](c)||et.Kanbun(c)||et["Kangxi Radicals"](c)||et["Katakana Phonetic Extensions"](c)||et.Katakana(c)&&c!==12540||!(!et["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!et["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||et["Unified Canadian Aboriginal Syllabics"](c)||et["Unified Canadian Aboriginal Syllabics Extended"](c)||et["Vertical Forms"](c)||et["Yijing Hexagram Symbols"](c)||et["Yi Syllables"](c)||et["Yi Radicals"](c))))}function wp(c){return!(Uh(c)||function(s){return!!(et["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||et["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||et["Letterlike Symbols"](s)||et["Number Forms"](s)||et["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||et["Control Pictures"](s)&&s!==9251||et["Optical Character Recognition"](s)||et["Enclosed Alphanumerics"](s)||et["Geometric Shapes"](s)||et["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||et["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||et["CJK Symbols and Punctuation"](s)||et.Katakana(s)||et["Private Use Area"](s)||et["CJK Compatibility Forms"](s)||et["Small Form Variants"](s)||et["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(c))}function Ap(c){return c>=1424&&c<=2303||et["Arabic Presentation Forms-A"](c)||et["Arabic Presentation Forms-B"](c)}function H_(c,s){return!(!s&&Ap(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||et.Khmer(c))}function Ep(c){for(const s of c)if(Ap(s.charCodeAt(0)))return!0;return!1}const Gh="deferred",Vh="loading",jh="loaded";let Hh=null,rr="unavailable",Io=null;const Tp=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(rr="error"),Hh&&Hh(c)};function qa(){Wh.fire(new Yr("pluginStateChange",{pluginStatus:rr,pluginURL:Io}))}const Wh=new Dr,Kl=function(){return rr},Sp=function(){if(rr!==Gh||!Io)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");rr=Vh,qa(),Io&&nr({url:Io},c=>{c?Tp(c):(rr=jh,qa())})},Fr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>rr===jh||Fr.applyArabicShaping!=null,isLoading:()=>rr===Vh,setState(c){if(!Fe())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");rr=c.pluginStatus,Io=c.pluginURL},isParsed(){if(!Fe())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Fr.applyArabicShaping!=null&&Fr.processBidirectionalText!=null&&Fr.processStyledBidirectionalText!=null},getPluginURL(){if(!Fe())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Io}};class In{constructor(s,u){this.zoom=s,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new zh,this.transition={})}isSupportedScript(s){return function(u,f){for(const g of u)if(!H_(g.charCodeAt(0),f))return!1;return!0}(s,Fr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,u=s-Math.floor(s),f=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class Yl{constructor(s,u){this.property=s,this.value=u,this.expression=function(f,g){if(bn(f))return new Xc(f,g);if(zl(f)){const v=up(f,g);if(v.result==="error")throw new Error(v.value.map(w=>`${w.key}: ${w.message}`).join(", "));return v.value}{let v=f;return g.type==="color"&&typeof f=="string"?v=Y.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)||(v=ae.parse(f)),{kind:"constant",evaluate:()=>v}}}(u===void 0?s.specification.default:u,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,u,f){return this.property.possiblyEvaluate(this,s,u,f)}}class Yc{constructor(s){this.property=s,this.value=new Yl(s,void 0)}transitioned(s,u){return new Ip(this.property,this.value,u,V({},s.transition,this.transition),s.now)}untransitioned(){return new Ip(this.property,this.value,null,{},0)}}class Cp{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return K(this._values[s].value.value)}setValue(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Yc(this._values[s].property)),this._values[s].value=new Yl(this._values[s].property,u===null?void 0:K(u))}getTransition(s){return K(this._values[s].transition)}setTransition(s,u){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Yc(this._values[s].property)),this._values[s].transition=K(u)||void 0}serialize(){const s={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(s[u]=f);const g=this.getTransition(u);g!==void 0&&(s[`${u}-transition`]=g)}return s}transitioned(s,u){const f=new Mp(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(s,u._values[g]);return f}untransitioned(){const s=new Mp(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].untransitioned();return s}}class Ip{constructor(s,u,f,g,v){this.property=s,this.value=u,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,s.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(s,u,f){const g=s.now||0,v=this.value.possiblyEvaluate(s,u,f),w=this.prior;if(w){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return w.possiblyEvaluate(s,u,f);{const E=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(s,u,f),v,function(I){if(I<=0)return 0;if(I>=1)return 1;const B=I*I,O=B*I;return 4*(I<.5?O:3*(I-B)+O-.75)}(E))}}return v}}class Mp{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,u,f){const g=new Ql(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(s,u,f);return g}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class W_{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}getValue(s){return K(this._values[s].value)}setValue(s,u){this._values[s]=new Yl(this._values[s].property,u===null?void 0:K(u))}serialize(){const s={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(s[u]=f)}return s}possiblyEvaluate(s,u,f){const g=new Ql(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(s,u,f);return g}}class Is{constructor(s,u,f){this.property=s,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,u,f,g){return this.property.evaluate(this.value,this.parameters,s,u,f,g)}}class Ql{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class ft{constructor(s){this.specification=s}possiblyEvaluate(s,u){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(u)}interpolate(s,u,f){const g=Xn[this.specification.type];return g?g(s,u,f):s}}class Tt{constructor(s,u){this.specification=s,this.overrides=u}possiblyEvaluate(s,u,f,g){return new Is(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(u,null,{},f,g)}:s.expression,u)}interpolate(s,u,f){if(s.value.kind!=="constant"||u.value.kind!=="constant")return s;if(s.value.value===void 0||u.value.value===void 0)return new Is(this,{kind:"constant",value:void 0},s.parameters);const g=Xn[this.specification.type];return g?new Is(this,{kind:"constant",value:g(s.value.value,u.value.value,f)},s.parameters):s}evaluate(s,u,f,g,v,w){return s.kind==="constant"?s.value:s.evaluate(u,f,g,v,w)}}class $a extends Tt{possiblyEvaluate(s,u,f,g){if(s.value===void 0)return new Is(this,{kind:"constant",value:void 0},u);if(s.expression.kind==="constant"){const v=s.expression.evaluate(u,null,{},f,g),w=s.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,E=this._calculate(w,w,w,u);return new Is(this,{kind:"constant",value:E},u)}if(s.expression.kind==="camera"){const v=this._calculate(s.expression.evaluate({zoom:u.zoom-1}),s.expression.evaluate({zoom:u.zoom}),s.expression.evaluate({zoom:u.zoom+1}),u);return new Is(this,{kind:"constant",value:v},u)}return new Is(this,s.expression,u)}evaluate(s,u,f,g,v,w){if(s.kind==="source"){const E=s.evaluate(u,f,g,v,w);return this._calculate(E,E,E,u)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(u.zoom)-1},f,g),s.evaluate({zoom:Math.floor(u.zoom)},f,g),s.evaluate({zoom:Math.floor(u.zoom)+1},f,g),u):s.value}_calculate(s,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:f,to:u}}interpolate(s){return s}}class Xh{constructor(s){this.specification=s}possiblyEvaluate(s,u,f,g){if(s.value!==void 0){if(s.expression.kind==="constant"){const v=s.expression.evaluate(u,null,{},f,g);return this._calculate(v,v,v,u)}return this._calculate(s.expression.evaluate(new In(Math.floor(u.zoom-1),u)),s.expression.evaluate(new In(Math.floor(u.zoom),u)),s.expression.evaluate(new In(Math.floor(u.zoom+1),u)),u)}}_calculate(s,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:f,to:u}}interpolate(s){return s}}class Mo{constructor(s){this.specification=s}possiblyEvaluate(s,u,f,g){return!!s.expression.evaluate(u,null,{},f,g)}interpolate(){return!1}}class Ci{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in s){const f=s[u];f.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new Yl(f,void 0),v=this.defaultTransitionablePropertyValues[u]=new Yc(f);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate({})}}}at("DataDrivenProperty",Tt),at("DataConstantProperty",ft),at("CrossFadedDataDrivenProperty",$a),at("CrossFadedProperty",Xh),at("ColorRampProperty",Mo);const Po="-transition";class Ms extends Dr{constructor(s,u){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),u.layout&&(this._unevaluatedLayout=new W_(u.layout)),u.paint)){this._transitionablePaint=new Cp(u.paint);for(const f in s.paint)this.setPaintProperty(f,s.paint[f],{validate:!1});for(const f in s.layout)this.setLayoutProperty(f,s.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ql(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,u,f={}){u!=null&&this._validate(V_,`layers.${this.id}.layout.${s}`,s,u,f)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,u):this.visibility=u)}getPaintProperty(s){return s.endsWith(Po)?this._transitionablePaint.getTransition(s.slice(0,-Po.length)):this._transitionablePaint.getValue(s)}setPaintProperty(s,u,f={}){if(u!=null&&this._validate(G_,`layers.${this.id}.paint.${s}`,s,u,f))return!1;if(s.endsWith(Po))return this._transitionablePaint.setTransition(s.slice(0,-Po.length),u||void 0),!1;{const g=this._transitionablePaint._values[s],v=g.property.specification["property-type"]==="cross-faded-data-driven",w=g.value.isDataDriven(),E=g.value;this._transitionablePaint.setValue(s,u),this._handleSpecialPaintPropertyUpdate(s);const I=this._transitionablePaint._values[s].value;return I.isDataDriven()||w||v||this._handleOverridablePaintPropertyUpdate(s,E,I)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,u,f){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,u){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,u)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),j(s,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(s,u,f,g,v={}){return(!v||v.validate!==!1)&&Jc(this,s.call(Zl,{key:u,layerType:this.type,objectKey:f,value:g,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const u=this.paint.get(s);if(u instanceof Is&&En(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const Pp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bo{constructor(s,u){this._structArray=s,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Un{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,u){return s._trim(),u&&(s.isTransferred=!0,u.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const u=Object.create(this.prototype);return u.arrayBuffer=s.arrayBuffer,u.length=s.length,u.capacity=s.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ei(c,s=1){let u=0,f=0;return{members:c.map(g=>{const v=Pp[g.type].BYTES_PER_ELEMENT,w=u=qh(u,Math.max(s,v)),E=g.components||1;return f=Math.max(f,v),u+=v*E,{name:g.name,type:g.type,components:E,offset:w}}),size:qh(u,Math.max(f,s)),alignment:s}}function qh(c,s){return Math.ceil(c/s)*s}class na extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const g=2*s;return this.int16[g+0]=u,this.int16[g+1]=f,s}}na.prototype.bytesPerElement=4,at("StructArrayLayout2i4",na);class m extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,s,u,f,g)}emplace(s,u,f,g,v){const w=4*s;return this.int16[w+0]=u,this.int16[w+1]=f,this.int16[w+2]=g,this.int16[w+3]=v,s}}m.prototype.bytesPerElement=8,at("StructArrayLayout4i8",m);class o extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,g,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,s,u,f,g,v,w)}emplace(s,u,f,g,v,w,E){const I=6*s;return this.int16[I+0]=u,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=v,this.int16[I+4]=w,this.int16[I+5]=E,s}}o.prototype.bytesPerElement=12,at("StructArrayLayout2i4i12",o);class d extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,g,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,s,u,f,g,v,w)}emplace(s,u,f,g,v,w,E){const I=4*s,B=8*s;return this.int16[I+0]=u,this.int16[I+1]=f,this.uint8[B+4]=g,this.uint8[B+5]=v,this.uint8[B+6]=w,this.uint8[B+7]=E,s}}d.prototype.bytesPerElement=8,at("StructArrayLayout2i4ub8",d);class p extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const g=2*s;return this.float32[g+0]=u,this.float32[g+1]=f,s}}p.prototype.bytesPerElement=8,at("StructArrayLayout2f8",p);class _ extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,g,v,w,E,I,B,O){const F=this.length;return this.resize(F+1),this.emplace(F,s,u,f,g,v,w,E,I,B,O)}emplace(s,u,f,g,v,w,E,I,B,O,F){const G=10*s;return this.uint16[G+0]=u,this.uint16[G+1]=f,this.uint16[G+2]=g,this.uint16[G+3]=v,this.uint16[G+4]=w,this.uint16[G+5]=E,this.uint16[G+6]=I,this.uint16[G+7]=B,this.uint16[G+8]=O,this.uint16[G+9]=F,s}}_.prototype.bytesPerElement=20,at("StructArrayLayout10ui20",_);class b extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,g,v,w,E,I,B,O,F,G){const X=this.length;return this.resize(X+1),this.emplace(X,s,u,f,g,v,w,E,I,B,O,F,G)}emplace(s,u,f,g,v,w,E,I,B,O,F,G,X){const $=12*s;return this.int16[$+0]=u,this.int16[$+1]=f,this.int16[$+2]=g,this.int16[$+3]=v,this.uint16[$+4]=w,this.uint16[$+5]=E,this.uint16[$+6]=I,this.uint16[$+7]=B,this.int16[$+8]=O,this.int16[$+9]=F,this.int16[$+10]=G,this.int16[$+11]=X,s}}b.prototype.bytesPerElement=24,at("StructArrayLayout4i4ui4i24",b);class A extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,u,f)}emplace(s,u,f,g){const v=3*s;return this.float32[v+0]=u,this.float32[v+1]=f,this.float32[v+2]=g,s}}A.prototype.bytesPerElement=12,at("StructArrayLayout3f12",A);class M extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint32[1*s+0]=u,s}}M.prototype.bytesPerElement=4,at("StructArrayLayout1ul4",M);class P extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f,g,v,w,E,I,B){const O=this.length;return this.resize(O+1),this.emplace(O,s,u,f,g,v,w,E,I,B)}emplace(s,u,f,g,v,w,E,I,B,O){const F=10*s,G=5*s;return this.int16[F+0]=u,this.int16[F+1]=f,this.int16[F+2]=g,this.int16[F+3]=v,this.int16[F+4]=w,this.int16[F+5]=E,this.uint32[G+3]=I,this.uint16[F+8]=B,this.uint16[F+9]=O,s}}P.prototype.bytesPerElement=20,at("StructArrayLayout6i1ul2ui20",P);class R extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,g,v,w){const E=this.length;return this.resize(E+1),this.emplace(E,s,u,f,g,v,w)}emplace(s,u,f,g,v,w,E){const I=6*s;return this.int16[I+0]=u,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=v,this.int16[I+4]=w,this.int16[I+5]=E,s}}R.prototype.bytesPerElement=12,at("StructArrayLayout2i2i2i12",R);class k extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,s,u,f,g,v)}emplace(s,u,f,g,v,w){const E=4*s,I=8*s;return this.float32[E+0]=u,this.float32[E+1]=f,this.float32[E+2]=g,this.int16[I+6]=v,this.int16[I+7]=w,s}}k.prototype.bytesPerElement=16,at("StructArrayLayout2f1f2i16",k);class U extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,s,u,f,g)}emplace(s,u,f,g,v){const w=12*s,E=3*s;return this.uint8[w+0]=u,this.uint8[w+1]=f,this.float32[E+1]=g,this.float32[E+2]=v,s}}U.prototype.bytesPerElement=12,at("StructArrayLayout2ub2f12",U);class H extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,u,f)}emplace(s,u,f,g){const v=3*s;return this.uint16[v+0]=u,this.uint16[v+1]=f,this.uint16[v+2]=g,s}}H.prototype.bytesPerElement=6,at("StructArrayLayout3ui6",H);class ie extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,g,v,w,E,I,B,O,F,G,X,$,oe,se,ye){const Te=this.length;return this.resize(Te+1),this.emplace(Te,s,u,f,g,v,w,E,I,B,O,F,G,X,$,oe,se,ye)}emplace(s,u,f,g,v,w,E,I,B,O,F,G,X,$,oe,se,ye,Te){const _e=24*s,Ae=12*s,ke=48*s;return this.int16[_e+0]=u,this.int16[_e+1]=f,this.uint16[_e+2]=g,this.uint16[_e+3]=v,this.uint32[Ae+2]=w,this.uint32[Ae+3]=E,this.uint32[Ae+4]=I,this.uint16[_e+10]=B,this.uint16[_e+11]=O,this.uint16[_e+12]=F,this.float32[Ae+7]=G,this.float32[Ae+8]=X,this.uint8[ke+36]=$,this.uint8[ke+37]=oe,this.uint8[ke+38]=se,this.uint32[Ae+10]=ye,this.int16[_e+22]=Te,s}}ie.prototype.bytesPerElement=48,at("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ie);class te extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,g,v,w,E,I,B,O,F,G,X,$,oe,se,ye,Te,_e,Ae,ke,Oe,st,ht,tt,Je,We,nt){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,s,u,f,g,v,w,E,I,B,O,F,G,X,$,oe,se,ye,Te,_e,Ae,ke,Oe,st,ht,tt,Je,We,nt)}emplace(s,u,f,g,v,w,E,I,B,O,F,G,X,$,oe,se,ye,Te,_e,Ae,ke,Oe,st,ht,tt,Je,We,nt,Ye){const Ve=34*s,wt=17*s;return this.int16[Ve+0]=u,this.int16[Ve+1]=f,this.int16[Ve+2]=g,this.int16[Ve+3]=v,this.int16[Ve+4]=w,this.int16[Ve+5]=E,this.int16[Ve+6]=I,this.int16[Ve+7]=B,this.uint16[Ve+8]=O,this.uint16[Ve+9]=F,this.uint16[Ve+10]=G,this.uint16[Ve+11]=X,this.uint16[Ve+12]=$,this.uint16[Ve+13]=oe,this.uint16[Ve+14]=se,this.uint16[Ve+15]=ye,this.uint16[Ve+16]=Te,this.uint16[Ve+17]=_e,this.uint16[Ve+18]=Ae,this.uint16[Ve+19]=ke,this.uint16[Ve+20]=Oe,this.uint16[Ve+21]=st,this.uint16[Ve+22]=ht,this.uint32[wt+12]=tt,this.float32[wt+13]=Je,this.float32[wt+14]=We,this.float32[wt+15]=nt,this.float32[wt+16]=Ye,s}}te.prototype.bytesPerElement=68,at("StructArrayLayout8i15ui1ul4f68",te);class ne extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.float32[1*s+0]=u,s}}ne.prototype.bytesPerElement=4,at("StructArrayLayout1f4",ne);class fe extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,u,f)}emplace(s,u,f,g){const v=3*s;return this.int16[v+0]=u,this.int16[v+1]=f,this.int16[v+2]=g,s}}fe.prototype.bytesPerElement=6,at("StructArrayLayout3i6",fe);class ge extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,s,u,f)}emplace(s,u,f,g){const v=4*s;return this.uint32[2*s+0]=u,this.uint16[v+2]=f,this.uint16[v+3]=g,s}}ge.prototype.bytesPerElement=8,at("StructArrayLayout1ul2ui8",ge);class xe extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,u){const f=this.length;return this.resize(f+1),this.emplace(f,s,u)}emplace(s,u,f){const g=2*s;return this.uint16[g+0]=u,this.uint16[g+1]=f,s}}xe.prototype.bytesPerElement=4,at("StructArrayLayout2ui4",xe);class re extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const u=this.length;return this.resize(u+1),this.emplace(u,s)}emplace(s,u){return this.uint16[1*s+0]=u,s}}re.prototype.bytesPerElement=2,at("StructArrayLayout1ui2",re);class Ee extends Un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,s,u,f,g)}emplace(s,u,f,g,v){const w=4*s;return this.float32[w+0]=u,this.float32[w+1]=f,this.float32[w+2]=g,this.float32[w+3]=v,s}}Ee.prototype.bytesPerElement=16,at("StructArrayLayout4f16",Ee);class be extends Bo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new yt(this.anchorPointX,this.anchorPointY)}}be.prototype.size=20;class Le extends P{get(s){return new be(this,s)}}at("CollisionBoxArray",Le);class Re extends Bo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Re.prototype.size=48;class Ue extends ie{get(s){return new Re(this,s)}}at("PlacedSymbolArray",Ue);class Pe extends Bo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Pe.prototype.size=68;class it extends te{get(s){return new Pe(this,s)}}at("SymbolInstanceArray",it);class Ze extends ne{getoffsetX(s){return this.float32[1*s+0]}}at("GlyphOffsetArray",Ze);class rt extends fe{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}at("SymbolLineVertexArray",rt);class Bt extends Bo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Bt.prototype.size=8;class Ot extends ge{get(s){return new Bt(this,s)}}at("FeatureIndexArray",Ot);class bt extends na{}class ln extends na{}class cn extends na{}class qt extends o{}class Zt extends d{}class fn extends p{}class _i extends _{}class Ps extends b{}class is extends A{}class Bs extends M{}class Lo extends R{}class zr extends U{}class sr extends H{}class Ys extends xe{}const Qc=ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:ui}=Qc;class Ut{constructor(s=[]){this.segments=s}prepareSegment(s,u,f,g){let v=this.segments[this.segments.length-1];return s>Ut.MAX_VERTEX_ARRAY_LENGTH&&ve(`Max vertices per segment is ${Ut.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!v||v.vertexLength+s>Ut.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g)&&(v={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(v.sortKey=g),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const s of this.segments)for(const u in s.vaos)s.vaos[u].destroy()}static simpleSegment(s,u,f,g){return new Ut([{vertexOffset:s,primitiveOffset:u,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function an(c,s){return 256*(c=S(Math.floor(c),0,255))+S(Math.floor(s),0,255)}Ut.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,at("SegmentVector",Ut);const yi=ei([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var vi={exports:{}},Mn={exports:{}};Mn.exports=function(c,s){var u,f,g,v,w,E,I,B;for(f=c.length-(u=3&c.length),g=s,w=3432918353,E=461845907,B=0;B<f;)I=255&c.charCodeAt(B)|(255&c.charCodeAt(++B))<<8|(255&c.charCodeAt(++B))<<16|(255&c.charCodeAt(++B))<<24,++B,g=27492+(65535&(v=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*E+(((I>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(I=0,u){case 3:I^=(255&c.charCodeAt(B+2))<<16;case 2:I^=(255&c.charCodeAt(B+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&c.charCodeAt(B)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*E+(((I>>>16)*E&65535)<<16)&4294967295}return g^=c.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Nr={exports:{}};Nr.exports=function(c,s){for(var u,f=c.length,g=s^f,v=0;f>=4;)u=1540483477*(65535&(u=255&c.charCodeAt(v)|(255&c.charCodeAt(++v))<<8|(255&c.charCodeAt(++v))<<16|(255&c.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:g^=(255&c.charCodeAt(v+2))<<16;case 2:g^=(255&c.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&c.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var ia=Mn.exports,$h=Nr.exports;vi.exports=ia,vi.exports.murmur3=ia,vi.exports.murmur2=$h;class Za{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,u,f,g){this.ids.push(Bp(s)),this.positions.push(u,f,g)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Bp(s);let f=0,g=this.ids.length-1;for(;f<g;){const w=f+g>>1;this.ids[w]>=u?g=w:f=w+1}const v=[];for(;this.ids[f]===u;)v.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return v}static serialize(s,u){const f=new Float64Array(s.ids),g=new Uint32Array(s.positions);return Zh(f,g,0,f.length-1),u&&u.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(s){const u=new Za;return u.ids=s.ids,u.positions=s.positions,u.indexed=!0,u}}function Bp(c){const s=+c;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:vi.exports(String(c))}function Zh(c,s,u,f){for(;u<f;){const g=c[u+f>>1];let v=u-1,w=f+1;for(;;){do v++;while(c[v]<g);do w--;while(c[w]>g);if(v>=w)break;Ro(c,v,w),Ro(s,3*v,3*w),Ro(s,3*v+1,3*w+1),Ro(s,3*v+2,3*w+2)}w-u<f-w?(Zh(c,s,u,w),u=w+1):(Zh(c,s,w+1,f),f=w)}}function Ro(c,s,u){const f=c[s];c[s]=c[u],c[u]=f}at("FeaturePositionMap",Za);class ra{constructor(s,u){this.gl=s.gl,this.location=u}}class sa extends ra{constructor(s,u){super(s,u),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class eu extends ra{constructor(s,u){super(s,u),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class jb extends ra{constructor(s,u){super(s,u),this.current=Y.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const uL=new Float32Array(16);function X_(c){return[an(255*c.r,255*c.g),an(255*c.b,255*c.a)]}class Jh{constructor(s,u,f){this.value=s,this.uniformNames=u.map(g=>`u_${g}`),this.type=f}setUniform(s,u,f){s.set(f.constantOr(this.value))}getBinding(s,u,f){return this.type==="color"?new jb(s,u):new sa(s,u)}}class tu{constructor(s,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=s.tlbr}setUniform(s,u,f,g){const v=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&s.set(v)}getBinding(s,u,f){return f.substr(0,9)==="u_pattern"?new eu(s,u):new sa(s,u)}}class oa{constructor(s,u,f,g){this.expression=s,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(v=>({name:`a_${v}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(s,u,f,g,v){const w=this.paintVertexArray.length,E=this.expression.evaluate(new In(0),u,{},g,[],v);this.paintVertexArray.resize(s),this._setPaintValue(w,s,E)}updatePaintArray(s,u,f,g){const v=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(s,u,v)}_setPaintValue(s,u,f){if(this.type==="color"){const g=X_(f);for(let v=s;v<u;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=s;g<u;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qs{constructor(s,u,f,g,v,w){this.expression=s,this.uniformNames=u.map(E=>`u_${E}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=u.map(E=>({name:`a_${E}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(s,u,f,g,v){const w=this.expression.evaluate(new In(this.zoom),u,{},g,[],v),E=this.expression.evaluate(new In(this.zoom+1),u,{},g,[],v),I=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(I,s,w,E)}updatePaintArray(s,u,f,g){const v=this.expression.evaluate({zoom:this.zoom},f,g),w=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(s,u,v,w)}_setPaintValue(s,u,f,g){if(this.type==="color"){const v=X_(f),w=X_(g);for(let E=s;E<u;E++)this.paintVertexArray.emplace(E,v[0],v[1],w[0],w[1])}else{for(let v=s;v<u;v++)this.paintVertexArray.emplace(v,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,g=S(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);s.set(g)}getBinding(s,u,f){return new sa(s,u)}}class Ja{constructor(s,u,f,g,v,w){this.expression=s,this.type=u,this.useIntegerZoom=f,this.zoom=g,this.layerId=w,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(s,u,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(g,s,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(s,u,f,g,v){this._setPaintValues(s,u,f.patterns&&f.patterns[this.layerId],v)}_setPaintValues(s,u,f,g){if(!g||!f)return;const{min:v,mid:w,max:E}=f,I=g[v],B=g[w],O=g[E];if(I&&B&&O)for(let F=s;F<u;F++)this.zoomInPaintVertexArray.emplace(F,B.tl[0],B.tl[1],B.br[0],B.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],B.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,B.tl[0],B.tl[1],B.br[0],B.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],B.pixelRatio,O.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,yi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,yi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Hb{constructor(s,u,f){this.binders={},this._buffers=[];const g=[];for(const v in s.paint._values){if(!f(v))continue;const w=s.paint.get(v);if(!(w instanceof Is&&En(w.property.specification)))continue;const E=hL(v,s.type),I=w.value,B=w.property.specification.type,O=w.property.useIntegerZoom,F=w.property.specification["property-type"],G=F==="cross-faded"||F==="cross-faded-data-driven";if(I.kind==="constant")this.binders[v]=G?new tu(I.value,E):new Jh(I.value,E,B),g.push(`/u_${v}`);else if(I.kind==="source"||G){const X=Wb(v,B,"source");this.binders[v]=G?new Ja(I,B,O,u,X,s.id):new oa(I,E,B,X),g.push(`/a_${v}`)}else{const X=Wb(v,B,"composite");this.binders[v]=new Qs(I,E,B,O,u,X),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(s){const u=this.binders[s];return u instanceof oa||u instanceof Qs?u.maxValue:0}populatePaintArrays(s,u,f,g,v){for(const w in this.binders){const E=this.binders[w];(E instanceof oa||E instanceof Qs||E instanceof Ja)&&E.populatePaintArray(s,u,f,g,v)}}setConstantPatternPositions(s,u){for(const f in this.binders){const g=this.binders[f];g instanceof tu&&g.setConstantPatternPositions(s,u)}}updatePaintArrays(s,u,f,g,v){let w=!1;for(const E in s){const I=u.getPositions(E);for(const B of I){const O=f.feature(B.index);for(const F in this.binders){const G=this.binders[F];if((G instanceof oa||G instanceof Qs||G instanceof Ja)&&G.expression.isStateDependent===!0){const X=g.paint.get(F);G.expression=X.value,G.updatePaintArray(B.start,B.end,O,s[E],v),w=!0}}}}return w}defines(){const s=[];for(const u in this.binders){const f=this.binders[u];(f instanceof Jh||f instanceof tu)&&s.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return s}getBinderAttributes(){const s=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof oa||f instanceof Qs)for(let g=0;g<f.paintVertexAttributes.length;g++)s.push(f.paintVertexAttributes[g].name);else if(f instanceof Ja)for(let g=0;g<yi.members.length;g++)s.push(yi.members[g].name)}return s}getBinderUniforms(){const s=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Jh||f instanceof tu||f instanceof Qs)for(const g of f.uniformNames)s.push(g)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,u){const f=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof Jh||v instanceof tu||v instanceof Qs){for(const w of v.uniformNames)if(u[w]){const E=v.getBinding(s,u[w],w);f.push({name:w,property:g,binding:E})}}}return f}setUniforms(s,u,f,g){for(const{name:v,property:w,binding:E}of u)this.binders[w].setUniform(E,g,f.get(w),v)}updatePaintBuffers(s){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(s&&f instanceof Ja){const g=s.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof oa||f instanceof Qs)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(s){for(const u in this.binders){const f=this.binders[u];(f instanceof oa||f instanceof Qs||f instanceof Ja)&&f.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const u=this.binders[s];(u instanceof oa||u instanceof Qs||u instanceof Ja)&&u.destroy()}}}class ec{constructor(s,u,f=()=>!0){this.programConfigurations={};for(const g of s)this.programConfigurations[g.id]=new Hb(g,u,f);this.needsUpload=!1,this._featureMap=new Za,this._bufferOffset=0}populatePaintArrays(s,u,f,g,v,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(s,u,g,v,w);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,u,f,g){for(const v of f)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(s,this._featureMap,u,v,g)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function hL(c,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}function Wb(c,s,u){const f={color:{source:p,composite:Ee},number:{source:ne,composite:p}},g=function(v){return{"line-pattern":{source:_i,composite:_i},"fill-pattern":{source:_i,composite:_i},"fill-extrusion-pattern":{source:_i,composite:_i}}[v]}(c);return g&&g[u]||f[s][u]}at("ConstantBinder",Jh),at("CrossFadedConstantBinder",tu),at("SourceExpressionBinder",oa),at("CrossFadedCompositeBinder",Ja),at("CompositeExpressionBinder",Qs),at("ProgramConfiguration",Hb,{omit:["_buffers"]}),at("ProgramConfigurationSet",ec);var hi=8192;const q_=Math.pow(2,14)-1,Xb=-q_-1;function tc(c){const s=hi/c.extent,u=c.loadGeometry();for(let f=0;f<u.length;f++){const g=u[f];for(let v=0;v<g.length;v++){const w=g[v],E=Math.round(w.x*s),I=Math.round(w.y*s);w.x=S(E,Xb,q_),w.y=S(I,Xb,q_),(E<w.x||E>w.x+1||I<w.y||I>w.y+1)&&ve("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function nc(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?tc(c):[]}}function Lp(c,s,u,f,g){c.emplaceBack(2*s+(f+1)/2,2*u+(g+1)/2)}class $_{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ln,this.indexArray=new sr,this.segments=new Ut,this.programConfigurations=new ec(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){const g=this.layers[0],v=[];let w=null,E=!1;g.type==="circle"&&(w=g.layout.get("circle-sort-key"),E=!w.isConstant());for(const{feature:I,id:B,index:O,sourceLayerIndex:F}of s){const G=this.layers[0]._featureFilter.needGeometry,X=nc(I,G);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),X,f))continue;const $=E?w.evaluate(X,{},f):void 0,oe={id:B,properties:I.properties,type:I.type,sourceLayerIndex:F,index:O,geometry:G?X.geometry:tc(I),patterns:{},sortKey:$};v.push(oe)}E&&v.sort((I,B)=>I.sortKey-B.sortKey);for(const I of v){const{geometry:B,index:O,sourceLayerIndex:F}=I,G=s[O].feature;this.addFeature(I,B,O,f),u.featureIndex.insert(G,B,O,F,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ui),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,u,f,g){for(const v of u)for(const w of v){const E=w.x,I=w.y;if(E<0||E>=hi||I<0||I>=hi)continue;const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),O=B.vertexLength;Lp(this.layoutVertexArray,E,I,-1,-1),Lp(this.layoutVertexArray,E,I,1,-1),Lp(this.layoutVertexArray,E,I,1,1),Lp(this.layoutVertexArray,E,I,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{},g)}}function qb(c,s){for(let u=0;u<c.length;u++)if(nu(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(nu(c,s[u]))return!0;return!!Z_(c,s)}function dL(c,s,u){return!!nu(c,s)||!!J_(s,c,u)}function $b(c,s){if(c.length===1)return Jb(s,c[0]);for(let u=0;u<s.length;u++){const f=s[u];for(let g=0;g<f.length;g++)if(nu(c,f[g]))return!0}for(let u=0;u<c.length;u++)if(Jb(s,c[u]))return!0;for(let u=0;u<s.length;u++)if(Z_(c,s[u]))return!0;return!1}function fL(c,s,u){if(c.length>1){if(Z_(c,s))return!0;for(let f=0;f<s.length;f++)if(J_(s[f],c,u))return!0}for(let f=0;f<c.length;f++)if(J_(c[f],s,u))return!0;return!1}function Z_(c,s){if(c.length===0||s.length===0)return!1;for(let u=0;u<c.length-1;u++){const f=c[u],g=c[u+1];for(let v=0;v<s.length-1;v++)if(pL(f,g,s[v],s[v+1]))return!0}return!1}function pL(c,s,u,f){return Ie(c,u,f)!==Ie(s,u,f)&&Ie(c,s,u)!==Ie(c,s,f)}function J_(c,s,u){const f=u*u;if(s.length===1)return c.distSqr(s[0])<f;for(let g=1;g<s.length;g++)if(Zb(c,s[g-1],s[g])<f)return!0;return!1}function Zb(c,s,u){const f=s.distSqr(u);if(f===0)return c.distSqr(s);const g=((c.x-s.x)*(u.x-s.x)+(c.y-s.y)*(u.y-s.y))/f;return c.distSqr(g<0?s:g>1?u:u.sub(s)._mult(g)._add(s))}function Jb(c,s){let u,f,g,v=!1;for(let w=0;w<c.length;w++){u=c[w];for(let E=0,I=u.length-1;E<u.length;I=E++)f=u[E],g=u[I],f.y>s.y!=g.y>s.y&&s.x<(g.x-f.x)*(s.y-f.y)/(g.y-f.y)+f.x&&(v=!v)}return v}function nu(c,s){let u=!1;for(let f=0,g=c.length-1;f<c.length;g=f++){const v=c[f],w=c[g];v.y>s.y!=w.y>s.y&&s.x<(w.x-v.x)*(s.y-v.y)/(w.y-v.y)+v.x&&(u=!u)}return u}function mL(c,s,u){const f=u[0],g=u[2];if(c.x<f.x&&s.x<f.x||c.x>g.x&&s.x>g.x||c.y<f.y&&s.y<f.y||c.y>g.y&&s.y>g.y)return!1;const v=Ie(c,s,u[0]);return v!==Ie(c,s,u[1])||v!==Ie(c,s,u[2])||v!==Ie(c,s,u[3])}function Kh(c,s,u){const f=s.paint.get(c).value;return f.kind==="constant"?f.value:u.programConfigurations.get(s.id).getMaxValue(c)}function Rp(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Dp(c,s,u,f,g){if(!s[0]&&!s[1])return c;const v=yt.convert(s)._mult(g);u==="viewport"&&v._rotate(-f);const w=[];for(let E=0;E<c.length;E++)w.push(c[E].sub(v));return w}at("CircleBucket",$_,{omit:["layers"]});const gL=new Ci({"circle-sort-key":new Tt(Be.layout_circle["circle-sort-key"])});var _L={paint:new Ci({"circle-radius":new Tt(Be.paint_circle["circle-radius"]),"circle-color":new Tt(Be.paint_circle["circle-color"]),"circle-blur":new Tt(Be.paint_circle["circle-blur"]),"circle-opacity":new Tt(Be.paint_circle["circle-opacity"]),"circle-translate":new ft(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new ft(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ft(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ft(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tt(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tt(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tt(Be.paint_circle["circle-stroke-opacity"])}),layout:gL},or=1e-6,ar=typeof Float32Array<"u"?Float32Array:Array;function Kb(){var c=new ar(9);return ar!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function K_(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Yb(c,s,u){var f=s[0],g=s[1],v=s[2],w=s[3],E=s[4],I=s[5],B=s[6],O=s[7],F=s[8],G=s[9],X=s[10],$=s[11],oe=s[12],se=s[13],ye=s[14],Te=s[15],_e=u[0],Ae=u[1],ke=u[2],Oe=u[3];return c[0]=_e*f+Ae*E+ke*F+Oe*oe,c[1]=_e*g+Ae*I+ke*G+Oe*se,c[2]=_e*v+Ae*B+ke*X+Oe*ye,c[3]=_e*w+Ae*O+ke*$+Oe*Te,c[4]=(_e=u[4])*f+(Ae=u[5])*E+(ke=u[6])*F+(Oe=u[7])*oe,c[5]=_e*g+Ae*I+ke*G+Oe*se,c[6]=_e*v+Ae*B+ke*X+Oe*ye,c[7]=_e*w+Ae*O+ke*$+Oe*Te,c[8]=(_e=u[8])*f+(Ae=u[9])*E+(ke=u[10])*F+(Oe=u[11])*oe,c[9]=_e*g+Ae*I+ke*G+Oe*se,c[10]=_e*v+Ae*B+ke*X+Oe*ye,c[11]=_e*w+Ae*O+ke*$+Oe*Te,c[12]=(_e=u[12])*f+(Ae=u[13])*E+(ke=u[14])*F+(Oe=u[15])*oe,c[13]=_e*g+Ae*I+ke*G+Oe*se,c[14]=_e*v+Ae*B+ke*X+Oe*ye,c[15]=_e*w+Ae*O+ke*$+Oe*Te,c}Math.hypot||(Math.hypot=function(){for(var c=0,s=arguments.length;s--;)c+=arguments[s]*arguments[s];return Math.sqrt(c)});var Yh,yL=Yb;function Qb(){var c=new ar(3);return ar!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function ew(c,s,u){var f=new ar(3);return f[0]=c,f[1]=s,f[2]=u,f}function Op(c,s,u){var f=s[0],g=s[1],v=s[2],w=s[3];return c[0]=u[0]*f+u[4]*g+u[8]*v+u[12]*w,c[1]=u[1]*f+u[5]*g+u[9]*v+u[13]*w,c[2]=u[2]*f+u[6]*g+u[10]*v+u[14]*w,c[3]=u[3]*f+u[7]*g+u[11]*v+u[15]*w,c}function tw(){var c=new ar(4);return ar!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function nw(c,s){const u=Op([],[c.x,c.y,0,1],s);return new yt(u[0]/u[3],u[1]/u[3])}Qb(),Yh=new ar(4),ar!=Float32Array&&(Yh[0]=0,Yh[1]=0,Yh[2]=0,Yh[3]=0),Qb(),ew(1,0,0),ew(0,1,0),tw(),tw(),Kb(),function(){var c;c=new ar(2),ar!=Float32Array&&(c[0]=0,c[1]=0)}();class iw extends $_{}at("HeatmapBucket",iw,{omit:["layers"]});var vL={paint:new Ci({"heatmap-radius":new Tt(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tt(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ft(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mo(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ft(Be.paint_heatmap["heatmap-opacity"])})};function Y_(c,{width:s,height:u},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==s*u*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${s*u*f}`)}else g=new Uint8Array(s*u*f);return c.width=s,c.height=u,c.data=g,c}function rw(c,{width:s,height:u},f){if(s===c.width&&u===c.height)return;const g=Y_({},{width:s,height:u},f);Q_(c,g,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,s),height:Math.min(c.height,u)},f),c.width=s,c.height=u,c.data=g.data}function Q_(c,s,u,f,g,v){if(g.width===0||g.height===0)return s;if(g.width>c.width||g.height>c.height||u.x>c.width-g.width||u.y>c.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>s.width||g.height>s.height||f.x>s.width-g.width||f.y>s.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const w=c.data,E=s.data;if(w===E)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<g.height;I++){const B=((u.y+I)*c.width+u.x)*v,O=((f.y+I)*s.width+f.x)*v;for(let F=0;F<g.width*v;F++)E[O+F]=w[B+F]}return s}class Qh{constructor(s,u){Y_(this,s,1,u)}resize(s){rw(this,s,1)}clone(){return new Qh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,f,g,v){Q_(s,u,f,g,v,1)}}class rs{constructor(s,u){Y_(this,s,4,u)}resize(s){rw(this,s,4)}replace(s,u){u?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new rs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,u,f,g,v){Q_(s,u,f,g,v,4)}}function sw(c){const s={},u=c.resolution||256,f=c.clips?c.clips.length:1,g=c.image||new rs({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const v=(w,E,I)=>{s[c.evaluationKey]=I;const B=c.expression.evaluate(s);g.data[w+E+0]=Math.floor(255*B.r/B.a),g.data[w+E+1]=Math.floor(255*B.g/B.a),g.data[w+E+2]=Math.floor(255*B.b/B.a),g.data[w+E+3]=Math.floor(255*B.a)};if(c.clips)for(let w=0,E=0;w<f;++w,E+=4*u)for(let I=0,B=0;I<u;I++,B+=4){const O=I/(u-1),{start:F,end:G}=c.clips[w];v(E,B,F*(1-O)+G*O)}else for(let w=0,E=0;w<u;w++,E+=4)v(0,E,w/(u-1));return g}at("AlphaImage",Qh),at("RGBAImage",rs);var xL={paint:new Ci({"hillshade-illumination-direction":new ft(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ft(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ft(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ft(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ft(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ft(Be.paint_hillshade["hillshade-accent-color"])})};const bL=ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:wL}=bL;var kp={exports:{}};function Fp(c,s,u){u=u||2;var f,g,v,w,E,I,B,O=s&&s.length,F=O?s[0]*u:c.length,G=ow(c,0,F,u,!0),X=[];if(!G||G.next===G.prev)return X;if(O&&(G=function(oe,se,ye,Te){var _e,Ae,ke,Oe=[];for(_e=0,Ae=se.length;_e<Ae;_e++)(ke=ow(oe,se[_e]*Te,_e<Ae-1?se[_e+1]*Te:oe.length,Te,!1))===ke.next&&(ke.steiner=!0),Oe.push(PL(ke));for(Oe.sort(CL),_e=0;_e<Oe.length;_e++)ye=IL(Oe[_e],ye);return ye}(c,s,G,u)),c.length>80*u){f=v=c[0],g=w=c[1];for(var $=u;$<F;$+=u)(E=c[$])<f&&(f=E),(I=c[$+1])<g&&(g=I),E>v&&(v=E),I>w&&(w=I);B=(B=Math.max(v-f,w-g))!==0?32767/B:0}return ed(G,X,u,f,g,B,0),X}function ow(c,s,u,f,g){var v,w;if(g===ny(c,s,u,f)>0)for(v=s;v<u;v+=f)w=cw(v,c[v],c[v+1],w);else for(v=u-f;v>=s;v-=f)w=cw(v,c[v],c[v+1],w);return w&&zp(w,w.next)&&(nd(w),w=w.next),w}function ic(c,s){if(!c)return c;s||(s=c);var u,f=c;do if(u=!1,f.steiner||!zp(f,f.next)&&qn(f.prev,f,f.next)!==0)f=f.next;else{if(nd(f),(f=s=f.prev)===f.next)break;u=!0}while(u||f!==s);return s}function ed(c,s,u,f,g,v,w){if(c){!w&&v&&function(O,F,G,X){var $=O;do $.z===0&&($.z=ey($.x,$.y,F,G,X)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==O);$.prevZ.nextZ=null,$.prevZ=null,function(oe){var se,ye,Te,_e,Ae,ke,Oe,st,ht=1;do{for(ye=oe,oe=null,Ae=null,ke=0;ye;){for(ke++,Te=ye,Oe=0,se=0;se<ht&&(Oe++,Te=Te.nextZ);se++);for(st=ht;Oe>0||st>0&&Te;)Oe!==0&&(st===0||!Te||ye.z<=Te.z)?(_e=ye,ye=ye.nextZ,Oe--):(_e=Te,Te=Te.nextZ,st--),Ae?Ae.nextZ=_e:oe=_e,_e.prevZ=Ae,Ae=_e;ye=Te}Ae.nextZ=null,ht*=2}while(ke>1)}($)}(c,f,g,v);for(var E,I,B=c;c.prev!==c.next;)if(E=c.prev,I=c.next,v?EL(c,f,g,v):AL(c))s.push(E.i/u|0),s.push(c.i/u|0),s.push(I.i/u|0),nd(c),c=I.next,B=I.next;else if((c=I)===B){w?w===1?ed(c=TL(ic(c),s,u),s,u,f,g,v,2):w===2&&SL(c,s,u,f,g,v):ed(ic(c),s,u,f,g,v,1);break}}}function AL(c){var s=c.prev,u=c,f=c.next;if(qn(s,u,f)>=0)return!1;for(var g=s.x,v=u.x,w=f.x,E=s.y,I=u.y,B=f.y,O=g<v?g<w?g:w:v<w?v:w,F=E<I?E<B?E:B:I<B?I:B,G=g>v?g>w?g:w:v>w?v:w,X=E>I?E>B?E:B:I>B?I:B,$=f.next;$!==s;){if($.x>=O&&$.x<=G&&$.y>=F&&$.y<=X&&iu(g,E,v,I,w,B,$.x,$.y)&&qn($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function EL(c,s,u,f){var g=c.prev,v=c,w=c.next;if(qn(g,v,w)>=0)return!1;for(var E=g.x,I=v.x,B=w.x,O=g.y,F=v.y,G=w.y,X=E<I?E<B?E:B:I<B?I:B,$=O<F?O<G?O:G:F<G?F:G,oe=E>I?E>B?E:B:I>B?I:B,se=O>F?O>G?O:G:F>G?F:G,ye=ey(X,$,s,u,f),Te=ey(oe,se,s,u,f),_e=c.prevZ,Ae=c.nextZ;_e&&_e.z>=ye&&Ae&&Ae.z<=Te;){if(_e.x>=X&&_e.x<=oe&&_e.y>=$&&_e.y<=se&&_e!==g&&_e!==w&&iu(E,O,I,F,B,G,_e.x,_e.y)&&qn(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,Ae.x>=X&&Ae.x<=oe&&Ae.y>=$&&Ae.y<=se&&Ae!==g&&Ae!==w&&iu(E,O,I,F,B,G,Ae.x,Ae.y)&&qn(Ae.prev,Ae,Ae.next)>=0))return!1;Ae=Ae.nextZ}for(;_e&&_e.z>=ye;){if(_e.x>=X&&_e.x<=oe&&_e.y>=$&&_e.y<=se&&_e!==g&&_e!==w&&iu(E,O,I,F,B,G,_e.x,_e.y)&&qn(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;Ae&&Ae.z<=Te;){if(Ae.x>=X&&Ae.x<=oe&&Ae.y>=$&&Ae.y<=se&&Ae!==g&&Ae!==w&&iu(E,O,I,F,B,G,Ae.x,Ae.y)&&qn(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.nextZ}return!0}function TL(c,s,u){var f=c;do{var g=f.prev,v=f.next.next;!zp(g,v)&&aw(g,f,f.next,v)&&td(g,v)&&td(v,g)&&(s.push(g.i/u|0),s.push(f.i/u|0),s.push(v.i/u|0),nd(f),nd(f.next),f=c=v),f=f.next}while(f!==c);return ic(f)}function SL(c,s,u,f,g,v){var w=c;do{for(var E=w.next.next;E!==w.prev;){if(w.i!==E.i&&BL(w,E)){var I=lw(w,E);return w=ic(w,w.next),I=ic(I,I.next),ed(w,s,u,f,g,v,0),void ed(I,s,u,f,g,v,0)}E=E.next}w=w.next}while(w!==c)}function CL(c,s){return c.x-s.x}function IL(c,s){var u=function(g,v){var w,E=v,I=g.x,B=g.y,O=-1/0;do{if(B<=E.y&&B>=E.next.y&&E.next.y!==E.y){var F=E.x+(B-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(F<=I&&F>O&&(O=F,w=E.x<E.next.x?E:E.next,F===I))return w}E=E.next}while(E!==v);if(!w)return null;var G,X=w,$=w.x,oe=w.y,se=1/0;E=w;do I>=E.x&&E.x>=$&&I!==E.x&&iu(B<oe?I:O,B,$,oe,B<oe?O:I,B,E.x,E.y)&&(G=Math.abs(B-E.y)/(I-E.x),td(E,g)&&(G<se||G===se&&(E.x>w.x||E.x===w.x&&ML(w,E)))&&(w=E,se=G)),E=E.next;while(E!==X);return w}(c,s);if(!u)return s;var f=lw(u,c);return ic(f,f.next),ic(u,u.next)}function ML(c,s){return qn(c.prev,c,s.prev)<0&&qn(s.next,c,c.next)<0}function ey(c,s,u,f,g){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-u)*g|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-f)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function PL(c){var s=c,u=c;do(s.x<u.x||s.x===u.x&&s.y<u.y)&&(u=s),s=s.next;while(s!==c);return u}function iu(c,s,u,f,g,v,w,E){return(g-w)*(s-E)>=(c-w)*(v-E)&&(c-w)*(f-E)>=(u-w)*(s-E)&&(u-w)*(v-E)>=(g-w)*(f-E)}function BL(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!function(u,f){var g=u;do{if(g.i!==u.i&&g.next.i!==u.i&&g.i!==f.i&&g.next.i!==f.i&&aw(g,g.next,u,f))return!0;g=g.next}while(g!==u);return!1}(c,s)&&(td(c,s)&&td(s,c)&&function(u,f){var g=u,v=!1,w=(u.x+f.x)/2,E=(u.y+f.y)/2;do g.y>E!=g.next.y>E&&g.next.y!==g.y&&w<(g.next.x-g.x)*(E-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==u);return v}(c,s)&&(qn(c.prev,c,s.prev)||qn(c,s.prev,s))||zp(c,s)&&qn(c.prev,c,c.next)>0&&qn(s.prev,s,s.next)>0)}function qn(c,s,u){return(s.y-c.y)*(u.x-s.x)-(s.x-c.x)*(u.y-s.y)}function zp(c,s){return c.x===s.x&&c.y===s.y}function aw(c,s,u,f){var g=Up(qn(c,s,u)),v=Up(qn(c,s,f)),w=Up(qn(u,f,c)),E=Up(qn(u,f,s));return g!==v&&w!==E||!(g!==0||!Np(c,u,s))||!(v!==0||!Np(c,f,s))||!(w!==0||!Np(u,c,f))||!(E!==0||!Np(u,s,f))}function Np(c,s,u){return s.x<=Math.max(c.x,u.x)&&s.x>=Math.min(c.x,u.x)&&s.y<=Math.max(c.y,u.y)&&s.y>=Math.min(c.y,u.y)}function Up(c){return c>0?1:c<0?-1:0}function td(c,s){return qn(c.prev,c,c.next)<0?qn(c,s,c.next)>=0&&qn(c,c.prev,s)>=0:qn(c,s,c.prev)<0||qn(c,c.next,s)<0}function lw(c,s){var u=new ty(c.i,c.x,c.y),f=new ty(s.i,s.x,s.y),g=c.next,v=s.prev;return c.next=s,s.prev=c,u.next=g,g.prev=u,f.next=u,u.prev=f,v.next=f,f.prev=v,f}function cw(c,s,u,f){var g=new ty(c,s,u);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function nd(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function ty(c,s,u){this.i=c,this.x=s,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ny(c,s,u,f){for(var g=0,v=s,w=u-f;v<u;v+=f)g+=(c[w]-c[v])*(c[v+1]+c[w+1]),w=v;return g}function LL(c,s,u,f,g){uw(c,s,u||0,f||c.length-1,g||RL)}function uw(c,s,u,f,g){for(;f>u;){if(f-u>600){var v=f-u+1,w=s-u+1,E=Math.log(v),I=.5*Math.exp(2*E/3),B=.5*Math.sqrt(E*I*(v-I)/v)*(w-v/2<0?-1:1);uw(c,s,Math.max(u,Math.floor(s-w*I/v+B)),Math.min(f,Math.floor(s+(v-w)*I/v+B)),g)}var O=c[s],F=u,G=f;for(id(c,u,s),g(c[f],O)>0&&id(c,u,f);F<G;){for(id(c,F,G),F++,G--;g(c[F],O)<0;)F++;for(;g(c[G],O)>0;)G--}g(c[u],O)===0?id(c,u,G):id(c,++G,f),G<=s&&(u=G+1),s<=G&&(f=G-1)}}function id(c,s,u){var f=c[s];c[s]=c[u],c[u]=f}function RL(c,s){return c<s?-1:c>s?1:0}function iy(c,s){const u=c.length;if(u<=1)return[c];const f=[];let g,v;for(let w=0;w<u;w++){const E=De(c[w]);E!==0&&(c[w].area=Math.abs(E),v===void 0&&(v=E<0),v===E<0?(g&&f.push(g),g=[c[w]]):g.push(c[w]))}if(g&&f.push(g),s>1)for(let w=0;w<f.length;w++)f[w].length<=s||(LL(f[w],s,1,f[w].length-1,DL),f[w]=f[w].slice(0,s));return f}function DL(c,s){return s.area-c.area}function ry(c,s,u){const f=u.patternDependencies;let g=!1;for(const v of s){const w=v.paint.get(`${c}-pattern`);w.isConstant()||(g=!0);const E=w.constantOr(null);E&&(g=!0,f[E.to]=!0,f[E.from]=!0)}return g}function sy(c,s,u,f,g){const v=g.patternDependencies;for(const w of s){const E=w.paint.get(`${c}-pattern`).value;if(E.kind!=="constant"){let I=E.evaluate({zoom:f-1},u,{},g.availableImages),B=E.evaluate({zoom:f},u,{},g.availableImages),O=E.evaluate({zoom:f+1},u,{},g.availableImages);I=I&&I.name?I.name:I,B=B&&B.name?B.name:B,O=O&&O.name?O.name:O,v[I]=!0,v[B]=!0,v[O]=!0,u.patterns[w.id]={min:I,mid:B,max:O}}}return u}kp.exports=Fp,kp.exports.default=Fp,Fp.deviation=function(c,s,u,f){var g=s&&s.length,v=Math.abs(ny(c,0,g?s[0]*u:c.length,u));if(g)for(var w=0,E=s.length;w<E;w++)v-=Math.abs(ny(c,s[w]*u,w<E-1?s[w+1]*u:c.length,u));var I=0;for(w=0;w<f.length;w+=3){var B=f[w]*u,O=f[w+1]*u,F=f[w+2]*u;I+=Math.abs((c[B]-c[F])*(c[O+1]-c[B+1])-(c[B]-c[O])*(c[F+1]-c[B+1]))}return v===0&&I===0?0:Math.abs((I-v)/v)},Fp.flatten=function(c){for(var s=c[0][0].length,u={vertices:[],holes:[],dimensions:s},f=0,g=0;g<c.length;g++){for(var v=0;v<c[g].length;v++)for(var w=0;w<s;w++)u.vertices.push(c[g][v][w]);g>0&&u.holes.push(f+=c[g-1].length)}return u};class oy{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new cn,this.indexArray=new sr,this.indexArray2=new Ys,this.programConfigurations=new ec(s.layers,s.zoom),this.segments=new Ut,this.segments2=new Ut,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.hasPattern=ry("fill",this.layers,u);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),w=[];for(const{feature:E,id:I,index:B,sourceLayerIndex:O}of s){const F=this.layers[0]._featureFilter.needGeometry,G=nc(E,F);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),G,f))continue;const X=v?g.evaluate(G,{},f,u.availableImages):void 0,$={id:I,properties:E.properties,type:E.type,sourceLayerIndex:O,index:B,geometry:F?G.geometry:tc(E),patterns:{},sortKey:X};w.push($)}v&&w.sort((E,I)=>E.sortKey-I.sortKey);for(const E of w){const{geometry:I,index:B,sourceLayerIndex:O}=E;if(this.hasPattern){const F=sy("fill",this.layers,E,this.zoom,u);this.patternFeatures.push(F)}else this.addFeature(E,I,B,f,{});u.featureIndex.insert(s[B].feature,I,B,O,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}addFeatures(s,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,wL),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,u,f,g,v){for(const w of iy(u,500)){let E=0;for(const X of w)E+=X.length;const I=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),B=I.vertexLength,O=[],F=[];for(const X of w){if(X.length===0)continue;X!==w[0]&&F.push(O.length/2);const $=this.segments2.prepareSegment(X.length,this.layoutVertexArray,this.indexArray2),oe=$.vertexLength;this.layoutVertexArray.emplaceBack(X[0].x,X[0].y),this.indexArray2.emplaceBack(oe+X.length-1,oe),O.push(X[0].x),O.push(X[0].y);for(let se=1;se<X.length;se++)this.layoutVertexArray.emplaceBack(X[se].x,X[se].y),this.indexArray2.emplaceBack(oe+se-1,oe+se),O.push(X[se].x),O.push(X[se].y);$.vertexLength+=X.length,$.primitiveLength+=X.length}const G=kp.exports(O,F);for(let X=0;X<G.length;X+=3)this.indexArray.emplaceBack(B+G[X],B+G[X+1],B+G[X+2]);I.vertexLength+=E,I.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,v,g)}}at("FillBucket",oy,{omit:["layers","patternFeatures"]});const OL=new Ci({"fill-sort-key":new Tt(Be.layout_fill["fill-sort-key"])});var kL={paint:new Ci({"fill-antialias":new ft(Be.paint_fill["fill-antialias"]),"fill-opacity":new Tt(Be.paint_fill["fill-opacity"]),"fill-color":new Tt(Be.paint_fill["fill-color"]),"fill-outline-color":new Tt(Be.paint_fill["fill-outline-color"]),"fill-translate":new ft(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new ft(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new $a(Be.paint_fill["fill-pattern"])}),layout:OL};const FL=ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),zL=ei([{name:"a_centroid",components:2,type:"Int16"}],4),{members:NL}=FL;var Ka={},UL=yt,hw=ru;function ru(c,s,u,f,g){this.properties={},this.extent=u,this.type=0,this._pbf=c,this._geometry=-1,this._keys=f,this._values=g,c.readFields(VL,this,s)}function VL(c,s,u){c==1?s.id=u.readVarint():c==2?function(f,g){for(var v=f.readVarint()+f.pos;f.pos<v;){var w=g._keys[f.readVarint()],E=g._values[f.readVarint()];g.properties[w]=E}}(u,s):c==3?s.type=u.readVarint():c==4&&(s._geometry=u.pos)}function jL(c){for(var s,u,f=0,g=0,v=c.length,w=v-1;g<v;w=g++)f+=((u=c[w]).x-(s=c[g]).x)*(s.y+u.y);return f}ru.types=["Unknown","Point","LineString","Polygon"],ru.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var s,u=c.readVarint()+c.pos,f=1,g=0,v=0,w=0,E=[];c.pos<u;){if(g<=0){var I=c.readVarint();f=7&I,g=I>>3}if(g--,f===1||f===2)v+=c.readSVarint(),w+=c.readSVarint(),f===1&&(s&&E.push(s),s=[]),s.push(new UL(v,w));else{if(f!==7)throw new Error("unknown command "+f);s&&s.push(s[0].clone())}}return s&&E.push(s),E},ru.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var s=c.readVarint()+c.pos,u=1,f=0,g=0,v=0,w=1/0,E=-1/0,I=1/0,B=-1/0;c.pos<s;){if(f<=0){var O=c.readVarint();u=7&O,f=O>>3}if(f--,u===1||u===2)(g+=c.readSVarint())<w&&(w=g),g>E&&(E=g),(v+=c.readSVarint())<I&&(I=v),v>B&&(B=v);else if(u!==7)throw new Error("unknown command "+u)}return[w,I,E,B]},ru.prototype.toGeoJSON=function(c,s,u){var f,g,v=this.extent*Math.pow(2,u),w=this.extent*c,E=this.extent*s,I=this.loadGeometry(),B=ru.types[this.type];function O(X){for(var $=0;$<X.length;$++){var oe=X[$];X[$]=[360*(oe.x+w)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+E)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(f=0;f<I.length;f++)F[f]=I[f][0];O(I=F);break;case 2:for(f=0;f<I.length;f++)O(I[f]);break;case 3:for(I=function(X){var $=X.length;if($<=1)return[X];for(var oe,se,ye=[],Te=0;Te<$;Te++){var _e=jL(X[Te]);_e!==0&&(se===void 0&&(se=_e<0),se===_e<0?(oe&&ye.push(oe),oe=[X[Te]]):oe.push(X[Te]))}return oe&&ye.push(oe),ye}(I),f=0;f<I.length;f++)for(g=0;g<I[f].length;g++)O(I[f][g])}I.length===1?I=I[0]:B="Multi"+B;var G={type:"Feature",geometry:{type:B,coordinates:I},properties:this.properties};return"id"in this&&(G.id=this.id),G};var HL=hw,dw=fw;function fw(c,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(WL,this,s),this.length=this._features.length}function WL(c,s,u){c===15?s.version=u.readVarint():c===1?s.name=u.readString():c===5?s.extent=u.readVarint():c===2?s._features.push(u.pos):c===3?s._keys.push(u.readString()):c===4&&s._values.push(function(f){for(var g=null,v=f.readVarint()+f.pos;f.pos<v;){var w=f.readVarint()>>3;g=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return g}(u))}fw.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var s=this._pbf.readVarint()+this._pbf.pos;return new HL(this._pbf,s,this.extent,this._keys,this._values)};var XL=dw;function qL(c,s,u){if(c===3){var f=new XL(u,u.readVarint()+u.pos);f.length&&(s[f.name]=f)}}Ka.VectorTile=function(c,s){this.layers=c.readFields(qL,{},s)},Ka.VectorTileFeature=hw,Ka.VectorTileLayer=dw;const $L=Ka.VectorTileFeature.types,ay=Math.pow(2,13);function rd(c,s,u,f,g,v,w,E){c.emplaceBack(s,u,2*Math.floor(f*ay)+w,g*ay*2,v*ay*2,Math.round(E))}class ly{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new qt,this.centroidVertexArray=new bt,this.indexArray=new sr,this.programConfigurations=new ec(s.layers,s.zoom),this.segments=new Ut,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.features=[],this.hasPattern=ry("fill-extrusion",this.layers,u);for(const{feature:g,id:v,index:w,sourceLayerIndex:E}of s){const I=this.layers[0]._featureFilter.needGeometry,B=nc(g,I);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),B,f))continue;const O={id:v,sourceLayerIndex:E,index:w,geometry:I?B.geometry:tc(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(sy("fill-extrusion",this.layers,O,this.zoom,u)):this.addFeature(O,O.geometry,w,f,{}),u.featureIndex.insert(g,O.geometry,w,E,this.index,!0)}}addFeatures(s,u,f){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,u,f)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,NL),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,zL.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,u,f,g,v){const w={x:0,y:0,vertexCount:0};for(const E of iy(u,500)){let I=0;for(const $ of E)I+=$.length;let B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const $ of E){if($.length===0||JL($))continue;let oe=0;for(let se=0;se<$.length;se++){const ye=$[se];if(se>=1){const Te=$[se-1];if(!ZL(ye,Te)){B.vertexLength+4>Ut.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const _e=ye.sub(Te)._perp()._unit(),Ae=Te.dist(ye);oe+Ae>32768&&(oe=0),rd(this.layoutVertexArray,ye.x,ye.y,_e.x,_e.y,0,0,oe),rd(this.layoutVertexArray,ye.x,ye.y,_e.x,_e.y,0,1,oe),w.x+=2*ye.x,w.y+=2*ye.y,w.vertexCount+=2,oe+=Ae,rd(this.layoutVertexArray,Te.x,Te.y,_e.x,_e.y,0,0,oe),rd(this.layoutVertexArray,Te.x,Te.y,_e.x,_e.y,0,1,oe),w.x+=2*Te.x,w.y+=2*Te.y,w.vertexCount+=2;const ke=B.vertexLength;this.indexArray.emplaceBack(ke,ke+2,ke+1),this.indexArray.emplaceBack(ke+1,ke+2,ke+3),B.vertexLength+=4,B.primitiveLength+=2}}}}if(B.vertexLength+I>Ut.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),$L[s.type]!=="Polygon")continue;const O=[],F=[],G=B.vertexLength;for(const $ of E)if($.length!==0){$!==E[0]&&F.push(O.length/2);for(let oe=0;oe<$.length;oe++){const se=$[oe];rd(this.layoutVertexArray,se.x,se.y,0,0,1,1,0),w.x+=se.x,w.y+=se.y,w.vertexCount+=1,O.push(se.x),O.push(se.y)}}const X=kp.exports(O,F);for(let $=0;$<X.length;$+=3)this.indexArray.emplaceBack(G+X[$],G+X[$+2],G+X[$+1]);B.primitiveLength+=X.length/3,B.vertexLength+=I}for(let E=0;E<w.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,v,g)}}function ZL(c,s){return c.x===s.x&&(c.x<0||c.x>hi)||c.y===s.y&&(c.y<0||c.y>hi)}function JL(c){return c.every(s=>s.x<0)||c.every(s=>s.x>hi)||c.every(s=>s.y<0)||c.every(s=>s.y>hi)}at("FillExtrusionBucket",ly,{omit:["layers","features"]});var KL={paint:new Ci({"fill-extrusion-opacity":new ft(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ft(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ft(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $a(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ft(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function sd(c,s){return c.x*s.x+c.y*s.y}function pw(c,s){if(c.length===1){let u=0;const f=s[u++];let g;for(;!g||f.equals(g);)if(g=s[u++],!g)return 1/0;for(;u<s.length;u++){const v=s[u],w=c[0],E=g.sub(f),I=v.sub(f),B=w.sub(f),O=sd(E,E),F=sd(E,I),G=sd(I,I),X=sd(B,E),$=sd(B,I),oe=O*G-F*F,se=(G*X-F*$)/oe,ye=(O*$-F*X)/oe,Te=f.z*(1-se-ye)+g.z*se+v.z*ye;if(isFinite(Te))return Te}return 1/0}{let u=1/0;for(const f of s)u=Math.min(u,f.z);return u}}const YL=ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:QL}=YL,eR=ei([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tR}=eR,nR=Ka.VectorTileFeature.types,iR=Math.cos(Math.PI/180*37.5),mw=Math.pow(2,14)/.5;class cy{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(u=>u.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Zt,this.layoutVertexArray2=new fn,this.indexArray=new sr,this.programConfigurations=new ec(s.layers,s.zoom),this.segments=new Ut,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(s,u,f){this.hasPattern=ry("line",this.layers,u);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),w=[];for(const{feature:E,id:I,index:B,sourceLayerIndex:O}of s){const F=this.layers[0]._featureFilter.needGeometry,G=nc(E,F);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),G,f))continue;const X=v?g.evaluate(G,{},f):void 0,$={id:I,properties:E.properties,type:E.type,sourceLayerIndex:O,index:B,geometry:F?G.geometry:tc(E),patterns:{},sortKey:X};w.push($)}v&&w.sort((E,I)=>E.sortKey-I.sortKey);for(const E of w){const{geometry:I,index:B,sourceLayerIndex:O}=E;if(this.hasPattern){const F=sy("line",this.layers,E,this.zoom,u);this.patternFeatures.push(F)}else this.addFeature(E,I,B,f,{});u.featureIndex.insert(s[B].feature,I,B,O,this.index)}}update(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)}addFeatures(s,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,tR)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,QL),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,u,f,g,v){const w=this.layers[0].layout,E=w.get("line-join").evaluate(s,{}),I=w.get("line-cap"),B=w.get("line-miter-limit"),O=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const F of u)this.addLine(F,s,E,I,B,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,v,g)}addLine(s,u,f,g,v,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ye=0;ye<s.length-1;ye++)this.totalDistance+=s[ye].dist(s[ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=nR[u.type]==="Polygon";let I=s.length;for(;I>=2&&s[I-1].equals(s[I-2]);)I--;let B=0;for(;B<I-1&&s[B].equals(s[B+1]);)B++;if(I<(E?3:2))return;f==="bevel"&&(v=1.05);const O=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let G,X,$,oe,se;this.e1=this.e2=-1,E&&(G=s[I-2],se=s[B].sub(G)._unit()._perp());for(let ye=B;ye<I;ye++){if($=ye===I-1?E?s[B+1]:void 0:s[ye+1],$&&s[ye].equals($))continue;se&&(oe=se),G&&(X=G),G=s[ye],se=$?$.sub(G)._unit()._perp():oe,oe=oe||se;let Te=oe.add(se);Te.x===0&&Te.y===0||Te._unit();const _e=oe.x*se.x+oe.y*se.y,Ae=Te.x*se.x+Te.y*se.y,ke=Ae!==0?1/Ae:1/0,Oe=2*Math.sqrt(2-2*Ae),st=Ae<iR&&X&&$,ht=oe.x*se.y-oe.y*se.x>0;if(st&&ye>B){const We=G.dist(X);if(We>2*O){const nt=G.sub(G.sub(X)._mult(O/We)._round());this.updateDistance(X,nt),this.addCurrentVertex(nt,oe,0,0,F),X=nt}}const tt=X&&$;let Je=tt?f:E?"butt":g;if(tt&&Je==="round"&&(ke<w?Je="miter":ke<=2&&(Je="fakeround")),Je==="miter"&&ke>v&&(Je="bevel"),Je==="bevel"&&(ke>2&&(Je="flipbevel"),ke<v&&(Je="miter")),X&&this.updateDistance(X,G),Je==="miter")Te._mult(ke),this.addCurrentVertex(G,Te,0,0,F);else if(Je==="flipbevel"){if(ke>100)Te=se.mult(-1);else{const We=ke*oe.add(se).mag()/oe.sub(se).mag();Te._perp()._mult(We*(ht?-1:1))}this.addCurrentVertex(G,Te,0,0,F),this.addCurrentVertex(G,Te.mult(-1),0,0,F)}else if(Je==="bevel"||Je==="fakeround"){const We=-Math.sqrt(ke*ke-1),nt=ht?We:0,Ye=ht?0:We;if(X&&this.addCurrentVertex(G,oe,nt,Ye,F),Je==="fakeround"){const Ve=Math.round(180*Oe/Math.PI/20);for(let wt=1;wt<Ve;wt++){let mt=wt/Ve;if(mt!==.5){const Tn=mt-.5;mt+=mt*Tn*(mt-1)*((1.0904+_e*(_e*(3.55645-1.43519*_e)-3.2452))*Tn*Tn+(.848013+_e*(.215638*_e-1.06021)))}const kt=se.sub(oe)._mult(mt)._add(oe)._unit()._mult(ht?-1:1);this.addHalfVertex(G,kt.x,kt.y,!1,ht,0,F)}}$&&this.addCurrentVertex(G,se,-nt,-Ye,F)}else if(Je==="butt")this.addCurrentVertex(G,Te,0,0,F);else if(Je==="square"){const We=X?1:-1;this.addCurrentVertex(G,Te,We,We,F)}else Je==="round"&&(X&&(this.addCurrentVertex(G,oe,0,0,F),this.addCurrentVertex(G,oe,1,1,F,!0)),$&&(this.addCurrentVertex(G,se,-1,-1,F,!0),this.addCurrentVertex(G,se,0,0,F)));if(st&&ye<I-1){const We=G.dist($);if(We>2*O){const nt=G.add($.sub(G)._mult(O/We)._round());this.updateDistance(G,nt),this.addCurrentVertex(nt,se,0,0,F),G=nt}}}}addCurrentVertex(s,u,f,g,v,w=!1){const E=u.y*g-u.x,I=-u.y-u.x*g;this.addHalfVertex(s,u.x+u.y*f,u.y-u.x*f,w,!1,f,v),this.addHalfVertex(s,E,I,w,!0,-g,v),this.distance>mw/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(s,u,f,g,v,w))}addHalfVertex({x:s,y:u},f,g,v,w,E,I){const B=.5*(this.lineClips?this.scaledDistance*(mw-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(v?1:0),(u<<1)+(w?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(E===0?0:E<0?-1:1)|(63&B)<<2,B>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),I.primitiveLength++),w?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,u){this.distance+=s.dist(u),this.updateScaledDistance()}}at("LineBucket",cy,{omit:["layers","patternFeatures"]});const rR=new Ci({"line-cap":new ft(Be.layout_line["line-cap"]),"line-join":new Tt(Be.layout_line["line-join"]),"line-miter-limit":new ft(Be.layout_line["line-miter-limit"]),"line-round-limit":new ft(Be.layout_line["line-round-limit"]),"line-sort-key":new Tt(Be.layout_line["line-sort-key"])});var gw={paint:new Ci({"line-opacity":new Tt(Be.paint_line["line-opacity"]),"line-color":new Tt(Be.paint_line["line-color"]),"line-translate":new ft(Be.paint_line["line-translate"]),"line-translate-anchor":new ft(Be.paint_line["line-translate-anchor"]),"line-width":new Tt(Be.paint_line["line-width"]),"line-gap-width":new Tt(Be.paint_line["line-gap-width"]),"line-offset":new Tt(Be.paint_line["line-offset"]),"line-blur":new Tt(Be.paint_line["line-blur"]),"line-dasharray":new Xh(Be.paint_line["line-dasharray"]),"line-pattern":new $a(Be.paint_line["line-pattern"]),"line-gradient":new Mo(Be.paint_line["line-gradient"])}),layout:rR};const _w=new class extends Tt{possiblyEvaluate(c,s){return s=new In(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(c,s)}evaluate(c,s,u,f){return s=V({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(c,s,u,f)}}(gw.paint.properties["line-width"].specification);function yw(c,s){return s>0?s+2*c:c}_w.useIntegerZoom=!0;const sR=ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),oR=ei([{name:"a_projected_pos",components:3,type:"Float32"}],4);ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const aR=ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ei([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const vw=ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lR=ei([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function cR(c,s,u){return c.sections.forEach(f=>{f.text=function(g,v,w){const E=v.layout.get("text-transform").evaluate(w,{});return E==="uppercase"?g=g.toLocaleUpperCase():E==="lowercase"&&(g=g.toLocaleLowerCase()),Fr.applyArabicShaping&&(g=Fr.applyArabicShaping(g)),g}(f.text,s,u)}),c}ei([{name:"triangle",components:3,type:"Uint16"}]),ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ei([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ei([{type:"Float32",name:"offsetX"}]),ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const od={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Ii=24,uy=gn,xw=function(c,s,u,f,g){var v,w,E=8*g-f-1,I=(1<<E)-1,B=I>>1,O=-7,F=u?g-1:0,G=u?-1:1,X=c[s+F];for(F+=G,v=X&(1<<-O)-1,X>>=-O,O+=E;O>0;v=256*v+c[s+F],F+=G,O-=8);for(w=v&(1<<-O)-1,v>>=-O,O+=f;O>0;w=256*w+c[s+F],F+=G,O-=8);if(v===0)v=1-B;else{if(v===I)return w?NaN:1/0*(X?-1:1);w+=Math.pow(2,f),v-=B}return(X?-1:1)*w*Math.pow(2,v-f)},bw=function(c,s,u,f,g,v){var w,E,I,B=8*v-g-1,O=(1<<B)-1,F=O>>1,G=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,X=f?0:v-1,$=f?1:-1,oe=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(E=isNaN(s)?1:0,w=O):(w=Math.floor(Math.log(s)/Math.LN2),s*(I=Math.pow(2,-w))<1&&(w--,I*=2),(s+=w+F>=1?G/I:G*Math.pow(2,1-F))*I>=2&&(w++,I/=2),w+F>=O?(E=0,w=O):w+F>=1?(E=(s*I-1)*Math.pow(2,g),w+=F):(E=s*Math.pow(2,F-1)*Math.pow(2,g),w=0));g>=8;c[u+X]=255&E,X+=$,E/=256,g-=8);for(w=w<<g|E,B+=g;B>0;c[u+X]=255&w,X+=$,w/=256,B-=8);c[u+X-$]|=128*oe};function gn(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}gn.Varint=0,gn.Fixed64=1,gn.Bytes=2,gn.Fixed32=5;var Ya,hy=4294967296,ww=1/hy,Aw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function aa(c){return c.type===gn.Bytes?c.readVarint()+c.pos:c.pos+1}function su(c,s,u){return u?4294967296*s+(c>>>0):4294967296*(s>>>0)+(c>>>0)}function Ew(c,s,u){var f=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));u.realloc(f);for(var g=u.pos-1;g>=c;g--)u.buf[g+f]=u.buf[g]}function uR(c,s){for(var u=0;u<c.length;u++)s.writeVarint(c[u])}function hR(c,s){for(var u=0;u<c.length;u++)s.writeSVarint(c[u])}function dR(c,s){for(var u=0;u<c.length;u++)s.writeFloat(c[u])}function fR(c,s){for(var u=0;u<c.length;u++)s.writeDouble(c[u])}function pR(c,s){for(var u=0;u<c.length;u++)s.writeBoolean(c[u])}function mR(c,s){for(var u=0;u<c.length;u++)s.writeFixed32(c[u])}function gR(c,s){for(var u=0;u<c.length;u++)s.writeSFixed32(c[u])}function _R(c,s){for(var u=0;u<c.length;u++)s.writeFixed64(c[u])}function yR(c,s){for(var u=0;u<c.length;u++)s.writeSFixed64(c[u])}function Gp(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+16777216*c[s+3]}function ou(c,s,u){c[u]=s,c[u+1]=s>>>8,c[u+2]=s>>>16,c[u+3]=s>>>24}function Tw(c,s){return(c[s]|c[s+1]<<8|c[s+2]<<16)+(c[s+3]<<24)}function vR(c,s,u){c===1&&u.readMessage(xR,s)}function xR(c,s,u){if(c===3){const{id:f,bitmap:g,width:v,height:w,left:E,top:I,advance:B}=u.readMessage(bR,{});s.push({id:f,bitmap:new Qh({width:v+6,height:w+6},g),metrics:{width:v,height:w,left:E,top:I,advance:B}})}}function bR(c,s,u){c===1?s.id=u.readVarint():c===2?s.bitmap=u.readBytes():c===3?s.width=u.readVarint():c===4?s.height=u.readVarint():c===5?s.left=u.readSVarint():c===6?s.top=u.readSVarint():c===7&&(s.advance=u.readVarint())}function Sw(c){let s=0,u=0;for(const w of c)s+=w.w*w.h,u=Math.max(u,w.w);c.sort((w,E)=>E.h-w.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),u),h:1/0}];let g=0,v=0;for(const w of c)for(let E=f.length-1;E>=0;E--){const I=f[E];if(!(w.w>I.w||w.h>I.h)){if(w.x=I.x,w.y=I.y,v=Math.max(v,w.y+w.h),g=Math.max(g,w.x+w.w),w.w===I.w&&w.h===I.h){const B=f.pop();E<f.length&&(f[E]=B)}else w.h===I.h?(I.x+=w.w,I.w-=w.w):w.w===I.w?(I.y+=w.h,I.h-=w.h):(f.push({x:I.x+w.w,y:I.y,w:I.w-w.w,h:w.h}),I.y+=w.h,I.h-=w.h);break}}return{w:g,h:v,fill:s/(g*v)||0}}gn.prototype={destroy:function(){this.buf=null},readFields:function(c,s,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),g=f>>3,v=this.pos;this.type=7&f,c(g,s,this),this.pos===v&&this.skip(f)}return s},readMessage:function(c,s){return this.readFields(c,s,this.readVarint()+this.pos)},readFixed32:function(){var c=Gp(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=Tw(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=Gp(this.buf,this.pos)+Gp(this.buf,this.pos+4)*hy;return this.pos+=8,c},readSFixed64:function(){var c=Gp(this.buf,this.pos)+Tw(this.buf,this.pos+4)*hy;return this.pos+=8,c},readFloat:function(){var c=xw(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=xw(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var s,u,f=this.buf;return s=127&(u=f[this.pos++]),u<128?s:(s|=(127&(u=f[this.pos++]))<<7,u<128?s:(s|=(127&(u=f[this.pos++]))<<14,u<128?s:(s|=(127&(u=f[this.pos++]))<<21,u<128?s:function(g,v,w){var E,I,B=w.buf;if(E=(112&(I=B[w.pos++]))>>4,I<128||(E|=(127&(I=B[w.pos++]))<<3,I<128)||(E|=(127&(I=B[w.pos++]))<<10,I<128)||(E|=(127&(I=B[w.pos++]))<<17,I<128)||(E|=(127&(I=B[w.pos++]))<<24,I<128)||(E|=(1&(I=B[w.pos++]))<<31,I<128))return su(g,E,v);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(u=f[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,s=this.pos;return this.pos=c,c-s>=12&&Aw?function(u,f,g){return Aw.decode(u.subarray(f,g))}(this.buf,s,c):function(u,f,g){for(var v="",w=f;w<g;){var E,I,B,O=u[w],F=null,G=O>239?4:O>223?3:O>191?2:1;if(w+G>g)break;G===1?O<128&&(F=O):G===2?(192&(E=u[w+1]))==128&&(F=(31&O)<<6|63&E)<=127&&(F=null):G===3?(I=u[w+2],(192&(E=u[w+1]))==128&&(192&I)==128&&((F=(15&O)<<12|(63&E)<<6|63&I)<=2047||F>=55296&&F<=57343)&&(F=null)):G===4&&(I=u[w+2],B=u[w+3],(192&(E=u[w+1]))==128&&(192&I)==128&&(192&B)==128&&((F=(15&O)<<18|(63&E)<<12|(63&I)<<6|63&B)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,G=1):F>65535&&(F-=65536,v+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),v+=String.fromCharCode(F),w+=G}return v}(this.buf,s,c)},readBytes:function(){var c=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,c);return this.pos=c,s},readPackedVarint:function(c,s){if(this.type!==gn.Bytes)return c.push(this.readVarint(s));var u=aa(this);for(c=c||[];this.pos<u;)c.push(this.readVarint(s));return c},readPackedSVarint:function(c){if(this.type!==gn.Bytes)return c.push(this.readSVarint());var s=aa(this);for(c=c||[];this.pos<s;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==gn.Bytes)return c.push(this.readBoolean());var s=aa(this);for(c=c||[];this.pos<s;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==gn.Bytes)return c.push(this.readFloat());var s=aa(this);for(c=c||[];this.pos<s;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==gn.Bytes)return c.push(this.readDouble());var s=aa(this);for(c=c||[];this.pos<s;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==gn.Bytes)return c.push(this.readFixed32());var s=aa(this);for(c=c||[];this.pos<s;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==gn.Bytes)return c.push(this.readSFixed32());var s=aa(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==gn.Bytes)return c.push(this.readFixed64());var s=aa(this);for(c=c||[];this.pos<s;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==gn.Bytes)return c.push(this.readSFixed64());var s=aa(this);for(c=c||[];this.pos<s;)c.push(this.readSFixed64());return c},skip:function(c){var s=7&c;if(s===gn.Varint)for(;this.buf[this.pos++]>127;);else if(s===gn.Bytes)this.pos=this.readVarint()+this.pos;else if(s===gn.Fixed32)this.pos+=4;else{if(s!==gn.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(c,s){this.writeVarint(c<<3|s)},realloc:function(c){for(var s=this.length||16;s<this.pos+c;)s*=2;if(s!==this.length){var u=new Uint8Array(s);u.set(this.buf),this.buf=u,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),ou(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),ou(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),ou(this.buf,-1&c,this.pos),ou(this.buf,Math.floor(c*ww),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),ou(this.buf,-1&c,this.pos),ou(this.buf,Math.floor(c*ww),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(s,u){var f,g;if(s>=0?(f=s%4294967296|0,g=s/4294967296|0):(g=~(-s/4294967296),4294967295^(f=~(-s%4294967296))?f=f+1|0:(f=0,g=g+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(v,w,E){E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,v>>>=7,E.buf[E.pos++]=127&v|128,E.buf[E.pos]=127&(v>>>=7)}(f,0,u),function(v,w){var E=(7&v)<<4;w.buf[w.pos++]|=E|((v>>>=3)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v)))))}(g,u)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var s=this.pos;this.pos=function(f,g,v){for(var w,E,I=0;I<g.length;I++){if((w=g.charCodeAt(I))>55295&&w<57344){if(!E){w>56319||I+1===g.length?(f[v++]=239,f[v++]=191,f[v++]=189):E=w;continue}if(w<56320){f[v++]=239,f[v++]=191,f[v++]=189,E=w;continue}w=E-55296<<10|w-56320|65536,E=null}else E&&(f[v++]=239,f[v++]=191,f[v++]=189,E=null);w<128?f[v++]=w:(w<2048?f[v++]=w>>6|192:(w<65536?f[v++]=w>>12|224:(f[v++]=w>>18|240,f[v++]=w>>12&63|128),f[v++]=w>>6&63|128),f[v++]=63&w|128)}return v}(this.buf,c,this.pos);var u=this.pos-s;u>=128&&Ew(s,u,this),this.pos=s-1,this.writeVarint(u),this.pos+=u},writeFloat:function(c){this.realloc(4),bw(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),bw(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var s=c.length;this.writeVarint(s),this.realloc(s);for(var u=0;u<s;u++)this.buf[this.pos++]=c[u]},writeRawMessage:function(c,s){this.pos++;var u=this.pos;c(s,this);var f=this.pos-u;f>=128&&Ew(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(c,s,u){this.writeTag(c,gn.Bytes),this.writeRawMessage(s,u)},writePackedVarint:function(c,s){s.length&&this.writeMessage(c,uR,s)},writePackedSVarint:function(c,s){s.length&&this.writeMessage(c,hR,s)},writePackedBoolean:function(c,s){s.length&&this.writeMessage(c,pR,s)},writePackedFloat:function(c,s){s.length&&this.writeMessage(c,dR,s)},writePackedDouble:function(c,s){s.length&&this.writeMessage(c,fR,s)},writePackedFixed32:function(c,s){s.length&&this.writeMessage(c,mR,s)},writePackedSFixed32:function(c,s){s.length&&this.writeMessage(c,gR,s)},writePackedFixed64:function(c,s){s.length&&this.writeMessage(c,_R,s)},writePackedSFixed64:function(c,s){s.length&&this.writeMessage(c,yR,s)},writeBytesField:function(c,s){this.writeTag(c,gn.Bytes),this.writeBytes(s)},writeFixed32Field:function(c,s){this.writeTag(c,gn.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(c,s){this.writeTag(c,gn.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(c,s){this.writeTag(c,gn.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(c,s){this.writeTag(c,gn.Fixed64),this.writeSFixed64(s)},writeVarintField:function(c,s){this.writeTag(c,gn.Varint),this.writeVarint(s)},writeSVarintField:function(c,s){this.writeTag(c,gn.Varint),this.writeSVarint(s)},writeStringField:function(c,s){this.writeTag(c,gn.Bytes),this.writeString(s)},writeFloatField:function(c,s){this.writeTag(c,gn.Fixed32),this.writeFloat(s)},writeDoubleField:function(c,s){this.writeTag(c,gn.Fixed64),this.writeDouble(s)},writeBooleanField:function(c,s){this.writeVarintField(c,!!s)}};class dy{constructor(s,{pixelRatio:u,version:f,stretchX:g,stretchY:v,content:w}){this.paddedRect=s,this.pixelRatio=u,this.stretchX=g,this.stretchY=v,this.content=w,this.version=f}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Cw{constructor(s,u){const f={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(s,f,v),this.addImages(u,g,v);const{w,h:E}=Sw(v),I=new rs({width:w||1,height:E||1});for(const B in s){const O=s[B],F=f[B].paddedRect;rs.copy(O.data,I,{x:0,y:0},{x:F.x+1,y:F.y+1},O.data)}for(const B in u){const O=u[B],F=g[B].paddedRect,G=F.x+1,X=F.y+1,$=O.data.width,oe=O.data.height;rs.copy(O.data,I,{x:0,y:0},{x:G,y:X},O.data),rs.copy(O.data,I,{x:0,y:oe-1},{x:G,y:X-1},{width:$,height:1}),rs.copy(O.data,I,{x:0,y:0},{x:G,y:X+oe},{width:$,height:1}),rs.copy(O.data,I,{x:$-1,y:0},{x:G-1,y:X},{width:1,height:oe}),rs.copy(O.data,I,{x:0,y:0},{x:G+$,y:X},{width:1,height:oe})}this.image=I,this.iconPositions=f,this.patternPositions=g}addImages(s,u,f){for(const g in s){const v=s[g],w={x:0,y:0,w:v.data.width+2,h:v.data.height+2};f.push(w),u[g]=new dy(w,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(s,u){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in s.updatedImages)this.patchUpdatedImage(this.iconPositions[f],s.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],s.getImage(f),u)}patchUpdatedImage(s,u,f){if(!s||!u||s.version===u.version)return;s.version=u.version;const[g,v]=s.tl;f.update(u.data,void 0,{x:g,y:v})}}at("ImagePosition",dy),at("ImageAtlas",Cw),l.WritingMode=void 0,(Ya=l.WritingMode||(l.WritingMode={}))[Ya.none=0]="none",Ya[Ya.horizontal=1]="horizontal",Ya[Ya.vertical=2]="vertical",Ya[Ya.horizontalOnly=3]="horizontalOnly";const Vp=-17;class ad{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,u){const f=new ad;return f.scale=s||1,f.fontStack=u,f}static forImage(s){const u=new ad;return u.imageName=s,u}}class au{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,u){const f=new au;for(let g=0;g<s.sections.length;g++){const v=s.sections[g];v.image?f.addImageSection(v):f.addTextSection(v,u)}return f}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let u="";for(let f=0;f<s.length;f++){const g=s.charCodeAt(f+1)||null,v=s.charCodeAt(f-1)||null;u+=g&&wp(g)&&!od[s[f+1]]||v&&wp(v)&&!od[s[f-1]]||!od[s[f]]?s[f]:od[s[f]]}return u}(this.text)}trim(){let s=0;for(let f=0;f<this.text.length&&Hp[this.text.charCodeAt(f)];f++)s++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=s&&Hp[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(s,u),this.sectionIndex=this.sectionIndex.slice(s,u)}substring(s,u){const f=new au;return f.text=this.text.substring(s,u),f.sectionIndex=this.sectionIndex.slice(s,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,u)=>Math.max(s,this.sections[u].scale),0)}addTextSection(s,u){this.text+=s.text,this.sections.push(ad.forText(s.scale,s.fontStack||u));const f=this.sections.length-1;for(let g=0;g<s.text.length;++g)this.sectionIndex.push(f)}addImageSection(s){const u=s.image?s.image.name:"";if(u.length===0)return void ve("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(ad.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ve("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jp(c,s,u,f,g,v,w,E,I,B,O,F,G,X,$,oe){const se=au.fromFeature(c,g);let ye;F===l.WritingMode.vertical&&se.verticalizePunctuation();const{processBidirectionalText:Te,processStyledBidirectionalText:_e}=Fr;if(Te&&se.sections.length===1){ye=[];const Oe=Te(se.toString(),fy(se,B,v,s,f,X,$));for(const st of Oe){const ht=new au;ht.text=st,ht.sections=se.sections;for(let tt=0;tt<st.length;tt++)ht.sectionIndex.push(0);ye.push(ht)}}else if(_e){ye=[];const Oe=_e(se.text,se.sectionIndex,fy(se,B,v,s,f,X,$));for(const st of Oe){const ht=new au;ht.text=st[0],ht.sectionIndex=st[1],ht.sections=se.sections,ye.push(ht)}}else ye=function(Oe,st){const ht=[],tt=Oe.text;let Je=0;for(const We of st)ht.push(Oe.substring(Je,We)),Je=We;return Je<tt.length&&ht.push(Oe.substring(Je,tt.length)),ht}(se,fy(se,B,v,s,f,X,$));const Ae=[],ke={positionedLines:Ae,text:se.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(Oe,st,ht,tt,Je,We,nt,Ye,Ve,wt,mt,kt){let Tn=0,Pn=Vp,di=0,os=0;const Fi=Ye==="right"?1:Ye==="left"?0:.5;let ti=0;for(const ni of Je){ni.trim();const Ni=ni.getMaxScale(),Zi=(Ni-1)*Ii,lr={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[ti]=lr;const Er=lr.positionedGlyphs;let Tr=0;if(!ni.length()){Pn+=We,++ti;continue}for(let bi=0;bi<ni.length();bi++){const jt=ni.getSection(bi),Ur=ni.getSectionIndex(bi),Ui=ni.getCharCode(bi);let Ji=0,Ls=null,eo=null,to=null,ca=Ii;const Rs=!(Ve===l.WritingMode.horizontal||!mt&&!Uh(Ui)||mt&&(Hp[Ui]||(xi=Ui,et.Arabic(xi)||et["Arabic Supplement"](xi)||et["Arabic Extended-A"](xi)||et["Arabic Presentation Forms-A"](xi)||et["Arabic Presentation Forms-B"](xi))));if(jt.imageName){const as=tt[jt.imageName];if(!as)continue;to=jt.imageName,Oe.iconsInText=Oe.iconsInText||!0,eo=as.paddedRect;const Sr=as.displaySize;jt.scale=jt.scale*Ii/kt,Ls={width:Sr[0],height:Sr[1],left:1,top:-3,advance:Rs?Sr[1]:Sr[0]},Ji=Zi+(Ii-Sr[1]*jt.scale),ca=Ls.advance;const ua=Rs?Sr[0]*jt.scale-Ii*Ni:Sr[1]*jt.scale-Ii*Ni;ua>0&&ua>Tr&&(Tr=ua)}else{const as=ht[jt.fontStack],Sr=as&&as[Ui];if(Sr&&Sr.rect)eo=Sr.rect,Ls=Sr.metrics;else{const ua=st[jt.fontStack],ud=ua&&ua[Ui];if(!ud)continue;Ls=ud.metrics}Ji=(Ni-jt.scale)*Ii}Rs?(Oe.verticalizable=!0,Er.push({glyph:Ui,imageName:to,x:Tn,y:Pn+Ji,vertical:Rs,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Ur,metrics:Ls,rect:eo}),Tn+=ca*jt.scale+wt):(Er.push({glyph:Ui,imageName:to,x:Tn,y:Pn+Ji,vertical:Rs,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Ur,metrics:Ls,rect:eo}),Tn+=Ls.advance*jt.scale+wt)}Er.length!==0&&(di=Math.max(Tn-wt,di),ER(Er,0,Er.length-1,Fi,Tr)),Tn=0;const Ln=We*Ni+Tr;lr.lineOffset=Math.max(Tr,Zi),Pn+=Ln,os=Math.max(Ln,os),++ti}var xi;const zi=Pn-Vp,{horizontalAlign:$i,verticalAlign:Ar}=py(nt);(function(ni,Ni,Zi,lr,Er,Tr,Ln,bi,jt){const Ur=(Ni-Zi)*Er;let Ui=0;Ui=Tr!==Ln?-bi*lr-Vp:(-lr*jt+.5)*Ln;for(const Ji of ni)for(const Ls of Ji.positionedGlyphs)Ls.x+=Ur,Ls.y+=Ui})(Oe.positionedLines,Fi,$i,Ar,di,os,We,zi,Je.length),Oe.top+=-Ar*zi,Oe.bottom=Oe.top+zi,Oe.left+=-$i*di,Oe.right=Oe.left+di}(ke,s,u,f,ye,w,E,I,F,B,G,oe),!function(Oe){for(const st of Oe)if(st.positionedGlyphs.length!==0)return!1;return!0}(Ae)&&ke}const Hp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wR={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Iw(c,s,u,f,g,v){if(s.imageName){const w=f[s.imageName];return w?w.displaySize[0]*s.scale*Ii/v+g:0}{const w=u[s.fontStack],E=w&&w[c];return E?E.metrics.advance*s.scale+g:0}}function Mw(c,s,u,f){const g=Math.pow(c-s,2);return f?c<s?g/2:2*g:g+Math.abs(u)*u}function AR(c,s,u){let f=0;return c===10&&(f-=1e4),u&&(f+=150),c!==40&&c!==65288||(f+=50),s!==41&&s!==65289||(f+=50),f}function Pw(c,s,u,f,g,v){let w=null,E=Mw(s,u,g,v);for(const I of f){const B=Mw(s-I.x,u,g,v)+I.badness;B<=E&&(w=I,E=B)}return{index:c,x:s,priorBreak:w,badness:E}}function Bw(c){return c?Bw(c.priorBreak).concat(c.index):[]}function fy(c,s,u,f,g,v,w){if(v!=="point")return[];if(!c)return[];const E=[],I=function(G,X,$,oe,se,ye){let Te=0;for(let _e=0;_e<G.length();_e++){const Ae=G.getSection(_e);Te+=Iw(G.getCharCode(_e),Ae,oe,se,X,ye)}return Te/Math.max(1,Math.ceil(Te/$))}(c,s,u,f,g,w),B=c.text.indexOf("​")>=0;let O=0;for(let G=0;G<c.length();G++){const X=c.getSection(G),$=c.getCharCode(G);if(Hp[$]||(O+=Iw($,X,f,g,s,w)),G<c.length()-1){const oe=!((F=$)<11904||!(et["Bopomofo Extended"](F)||et.Bopomofo(F)||et["CJK Compatibility Forms"](F)||et["CJK Compatibility Ideographs"](F)||et["CJK Compatibility"](F)||et["CJK Radicals Supplement"](F)||et["CJK Strokes"](F)||et["CJK Symbols and Punctuation"](F)||et["CJK Unified Ideographs Extension A"](F)||et["CJK Unified Ideographs"](F)||et["Enclosed CJK Letters and Months"](F)||et["Halfwidth and Fullwidth Forms"](F)||et.Hiragana(F)||et["Ideographic Description Characters"](F)||et["Kangxi Radicals"](F)||et["Katakana Phonetic Extensions"](F)||et.Katakana(F)||et["Vertical Forms"](F)||et["Yi Radicals"](F)||et["Yi Syllables"](F)));(wR[$]||oe||X.imageName)&&E.push(Pw(G+1,O,I,E,AR($,c.getCharCode(G+1),oe&&B),!1))}}var F;return Bw(Pw(c.length(),O,I,E,0,!0))}function py(c){let s=.5,u=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:s,verticalAlign:u}}function ER(c,s,u,f,g){if(!f&&!g)return;const v=c[u],w=(c[u].x+v.metrics.advance*v.scale)*f;for(let E=s;E<=u;E++)c[E].x-=w,c[E].y+=g}function TR(c,s,u){const{horizontalAlign:f,verticalAlign:g}=py(u),v=s[0]-c.displaySize[0]*f,w=s[1]-c.displaySize[1]*g;return{image:c,top:w,bottom:w+c.displaySize[1],left:v,right:v+c.displaySize[0]}}function Lw(c,s,u,f,g,v){const w=c.image;let E;if(w.content){const se=w.content,ye=w.pixelRatio||1;E=[se[0]/ye,se[1]/ye,w.displaySize[0]-se[2]/ye,w.displaySize[1]-se[3]/ye]}const I=s.left*v,B=s.right*v;let O,F,G,X;u==="width"||u==="both"?(X=g[0]+I-f[3],F=g[0]+B+f[1]):(X=g[0]+(I+B-w.displaySize[0])/2,F=X+w.displaySize[0]);const $=s.top*v,oe=s.bottom*v;return u==="height"||u==="both"?(O=g[1]+$-f[0],G=g[1]+oe+f[2]):(O=g[1]+($+oe-w.displaySize[1])/2,G=O+w.displaySize[1]),{image:w,top:O,right:F,bottom:G,left:X,collisionPadding:E}}const la=128;function Rw(c,s){const{expression:u}=s;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new In(c+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=u;let v=0;for(;v<f.length&&f[v]<=c;)v++;v=Math.max(0,v-1);let w=v;for(;w<f.length&&f[w]<c+1;)w++;w=Math.min(f.length-1,w);const E=f[v],I=f[w];return u.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:I,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:I,minSize:u.evaluate(new In(E)),maxSize:u.evaluate(new In(I)),interpolationType:g}}}class Qa extends yt{constructor(s,u,f,g){super(s,u),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new Qa(this.x,this.y,this.angle,this.segment)}}function Dw(c,s,u,f,g){if(s.segment===void 0)return!0;let v=s,w=s.segment+1,E=0;for(;E>-u/2;){if(w--,w<0)return!1;E-=c[w].dist(v),v=c[w]}E+=c[w].dist(c[w+1]),w++;const I=[];let B=0;for(;E<u/2;){const O=c[w],F=c[w+1];if(!F)return!1;let G=c[w-1].angleTo(O)-O.angleTo(F);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:E,angleDelta:G}),B+=G;E-I[0].distance>f;)B-=I.shift().angleDelta;if(B>g)return!1;w++,E+=O.dist(F)}return!0}function Ow(c){let s=0;for(let u=0;u<c.length-1;u++)s+=c[u].dist(c[u+1]);return s}function kw(c,s,u){return c?.6*s*u:0}function Fw(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function SR(c,s,u,f,g,v){const w=kw(u,g,v),E=Fw(u,f)*v;let I=0;const B=Ow(c)/2;for(let O=0;O<c.length-1;O++){const F=c[O],G=c[O+1],X=F.dist(G);if(I+X>B){const $=(B-I)/X,oe=Dt(F.x,G.x,$),se=Dt(F.y,G.y,$),ye=new Qa(oe,se,G.angleTo(F),O);return ye._round(),!w||Dw(c,ye,E,w,s)?ye:void 0}I+=X}}function CR(c,s,u,f,g,v,w,E,I){const B=kw(f,v,w),O=Fw(f,g),F=O*w,G=c[0].x===0||c[0].x===I||c[0].y===0||c[0].y===I;return s-F<s/4&&(s=F+s/4),zw(c,G?s/2*E%s:(O/2+2*v)*w*E%s,s,B,u,F,G,!1,I)}function zw(c,s,u,f,g,v,w,E,I){const B=v/2,O=Ow(c);let F=0,G=s-u,X=[];for(let $=0;$<c.length-1;$++){const oe=c[$],se=c[$+1],ye=oe.dist(se),Te=se.angleTo(oe);for(;G+u<F+ye;){G+=u;const _e=(G-F)/ye,Ae=Dt(oe.x,se.x,_e),ke=Dt(oe.y,se.y,_e);if(Ae>=0&&Ae<I&&ke>=0&&ke<I&&G-B>=0&&G+B<=O){const Oe=new Qa(Ae,ke,Te,$);Oe._round(),f&&!Dw(c,Oe,v,f,g)||X.push(Oe)}}F+=ye}return E||X.length||w||(X=zw(c,F/2,u,f,g,v,w,!0,I)),X}function Nw(c,s,u,f,g){const v=[];for(let w=0;w<c.length;w++){const E=c[w];let I;for(let B=0;B<E.length-1;B++){let O=E[B],F=E[B+1];O.x<s&&F.x<s||(O.x<s?O=new yt(s,O.y+(s-O.x)/(F.x-O.x)*(F.y-O.y))._round():F.x<s&&(F=new yt(s,O.y+(s-O.x)/(F.x-O.x)*(F.y-O.y))._round()),O.y<u&&F.y<u||(O.y<u?O=new yt(O.x+(u-O.y)/(F.y-O.y)*(F.x-O.x),u)._round():F.y<u&&(F=new yt(O.x+(u-O.y)/(F.y-O.y)*(F.x-O.x),u)._round()),O.x>=f&&F.x>=f||(O.x>=f?O=new yt(f,O.y+(f-O.x)/(F.x-O.x)*(F.y-O.y))._round():F.x>=f&&(F=new yt(f,O.y+(f-O.x)/(F.x-O.x)*(F.y-O.y))._round()),O.y>=g&&F.y>=g||(O.y>=g?O=new yt(O.x+(g-O.y)/(F.y-O.y)*(F.x-O.x),g)._round():F.y>=g&&(F=new yt(O.x+(g-O.y)/(F.y-O.y)*(F.x-O.x),g)._round()),I&&O.equals(I[I.length-1])||(I=[O],v.push(I)),I.push(F)))))}}return v}function Uw(c,s,u,f){const g=[],v=c.image,w=v.pixelRatio,E=v.paddedRect.w-2,I=v.paddedRect.h-2,B=c.right-c.left,O=c.bottom-c.top,F=v.stretchX||[[0,E]],G=v.stretchY||[[0,I]],X=(We,nt)=>We+nt[1]-nt[0],$=F.reduce(X,0),oe=G.reduce(X,0),se=E-$,ye=I-oe;let Te=0,_e=$,Ae=0,ke=oe,Oe=0,st=se,ht=0,tt=ye;if(v.content&&f){const We=v.content;Te=Wp(F,0,We[0]),Ae=Wp(G,0,We[1]),_e=Wp(F,We[0],We[2]),ke=Wp(G,We[1],We[3]),Oe=We[0]-Te,ht=We[1]-Ae,st=We[2]-We[0]-_e,tt=We[3]-We[1]-ke}const Je=(We,nt,Ye,Ve)=>{const wt=Xp(We.stretch-Te,_e,B,c.left),mt=qp(We.fixed-Oe,st,We.stretch,$),kt=Xp(nt.stretch-Ae,ke,O,c.top),Tn=qp(nt.fixed-ht,tt,nt.stretch,oe),Pn=Xp(Ye.stretch-Te,_e,B,c.left),di=qp(Ye.fixed-Oe,st,Ye.stretch,$),os=Xp(Ve.stretch-Ae,ke,O,c.top),Fi=qp(Ve.fixed-ht,tt,Ve.stretch,oe),ti=new yt(wt,kt),xi=new yt(Pn,kt),zi=new yt(Pn,os),$i=new yt(wt,os),Ar=new yt(mt/w,Tn/w),ni=new yt(di/w,Fi/w),Ni=s*Math.PI/180;if(Ni){const Er=Math.sin(Ni),Tr=Math.cos(Ni),Ln=[Tr,-Er,Er,Tr];ti._matMult(Ln),xi._matMult(Ln),$i._matMult(Ln),zi._matMult(Ln)}const Zi=We.stretch+We.fixed,lr=nt.stretch+nt.fixed;return{tl:ti,tr:xi,bl:$i,br:zi,tex:{x:v.paddedRect.x+1+Zi,y:v.paddedRect.y+1+lr,w:Ye.stretch+Ye.fixed-Zi,h:Ve.stretch+Ve.fixed-lr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ar,pixelOffsetBR:ni,minFontScaleX:st/w/B,minFontScaleY:tt/w/O,isSDF:u}};if(f&&(v.stretchX||v.stretchY)){const We=Gw(F,se,$),nt=Gw(G,ye,oe);for(let Ye=0;Ye<We.length-1;Ye++){const Ve=We[Ye],wt=We[Ye+1];for(let mt=0;mt<nt.length-1;mt++)g.push(Je(Ve,nt[mt],wt,nt[mt+1]))}}else g.push(Je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:I+1}));return g}function Wp(c,s,u){let f=0;for(const g of c)f+=Math.max(s,Math.min(u,g[1]))-Math.max(s,Math.min(u,g[0]));return f}function Gw(c,s,u){const f=[{fixed:-1,stretch:0}];for(const[g,v]of c){const w=f[f.length-1];f.push({fixed:g-w.stretch,stretch:w.stretch}),f.push({fixed:g-w.stretch,stretch:w.stretch+(v-g)})}return f.push({fixed:s+1,stretch:u}),f}function Xp(c,s,u,f){return c/s*u+f}function qp(c,s,u,f){return c-s*u/f}at("Anchor",Qa);class $p{constructor(s,u,f,g,v,w,E,I,B,O){if(this.boxStartIndex=s.length,B){let F=w.top,G=w.bottom;const X=w.collisionPadding;X&&(F-=X[1],G+=X[3]);let $=G-F;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{let F=w.top*E-I[0],G=w.bottom*E+I[2],X=w.left*E-I[3],$=w.right*E+I[1];const oe=w.collisionPadding;if(oe&&(X-=oe[0]*E,F-=oe[1]*E,$+=oe[2]*E,G+=oe[3]*E),O){const se=new yt(X,F),ye=new yt($,F),Te=new yt(X,G),_e=new yt($,G),Ae=O*Math.PI/180;se._rotate(Ae),ye._rotate(Ae),Te._rotate(Ae),_e._rotate(Ae),X=Math.min(se.x,ye.x,Te.x,_e.x),$=Math.max(se.x,ye.x,Te.x,_e.x),F=Math.min(se.y,ye.y,Te.y,_e.y),G=Math.max(se.y,ye.y,Te.y,_e.y)}s.emplaceBack(u.x,u.y,X,F,$,G,f,g,v)}this.boxEndIndex=s.length}}class IR{constructor(s=[],u=MR){if(this.data=s,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:u,compare:f}=this,g=u[s];for(;s>0;){const v=s-1>>1,w=u[v];if(f(g,w)>=0)break;u[s]=w,s=v}u[s]=g}_down(s){const{data:u,compare:f}=this,g=this.length>>1,v=u[s];for(;s<g;){let w=1+(s<<1),E=u[w];const I=w+1;if(I<this.length&&f(u[I],E)<0&&(w=I,E=u[I]),f(E,v)>=0)break;u[s]=E,s=w}u[s]=v}}function MR(c,s){return c<s?-1:c>s?1:0}function PR(c,s=1,u=!1){let f=1/0,g=1/0,v=-1/0,w=-1/0;const E=c[0];for(let X=0;X<E.length;X++){const $=E[X];(!X||$.x<f)&&(f=$.x),(!X||$.y<g)&&(g=$.y),(!X||$.x>v)&&(v=$.x),(!X||$.y>w)&&(w=$.y)}const I=Math.min(v-f,w-g);let B=I/2;const O=new IR([],BR);if(I===0)return new yt(f,g);for(let X=f;X<v;X+=I)for(let $=g;$<w;$+=I)O.push(new lu(X+B,$+B,B,c));let F=function(X){let $=0,oe=0,se=0;const ye=X[0];for(let Te=0,_e=ye.length,Ae=_e-1;Te<_e;Ae=Te++){const ke=ye[Te],Oe=ye[Ae],st=ke.x*Oe.y-Oe.x*ke.y;oe+=(ke.x+Oe.x)*st,se+=(ke.y+Oe.y)*st,$+=3*st}return new lu(oe/$,se/$,0,X)}(c),G=O.length;for(;O.length;){const X=O.pop();(X.d>F.d||!F.d)&&(F=X,u&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,G)),X.max-F.d<=s||(B=X.h/2,O.push(new lu(X.p.x-B,X.p.y-B,B,c)),O.push(new lu(X.p.x+B,X.p.y-B,B,c)),O.push(new lu(X.p.x-B,X.p.y+B,B,c)),O.push(new lu(X.p.x+B,X.p.y+B,B,c)),G+=4)}return u&&(console.log(`num probes: ${G}`),console.log(`best distance: ${F.d}`)),F.p}function BR(c,s){return s.max-c.max}function lu(c,s,u,f){this.p=new yt(c,s),this.h=u,this.d=function(g,v){let w=!1,E=1/0;for(let I=0;I<v.length;I++){const B=v[I];for(let O=0,F=B.length,G=F-1;O<F;G=O++){const X=B[O],$=B[G];X.y>g.y!=$.y>g.y&&g.x<($.x-X.x)*(g.y-X.y)/($.y-X.y)+X.x&&(w=!w),E=Math.min(E,Zb(g,X,$))}}return(w?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}const my=Number.POSITIVE_INFINITY;function Vw(c,s){return s[1]!==my?function(u,f,g){let v=0,w=0;switch(f=Math.abs(f),g=Math.abs(g),u){case"top-right":case"top-left":case"top":w=g-7;break;case"bottom-right":case"bottom-left":case"bottom":w=7-g}switch(u){case"top-right":case"bottom-right":case"right":v=-f;break;case"top-left":case"bottom-left":case"left":v=f}return[v,w]}(c,s[0],s[1]):function(u,f){let g=0,v=0;f<0&&(f=0);const w=f/Math.sqrt(2);switch(u){case"top-right":case"top-left":v=w-7;break;case"bottom-right":case"bottom-left":v=7-w;break;case"bottom":v=7-f;break;case"top":v=f-7}switch(u){case"top-right":case"bottom-right":g=-w;break;case"top-left":case"bottom-left":g=w;break;case"left":g=f;break;case"right":g=-f}return[g,v]}(c,s[0])}function gy(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function LR(c,s,u,f,g,v,w,E,I,B,O){let F=v.textMaxSize.evaluate(s,{});F===void 0&&(F=w);const G=c.layers[0].layout,X=G.get("icon-offset").evaluate(s,{},O),$=Hw(u.horizontal),oe=w/24,se=c.tilePixelRatio*oe,ye=c.tilePixelRatio*F/24,Te=c.tilePixelRatio*E,_e=c.tilePixelRatio*G.get("symbol-spacing"),Ae=G.get("text-padding")*c.tilePixelRatio,ke=function(Ve,wt,mt,kt=1){const Tn=Ve.get("icon-padding").evaluate(wt,{},mt),Pn=Tn&&Tn.values;return[Pn[0]*kt,Pn[1]*kt,Pn[2]*kt,Pn[3]*kt]}(G,s,O,c.tilePixelRatio),Oe=G.get("text-max-angle")/180*Math.PI,st=G.get("text-rotation-alignment")!=="viewport"&&G.get("symbol-placement")!=="point",ht=G.get("icon-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",tt=G.get("symbol-placement"),Je=_e/2,We=G.get("icon-text-fit");let nt;f&&We!=="none"&&(c.allowVerticalPlacement&&u.vertical&&(nt=Lw(f,u.vertical,We,G.get("icon-text-fit-padding"),X,oe)),$&&(f=Lw(f,$,We,G.get("icon-text-fit-padding"),X,oe)));const Ye=(Ve,wt)=>{wt.x<0||wt.x>=hi||wt.y<0||wt.y>=hi||function(mt,kt,Tn,Pn,di,os,Fi,ti,xi,zi,$i,Ar,ni,Ni,Zi,lr,Er,Tr,Ln,bi,jt,Ur,Ui,Ji,Ls){const eo=mt.addToLineVertexArray(kt,Tn);let to,ca,Rs,as,Sr=0,ua=0,ud=0,oA=0,Sy=-1,Cy=-1;const ha={};let aA=vi.exports(""),Iy=0,My=0;if(ti._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Iy,My]=ti.layout.get("text-offset").evaluate(jt,{},Ji).map(Cr=>Cr*Ii):(Iy=ti.layout.get("text-radial-offset").evaluate(jt,{},Ji)*Ii,My=my),mt.allowVerticalPlacement&&Pn.vertical){const Cr=ti.layout.get("text-rotate").evaluate(jt,{},Ji)+90;Rs=new $p(xi,kt,zi,$i,Ar,Pn.vertical,ni,Ni,Zi,Cr),Fi&&(as=new $p(xi,kt,zi,$i,Ar,Fi,Er,Tr,Zi,Cr))}if(di){const Cr=ti.layout.get("icon-rotate").evaluate(jt,{}),Do=ti.layout.get("icon-text-fit")!=="none",hd=Uw(di,Cr,Ui,Do),dd=Fi?Uw(Fi,Cr,Ui,Do):void 0;ca=new $p(xi,kt,zi,$i,Ar,di,Er,Tr,!1,Cr),Sr=4*hd.length;const uA=mt.iconSizeData;let sc=null;uA.kind==="source"?(sc=[la*ti.layout.get("icon-size").evaluate(jt,{})],sc[0]>el&&ve(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):uA.kind==="composite"&&(sc=[la*Ur.compositeIconSizes[0].evaluate(jt,{},Ji),la*Ur.compositeIconSizes[1].evaluate(jt,{},Ji)],(sc[0]>el||sc[1]>el)&&ve(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,hd,sc,bi,Ln,jt,l.WritingMode.none,kt,eo.lineStartIndex,eo.lineLength,-1,Ji),Sy=mt.icon.placedSymbolArray.length-1,dd&&(ua=4*dd.length,mt.addSymbols(mt.icon,dd,sc,bi,Ln,jt,l.WritingMode.vertical,kt,eo.lineStartIndex,eo.lineLength,-1,Ji),Cy=mt.icon.placedSymbolArray.length-1)}const lA=Object.keys(Pn.horizontal);for(const Cr of lA){const Do=Pn.horizontal[Cr];if(!to){aA=vi.exports(Do.text);const dd=ti.layout.get("text-rotate").evaluate(jt,{},Ji);to=new $p(xi,kt,zi,$i,Ar,Do,ni,Ni,Zi,dd)}const hd=Do.positionedLines.length===1;if(ud+=jw(mt,kt,Do,os,ti,Zi,jt,lr,eo,Pn.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,hd?lA:[Cr],ha,Sy,Ur,Ji),hd)break}Pn.vertical&&(oA+=jw(mt,kt,Pn.vertical,os,ti,Zi,jt,lr,eo,l.WritingMode.vertical,["vertical"],ha,Cy,Ur,Ji));const WR=to?to.boxStartIndex:mt.collisionBoxArray.length,XR=to?to.boxEndIndex:mt.collisionBoxArray.length,qR=Rs?Rs.boxStartIndex:mt.collisionBoxArray.length,$R=Rs?Rs.boxEndIndex:mt.collisionBoxArray.length,ZR=ca?ca.boxStartIndex:mt.collisionBoxArray.length,JR=ca?ca.boxEndIndex:mt.collisionBoxArray.length,KR=as?as.boxStartIndex:mt.collisionBoxArray.length,YR=as?as.boxEndIndex:mt.collisionBoxArray.length;let no=-1;const Qp=(Cr,Do)=>Cr&&Cr.circleDiameter?Math.max(Cr.circleDiameter,Do):Do;no=Qp(to,no),no=Qp(Rs,no),no=Qp(ca,no),no=Qp(as,no);const cA=no>-1?1:0;cA&&(no*=Ls/Ii),mt.glyphOffsetArray.length>=cu.MAX_GLYPHS&&ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jt.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,jt.sortKey),mt.symbolInstances.emplaceBack(kt.x,kt.y,ha.right>=0?ha.right:-1,ha.center>=0?ha.center:-1,ha.left>=0?ha.left:-1,ha.vertical||-1,Sy,Cy,aA,WR,XR,qR,$R,ZR,JR,KR,YR,zi,ud,oA,Sr,ua,cA,0,ni,Iy,My,no)}(c,wt,Ve,u,f,g,nt,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,se,[Ae,Ae,Ae,Ae],st,I,Te,ke,ht,X,s,v,B,O,w)};if(tt==="line")for(const Ve of Nw(s.geometry,0,0,hi,hi)){const wt=CR(Ve,_e,Oe,u.vertical||$,f,24,ye,c.overscaling,hi);for(const mt of wt){const kt=$;kt&&RR(c,kt.text,Je,mt)||Ye(Ve,mt)}}else if(tt==="line-center"){for(const Ve of s.geometry)if(Ve.length>1){const wt=SR(Ve,Oe,u.vertical||$,f,24,ye);wt&&Ye(Ve,wt)}}else if(s.type==="Polygon")for(const Ve of iy(s.geometry,0)){const wt=PR(Ve,16);Ye(Ve[0],new Qa(wt.x,wt.y,0))}else if(s.type==="LineString")for(const Ve of s.geometry)Ye(Ve,new Qa(Ve[0].x,Ve[0].y,0));else if(s.type==="Point")for(const Ve of s.geometry)for(const wt of Ve)Ye([wt],new Qa(wt.x,wt.y,0))}const el=32640;function jw(c,s,u,f,g,v,w,E,I,B,O,F,G,X,$){const oe=function(Te,_e,Ae,ke,Oe,st,ht,tt){const Je=ke.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,We=[];for(const nt of _e.positionedLines)for(const Ye of nt.positionedGlyphs){if(!Ye.rect)continue;const Ve=Ye.rect||{};let wt=4,mt=!0,kt=1,Tn=0;const Pn=(Oe||tt)&&Ye.vertical,di=Ye.metrics.advance*Ye.scale/2;if(tt&&_e.verticalizable){const Ln=(Ye.scale-1)*Ii,bi=(Ii-Ye.metrics.width*Ye.scale)/2;Tn=nt.lineOffset/2-(Ye.imageName?-bi:Ln)}if(Ye.imageName){const Ln=ht[Ye.imageName];mt=Ln.sdf,kt=Ln.pixelRatio,wt=1/kt}const os=Oe?[Ye.x+di,Ye.y]:[0,0];let Fi=Oe?[0,0]:[Ye.x+di+Ae[0],Ye.y+Ae[1]-Tn],ti=[0,0];Pn&&(ti=Fi,Fi=[0,0]);const xi=(Ye.metrics.left-wt)*Ye.scale-di+Fi[0],zi=(-Ye.metrics.top-wt)*Ye.scale+Fi[1],$i=xi+Ve.w*Ye.scale/kt,Ar=zi+Ve.h*Ye.scale/kt,ni=new yt(xi,zi),Ni=new yt($i,zi),Zi=new yt(xi,Ar),lr=new yt($i,Ar);if(Pn){const Ln=new yt(-di,di-Vp),bi=-Math.PI/2,jt=12-di,Ur=new yt(22-jt,-(Ye.imageName?jt:0)),Ui=new yt(...ti);ni._rotateAround(bi,Ln)._add(Ur)._add(Ui),Ni._rotateAround(bi,Ln)._add(Ur)._add(Ui),Zi._rotateAround(bi,Ln)._add(Ur)._add(Ui),lr._rotateAround(bi,Ln)._add(Ur)._add(Ui)}if(Je){const Ln=Math.sin(Je),bi=Math.cos(Je),jt=[bi,-Ln,Ln,bi];ni._matMult(jt),Ni._matMult(jt),Zi._matMult(jt),lr._matMult(jt)}const Er=new yt(0,0),Tr=new yt(0,0);We.push({tl:ni,tr:Ni,bl:Zi,br:lr,tex:Ve,writingMode:_e.writingMode,glyphOffset:os,sectionIndex:Ye.sectionIndex,isSDF:mt,pixelOffsetTL:Er,pixelOffsetBR:Tr,minFontScaleX:0,minFontScaleY:0})}return We}(0,u,E,g,v,w,f,c.allowVerticalPlacement),se=c.textSizeData;let ye=null;se.kind==="source"?(ye=[la*g.layout.get("text-size").evaluate(w,{})],ye[0]>el&&ve(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(ye=[la*X.compositeTextSizes[0].evaluate(w,{},$),la*X.compositeTextSizes[1].evaluate(w,{},$)],(ye[0]>el||ye[1]>el)&&ve(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,oe,ye,E,v,w,B,s,I.lineStartIndex,I.lineLength,G,$);for(const Te of O)F[Te]=c.text.placedSymbolArray.length-1;return 4*oe.length}function Hw(c){for(const s in c)return c[s];return null}function RR(c,s,u,f){const g=c.compareText;if(s in g){const v=g[s];for(let w=v.length-1;w>=0;w--)if(f.dist(v[w])<u)return!0}else g[s]=[];return g[s].push(f),!1}const DR=Ka.VectorTileFeature.types,OR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Zp(c,s,u,f,g,v,w,E,I,B,O,F,G){const X=E?Math.min(el,Math.round(E[0])):0,$=E?Math.min(el,Math.round(E[1])):0;c.emplaceBack(s,u,Math.round(32*f),Math.round(32*g),v,w,(X<<1)+(I?1:0),$,16*B,16*O,256*F,256*G)}function _y(c,s,u){c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u),c.emplaceBack(s.x,s.y,u)}function kR(c){for(const s of c.sections)if(Ep(s.text))return!0;return!1}class yy{constructor(s){this.layoutVertexArray=new Ps,this.indexArray=new sr,this.programConfigurations=s,this.segments=new Ut,this.dynamicLayoutVertexArray=new is,this.opacityVertexArray=new Bs,this.placedSymbolArray=new Ue}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,u,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,sR.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,oR.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,OR,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}at("SymbolBuffers",yy);class vy{constructor(s,u,f){this.layoutVertexArray=new s,this.layoutAttributes=u,this.indexArray=new f,this.segments=new Ut,this.collisionVertexArray=new zr}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,aR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}at("CollisionBuffers",vy);class cu{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(w=>w.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=K_([]),this.placementViewportMatrix=K_([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Rw(this.zoom,u["text-size"]),this.iconSizeData=Rw(this.zoom,u["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),v=f.get("symbol-z-order");this.canOverlap=by(f,"text-overlap","text-allow-overlap")!=="never"||by(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(w=>l.WritingMode[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=s.sourceID}createArrays(){this.text=new yy(new ec(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new yy(new ec(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new Ze,this.lineVertexArray=new rt,this.symbolInstances=new it}calculateGlyphDependencies(s,u,f,g,v){for(let w=0;w<s.length;w++)if(u[s.charCodeAt(w)]=!0,(f||g)&&v){const E=od[s.charAt(w)];E&&(u[E.charCodeAt(0)]=!0)}}populate(s,u,f){const g=this.layers[0],v=g.layout,w=v.get("text-font"),E=v.get("text-field"),I=v.get("icon-image"),B=(E.value.kind!=="constant"||E.value.value instanceof he&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),O=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,F=v.get("symbol-sort-key");if(this.features=[],!B&&!O)return;const G=u.iconDependencies,X=u.glyphDependencies,$=u.availableImages,oe=new In(this.zoom);for(const{feature:se,id:ye,index:Te,sourceLayerIndex:_e}of s){const Ae=g._featureFilter.needGeometry,ke=nc(se,Ae);if(!g._featureFilter.filter(oe,ke,f))continue;let Oe,st;if(Ae||(ke.geometry=tc(se)),B){const tt=g.getValueAndResolveTokens("text-field",ke,f,$),Je=he.factory(tt);kR(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||Kl()==="unavailable"||this.hasRTLText&&Fr.isParsed())&&(Oe=cR(Je,g,ke))}if(O){const tt=g.getValueAndResolveTokens("icon-image",ke,f,$);st=tt instanceof me?tt:me.fromString(tt)}if(!Oe&&!st)continue;const ht=this.sortFeaturesByKey?F.evaluate(ke,{},f):void 0;if(this.features.push({id:ye,text:Oe,icon:st,index:Te,sourceLayerIndex:_e,geometry:ke.geometry,properties:se.properties,type:DR[se.type],sortKey:ht}),st&&(G[st.name]=!0),Oe){const tt=w.evaluate(ke,{},f).join(","),Je=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const We of Oe.sections)if(We.image)G[We.image.name]=!0;else{const nt=Kc(Oe.toString()),Ye=We.fontStack||tt,Ve=X[Ye]=X[Ye]||{};this.calculateGlyphDependencies(We.text,Ve,Je,this.allowVerticalPlacement,nt)}}}v.get("symbol-placement")==="line"&&(this.features=function(se){const ye={},Te={},_e=[];let Ae=0;function ke(tt){_e.push(se[tt]),Ae++}function Oe(tt,Je,We){const nt=Te[tt];return delete Te[tt],Te[Je]=nt,_e[nt].geometry[0].pop(),_e[nt].geometry[0]=_e[nt].geometry[0].concat(We[0]),nt}function st(tt,Je,We){const nt=ye[Je];return delete ye[Je],ye[tt]=nt,_e[nt].geometry[0].shift(),_e[nt].geometry[0]=We[0].concat(_e[nt].geometry[0]),nt}function ht(tt,Je,We){const nt=We?Je[0][Je[0].length-1]:Je[0][0];return`${tt}:${nt.x}:${nt.y}`}for(let tt=0;tt<se.length;tt++){const Je=se[tt],We=Je.geometry,nt=Je.text?Je.text.toString():null;if(!nt){ke(tt);continue}const Ye=ht(nt,We),Ve=ht(nt,We,!0);if(Ye in Te&&Ve in ye&&Te[Ye]!==ye[Ve]){const wt=st(Ye,Ve,We),mt=Oe(Ye,Ve,_e[wt].geometry);delete ye[Ye],delete Te[Ve],Te[ht(nt,_e[mt].geometry,!0)]=mt,_e[wt].geometry=null}else Ye in Te?Oe(Ye,Ve,We):Ve in ye?st(Ye,Ve,We):(ke(tt),ye[Ye]=Ae-1,Te[Ve]=Ae-1)}return _e.filter(tt=>tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,ye)=>se.sortKey-ye.sortKey)}update(s,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(s,u,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,u){const f=this.lineVertexArray.length;if(s.segment!==void 0){let g=s.dist(u[s.segment+1]),v=s.dist(u[s.segment]);const w={};for(let E=s.segment+1;E<u.length;E++)w[E]={x:u[E].x,y:u[E].y,tileUnitDistanceFromAnchor:g},E<u.length-1&&(g+=u[E+1].dist(u[E]));for(let E=s.segment||0;E>=0;E--)w[E]={x:u[E].x,y:u[E].y,tileUnitDistanceFromAnchor:v},E>0&&(v+=u[E-1].dist(u[E]));for(let E=0;E<u.length;E++){const I=w[E];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(s,u,f,g,v,w,E,I,B,O,F,G){const X=s.indexArray,$=s.layoutVertexArray,oe=s.segments.prepareSegment(4*u.length,$,X,this.canOverlap?w.sortKey:void 0),se=this.glyphOffsetArray.length,ye=oe.vertexLength,Te=this.allowVerticalPlacement&&E===l.WritingMode.vertical?Math.PI/2:0,_e=w.text&&w.text.sections;for(let Ae=0;Ae<u.length;Ae++){const{tl:ke,tr:Oe,bl:st,br:ht,tex:tt,pixelOffsetTL:Je,pixelOffsetBR:We,minFontScaleX:nt,minFontScaleY:Ye,glyphOffset:Ve,isSDF:wt,sectionIndex:mt}=u[Ae],kt=oe.vertexLength,Tn=Ve[1];Zp($,I.x,I.y,ke.x,Tn+ke.y,tt.x,tt.y,f,wt,Je.x,Je.y,nt,Ye),Zp($,I.x,I.y,Oe.x,Tn+Oe.y,tt.x+tt.w,tt.y,f,wt,We.x,Je.y,nt,Ye),Zp($,I.x,I.y,st.x,Tn+st.y,tt.x,tt.y+tt.h,f,wt,Je.x,We.y,nt,Ye),Zp($,I.x,I.y,ht.x,Tn+ht.y,tt.x+tt.w,tt.y+tt.h,f,wt,We.x,We.y,nt,Ye),_y(s.dynamicLayoutVertexArray,I,Te),X.emplaceBack(kt,kt+1,kt+2),X.emplaceBack(kt+1,kt+2,kt+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ve[0]),Ae!==u.length-1&&mt===u[Ae+1].sectionIndex||s.programConfigurations.populatePaintArrays($.length,w,w.index,{},G,_e&&_e[mt])}s.placedSymbolArray.emplaceBack(I.x,I.y,se,this.glyphOffsetArray.length-se,ye,B,O,I.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],E,0,!1,0,F)}_addCollisionDebugVertex(s,u,f,g,v,w){return u.emplaceBack(0,0),s.emplaceBack(f.x,f.y,g,v,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(s,u,f,g,v,w,E){const I=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),B=I.vertexLength,O=v.layoutVertexArray,F=v.collisionVertexArray,G=E.anchorX,X=E.anchorY;this._addCollisionDebugVertex(O,F,w,G,X,new yt(s,u)),this._addCollisionDebugVertex(O,F,w,G,X,new yt(f,u)),this._addCollisionDebugVertex(O,F,w,G,X,new yt(f,g)),this._addCollisionDebugVertex(O,F,w,G,X,new yt(s,g)),I.vertexLength+=4;const $=v.indexArray;$.emplaceBack(B,B+1),$.emplaceBack(B+1,B+2),$.emplaceBack(B+2,B+3),$.emplaceBack(B+3,B),I.primitiveLength+=4}addDebugCollisionBoxes(s,u,f,g){for(let v=s;v<u;v++){const w=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,g?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vy(Lo,vw.members,Ys),this.iconCollisionBox=new vy(Lo,vw.members,Ys);for(let s=0;s<this.symbolInstances.length;s++){const u=this.symbolInstances.get(s);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(s,u,f,g,v,w,E,I,B){const O={};for(let F=u;F<f;F++){const G=s.get(F);O.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},O.textFeatureIndex=G.featureIndex;break}for(let F=g;F<v;F++){const G=s.get(F);O.verticalTextBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},O.verticalTextFeatureIndex=G.featureIndex;break}for(let F=w;F<E;F++){const G=s.get(F);O.iconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},O.iconFeatureIndex=G.featureIndex;break}for(let F=I;F<B;F++){const G=s.get(F);O.verticalIconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},O.verticalIconFeatureIndex=G.featureIndex;break}return O}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,u){const f=s.placedSymbolArray.get(u),g=f.vertexStartIndex+4*f.numGlyphs;for(let v=f.vertexStartIndex;v<g;v+=4)s.indexArray.emplaceBack(v,v+1,v+2),s.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(s),f=Math.cos(s),g=[],v=[],w=[];for(let E=0;E<this.symbolInstances.length;++E){w.push(E);const I=this.symbolInstances.get(E);g.push(0|Math.round(u*I.anchorX+f*I.anchorY)),v.push(I.featureIndex)}return w.sort((E,I)=>g[E]-g[I]||v[I]-v[E]),w}addToSortKeyRanges(s,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,v,w)=>{g>=0&&w.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}at("SymbolBucket",cu,{omit:["layers","collisionBoxArray","features","compareText"]}),cu.MAX_GLYPHS=65535,cu.addDynamicAttributes=_y;const FR=new Ci({"symbol-placement":new ft(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new ft(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ft(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tt(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ft(Be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ft(Be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ft(Be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ft(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new ft(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ft(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tt(Be.layout_symbol["icon-size"]),"icon-text-fit":new ft(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ft(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tt(Be.layout_symbol["icon-image"]),"icon-rotate":new Tt(Be.layout_symbol["icon-rotate"]),"icon-padding":new Tt(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new ft(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new Tt(Be.layout_symbol["icon-offset"]),"icon-anchor":new Tt(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ft(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ft(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ft(Be.layout_symbol["text-rotation-alignment"]),"text-field":new Tt(Be.layout_symbol["text-field"]),"text-font":new Tt(Be.layout_symbol["text-font"]),"text-size":new Tt(Be.layout_symbol["text-size"]),"text-max-width":new Tt(Be.layout_symbol["text-max-width"]),"text-line-height":new ft(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new Tt(Be.layout_symbol["text-letter-spacing"]),"text-justify":new Tt(Be.layout_symbol["text-justify"]),"text-radial-offset":new Tt(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ft(Be.layout_symbol["text-variable-anchor"]),"text-anchor":new Tt(Be.layout_symbol["text-anchor"]),"text-max-angle":new ft(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new ft(Be.layout_symbol["text-writing-mode"]),"text-rotate":new Tt(Be.layout_symbol["text-rotate"]),"text-padding":new ft(Be.layout_symbol["text-padding"]),"text-keep-upright":new ft(Be.layout_symbol["text-keep-upright"]),"text-transform":new Tt(Be.layout_symbol["text-transform"]),"text-offset":new Tt(Be.layout_symbol["text-offset"]),"text-allow-overlap":new ft(Be.layout_symbol["text-allow-overlap"]),"text-overlap":new ft(Be.layout_symbol["text-overlap"]),"text-ignore-placement":new ft(Be.layout_symbol["text-ignore-placement"]),"text-optional":new ft(Be.layout_symbol["text-optional"])});var xy={paint:new Ci({"icon-opacity":new Tt(Be.paint_symbol["icon-opacity"]),"icon-color":new Tt(Be.paint_symbol["icon-color"]),"icon-halo-color":new Tt(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tt(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tt(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new ft(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new ft(Be.paint_symbol["icon-translate-anchor"]),"text-opacity":new Tt(Be.paint_symbol["text-opacity"]),"text-color":new Tt(Be.paint_symbol["text-color"],{runtimeType:li,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Tt(Be.paint_symbol["text-halo-color"]),"text-halo-width":new Tt(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new Tt(Be.paint_symbol["text-halo-blur"]),"text-translate":new ft(Be.paint_symbol["text-translate"]),"text-translate-anchor":new ft(Be.paint_symbol["text-translate-anchor"])}),layout:FR};class Ww{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:Ss,this.defaultValue=s}evaluate(s){if(s.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(s.formattedSection))return u.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}at("FormatSectionOverride",Ww,{omit:["defaultValue"]});class Jp extends Ms{constructor(s){super(s,xy)}recalculate(s,u){if(super.recalculate(s,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const v of f)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,u,f,g){const v=this.layout.get(s).evaluate(u,{},f,g),w=this._unevaluatedLayout._values[s];return w.isDataDriven()||zl(w.value)||!v?v:function(E,I){return I.replace(/{([^{}]+)}/g,(B,O)=>O in E?String(E[O]):"")}(u.properties,v)}createBucket(s){return new cu(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of xy.paint.overridableProperties){if(!Jp.hasPaintOverride(this.layout,s))continue;const u=this.paint.get(s),f=new Ww(u),g=new Wc(f,u.property.specification);let v=null;v=u.value.kind==="constant"||u.value.kind==="source"?new Ul("source",g):new Dh("composite",g,u.value.zoomStops),this.paint._values[s]=new Is(u.property,v,u.parameters)}}_handleOverridablePaintPropertyUpdate(s,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&Jp.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,u){const f=s.get("text-field"),g=xy.paint.properties[u];let v=!1;const w=E=>{for(const I of E)if(g.overrides&&g.overrides.hasOverride(I))return void(v=!0)};if(f.value.kind==="constant"&&f.value.value instanceof he)w(f.value.value.sections);else if(f.value.kind==="source"){const E=B=>{v||(B instanceof ut&&Ce(B.value)===Qn?w(B.value.sections):B instanceof jc?w(B.sections):B.eachChild(E))},I=f.value;I._styleExpression&&E(I._styleExpression.expression)}return v}}function by(c,s,u){let f="never";const g=c.get(s);return g?f=g:c.get(u)&&(f="always"),f}var zR={paint:new Ci({"background-color":new ft(Be.paint_background["background-color"]),"background-pattern":new Xh(Be.paint_background["background-pattern"]),"background-opacity":new ft(Be.paint_background["background-opacity"])})},NR={paint:new Ci({"raster-opacity":new ft(Be.paint_raster["raster-opacity"]),"raster-hue-rotate":new ft(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ft(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ft(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new ft(Be.paint_raster["raster-saturation"]),"raster-contrast":new ft(Be.paint_raster["raster-contrast"]),"raster-resampling":new ft(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new ft(Be.paint_raster["raster-fade-duration"])})};class UR extends Ms{constructor(s){super(s,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const GR={circle:class extends Ms{constructor(c){super(c,_L)}createBucket(c){return new $_(c)}queryRadius(c){const s=c;return Kh("circle-radius",this,s)+Kh("circle-stroke-width",this,s)+Rp(this.paint.get("circle-translate"))}queryIntersectsFeature(c,s,u,f,g,v,w,E){const I=Dp(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,w),B=this.paint.get("circle-radius").evaluate(s,u)+this.paint.get("circle-stroke-width").evaluate(s,u),O=this.paint.get("circle-pitch-alignment")==="map",F=O?I:function(X,$){return X.map(oe=>nw(oe,$))}(I,E),G=O?B*w:B;for(const X of f)for(const $ of X){const oe=O?$:nw($,E);let se=G;const ye=Op([],[$.x,$.y,0,1],E);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?se*=ye[3]/v.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(se*=v.cameraToCenterDistance/ye[3]),dL(F,oe,se))return!0}return!1}},heatmap:class extends Ms{constructor(c){super(c,vL),this._updateColorRamp()}createBucket(c){return new iw(c)}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=sw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Ms{constructor(c){super(c,xL)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Ms{constructor(c){super(c,kL)}recalculate(c,s){super.recalculate(c,s);const u=this.paint._values["fill-outline-color"];u.value.kind==="constant"&&u.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new oy(c)}queryRadius(){return Rp(this.paint.get("fill-translate"))}queryIntersectsFeature(c,s,u,f,g,v,w){return $b(Dp(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,w),f)}isTileClipped(){return!0}},"fill-extrusion":class extends Ms{constructor(c){super(c,KL)}createBucket(c){return new ly(c)}queryRadius(){return Rp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,s,u,f,g,v,w,E){const I=Dp(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,w),B=this.paint.get("fill-extrusion-height").evaluate(s,u),O=this.paint.get("fill-extrusion-base").evaluate(s,u),F=function(X,$,oe,se){const ye=[];for(const Te of X){const _e=[Te.x,Te.y,0,1];Op(_e,_e,$),ye.push(new yt(_e[0]/_e[3],_e[1]/_e[3]))}return ye}(I,E),G=function(X,$,oe,se){const ye=[],Te=[],_e=se[8]*$,Ae=se[9]*$,ke=se[10]*$,Oe=se[11]*$,st=se[8]*oe,ht=se[9]*oe,tt=se[10]*oe,Je=se[11]*oe;for(const We of X){const nt=[],Ye=[];for(const Ve of We){const wt=Ve.x,mt=Ve.y,kt=se[0]*wt+se[4]*mt+se[12],Tn=se[1]*wt+se[5]*mt+se[13],Pn=se[2]*wt+se[6]*mt+se[14],di=se[3]*wt+se[7]*mt+se[15],os=Pn+ke,Fi=di+Oe,ti=kt+st,xi=Tn+ht,zi=Pn+tt,$i=di+Je,Ar=new yt((kt+_e)/Fi,(Tn+Ae)/Fi);Ar.z=os/Fi,nt.push(Ar);const ni=new yt(ti/$i,xi/$i);ni.z=zi/$i,Ye.push(ni)}ye.push(nt),Te.push(Ye)}return[ye,Te]}(f,O,B,E);return function(X,$,oe){let se=1/0;$b(oe,$)&&(se=pw(oe,$[0]));for(let ye=0;ye<$.length;ye++){const Te=$[ye],_e=X[ye];for(let Ae=0;Ae<Te.length-1;Ae++){const ke=Te[Ae],Oe=[ke,Te[Ae+1],_e[Ae+1],_e[Ae],ke];qb(oe,Oe)&&(se=Math.min(se,pw(oe,Oe)))}}return se!==1/0&&se}(G[0],G[1],F)}},line:class extends Ms{constructor(c){super(c,gw),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Bn,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,s){super.recalculate(c,s),this.paint._values["line-floorwidth"]=_w.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new cy(c)}queryRadius(c){const s=c,u=yw(Kh("line-width",this,s),Kh("line-gap-width",this,s)),f=Kh("line-offset",this,s);return u/2+Math.abs(f)+Rp(this.paint.get("line-translate"))}queryIntersectsFeature(c,s,u,f,g,v,w){const E=Dp(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,w),I=w/2*yw(this.paint.get("line-width").evaluate(s,u),this.paint.get("line-gap-width").evaluate(s,u)),B=this.paint.get("line-offset").evaluate(s,u);return B&&(f=function(O,F){const G=[];for(let X=0;X<O.length;X++){const $=O[X],oe=[];for(let se=0;se<$.length;se++){const ye=$[se-1],Te=$[se],_e=$[se+1],Ae=se===0?new yt(0,0):Te.sub(ye)._unit()._perp(),ke=se===$.length-1?new yt(0,0):_e.sub(Te)._unit()._perp(),Oe=Ae._add(ke)._unit(),st=Oe.x*ke.x+Oe.y*ke.y;st!==0&&Oe._mult(1/st),oe.push(Oe._mult(F)._add(Te))}G.push(oe)}return G}(f,B*w)),function(O,F,G){for(let X=0;X<F.length;X++){const $=F[X];if(O.length>=3){for(let oe=0;oe<$.length;oe++)if(nu(O,$[oe]))return!0}if(fL(O,$,G))return!0}return!1}(E,f,I)}isTileClipped(){return!0}},symbol:Jp,background:class extends Ms{constructor(c){super(c,zR)}},raster:class extends Ms{constructor(c){super(c,NR)}}};class VR{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Xw=63710088e-1;class Gn{constructor(s,u){if(isNaN(s)||isNaN(u))throw new Error(`Invalid LngLat object: (${s}, ${u})`);if(this.lng=+s,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Gn(z(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const u=Math.PI/180,f=this.lat*u,g=s.lat*u,v=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((s.lng-this.lng)*u);return Xw*Math.acos(Math.min(v,1))}toBounds(s=0){const u=360*s/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new rc(new Gn(this.lng-f,this.lat-u),new Gn(this.lng+f,this.lat+u))}static convert(s){if(s instanceof Gn)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new Gn(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new Gn(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class rc{constructor(s,u){s&&(u?this.setSouthWest(s).setNorthEast(u):s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1]))}setNorthEast(s){return this._ne=s instanceof Gn?new Gn(s.lng,s.lat):Gn.convert(s),this}setSouthWest(s){return this._sw=s instanceof Gn?new Gn(s.lng,s.lat):Gn.convert(s),this}extend(s){const u=this._sw,f=this._ne;let g,v;if(s instanceof Gn)g=s,v=s;else{if(!(s instanceof rc))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(rc.convert(s)):this.extend(Gn.convert(s)):this;if(g=s._sw,v=s._ne,!g||!v)return this}return u||f?(u.lng=Math.min(g.lng,u.lng),u.lat=Math.min(g.lat,u.lat),f.lng=Math.max(v.lng,f.lng),f.lat=Math.max(v.lat,f.lat)):(this._sw=new Gn(g.lng,g.lat),this._ne=new Gn(v.lng,v.lat)),this}getCenter(){return new Gn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Gn(this.getWest(),this.getNorth())}getSouthEast(){return new Gn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:u,lat:f}=Gn.convert(s);let g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}static convert(s){return s instanceof rc?s:s&&new rc(s)}}const qw=2*Math.PI*Xw;function $w(c){return qw*Math.cos(c*Math.PI/180)}function Zw(c){return(180+c)/360}function Jw(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Kw(c,s){return c/$w(s)}function wy(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class Kp{constructor(s,u,f=0){this.x=+s,this.y=+u,this.z=+f}static fromLngLat(s,u=0){const f=Gn.convert(s);return new Kp(Zw(f.lng),Jw(f.lat),Kw(u,f.lat))}toLngLat(){return new Gn(360*this.x-180,wy(this.y))}toAltitude(){return this.z*$w(wy(this.y))}meterInMercatorCoordinateUnits(){return 1/qw*(s=wy(this.y),1/Math.cos(s*Math.PI/180));var s}}function Yw(c,s,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[c*f-2*Math.PI*6378137/2,s*f-2*Math.PI*6378137/2]}class Ay{constructor(s,u,f){if(s<0||s>25||f<0||f>=Math.pow(2,s)||u<0||u>=Math.pow(2,s))throw new Error(`x=${u}, y=${f}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=u,this.y=f,this.key=ld(0,s,s,u,f)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,u,f){const g=(w=this.y,E=this.z,I=Yw(256*(v=this.x),256*(w=Math.pow(2,E)-w-1),E),B=Yw(256*(v+1),256*(w+1),E),I[0]+","+I[1]+","+B[0]+","+B[1]);var v,w,E,I,B;const O=function(F,G,X){let $,oe="";for(let se=F;se>0;se--)$=1<<se-1,oe+=(G&$?1:0)+(X&$?2:0);return oe}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,g)}isChildOf(s){const u=this.z-s.z;return u>0&&s.x===this.x>>u&&s.y===this.y>>u}getTilePoint(s){const u=Math.pow(2,this.z);return new yt((s.x*u-this.x)*hi,(s.y*u-this.y)*hi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qw{constructor(s,u){this.wrap=s,this.canonical=u,this.key=ld(s,u.z,u.z,u.x,u.y)}}class ss{constructor(s,u,f,g,v){if(s<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${f}`);this.overscaledZ=s,this.wrap=u,this.canonical=new Ay(f,+g,+v),this.key=ld(u,s,f,g,v)}clone(){return new ss(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-s;return s>this.canonical.z?new ss(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ss(s,this.wrap,s,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(s,u){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-s;return s>this.canonical.z?ld(this.wrap*+u,s,this.canonical.z,this.canonical.x,this.canonical.y):ld(this.wrap*+u,s,s,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const u=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>u&&s.canonical.y===this.canonical.y>>u}children(s){if(this.overscaledZ>=s)return[new ss(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new ss(u,this.wrap,u,f,g),new ss(u,this.wrap,u,f+1,g),new ss(u,this.wrap,u,f,g+1),new ss(u,this.wrap,u,f+1,g+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new ss(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new ss(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new Kp(s.x-this.wrap,s.y))}}function ld(c,s,u,f,g){(c*=2)<0&&(c=-1*c-1);const v=1<<u;return(v*v*c+v*g+f).toString(36)+u.toString(36)+s.toString(36)}at("CanonicalTileID",Ay),at("OverscaledTileID",ss,{omit:["posMatrix"]});class eA{constructor(s,u,f){if(this.uid=s,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void ve(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=u.height;const g=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=f||"mapbox";for(let v=0;v<g;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(g,v)]=this.data[this._idx(g-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,g)]=this.data[this._idx(v,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let v=0;v<g;v++)for(let w=0;w<g;w++){const E=this.get(v,w);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(s,u){const f=new Uint8Array(this.data.buffer),g=4*this._idx(s,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[g],f[g+1],f[g+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(s,u){if(s<-1||s>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(s+1)}_unpackMapbox(s,u,f){return(256*s*256+256*u+f)/10-1e4}_unpackTerrarium(s,u,f){return 256*s+u+f/256-32768}getPixels(){return new rs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,u,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let g=u*this.dim,v=u*this.dim+this.dim,w=f*this.dim,E=f*this.dim+this.dim;switch(u){case-1:g=v-1;break;case 1:v=g+1}switch(f){case-1:w=E-1;break;case 1:E=w+1}const I=-u*this.dim,B=-f*this.dim;for(let O=w;O<E;O++)for(let F=g;F<v;F++)this.data[this._idx(F,O)]=s.data[this._idx(F+I,O+B)]}}at("DEMData",eA);class tA{constructor(s){this._stringToNumber={},this._numberToString=[];for(let u=0;u<s.length;u++){const f=s[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class nA{constructor(s,u,f,g,v){this.type="Feature",this._vectorTileFeature=s,s._z=u,s._x=f,s._y=g,this.properties=s.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(s[u]=this[u]);return s}}class iA{constructor(s,u){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Jl(hi,16,0),this.grid3D=new Jl(hi,16,0),this.featureIndexArray=new Ot,this.promoteId=u}insert(s,u,f,g,v,w){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,v);const I=w?this.grid3D:this.grid;for(let B=0;B<u.length;B++){const O=u[B],F=[1/0,1/0,-1/0,-1/0];for(let G=0;G<O.length;G++){const X=O[G];F[0]=Math.min(F[0],X.x),F[1]=Math.min(F[1],X.y),F[2]=Math.max(F[2],X.x),F[3]=Math.max(F[3],X.y)}F[0]<hi&&F[1]<hi&&F[2]>=0&&F[3]>=0&&I.insert(E,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ka.VectorTile(new uy(this.rawTileData)).layers,this.sourceLayerCoder=new tA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,u,f,g){this.loadVTLayers();const v=s.params||{},w=hi/s.tileSize/s.scale,E=$c(v.filter),I=s.queryGeometry,B=s.queryPadding*w,O=sA(I),F=this.grid.query(O.minX-B,O.minY-B,O.maxX+B,O.maxY+B),G=sA(s.cameraQueryGeometry),X=this.grid3D.query(G.minX-B,G.minY-B,G.maxX+B,G.maxY+B,(se,ye,Te,_e)=>function(Ae,ke,Oe,st,ht){for(const Je of Ae)if(ke<=Je.x&&Oe<=Je.y&&st>=Je.x&&ht>=Je.y)return!0;const tt=[new yt(ke,Oe),new yt(ke,ht),new yt(st,ht),new yt(st,Oe)];if(Ae.length>2){for(const Je of tt)if(nu(Ae,Je))return!0}for(let Je=0;Je<Ae.length-1;Je++)if(mL(Ae[Je],Ae[Je+1],tt))return!0;return!1}(s.cameraQueryGeometry,se-B,ye-B,Te+B,_e+B));for(const se of X)F.push(se);F.sort(jR);const $={};let oe;for(let se=0;se<F.length;se++){const ye=F[se];if(ye===oe)continue;oe=ye;const Te=this.featureIndexArray.get(ye);let _e=null;this.loadMatchingFeature($,Te.bucketIndex,Te.sourceLayerIndex,Te.featureIndex,E,v.layers,v.availableImages,u,f,g,(Ae,ke,Oe)=>(_e||(_e=tc(Ae)),ke.queryIntersectsFeature(I,Ae,Oe,_e,this.z,s.transform,w,s.pixelPosMatrix)))}return $}loadMatchingFeature(s,u,f,g,v,w,E,I,B,O,F){const G=this.bucketLayerIDs[u];if(w&&!function(se,ye){for(let Te=0;Te<se.length;Te++)if(ye.indexOf(se[Te])>=0)return!0;return!1}(w,G))return;const X=this.sourceLayerCoder.decode(f),$=this.vtLayers[X].feature(g);if(v.needGeometry){const se=nc($,!0);if(!v.filter(new In(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!v.filter(new In(this.tileID.overscaledZ),$))return;const oe=this.getId($,X);for(let se=0;se<G.length;se++){const ye=G[se];if(w&&w.indexOf(ye)<0)continue;const Te=I[ye];if(!Te)continue;let _e={};oe&&O&&(_e=O.getState(Te.sourceLayer||"_geojsonTileLayer",oe));const Ae=V({},B[ye]);Ae.paint=rA(Ae.paint,Te.paint,$,_e,E),Ae.layout=rA(Ae.layout,Te.layout,$,_e,E);const ke=!F||F($,Te,_e);if(!ke)continue;const Oe=new nA($,this.z,this.x,this.y,oe);Oe.layer=Ae;let st=s[ye];st===void 0&&(st=s[ye]=[]),st.push({featureIndex:g,feature:Oe,intersectionZ:ke})}}lookupSymbolFeatures(s,u,f,g,v,w,E,I){const B={};this.loadVTLayers();const O=$c(v);for(const F of s)this.loadMatchingFeature(B,f,g,F,O,w,E,I,u);return B}hasLayer(s){for(const u of this.bucketLayerIDs)for(const f of u)if(s===f)return!0;return!1}getId(s,u){let f=s.id;return this.promoteId&&(f=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof f=="boolean"&&(f=Number(f))),f}}function rA(c,s,u,f,g){return q(c,(v,w)=>{const E=s instanceof Ql?s.get(w):null;return E&&E.evaluate?E.evaluate(u,f,g):E})}function sA(c){let s=1/0,u=1/0,f=-1/0,g=-1/0;for(const v of c)s=Math.min(s,v.x),u=Math.min(u,v.y),f=Math.max(f,v.x),g=Math.max(g,v.y);return{minX:s,minY:u,maxX:f,maxY:g}}function jR(c,s){return s-c}var Ey;at("FeatureIndex",iA,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(Ey=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",Ey.load="load",Ey.fullLoad="fullLoad";let Yp=null,cd=[];const Ty=1e3/30,HR={mark(c){performance.mark(c)},frame(c){const s=c;Yp!=null&&cd.push(s-Yp),Yp=s},clearMetrics(){Yp=null,cd=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const c in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[c])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const c=performance.getEntriesByName("loadTime")[0].duration,s=performance.getEntriesByName("fullLoadTime")[0].duration,u=cd.length,f=1/(cd.reduce((v,w)=>v+w,0)/u/1e3),g=cd.filter(v=>v>Ty).reduce((v,w)=>v+(w-Ty)/Ty,0);return{loadTime:c,fullLoadTime:s,fps:f,percentDroppedFrames:g/(u+g)*100}}};l.AJAXError=ai,l.ARRAY_TYPE=ar,l.Actor=class{constructor(c,s,u){this.target=c,this.parent=s,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ue(["receive","process"],this),this.invoker=new VR(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Fe()?c:window}send(c,s,u,f,g=!1){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[v]=u);const w=Xt(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:c,hasCallback:!!u,targetMapId:f,mustQueue:g,sourceMapId:this.mapId,data:ta(s,w)},w),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(c){const s=c.data,u=s.id;if(u&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[u];const f=this.cancelCallbacks[u];delete this.cancelCallbacks[u],f&&f()}else Fe()||s.mustQueue?(this.tasks[u]=s,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,s)}process(){if(!this.taskQueue.length)return;const c=this.taskQueue.shift(),s=this.tasks[c];delete this.tasks[c],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(c,s)}processTask(c,s){if(s.type==="<response>"){const u=this.callbacks[c];delete this.callbacks[c],u&&(s.error?u(Co(s.error)):u(null,Co(s.data)))}else{let u=!1;const f=Xt(this.globalScope)?void 0:[],g=s.hasCallback?(E,I)=>{u=!0,delete this.cancelCallbacks[c],this.target.postMessage({id:c,type:"<response>",sourceMapId:this.mapId,error:E?ta(E):null,data:ta(I,f)},f)}:E=>{u=!0};let v=null;const w=Co(s.data);if(this.parent[s.type])v=this.parent[s.type](s.sourceMapId,w,g);else if(this.parent.getWorkerSource){const E=s.type.split(".");v=this.parent.getWorkerSource(s.sourceMapId,E[0],w.source)[E[1]](w,g)}else g(new Error(`Could not find function ${s.type}`));!u&&v&&v.cancel&&(this.cancelCallbacks[c]=v.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=Qh,l.CanonicalTileID=Ay,l.CollisionBoxArray=Le,l.CollisionCircleLayoutArray=class extends k{},l.Color=Y,l.DEMData=eA,l.DataConstantProperty=ft,l.DictionaryCoder=tA,l.EXTENT=hi,l.ErrorEvent=bo,l.EvaluationParameters=In,l.Event=Yr,l.Evented=Dr,l.FeatureIndex=iA,l.FillBucket=oy,l.FillExtrusionBucket=ly,l.GeoJSONFeature=nA,l.ImageAtlas=Cw,l.ImagePosition=dy,l.LineBucket=cy,l.LineStripIndexArray=class extends re{},l.LngLat=Gn,l.LngLatBounds=rc,l.MercatorCoordinate=Kp,l.ONE_EM=Ii,l.OverscaledTileID=ss,l.PerformanceUtils=HR,l.PosArray=bt,l.Properties=Ci,l.QuadTriangleArray=class extends H{},l.RGBAImage=rs,l.RasterBoundsArray=class extends m{},l.RequestPerformance=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},l.ResourceType=Hi,l.SegmentVector=Ut,l.SymbolBucket=cu,l.Transitionable=Cp,l.TriangleIndexArray=sr,l.Uniform1f=sa,l.Uniform1i=class extends ra{constructor(c,s){super(c,s),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},l.Uniform2f=class extends ra{constructor(c,s){super(c,s),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},l.Uniform3f=class extends ra{constructor(c,s){super(c,s),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},l.Uniform4f=eu,l.UniformColor=jb,l.UniformMatrix4f=class extends ra{constructor(c,s){super(c,s),this.current=uL}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let s=1;s<16;s++)if(c[s]!==this.current[s]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},l.UnwrappedTileID=Qw,l.ValidationError=$e,l.ZoomHistory=zh,l.add=function(c,s,u){return c[0]=s[0]+u[0],c[1]=s[1]+u[1],c[2]=s[2]+u[2],c},l.addDynamicAttributes=_y,l.asyncAll=function(c,s,u){if(!c.length)return u(null,[]);let f=c.length;const g=new Array(c.length);let v=null;c.forEach((w,E)=>{s(w,(I,B)=>{I&&(v=I),g[E]=B,--f==0&&u(v,g)})})},l.bezier=T,l.bindAll=ue,l.cacheEntryPossiblyAdded=function(c){Di++,Di>ji&&(c.getActor().send("enforceCacheSizeLimit",sn),Di=0)},l.clamp=S,l.clearTileCache=function(c){const s=caches.delete(vt);c&&s.catch(c).then(()=>c())},l.clipLine=Nw,l.clone=function(c){var s=new ar(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},l.clone$1=K,l.clone$2=function(c){var s=new ar(3);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s},l.collisionCircleLayout=lR,l.config=Ke,l.copy=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},l.create=function(){var c=new ar(16);return ar!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},l.create$1=Kb,l.createExpression=Nl,l.createFilter=$c,l.createLayout=ei,l.createStyleLayer=function(c){return c.type==="custom"?new UR(c):new GR[c.type](c)},l.cross=function(c,s,u){var f=s[0],g=s[1],v=s[2],w=u[0],E=u[1],I=u[2];return c[0]=g*I-v*E,c[1]=v*w-f*I,c[2]=f*E-g*w,c},l.dot=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]},l.dot$1=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]*s[3]},l.ease=C,l.emitValidationErrors=Jc,l.enforceCacheSizeLimit=function(c){pi(),Et&&Et.then(s=>{s.keys().then(u=>{for(let f=0;f<u.length-c;f++)s.delete(u[f])})})},l.equals=function(c,s){var u=c[0],f=c[1],g=c[2],v=c[3],w=c[4],E=c[5],I=c[6],B=c[7],O=c[8],F=c[9],G=c[10],X=c[11],$=c[12],oe=c[13],se=c[14],ye=c[15],Te=s[0],_e=s[1],Ae=s[2],ke=s[3],Oe=s[4],st=s[5],ht=s[6],tt=s[7],Je=s[8],We=s[9],nt=s[10],Ye=s[11],Ve=s[12],wt=s[13],mt=s[14],kt=s[15];return Math.abs(u-Te)<=or*Math.max(1,Math.abs(u),Math.abs(Te))&&Math.abs(f-_e)<=or*Math.max(1,Math.abs(f),Math.abs(_e))&&Math.abs(g-Ae)<=or*Math.max(1,Math.abs(g),Math.abs(Ae))&&Math.abs(v-ke)<=or*Math.max(1,Math.abs(v),Math.abs(ke))&&Math.abs(w-Oe)<=or*Math.max(1,Math.abs(w),Math.abs(Oe))&&Math.abs(E-st)<=or*Math.max(1,Math.abs(E),Math.abs(st))&&Math.abs(I-ht)<=or*Math.max(1,Math.abs(I),Math.abs(ht))&&Math.abs(B-tt)<=or*Math.max(1,Math.abs(B),Math.abs(tt))&&Math.abs(O-Je)<=or*Math.max(1,Math.abs(O),Math.abs(Je))&&Math.abs(F-We)<=or*Math.max(1,Math.abs(F),Math.abs(We))&&Math.abs(G-nt)<=or*Math.max(1,Math.abs(G),Math.abs(nt))&&Math.abs(X-Ye)<=or*Math.max(1,Math.abs(X),Math.abs(Ye))&&Math.abs($-Ve)<=or*Math.max(1,Math.abs($),Math.abs(Ve))&&Math.abs(oe-wt)<=or*Math.max(1,Math.abs(oe),Math.abs(wt))&&Math.abs(se-mt)<=or*Math.max(1,Math.abs(se),Math.abs(mt))&&Math.abs(ye-kt)<=or*Math.max(1,Math.abs(ye),Math.abs(kt))},l.evaluateSizeForFeature=function(c,{uSize:s,uSizeT:u},{lowerSize:f,upperSize:g}){return c.kind==="source"?f/la:c.kind==="composite"?Dt(f/la,g/la,u):s},l.evaluateSizeForZoom=function(c,s){let u=0,f=0;if(c.kind==="constant")f=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:w}=c,E=g?S(xr.interpolationFactor(g,s,v,w),0,1):0;c.kind==="camera"?f=Dt(c.minSize,c.maxSize,E):u=E}return{uSizeT:u,uSize:f}},l.evaluateVariableOffset=Vw,l.evented=Wh,l.exported=jn,l.exported$1=mi,l.extend=V,l.filterObject=j,l.fromRotation=function(c,s){var u=Math.sin(s),f=Math.cos(s);return c[0]=f,c[1]=u,c[2]=0,c[3]=-u,c[4]=f,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},l.fromScaling=function(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},l.getAnchorAlignment=py,l.getAnchorJustification=gy,l.getArrayBuffer=nr,l.getImage=Es,l.getJSON=function(c,s){return Ti(V(c,{type:"json"}),s)},l.getOverlapMode=by,l.getRTLTextPluginStatus=Kl,l.getReferrer=Jr,l.getVideo=function(c,s){const u=window.document.createElement("video");u.muted=!0,u.onloadstart=function(){s(null,u)};for(let f=0;f<c.length;f++){const g=window.document.createElement("source");xo(c[f])||(u.crossOrigin="Anonymous"),g.src=c[f],u.appendChild(g)}return{cancel:()=>{}}},l.identity=K_,l.invert=function(c,s){var u=s[0],f=s[1],g=s[2],v=s[3],w=s[4],E=s[5],I=s[6],B=s[7],O=s[8],F=s[9],G=s[10],X=s[11],$=s[12],oe=s[13],se=s[14],ye=s[15],Te=u*E-f*w,_e=u*I-g*w,Ae=u*B-v*w,ke=f*I-g*E,Oe=f*B-v*E,st=g*B-v*I,ht=O*oe-F*$,tt=O*se-G*$,Je=O*ye-X*$,We=F*se-G*oe,nt=F*ye-X*oe,Ye=G*ye-X*se,Ve=Te*Ye-_e*nt+Ae*We+ke*Je-Oe*tt+st*ht;return Ve?(c[0]=(E*Ye-I*nt+B*We)*(Ve=1/Ve),c[1]=(g*nt-f*Ye-v*We)*Ve,c[2]=(oe*st-se*Oe+ye*ke)*Ve,c[3]=(G*Oe-F*st-X*ke)*Ve,c[4]=(I*Je-w*Ye-B*tt)*Ve,c[5]=(u*Ye-g*Je+v*tt)*Ve,c[6]=(se*Ae-$*st-ye*_e)*Ve,c[7]=(O*st-G*Ae+X*_e)*Ve,c[8]=(w*nt-E*Je+B*ht)*Ve,c[9]=(f*Je-u*nt-v*ht)*Ve,c[10]=($*Oe-oe*Ae+ye*Te)*Ve,c[11]=(F*Ae-O*Oe-X*Te)*Ve,c[12]=(E*tt-w*We-I*ht)*Ve,c[13]=(u*We-f*tt+g*ht)*Ve,c[14]=(oe*_e-$*ke-se*Te)*Ve,c[15]=(O*ke-F*_e+G*Te)*Ve,c):null},l.isImageBitmap=Lt,l.isSafari=Xt,l.isWorker=Fe,l.keysDifference=function(c,s){const u=[];for(const f in c)f in s||u.push(f);return u},l.lazyLoadRTLTextPlugin=function(){Fr.isLoading()||Fr.isLoaded()||Kl()!=="deferred"||Sp()},l.makeRequest=Ti,l.mapObject=q,l.mercatorXfromLng=Zw,l.mercatorYfromLat=Jw,l.mercatorZfromAltitude=Kw,l.mul=yL,l.mul$1=function(c,s,u){return c[0]=s[0]*u[0],c[1]=s[1]*u[1],c[2]=s[2]*u[2],c[3]=s[3]*u[3],c},l.multiply=Yb,l.nextPowerOfTwo=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},l.normalize=function(c,s){var u=s[0],f=s[1],g=s[2],v=u*u+f*f+g*g;return v>0&&(v=1/Math.sqrt(v)),c[0]=s[0]*v,c[1]=s[1]*v,c[2]=s[2]*v,c},l.number=Dt,l.ortho=function(c,s,u,f,g,v,w){var E=1/(s-u),I=1/(f-g),B=1/(v-w);return c[0]=-2*E,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*I,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*B,c[11]=0,c[12]=(s+u)*E,c[13]=(g+f)*I,c[14]=(w+v)*B,c[15]=1,c},l.parseCacheControl=je,l.parseGlyphPbf=function(c){return new uy(c).readFields(vR,[])},l.pbf=uy,l.performSymbolLayout=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=hi/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const s=c.bucket.layers[0].layout,u=c.bucket.layers[0]._unevaluatedLayout._values,f={layoutIconSize:u["icon-size"].possiblyEvaluate(new In(c.bucket.zoom+1),c.canonical),layoutTextSize:u["text-size"].possiblyEvaluate(new In(c.bucket.zoom+1),c.canonical),textMaxSize:u["text-size"].possiblyEvaluate(new In(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:B}=c.bucket.textSizeData;f.compositeTextSizes=[u["text-size"].possiblyEvaluate(new In(I),c.canonical),u["text-size"].possiblyEvaluate(new In(B),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:B}=c.bucket.iconSizeData;f.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new In(I),c.canonical),u["icon-size"].possiblyEvaluate(new In(B),c.canonical)]}const g=s.get("text-line-height")*Ii,v=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",w=s.get("text-keep-upright"),E=s.get("text-size");for(const I of c.bucket.features){const B=s.get("text-font").evaluate(I,{},c.canonical).join(","),O=E.evaluate(I,{},c.canonical),F=f.layoutTextSize.evaluate(I,{},c.canonical),G=f.layoutIconSize.evaluate(I,{},c.canonical),X={horizontal:{},vertical:void 0},$=I.text;let oe,se=[0,0];if($){const _e=$.toString(),Ae=s.get("text-letter-spacing").evaluate(I,{},c.canonical)*Ii,ke=j_(_e)?Ae:0,Oe=s.get("text-anchor").evaluate(I,{},c.canonical),st=s.get("text-variable-anchor");if(!st){const nt=s.get("text-radial-offset").evaluate(I,{},c.canonical);se=nt?Vw(Oe,[nt*Ii,my]):s.get("text-offset").evaluate(I,{},c.canonical).map(Ye=>Ye*Ii)}let ht=v?"center":s.get("text-justify").evaluate(I,{},c.canonical);const tt=s.get("symbol-placement"),Je=tt==="point"?s.get("text-max-width").evaluate(I,{},c.canonical)*Ii:0,We=()=>{c.bucket.allowVerticalPlacement&&Kc(_e)&&(X.vertical=jp($,c.glyphMap,c.glyphPositions,c.imagePositions,B,Je,g,Oe,"left",ke,se,l.WritingMode.vertical,!0,tt,F,O))};if(!v&&st){const nt=ht==="auto"?st.map(Ve=>gy(Ve)):[ht];let Ye=!1;for(let Ve=0;Ve<nt.length;Ve++){const wt=nt[Ve];if(!X.horizontal[wt])if(Ye)X.horizontal[wt]=X.horizontal[0];else{const mt=jp($,c.glyphMap,c.glyphPositions,c.imagePositions,B,Je,g,"center",wt,ke,se,l.WritingMode.horizontal,!1,tt,F,O);mt&&(X.horizontal[wt]=mt,Ye=mt.positionedLines.length===1)}}We()}else{ht==="auto"&&(ht=gy(Oe));const nt=jp($,c.glyphMap,c.glyphPositions,c.imagePositions,B,Je,g,Oe,ht,ke,se,l.WritingMode.horizontal,!1,tt,F,O);nt&&(X.horizontal[ht]=nt),We(),Kc(_e)&&v&&w&&(X.vertical=jp($,c.glyphMap,c.glyphPositions,c.imagePositions,B,Je,g,Oe,ht,ke,se,l.WritingMode.vertical,!1,tt,F,O))}}let ye=!1;if(I.icon&&I.icon.name){const _e=c.imageMap[I.icon.name];_e&&(oe=TR(c.imagePositions[I.icon.name],s.get("icon-offset").evaluate(I,{},c.canonical),s.get("icon-anchor").evaluate(I,{},c.canonical)),ye=!!_e.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=ye:c.bucket.sdfIcons!==ye&&ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==c.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const Te=Hw(X.horizontal)||X.vertical;c.bucket.iconsInText=!!Te&&Te.iconsInText,(Te||oe)&&LR(c.bucket,I,X,oe,c.imageMap,f,F,G,se,ye,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},l.perspective=function(c,s,u,f,g){var v,w=1/Math.tan(s/2);return c[0]=w/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=w,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,g!=null&&g!==1/0?(c[10]=(g+f)*(v=1/(f-g)),c[14]=2*g*f*v):(c[10]=-1,c[14]=-2*f),c},l.pick=function(c,s){const u={};for(let f=0;f<s.length;f++){const g=s[f];g in c&&(u[g]=c[g])}return u},l.plugin=Fr,l.pointGeometry=yt,l.polygonIntersectsPolygon=qb,l.potpack=Sw,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=at,l.registerForPluginStateChange=function(c){return c({pluginStatus:rr,pluginURL:Io}),Wh.on("pluginStateChange",c),c},l.renderColorRamp=sw,l.rotateX=function(c,s,u){var f=Math.sin(u),g=Math.cos(u),v=s[4],w=s[5],E=s[6],I=s[7],B=s[8],O=s[9],F=s[10],G=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=v*g+B*f,c[5]=w*g+O*f,c[6]=E*g+F*f,c[7]=I*g+G*f,c[8]=B*g-v*f,c[9]=O*g-w*f,c[10]=F*g-E*f,c[11]=G*g-I*f,c},l.rotateZ=function(c,s,u){var f=Math.sin(u),g=Math.cos(u),v=s[0],w=s[1],E=s[2],I=s[3],B=s[4],O=s[5],F=s[6],G=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=v*g+B*f,c[1]=w*g+O*f,c[2]=E*g+F*f,c[3]=I*g+G*f,c[4]=B*g-v*f,c[5]=O*g-w*f,c[6]=F*g-E*f,c[7]=G*g-I*f,c},l.scale=function(c,s,u){var f=u[0],g=u[1],v=u[2];return c[0]=s[0]*f,c[1]=s[1]*f,c[2]=s[2]*f,c[3]=s[3]*f,c[4]=s[4]*g,c[5]=s[5]*g,c[6]=s[6]*g,c[7]=s[7]*g,c[8]=s[8]*v,c[9]=s[9]*v,c[10]=s[10]*v,c[11]=s[11]*v,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},l.scale$1=function(c,s,u){return c[0]=s[0]*u,c[1]=s[1]*u,c[2]=s[2]*u,c},l.setCacheLimits=function(c,s){sn=c,ji=s},l.setRTLTextPlugin=function(c,s,u=!1){if(rr===Gh||rr===Vh||rr===jh)throw new Error("setRTLTextPlugin cannot be called multiple times.");Io=jn.resolveURL(c),rr=Gh,Hh=s,qa(),u||Sp()},l.spec=Be,l.sphericalToCartesian=function([c,s,u]){return s+=90,s*=Math.PI/180,u*=Math.PI/180,{x:c*Math.cos(s)*Math.sin(u),y:c*Math.sin(s)*Math.sin(u),z:c*Math.cos(u)}},l.sqrLen=function(c){var s=c[0],u=c[1];return s*s+u*u},l.sub=function(c,s,u){return c[0]=s[0]-u[0],c[1]=s[1]-u[1],c[2]=s[2]-u[2],c},l.toEvaluationFeature=nc,l.transformMat3=function(c,s,u){var f=s[0],g=s[1],v=s[2];return c[0]=f*u[0]+g*u[3]+v*u[6],c[1]=f*u[1]+g*u[4]+v*u[7],c[2]=f*u[2]+g*u[5]+v*u[8],c},l.transformMat4=Op,l.transformMat4$1=function(c,s,u){var f=s[0],g=s[1];return c[0]=u[0]*f+u[4]*g+u[12],c[1]=u[1]*f+u[5]*g+u[13],c},l.translate=function(c,s,u){var f,g,v,w,E,I,B,O,F,G,X,$,oe=u[0],se=u[1],ye=u[2];return s===c?(c[12]=s[0]*oe+s[4]*se+s[8]*ye+s[12],c[13]=s[1]*oe+s[5]*se+s[9]*ye+s[13],c[14]=s[2]*oe+s[6]*se+s[10]*ye+s[14],c[15]=s[3]*oe+s[7]*se+s[11]*ye+s[15]):(g=s[1],v=s[2],w=s[3],E=s[4],I=s[5],B=s[6],O=s[7],F=s[8],G=s[9],X=s[10],$=s[11],c[0]=f=s[0],c[1]=g,c[2]=v,c[3]=w,c[4]=E,c[5]=I,c[6]=B,c[7]=O,c[8]=F,c[9]=G,c[10]=X,c[11]=$,c[12]=f*oe+E*se+F*ye+s[12],c[13]=g*oe+I*se+G*ye+s[13],c[14]=v*oe+B*se+X*ye+s[14],c[15]=w*oe+O*se+$*ye+s[15]),c},l.triggerPluginCompletionEvent=Tp,l.unicodeBlockLookup=et,l.uniqueId=function(){return Z++},l.validateCustomStyleLayer=function(c){const s=[],u=c.id;return u===void 0&&s.push({message:`layers.${u}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${u}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),s},l.validateLight=Fh,l.validateStyle=Zl,l.vectorTile=Ka,l.warnOnce=ve,l.wrap=z}),a(["./shared"],function(l){function y(ee){const D=typeof ee;if(D==="number"||D==="boolean"||D==="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){let Y="[";for(const le of ee)Y+=`${y(le)},`;return`${Y}]`}const N=Object.keys(ee).sort();let J="{";for(let Y=0;Y<N.length;Y++)J+=`${JSON.stringify(N[Y])}:${y(ee[N[Y]])},`;return`${J}}`}function x(ee){let D="";for(const N of l.refProperties)D+=`/${y(ee[N])}`;return D}class T{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,N){for(const Y of D){this._layerConfigs[Y.id]=Y;const le=this._layers[Y.id]=l.createStyleLayer(Y);le._featureFilter=l.createFilter(le.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of N)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const J=function(Y,le){const pe={};for(let ae=0;ae<Y.length;ae++){const me=le&&le[Y[ae].id]||x(Y[ae]);le&&(le[Y[ae].id]=me);let Me=pe[me];Me||(Me=pe[me]=[]),Me.push(Y[ae])}const he=[];for(const ae in pe)he.push(pe[ae]);return he}(Object.values(this._layerConfigs),this.keyCache);for(const Y of J){const le=Y.map(ze=>this._layers[ze.id]),pe=le[0];if(pe.visibility==="none")continue;const he=pe.source||"";let ae=this.familiesBySource[he];ae||(ae=this.familiesBySource[he]={});const me=pe.sourceLayer||"_geojsonTileLayer";let Me=ae[me];Me||(Me=ae[me]=[]),Me.push(le)}}}class C{constructor(D){const N={},J=[];for(const he in D){const ae=D[he],me=N[he]={};for(const Me in ae){const ze=ae[+Me];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Ce={x:0,y:0,w:ze.bitmap.width+2,h:ze.bitmap.height+2};J.push(Ce),me[Me]={rect:Ce,metrics:ze.metrics}}}const{w:Y,h:le}=l.potpack(J),pe=new l.AlphaImage({width:Y||1,height:le||1});for(const he in D){const ae=D[he];for(const me in ae){const Me=ae[+me];if(!Me||Me.bitmap.width===0||Me.bitmap.height===0)continue;const ze=N[he][me].rect;l.AlphaImage.copy(Me.bitmap,pe,{x:0,y:0},{x:ze.x+1,y:ze.y+1},Me.bitmap)}}this.image=pe,this.positions=N}}l.register("GlyphAtlas",C);class S{constructor(D){this.tileID=new l.OverscaledTileID(D.tileID.overscaledZ,D.tileID.wrap,D.tileID.canonical.z,D.tileID.canonical.x,D.tileID.canonical.y),this.uid=D.uid,this.zoom=D.zoom,this.pixelRatio=D.pixelRatio,this.tileSize=D.tileSize,this.source=D.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=D.showCollisionBoxes,this.collectResourceTiming=!!D.collectResourceTiming,this.returnDependencies=!!D.returnDependencies,this.promoteId=D.promoteId}parse(D,N,J,Y,le){this.status="parsing",this.data=D,this.collisionBoxArray=new l.CollisionBoxArray;const pe=new l.DictionaryCoder(Object.keys(D.layers).sort()),he=new l.FeatureIndex(this.tileID,this.promoteId);he.bucketLayerIDs=[];const ae={},me={featureIndex:he,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:J},Me=N.familiesBySource[this.source];for(const At in Me){const St=D.layers[At];if(!St)continue;St.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${At}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ft=pe.encode(At),Vt=[];for(let yn=0;yn<St.length;yn++){const vn=St.feature(yn),ci=he.getId(vn,At);Vt.push({feature:vn,id:ci,index:yn,sourceLayerIndex:Ft})}for(const yn of Me[At]){const vn=yn[0];vn.source!==this.source&&l.warnOnce(`layer.source = ${vn.source} does not equal this.source = ${this.source}`),vn.minzoom&&this.zoom<Math.floor(vn.minzoom)||vn.maxzoom&&this.zoom>=vn.maxzoom||vn.visibility!=="none"&&(z(yn,this.zoom,J),(ae[vn.id]=vn.createBucket({index:he.bucketLayerIDs.length,layers:yn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ft,sourceID:this.source})).populate(Vt,me,this.tileID.canonical),he.bucketLayerIDs.push(yn.map(ci=>ci.id)))}}let ze,Ce,ot,ut;const Qe=l.mapObject(me.glyphDependencies,At=>Object.keys(At).map(Number));Object.keys(Qe).length?Y.send("getGlyphs",{uid:this.uid,stacks:Qe},(At,St)=>{ze||(ze=At,Ce=St,Rt.call(this))}):Ce={};const xt=Object.keys(me.iconDependencies);xt.length?Y.send("getImages",{icons:xt,source:this.source,tileID:this.tileID,type:"icons"},(At,St)=>{ze||(ze=At,ot=St,Rt.call(this))}):ot={};const pt=Object.keys(me.patternDependencies);function Rt(){if(ze)return le(ze);if(Ce&&ot&&ut){const At=new C(Ce),St=new l.ImageAtlas(ot,ut);for(const Ft in ae){const Vt=ae[Ft];Vt instanceof l.SymbolBucket?(z(Vt.layers,this.zoom,J),l.performSymbolLayout({bucket:Vt,glyphMap:Ce,glyphPositions:At.positions,imageMap:ot,imagePositions:St.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Vt.hasPattern&&(Vt instanceof l.LineBucket||Vt instanceof l.FillBucket||Vt instanceof l.FillExtrusionBucket)&&(z(Vt.layers,this.zoom,J),Vt.addFeatures(me,this.tileID.canonical,St.patternPositions))}this.status="done",le(null,{buckets:Object.values(ae).filter(Ft=>!Ft.isEmpty()),featureIndex:he,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:At.image,imageAtlas:St,glyphMap:this.returnDependencies?Ce:null,iconMap:this.returnDependencies?ot:null,glyphPositions:this.returnDependencies?At.positions:null})}}pt.length?Y.send("getImages",{icons:pt,source:this.source,tileID:this.tileID,type:"patterns"},(At,St)=>{ze||(ze=At,ut=St,Rt.call(this))}):ut={},Rt.call(this)}}function z(ee,D,N){const J=new l.EvaluationParameters(D);for(const Y of ee)Y.recalculate(J,N)}function V(ee,D){const N=l.getArrayBuffer(ee.request,(J,Y,le,pe)=>{J?D(J):Y&&D(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(Y)),rawData:Y,cacheControl:le,expires:pe})});return()=>{N.cancel(),D()}}class Z{constructor(D,N,J,Y){this.actor=D,this.layerIndex=N,this.availableImages=J,this.loadVectorData=Y||V,this.loading={},this.loaded={}}loadTile(D,N){const J=D.uid;this.loading||(this.loading={});const Y=!!(D&&D.request&&D.request.collectResourceTiming)&&new l.RequestPerformance(D.request),le=this.loading[J]=new S(D);le.abort=this.loadVectorData(D,(pe,he)=>{if(delete this.loading[J],pe||!he)return le.status="done",this.loaded[J]=le,N(pe);const ae=he.rawData,me={};he.expires&&(me.expires=he.expires),he.cacheControl&&(me.cacheControl=he.cacheControl);const Me={};if(Y){const ze=Y.finish();ze&&(Me.resourceTiming=JSON.parse(JSON.stringify(ze)))}le.vectorTile=he.vectorTile,le.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,(ze,Ce)=>{if(ze||!Ce)return N(ze);N(null,l.extend({rawTileData:ae.slice(0)},Ce,me,Me))}),this.loaded=this.loaded||{},this.loaded[J]=le})}reloadTile(D,N){const J=this.loaded,Y=D.uid,le=this;if(J&&J[Y]){const pe=J[Y];pe.showCollisionBoxes=D.showCollisionBoxes;const he=(ae,me)=>{const Me=pe.reloadCallback;Me&&(delete pe.reloadCallback,pe.parse(pe.vectorTile,le.layerIndex,this.availableImages,le.actor,Me)),N(ae,me)};pe.status==="parsing"?pe.reloadCallback=he:pe.status==="done"&&(pe.vectorTile?pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,he):he())}}abortTile(D,N){const J=this.loading,Y=D.uid;J&&J[Y]&&J[Y].abort&&(J[Y].abort(),delete J[Y]),N()}removeTile(D,N){const J=this.loaded,Y=D.uid;J&&J[Y]&&delete J[Y],N()}}class ue{constructor(){this.loaded={}}loadTile(D,N){const{uid:J,encoding:Y,rawImageData:le}=D,pe=l.isImageBitmap(le)?this.getImageData(le):le,he=new l.DEMData(J,pe,Y);this.loaded=this.loaded||{},this.loaded[J]=he,N(null,he)}getImageData(D){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);const N=this.offscreenCanvasContext.getImageData(-1,-1,D.width+2,D.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:N.width,height:N.height},N.data)}removeTile(D){const N=this.loaded,J=D.uid;N&&N[J]&&delete N[J]}}var q=function ee(D,N){var J,Y=D&&D.type;if(Y==="FeatureCollection")for(J=0;J<D.features.length;J++)ee(D.features[J],N);else if(Y==="GeometryCollection")for(J=0;J<D.geometries.length;J++)ee(D.geometries[J],N);else if(Y==="Feature")ee(D.geometry,N);else if(Y==="Polygon")j(D.coordinates,N);else if(Y==="MultiPolygon")for(J=0;J<D.coordinates.length;J++)j(D.coordinates[J],N);return D};function j(ee,D){if(ee.length!==0){K(ee[0],D);for(var N=1;N<ee.length;N++)K(ee[N],!D)}}function K(ee,D){for(var N=0,J=0,Y=0,le=ee.length,pe=le-1;Y<le;pe=Y++){var he=(ee[Y][0]-ee[pe][0])*(ee[pe][1]+ee[Y][1]),ae=N+he;J+=Math.abs(N)>=Math.abs(he)?N-ae+he:he-ae+N,N=ae}N+J>=0!=!!D&&ee.reverse()}const de=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ve{constructor(D){this._feature=D,this.extent=l.EXTENT,this.type=D.type,this.properties=D.tags,"id"in D&&!isNaN(D.id)&&(this.id=parseInt(D.id,10))}loadGeometry(){if(this._feature.type===1){const D=[];for(const N of this._feature.geometry)D.push([new l.pointGeometry(N[0],N[1])]);return D}{const D=[];for(const N of this._feature.geometry){const J=[];for(const Y of N)J.push(new l.pointGeometry(Y[0],Y[1]));D.push(J)}return D}}toGeoJSON(D,N,J){return de.call(this,D,N,J)}}class Ie{constructor(D){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=D.length,this._features=D}feature(D){return new ve(this._features[D])}}var De={exports:{}},Fe=l.pointGeometry,je=l.vectorTile.VectorTileFeature,Ne=dt;function dt(ee,D){this.options=D||{},this.features=ee,this.length=ee.length}function Nt(ee,D){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=D||4096}dt.prototype.feature=function(ee){return new Nt(this.features[ee],this.options.extent)},Nt.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var D=0;D<ee.length;D++){for(var N=ee[D],J=[],Y=0;Y<N.length;Y++)J.push(new Fe(N[Y][0],N[Y][1]));this.geometry.push(J)}return this.geometry},Nt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,D=1/0,N=-1/0,J=1/0,Y=-1/0,le=0;le<ee.length;le++)for(var pe=ee[le],he=0;he<pe.length;he++){var ae=pe[he];D=Math.min(D,ae.x),N=Math.max(N,ae.x),J=Math.min(J,ae.y),Y=Math.max(Y,ae.y)}return[D,J,N,Y]},Nt.prototype.toGeoJSON=je.prototype.toGeoJSON;var Xt=l.pbf,Lt=Ne;function jn(ee){var D=new Xt;return function(N,J){for(var Y in N.layers)J.writeMessage(3,yt,N.layers[Y])}(ee,D),D.finish()}function yt(ee,D){var N;D.writeVarintField(15,ee.version||1),D.writeStringField(1,ee.name||""),D.writeVarintField(5,ee.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<ee.length;N++)J.feature=ee.feature(N),D.writeMessage(2,Yn,J);var Y=J.keys;for(N=0;N<Y.length;N++)D.writeStringField(3,Y[N]);var le=J.values;for(N=0;N<le.length;N++)D.writeMessage(4,sn,le[N])}function Yn(ee,D){var N=ee.feature;N.id!==void 0&&D.writeVarintField(1,N.id),D.writeMessage(2,Ke,ee),D.writeVarintField(3,N.type),D.writeMessage(4,en,N)}function Ke(ee,D){var N=ee.feature,J=ee.keys,Y=ee.values,le=ee.keycache,pe=ee.valuecache;for(var he in N.properties){var ae=N.properties[he],me=le[he];if(ae!==null){me===void 0&&(J.push(he),le[he]=me=J.length-1),D.writeVarint(me);var Me=typeof ae;Me!=="string"&&Me!=="boolean"&&Me!=="number"&&(ae=JSON.stringify(ae));var ze=Me+":"+ae,Ce=pe[ze];Ce===void 0&&(Y.push(ae),pe[ze]=Ce=Y.length-1),D.writeVarint(Ce)}}}function vt(ee,D){return(D<<3)+(7&ee)}function Et(ee){return ee<<1^ee>>31}function en(ee,D){for(var N=ee.loadGeometry(),J=ee.type,Y=0,le=0,pe=N.length,he=0;he<pe;he++){var ae=N[he],me=1;J===1&&(me=ae.length),D.writeVarint(vt(1,me));for(var Me=J===3?ae.length-1:ae.length,ze=0;ze<Me;ze++){ze===1&&J!==1&&D.writeVarint(vt(2,Me-1));var Ce=ae[ze].x-Y,ot=ae[ze].y-le;D.writeVarint(Et(Ce)),D.writeVarint(Et(ot)),Y+=Ce,le+=ot}J===3&&D.writeVarint(vt(7,1))}}function sn(ee,D){var N=typeof ee;N==="string"?D.writeStringField(1,ee):N==="boolean"?D.writeBooleanField(7,ee):N==="number"&&(ee%1!=0?D.writeDoubleField(3,ee):ee<0?D.writeSVarintField(6,ee):D.writeVarintField(5,ee))}function ji(ee,D,N,J,Y,le){if(Y-J<=N)return;const pe=J+Y>>1;pi(ee,D,pe,J,Y,le%2),ji(ee,D,N,J,pe-1,le+1),ji(ee,D,N,pe+1,Y,le+1)}function pi(ee,D,N,J,Y,le){for(;Y>J;){if(Y-J>600){const me=Y-J+1,Me=N-J+1,ze=Math.log(me),Ce=.5*Math.exp(2*ze/3),ot=.5*Math.sqrt(ze*Ce*(me-Ce)/me)*(Me-me/2<0?-1:1);pi(ee,D,N,Math.max(J,Math.floor(N-Me*Ce/me+ot)),Math.min(Y,Math.floor(N+(me-Me)*Ce/me+ot)),le)}const pe=D[2*N+le];let he=J,ae=Y;for(Di(ee,D,J,N),D[2*Y+le]>pe&&Di(ee,D,J,Y);he<ae;){for(Di(ee,D,he,ae),he++,ae--;D[2*he+le]<pe;)he++;for(;D[2*ae+le]>pe;)ae--}D[2*J+le]===pe?Di(ee,D,J,ae):(ae++,Di(ee,D,ae,Y)),ae<=N&&(J=ae+1),N<=ae&&(Y=ae-1)}}function Di(ee,D,N,J){mi(ee,N,J),mi(D,2*N,2*J),mi(D,2*N+1,2*J+1)}function mi(ee,D,N){const J=ee[D];ee[D]=ee[N],ee[N]=J}function mn(ee,D,N,J){const Y=ee-N,le=D-J;return Y*Y+le*le}De.exports=jn,De.exports.fromVectorTileJs=jn,De.exports.fromGeojsonVt=function(ee,D){D=D||{};var N={};for(var J in ee)N[J]=new Lt(ee[J].features,D),N[J].name=J,N[J].version=D.version,N[J].extent=D.extent;return jn({layers:N})},De.exports.GeoJSONWrapper=Lt;const Oi=ee=>ee[0],Jt=ee=>ee[1];class Hn{constructor(D,N=Oi,J=Jt,Y=64,le=Float64Array){this.nodeSize=Y,this.points=D;const pe=D.length<65536?Uint16Array:Uint32Array,he=this.ids=new pe(D.length),ae=this.coords=new le(2*D.length);for(let me=0;me<D.length;me++)he[me]=me,ae[2*me]=N(D[me]),ae[2*me+1]=J(D[me]);ji(he,ae,Y,0,he.length-1,0)}range(D,N,J,Y){return function(le,pe,he,ae,me,Me,ze){const Ce=[0,le.length-1,0],ot=[];let ut,Qe;for(;Ce.length;){const xt=Ce.pop(),pt=Ce.pop(),Rt=Ce.pop();if(pt-Rt<=ze){for(let Ft=Rt;Ft<=pt;Ft++)ut=pe[2*Ft],Qe=pe[2*Ft+1],ut>=he&&ut<=me&&Qe>=ae&&Qe<=Me&&ot.push(le[Ft]);continue}const At=Math.floor((Rt+pt)/2);ut=pe[2*At],Qe=pe[2*At+1],ut>=he&&ut<=me&&Qe>=ae&&Qe<=Me&&ot.push(le[At]);const St=(xt+1)%2;(xt===0?he<=ut:ae<=Qe)&&(Ce.push(Rt),Ce.push(At-1),Ce.push(St)),(xt===0?me>=ut:Me>=Qe)&&(Ce.push(At+1),Ce.push(pt),Ce.push(St))}return ot}(this.ids,this.coords,D,N,J,Y,this.nodeSize)}within(D,N,J){return function(Y,le,pe,he,ae,me){const Me=[0,Y.length-1,0],ze=[],Ce=ae*ae;for(;Me.length;){const ot=Me.pop(),ut=Me.pop(),Qe=Me.pop();if(ut-Qe<=me){for(let St=Qe;St<=ut;St++)mn(le[2*St],le[2*St+1],pe,he)<=Ce&&ze.push(Y[St]);continue}const xt=Math.floor((Qe+ut)/2),pt=le[2*xt],Rt=le[2*xt+1];mn(pt,Rt,pe,he)<=Ce&&ze.push(Y[xt]);const At=(ot+1)%2;(ot===0?pe-ae<=pt:he-ae<=Rt)&&(Me.push(Qe),Me.push(xt-1),Me.push(At)),(ot===0?pe+ae>=pt:he+ae>=Rt)&&(Me.push(xt+1),Me.push(ut),Me.push(At))}return ze}(this.ids,this.coords,D,N,J,this.nodeSize)}}const As={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},Hi=Math.fround||(ai=new Float32Array(1),ee=>(ai[0]=+ee,ai[0]));var ai;class Jr{constructor(D){this.options=Es(Object.create(As),D),this.trees=new Array(this.options.maxZoom+1)}load(D){const{log:N,minZoom:J,maxZoom:Y,nodeSize:le}=this.options;N&&console.time("total time");const pe=`prepare ${D.length} points`;N&&console.time(pe),this.points=D;let he=[];for(let ae=0;ae<D.length;ae++)D[ae].geometry&&he.push(Ti(D[ae],ae));this.trees[Y+1]=new Hn(he,Jo,Kr,le,Float32Array),N&&console.timeEnd(pe);for(let ae=Y;ae>=J;ae--){const me=+Date.now();he=this._cluster(he,ae),this.trees[ae]=new Hn(he,Jo,Kr,le,Float32Array),N&&console.log("z%d: %d clusters in %dms",ae,he.length,+Date.now()-me)}return N&&console.timeEnd("total time"),this}getClusters(D,N){let J=((D[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,D[1]));let le=D[2]===180?180:((D[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)J=-180,le=180;else if(J>le){const Me=this.getClusters([J,Y,180,pe],N),ze=this.getClusters([-180,Y,le,pe],N);return Me.concat(ze)}const he=this.trees[this._limitZoom(N)],ae=he.range(Ht(J),Wi(pe),Ht(le),Wi(Y)),me=[];for(const Me of ae){const ze=he.points[Me];me.push(ze.numPoints?nr(ze):this.points[ze.index])}return me}getChildren(D){const N=this._getOriginId(D),J=this._getOriginZoom(D),Y="No cluster with the specified id.",le=this.trees[J];if(!le)throw new Error(Y);const pe=le.points[N];if(!pe)throw new Error(Y);const he=this.options.radius/(this.options.extent*Math.pow(2,J-1)),ae=le.within(pe.x,pe.y,he),me=[];for(const Me of ae){const ze=le.points[Me];ze.parentId===D&&me.push(ze.numPoints?nr(ze):this.points[ze.index])}if(me.length===0)throw new Error(Y);return me}getLeaves(D,N,J){const Y=[];return this._appendLeaves(Y,D,N=N||10,J=J||0,0),Y}getTile(D,N,J){const Y=this.trees[this._limitZoom(D)],le=Math.pow(2,D),{extent:pe,radius:he}=this.options,ae=he/pe,me=(J-ae)/le,Me=(J+1+ae)/le,ze={features:[]};return this._addTileFeatures(Y.range((N-ae)/le,me,(N+1+ae)/le,Me),Y.points,N,J,le,ze),N===0&&this._addTileFeatures(Y.range(1-ae/le,me,1,Me),Y.points,le,J,le,ze),N===le-1&&this._addTileFeatures(Y.range(0,me,ae/le,Me),Y.points,-1,J,le,ze),ze.features.length?ze:null}getClusterExpansionZoom(D){let N=this._getOriginZoom(D)-1;for(;N<=this.options.maxZoom;){const J=this.getChildren(D);if(N++,J.length!==1)break;D=J[0].properties.cluster_id}return N}_appendLeaves(D,N,J,Y,le){const pe=this.getChildren(N);for(const he of pe){const ae=he.properties;if(ae&&ae.cluster?le+ae.point_count<=Y?le+=ae.point_count:le=this._appendLeaves(D,ae.cluster_id,J,Y,le):le<Y?le++:D.push(he),D.length===J)break}return le}_addTileFeatures(D,N,J,Y,le,pe){for(const he of D){const ae=N[he],me=ae.numPoints;let Me,ze,Ce;if(me)Me=xo(ae),ze=ae.x,Ce=ae.y;else{const Qe=this.points[ae.index];Me=Qe.properties,ze=Ht(Qe.geometry.coordinates[0]),Ce=Wi(Qe.geometry.coordinates[1])}const ot={type:1,geometry:[[Math.round(this.options.extent*(ze*le-J)),Math.round(this.options.extent*(Ce*le-Y))]],tags:Me};let ut;me?ut=ae.id:this.options.generateId?ut=ae.index:this.points[ae.index].id&&(ut=this.points[ae.index].id),ut!==void 0&&(ot.id=ut),pe.features.push(ot)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(Math.floor(+D),this.options.maxZoom+1))}_cluster(D,N){const J=[],{radius:Y,extent:le,reduce:pe,minPoints:he}=this.options,ae=Y/(le*Math.pow(2,N));for(let me=0;me<D.length;me++){const Me=D[me];if(Me.zoom<=N)continue;Me.zoom=N;const ze=this.trees[N+1],Ce=ze.within(Me.x,Me.y,ae),ot=Me.numPoints||1;let ut=ot;for(const Qe of Ce){const xt=ze.points[Qe];xt.zoom>N&&(ut+=xt.numPoints||1)}if(ut>ot&&ut>=he){let Qe=Me.x*ot,xt=Me.y*ot,pt=pe&&ot>1?this._map(Me,!0):null;const Rt=(me<<5)+(N+1)+this.points.length;for(const At of Ce){const St=ze.points[At];if(St.zoom<=N)continue;St.zoom=N;const Ft=St.numPoints||1;Qe+=St.x*Ft,xt+=St.y*Ft,St.parentId=Rt,pe&&(pt||(pt=this._map(Me,!0)),pe(pt,this._map(St)))}Me.parentId=Rt,J.push(tr(Qe/ut,xt/ut,Rt,ut,pt))}else if(J.push(Me),ut>1)for(const Qe of Ce){const xt=ze.points[Qe];xt.zoom<=N||(xt.zoom=N,J.push(xt))}}return J}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,N){if(D.numPoints)return N?Es({},D.properties):D.properties;const J=this.points[D.index].properties,Y=this.options.map(J);return N&&Y===J?Es({},Y):Y}}function tr(ee,D,N,J,Y){return{x:Hi(ee),y:Hi(D),zoom:1/0,id:N,parentId:-1,numPoints:J,properties:Y}}function Ti(ee,D){const[N,J]=ee.geometry.coordinates;return{x:Hi(Ht(N)),y:Hi(Wi(J)),zoom:1/0,index:D,parentId:-1}}function nr(ee){return{type:"Feature",id:ee.id,properties:xo(ee),geometry:{type:"Point",coordinates:[(D=ee.x,360*(D-.5)),Wn(ee.y)]}};var D}function xo(ee){const D=ee.numPoints,N=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D;return Es(Es({},ee.properties),{cluster:!0,cluster_id:ee.id,point_count:D,point_count_abbreviated:N})}function Ht(ee){return ee/360+.5}function Wi(ee){const D=Math.sin(ee*Math.PI/180),N=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return N<0?0:N>1?1:N}function Wn(ee){const D=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Es(ee,D){for(const N in D)ee[N]=D[N];return ee}function Jo(ee){return ee.x}function Kr(ee){return ee.y}function Yr(ee,D,N,J){for(var Y,le=J,pe=N-D>>1,he=N-D,ae=ee[D],me=ee[D+1],Me=ee[N],ze=ee[N+1],Ce=D+3;Ce<N;Ce+=3){var ot=bo(ee[Ce],ee[Ce+1],ae,me,Me,ze);if(ot>le)Y=Ce,le=ot;else if(ot===le){var ut=Math.abs(Ce-pe);ut<he&&(Y=Ce,he=ut)}}le>J&&(Y-D>3&&Yr(ee,D,Y,J),ee[Y+2]=le,N-Y>3&&Yr(ee,Y,N,J))}function bo(ee,D,N,J,Y,le){var pe=Y-N,he=le-J;if(pe!==0||he!==0){var ae=((ee-N)*pe+(D-J)*he)/(pe*pe+he*he);ae>1?(N=Y,J=le):ae>0&&(N+=pe*ae,J+=he*ae)}return(pe=ee-N)*pe+(he=D-J)*he}function Dr(ee,D,N,J){var Y={id:ee===void 0?null:ee,type:D,geometry:N,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var pe=le.geometry,he=le.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")Be(le,pe);else if(he==="Polygon"||he==="MultiLineString")for(var ae=0;ae<pe.length;ae++)Be(le,pe[ae]);else if(he==="MultiPolygon")for(ae=0;ae<pe.length;ae++)for(var me=0;me<pe[ae].length;me++)Be(le,pe[ae][me])}(Y),Y}function Be(ee,D){for(var N=0;N<D.length;N+=3)ee.minX=Math.min(ee.minX,D[N]),ee.minY=Math.min(ee.minY,D[N+1]),ee.maxX=Math.max(ee.maxX,D[N]),ee.maxY=Math.max(ee.maxY,D[N+1])}function $e(ee,D,N,J){if(D.geometry){var Y=D.geometry.coordinates,le=D.geometry.type,pe=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),he=[],ae=D.id;if(N.promoteId?ae=D.properties[N.promoteId]:N.generateId&&(ae=J||0),le==="Point")Ts(Y,he);else if(le==="MultiPoint")for(var me=0;me<Y.length;me++)Ts(Y[me],he);else if(le==="LineString")ki(Y,he,pe,!1);else if(le==="MultiLineString"){if(N.lineMetrics){for(me=0;me<Y.length;me++)ki(Y[me],he=[],pe,!1),ee.push(Dr(ae,"LineString",he,D.properties));return}Gt(Y,he,pe,!1)}else if(le==="Polygon")Gt(Y,he,pe,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(me=0;me<D.geometry.geometries.length;me++)$e(ee,{id:ae,geometry:D.geometry.geometries[me],properties:D.properties},N,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(me=0;me<Y.length;me++){var Me=[];Gt(Y[me],Me,pe,!0),he.push(Me)}}ee.push(Dr(ae,le,he,D.properties))}}function Ts(ee,D){D.push(ir(ee[0])),D.push(Xi(ee[1])),D.push(0)}function ki(ee,D,N,J){for(var Y,le,pe=0,he=0;he<ee.length;he++){var ae=ir(ee[he][0]),me=Xi(ee[he][1]);D.push(ae),D.push(me),D.push(0),he>0&&(pe+=J?(Y*me-ae*le)/2:Math.sqrt(Math.pow(ae-Y,2)+Math.pow(me-le,2))),Y=ae,le=me}var Me=D.length-3;D[2]=1,Yr(D,0,Me,N),D[Me+2]=1,D.size=Math.abs(pe),D.start=0,D.end=D.size}function Gt(ee,D,N,J){for(var Y=0;Y<ee.length;Y++){var le=[];ki(ee[Y],le,N,J),D.push(le)}}function ir(ee){return ee/360+.5}function Xi(ee){var D=Math.sin(ee*Math.PI/180),N=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return N<0?0:N>1?1:N}function qi(ee,D,N,J,Y,le,pe,he){if(J/=D,le>=(N/=D)&&pe<J)return ee;if(pe<N||le>=J)return null;for(var ae=[],me=0;me<ee.length;me++){var Me=ee[me],ze=Me.geometry,Ce=Me.type,ot=Y===0?Me.minX:Me.minY,ut=Y===0?Me.maxX:Me.maxY;if(ot>=N&&ut<J)ae.push(Me);else if(!(ut<N||ot>=J)){var Qe=[];if(Ce==="Point"||Ce==="MultiPoint")Ss(ze,Qe,N,J,Y);else if(Ce==="LineString")qe(ze,Qe,N,J,Y,!1,he.lineMetrics);else if(Ce==="MultiLineString")It(ze,Qe,N,J,Y,!1);else if(Ce==="Polygon")It(ze,Qe,N,J,Y,!0);else if(Ce==="MultiPolygon")for(var xt=0;xt<ze.length;xt++){var pt=[];It(ze[xt],pt,N,J,Y,!0),pt.length&&Qe.push(pt)}if(Qe.length){if(he.lineMetrics&&Ce==="LineString"){for(xt=0;xt<Qe.length;xt++)ae.push(Dr(Me.id,Ce,Qe[xt],Me.tags));continue}Ce!=="LineString"&&Ce!=="MultiLineString"||(Qe.length===1?(Ce="LineString",Qe=Qe[0]):Ce="MultiLineString"),Ce!=="Point"&&Ce!=="MultiPoint"||(Ce=Qe.length===3?"Point":"MultiPoint"),ae.push(Dr(Me.id,Ce,Qe,Me.tags))}}}return ae.length?ae:null}function Ss(ee,D,N,J,Y){for(var le=0;le<ee.length;le+=3){var pe=ee[le+Y];pe>=N&&pe<=J&&(D.push(ee[le]),D.push(ee[le+1]),D.push(ee[le+2]))}}function qe(ee,D,N,J,Y,le,pe){for(var he,ae,me=Mt(ee),Me=Y===0?Qr:Ct,ze=ee.start,Ce=0;Ce<ee.length-3;Ce+=3){var ot=ee[Ce],ut=ee[Ce+1],Qe=ee[Ce+2],xt=ee[Ce+3],pt=ee[Ce+4],Rt=Y===0?ot:ut,At=Y===0?xt:pt,St=!1;pe&&(he=Math.sqrt(Math.pow(ot-xt,2)+Math.pow(ut-pt,2))),Rt<N?At>N&&(ae=Me(me,ot,ut,xt,pt,N),pe&&(me.start=ze+he*ae)):Rt>J?At<J&&(ae=Me(me,ot,ut,xt,pt,J),pe&&(me.start=ze+he*ae)):li(me,ot,ut,Qe),At<N&&Rt>=N&&(ae=Me(me,ot,ut,xt,pt,N),St=!0),At>J&&Rt<=J&&(ae=Me(me,ot,ut,xt,pt,J),St=!0),!le&&St&&(pe&&(me.end=ze+he*ae),D.push(me),me=Mt(ee)),pe&&(ze+=he)}var Ft=ee.length-3;ot=ee[Ft],ut=ee[Ft+1],Qe=ee[Ft+2],(Rt=Y===0?ot:ut)>=N&&Rt<=J&&li(me,ot,ut,Qe),Ft=me.length-3,le&&Ft>=3&&(me[Ft]!==me[0]||me[Ft+1]!==me[1])&&li(me,me[0],me[1],me[2]),me.length&&D.push(me)}function Mt(ee){var D=[];return D.size=ee.size,D.start=ee.start,D.end=ee.end,D}function It(ee,D,N,J,Y,le){for(var pe=0;pe<ee.length;pe++)qe(ee[pe],D,N,J,Y,le,!1)}function li(ee,D,N,J){ee.push(D),ee.push(N),ee.push(J)}function Qr(ee,D,N,J,Y,le){var pe=(le-D)/(J-D);return ee.push(le),ee.push(N+(Y-N)*pe),ee.push(1),pe}function Ct(ee,D,N,J,Y,le){var pe=(le-N)/(Y-N);return ee.push(D+(J-D)*pe),ee.push(le),ee.push(1),pe}function yr(ee,D){for(var N=[],J=0;J<ee.length;J++){var Y,le=ee[J],pe=le.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")Y=Qn(le.geometry,D);else if(pe==="MultiLineString"||pe==="Polygon"){Y=[];for(var he=0;he<le.geometry.length;he++)Y.push(Qn(le.geometry[he],D))}else if(pe==="MultiPolygon")for(Y=[],he=0;he<le.geometry.length;he++){for(var ae=[],me=0;me<le.geometry[he].length;me++)ae.push(Qn(le.geometry[he][me],D));Y.push(ae)}N.push(Dr(le.id,pe,Y,le.tags))}return N}function Qn(ee,D){var N=[];N.size=ee.size,ee.start!==void 0&&(N.start=ee.start,N.end=ee.end);for(var J=0;J<ee.length;J+=3)N.push(ee[J]+D,ee[J+1],ee[J+2]);return N}function wo(ee,D){if(ee.transformed)return ee;var N,J,Y,le=1<<ee.z,pe=ee.x,he=ee.y;for(N=0;N<ee.features.length;N++){var ae=ee.features[N],me=ae.geometry,Me=ae.type;if(ae.geometry=[],Me===1)for(J=0;J<me.length;J+=2)ae.geometry.push(Nn(me[J],me[J+1],D,le,pe,he));else for(J=0;J<me.length;J++){var ze=[];for(Y=0;Y<me[J].length;Y+=2)ze.push(Nn(me[J][Y],me[J][Y+1],D,le,pe,he));ae.geometry.push(ze)}}return ee.transformed=!0,ee}function Nn(ee,D,N,J,Y,le){return[Math.round(N*(ee*J-Y)),Math.round(N*(D*J-le))]}function gi(ee,D,N,J,Y){for(var le=D===Y.maxZoom?0:Y.tolerance/((1<<D)*Y.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:J,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},he=0;he<ee.length;he++){pe.numFeatures++,on(pe,ee[he],le,Y);var ae=ee[he].minX,me=ee[he].minY,Me=ee[he].maxX,ze=ee[he].maxY;ae<pe.minX&&(pe.minX=ae),me<pe.minY&&(pe.minY=me),Me>pe.maxX&&(pe.maxX=Me),ze>pe.maxY&&(pe.maxY=ze)}return pe}function on(ee,D,N,J){var Y=D.geometry,le=D.type,pe=[];if(le==="Point"||le==="MultiPoint")for(var he=0;he<Y.length;he+=3)pe.push(Y[he]),pe.push(Y[he+1]),ee.numPoints++,ee.numSimplified++;else if(le==="LineString")Ao(pe,Y,ee,N,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(he=0;he<Y.length;he++)Ao(pe,Y[he],ee,N,le==="Polygon",he===0);else if(le==="MultiPolygon")for(var ae=0;ae<Y.length;ae++){var me=Y[ae];for(he=0;he<me.length;he++)Ao(pe,me[he],ee,N,!0,he===0)}if(pe.length){var Me=D.tags||null;if(le==="LineString"&&J.lineMetrics){for(var ze in Me={},D.tags)Me[ze]=D.tags[ze];Me.mapbox_clip_start=Y.start/Y.size,Me.mapbox_clip_end=Y.end/Y.size}var Ce={geometry:pe,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:Me};D.id!==null&&(Ce.id=D.id),ee.features.push(Ce)}}function Ao(ee,D,N,J,Y,le){var pe=J*J;if(J>0&&D.size<(Y?pe:J))N.numPoints+=D.length/3;else{for(var he=[],ae=0;ae<D.length;ae+=3)(J===0||D[ae+2]>pe)&&(N.numSimplified++,he.push(D[ae]),he.push(D[ae+1])),N.numPoints++;Y&&function(me,Me){for(var ze=0,Ce=0,ot=me.length,ut=ot-2;Ce<ot;ut=Ce,Ce+=2)ze+=(me[Ce]-me[ut])*(me[Ce+1]+me[ut+1]);if(ze>0===Me)for(Ce=0,ot=me.length;Ce<ot/2;Ce+=2){var Qe=me[Ce],xt=me[Ce+1];me[Ce]=me[ot-2-Ce],me[Ce+1]=me[ot-1-Ce],me[ot-2-Ce]=Qe,me[ot-1-Ce]=xt}}(he,le),ee.push(he)}}function Or(ee,D){var N=(D=this.options=function(Y,le){for(var pe in le)Y[pe]=le[pe];return Y}(Object.create(this.options),D)).debug;if(N&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(Y,le){var pe=[];if(Y.type==="FeatureCollection")for(var he=0;he<Y.features.length;he++)$e(pe,Y.features[he],le,he);else $e(pe,Y.type==="Feature"?Y:{geometry:Y},le);return pe}(ee,D);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),J=function(Y,le){var pe=le.buffer/le.extent,he=Y,ae=qi(Y,1,-1-pe,pe,0,-1,2,le),me=qi(Y,1,1-pe,2+pe,0,-1,2,le);return(ae||me)&&(he=qi(Y,1,-pe,1+pe,0,-1,2,le)||[],ae&&(he=yr(ae,1).concat(he)),me&&(he=he.concat(yr(me,-1)))),he}(J,D),J.length&&this.splitTile(J,0,0,0),N&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function kr(ee,D,N){return 32*((1<<ee)*N+D)+ee}function $s(ee,D){const N=ee.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const J=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!J)return D(null,null);const Y=new Ie(J.features);let le=De.exports(Y);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),D(null,{vectorTile:Y,rawData:le.buffer})}Or.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Or.prototype.splitTile=function(ee,D,N,J,Y,le,pe){for(var he=[ee,D,N,J],ae=this.options,me=ae.debug;he.length;){J=he.pop(),N=he.pop(),D=he.pop(),ee=he.pop();var Me=1<<D,ze=kr(D,N,J),Ce=this.tiles[ze];if(!Ce&&(me>1&&console.time("creation"),Ce=this.tiles[ze]=gi(ee,D,N,J,ae),this.tileCoords.push({z:D,x:N,y:J}),me)){me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,N,J,Ce.numFeatures,Ce.numPoints,Ce.numSimplified),console.timeEnd("creation"));var ot="z"+D;this.stats[ot]=(this.stats[ot]||0)+1,this.total++}if(Ce.source=ee,Y){if(D===ae.maxZoom||D===Y)continue;var ut=1<<Y-D;if(N!==Math.floor(le/ut)||J!==Math.floor(pe/ut))continue}else if(D===ae.indexMaxZoom||Ce.numPoints<=ae.indexMaxPoints)continue;if(Ce.source=null,ee.length!==0){me>1&&console.time("clipping");var Qe,xt,pt,Rt,At,St,Ft=.5*ae.buffer/ae.extent,Vt=.5-Ft,yn=.5+Ft,vn=1+Ft;Qe=xt=pt=Rt=null,At=qi(ee,Me,N-Ft,N+yn,0,Ce.minX,Ce.maxX,ae),St=qi(ee,Me,N+Vt,N+vn,0,Ce.minX,Ce.maxX,ae),ee=null,At&&(Qe=qi(At,Me,J-Ft,J+yn,1,Ce.minY,Ce.maxY,ae),xt=qi(At,Me,J+Vt,J+vn,1,Ce.minY,Ce.maxY,ae),At=null),St&&(pt=qi(St,Me,J-Ft,J+yn,1,Ce.minY,Ce.maxY,ae),Rt=qi(St,Me,J+Vt,J+vn,1,Ce.minY,Ce.maxY,ae),St=null),me>1&&console.timeEnd("clipping"),he.push(Qe||[],D+1,2*N,2*J),he.push(xt||[],D+1,2*N,2*J+1),he.push(pt||[],D+1,2*N+1,2*J),he.push(Rt||[],D+1,2*N+1,2*J+1)}}},Or.prototype.getTile=function(ee,D,N){var J=this.options,Y=J.extent,le=J.debug;if(ee<0||ee>24)return null;var pe=1<<ee,he=kr(ee,D=(D%pe+pe)%pe,N);if(this.tiles[he])return wo(this.tiles[he],Y);le>1&&console.log("drilling down to z%d-%d-%d",ee,D,N);for(var ae,me=ee,Me=D,ze=N;!ae&&me>0;)me--,Me=Math.floor(Me/2),ze=Math.floor(ze/2),ae=this.tiles[kr(me,Me,ze)];return ae&&ae.source?(le>1&&console.log("found parent tile z%d-%d-%d",me,Me,ze),le>1&&console.time("drilling down"),this.splitTile(ae.source,me,Me,ze,ee,D,N),le>1&&console.timeEnd("drilling down"),this.tiles[he]?wo(this.tiles[he],Y):null):null};class Eo extends Z{constructor(D,N,J,Y){super(D,N,J,$s),Y&&(this.loadGeoJSON=Y)}loadData(D,N){var J;(J=this._pendingRequest)===null||J===void 0||J.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Y=!!(D&&D.request&&D.request.collectResourceTiming)&&new l.RequestPerformance(D.request);this._pendingCallback=N,this._pendingRequest=this.loadGeoJSON(D,(le,pe)=>{if(delete this._pendingCallback,delete this._pendingRequest,le||!pe)return N(le);if(typeof pe!="object")return N(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{q(pe,!0);try{if(D.filter){const ae=l.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ae.result==="error")throw new Error(ae.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));pe={type:"FeatureCollection",features:pe.features.filter(Me=>ae.value.evaluate({zoom:0},Me))}}this._geoJSONIndex=D.cluster?new Jr(function({superclusterOptions:ae,clusterProperties:me}){if(!me||!ae)return ae;const Me={},ze={},Ce={accumulated:null,zoom:0},ot={properties:null},ut=Object.keys(me);for(const Qe of ut){const[xt,pt]=me[Qe],Rt=l.createExpression(pt),At=l.createExpression(typeof xt=="string"?[xt,["accumulated"],["get",Qe]]:xt);Me[Qe]=Rt.value,ze[Qe]=At.value}return ae.map=Qe=>{ot.properties=Qe;const xt={};for(const pt of ut)xt[pt]=Me[pt].evaluate(Ce,ot);return xt},ae.reduce=(Qe,xt)=>{ot.properties=xt;for(const pt of ut)Ce.accumulated=Qe[pt],Qe[pt]=ze[pt].evaluate(Ce,ot)},ae}(D)).load(pe.features):function(ae,me){return new Or(ae,me)}(pe,D.geojsonVtOptions)}catch(ae){return N(ae)}this.loaded={};const he={};if(Y){const ae=Y.finish();ae&&(he.resourceTiming={},he.resourceTiming[D.source]=JSON.parse(JSON.stringify(ae)))}N(null,he)}})}reloadTile(D,N){const J=this.loaded;return J&&J[D.uid]?super.reloadTile(D,N):this.loadTile(D,N)}loadGeoJSON(D,N){if(D.request)return l.getJSON(D.request,N);if(typeof D.data=="string")try{N(null,JSON.parse(D.data))}catch{N(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`))}else N(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(D,N){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),N()}getClusterExpansionZoom(D,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(J){N(J)}}getClusterChildren(D,N){try{N(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(J){N(J)}}getClusterLeaves(D,N){try{N(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(J){N(J)}}}class Cs{constructor(D){this.self=D,this.actor=new l.Actor(D,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Z,geojson:Eo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,J)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=J},this.self.registerRTLTextPlugin=N=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=N.applyArabicShaping,l.plugin.processBidirectionalText=N.processBidirectionalText,l.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}setReferrer(D,N){this.referrer=N}setImages(D,N,J){this.availableImages[D]=N;for(const Y in this.workerSources[D]){const le=this.workerSources[D][Y];for(const pe in le)le[pe].availableImages=N}J()}setLayers(D,N,J){this.getLayerIndex(D).replace(N),J()}updateLayers(D,N,J){this.getLayerIndex(D).update(N.layers,N.removedIds),J()}loadTile(D,N,J){this.getWorkerSource(D,N.type,N.source).loadTile(N,J)}loadDEMTile(D,N,J){this.getDEMWorkerSource(D,N.source).loadTile(N,J)}reloadTile(D,N,J){this.getWorkerSource(D,N.type,N.source).reloadTile(N,J)}abortTile(D,N,J){this.getWorkerSource(D,N.type,N.source).abortTile(N,J)}removeTile(D,N,J){this.getWorkerSource(D,N.type,N.source).removeTile(N,J)}removeDEMTile(D,N){this.getDEMWorkerSource(D,N.source).removeTile(N)}removeSource(D,N,J){if(!this.workerSources[D]||!this.workerSources[D][N.type]||!this.workerSources[D][N.type][N.source])return;const Y=this.workerSources[D][N.type][N.source];delete this.workerSources[D][N.type][N.source],Y.removeSource!==void 0?Y.removeSource(N,J):J()}loadWorkerSource(D,N,J){try{this.self.importScripts(N.url),J()}catch(Y){J(Y.toString())}}syncRTLPluginState(D,N,J){try{l.plugin.setState(N);const Y=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&Y!=null){this.self.importScripts(Y);const le=l.plugin.isParsed();J(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),le)}}catch(Y){J(Y.toString())}}getAvailableImages(D){let N=this.availableImages[D];return N||(N=[]),N}getLayerIndex(D){let N=this.layerIndexes[D];return N||(N=this.layerIndexes[D]=new T),N}getWorkerSource(D,N,J){if(this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][N]||(this.workerSources[D][N]={}),!this.workerSources[D][N][J]){const Y={send:(le,pe,he)=>{this.actor.send(le,pe,he,D)}};this.workerSources[D][N][J]=new this.workerSourceTypes[N](Y,this.getLayerIndex(D),this.getAvailableImages(D))}return this.workerSources[D][N][J]}getDEMWorkerSource(D,N){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][N]||(this.demWorkerSources[D][N]=new ue),this.demWorkerSources[D][N]}enforceCacheSizeLimit(D,N){l.enforceCacheSizeLimit(N)}}return l.isWorker()&&(self.worker=new Cs(self)),Cs}),a(["./shared"],function(l){var y=x;function x(m){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,b=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(b);try{_=new Worker(A),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(A),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var b=_.getImageData(0,0,1,1);return b&&b.width===p.width}()?(T[d=o&&o.failIfMajorPerformanceCaveat]===void 0&&(T[d]=function(p){var _,b=function(A){var M=document.createElement("canvas"),P=Object.create(x.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=A,M.getContext("webgl",P)||M.getContext("experimental-webgl",P)}(p);if(!b)return!1;try{_=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!_||b.isContextLost())&&(b.shaderSource(_,"void main() {}"),b.compileShader(_),b.getShaderParameter(_,b.COMPILE_STATUS)===!0)}(d)),T[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var d}(m)}var T={};function C(m,o){if(Array.isArray(m)){if(!Array.isArray(o)||m.length!==o.length)return!1;for(let d=0;d<m.length;d++)if(!C(m[d],o[d]))return!1;return!0}if(typeof m=="object"&&m!==null&&o!==null){if(typeof o!="object"||Object.keys(m).length!==Object.keys(o).length)return!1;for(const d in m)if(!C(m[d],o[d]))return!1;return!0}return m===o}x.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class S{static testProp(o){if(!S.docStyle)return o[0];for(let d=0;d<o.length;d++)if(o[d]in S.docStyle)return o[d];return o[0]}static create(o,d,p){const _=window.document.createElement(o);return d!==void 0&&(_.className=d),p&&p.appendChild(_),_}static createNS(o,d){return window.document.createElementNS(o,d)}static disableDrag(){S.docStyle&&S.selectProp&&(S.userSelect=S.docStyle[S.selectProp],S.docStyle[S.selectProp]="none")}static enableDrag(){S.docStyle&&S.selectProp&&(S.docStyle[S.selectProp]=S.userSelect)}static setTransform(o,d){o.style[S.transformProp]=d}static addEventListener(o,d,p,_={}){o.addEventListener(d,p,"passive"in _?_:_.capture)}static removeEventListener(o,d,p,_={}){o.removeEventListener(d,p,"passive"in _?_:_.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",S.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",S.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",S.suppressClickInternal,!0)},0)}static mousePos(o,d){const p=o.getBoundingClientRect();return new l.pointGeometry(d.clientX-p.left-o.clientLeft,d.clientY-p.top-o.clientTop)}static touchPos(o,d){const p=o.getBoundingClientRect(),_=[];for(let b=0;b<d.length;b++)_.push(new l.pointGeometry(d[b].clientX-p.left-o.clientLeft,d[b].clientY-p.top-o.clientTop));return _}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}S.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,S.selectProp=S.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),S.transformProp=S.testProp(["transform","WebkitTransform"]);class z{constructor(o){this._transformRequestFn=o}transformRequest(o,d){return this._transformRequestFn&&this._transformRequestFn(o,d)||{url:o}}normalizeSpriteURL(o,d,p){const _=function(b){const A=b.match(V);if(!A)throw new Error(`Unable to parse URL "${b}"`);return{protocol:A[1],authority:A[2],path:A[3]||"/",params:A[4]?A[4].split("&"):[]}}(o);return _.path+=`${d}${p}`,function(b){const A=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${A}`}(_)}setTransformRequest(o){this._transformRequestFn=o}}const V=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class Z{constructor(o,d,p,_){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(d,_)}update(o,d,p){const{width:_,height:b}=o,A=!(this.size&&this.size[0]===_&&this.size[1]===b||p),{context:M}=this,{gl:P}=M;if(this.useMipmap=!!(d&&d.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!d||d.premultiply!==!1)),A)this.size=[_,b],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,o):P.texImage2D(P.TEXTURE_2D,0,this.format,_,b,0,this.format,P.UNSIGNED_BYTE,o.data);else{const{x:R,y:k}=p||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||l.isImageBitmap(o)?P.texSubImage2D(P.TEXTURE_2D,0,R,k,P.RGBA,P.UNSIGNED_BYTE,o):P.texSubImage2D(P.TEXTURE_2D,0,R,k,_,b,P.RGBA,P.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)}bind(o,d,p){const{context:_}=this,{gl:b}=_;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),o!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,o),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||o),this.filter=o),d!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,d),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function ue(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class q extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:d,callback:p}of this.requestors)this._notify(d,p);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,d){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,d)&&(this.images[o]=d)}_validate(o,d){let p=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(d.content,d)||(this.fire(new l.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,d){if(!o)return!0;let p=0;for(const _ of o){if(_[0]<p||_[1]<_[0]||d<_[1])return!1;p=_[1]}return!0}_validateContent(o,d){return!(o&&(o.length!==4||o[0]<0||d.data.width<o[0]||o[1]<0||d.data.height<o[1]||o[2]<0||d.data.width<o[2]||o[3]<0||d.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,d){const p=this.images[o];if(p.data.width!==d.data.width||p.data.height!==d.data.height)throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=p.version+1,this.images[o]=d,this.updatedImages[o]=!0}removeImage(o){const d=this.images[o];delete this.images[o],delete this.patterns[o],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,d){let p=!0;if(!this.isLoaded())for(const _ of o)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(o,d):this.requestors.push({ids:o,callback:d})}_notify(o,d){const p={};for(const _ of o){this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));const b=this.images[_];b?p[_]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:l.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,p)}getPixelSize(){const{width:o,height:d}=this.atlasImage;return{width:o,height:d}}getPattern(o){const d=this.patterns[o],p=this.getImage(o);if(!p)return null;if(d&&d.position.version===p.version)return d.position;if(d)d.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new l.ImagePosition(_,p);this.patterns[o]={bin:_,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const d=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Z(o,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:d,h:p}=l.potpack(o),_=this.atlasImage;_.resize({width:d||1,height:p||1});for(const b in this.patterns){const{bin:A}=this.patterns[b],M=A.x+1,P=A.y+1,R=this.images[b].data,k=R.width,U=R.height;l.RGBAImage.copy(R,_,{x:0,y:0},{x:M,y:P},{width:k,height:U}),l.RGBAImage.copy(R,_,{x:0,y:U-1},{x:M,y:P-1},{width:k,height:1}),l.RGBAImage.copy(R,_,{x:0,y:0},{x:M,y:P+U},{width:k,height:1}),l.RGBAImage.copy(R,_,{x:k-1,y:0},{x:M-1,y:P},{width:1,height:U}),l.RGBAImage.copy(R,_,{x:0,y:0},{x:M+k,y:P},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const d of o){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const p=this.images[d];p||l.warnOnce(`Image with ID: "${d}" was not found`),ue(p)&&this.updateImage(d,p)}}}const j=1e20;function K(m,o,d,p,_,b,A,M,P){for(let R=o;R<o+p;R++)de(m,d*b+R,b,_,A,M,P);for(let R=d;R<d+_;R++)de(m,R*b+o,1,p,A,M,P)}function de(m,o,d,p,_,b,A){b[0]=0,A[0]=-j,A[1]=j,_[0]=m[o];for(let M=1,P=0,R=0;M<p;M++){_[M]=m[o+M*d];const k=M*M;do{const U=b[P];R=(_[M]-_[U]+k-U*U)/(M-U)/2}while(R<=A[P]&&--P>-1);P++,b[P]=M,A[P]=R,A[P+1]=j}for(let M=0,P=0;M<p;M++){for(;A[P+1]<M;)P++;const R=b[P],k=M-R;m[o+M*d]=_[R]+k*k}}class ve{constructor(o,d){this.requestManager=o,this.localIdeographFontFamily=d,this.entries={}}setURL(o){this.url=o}getGlyphs(o,d){const p=[];for(const _ in o)for(const b of o[_])p.push({stack:_,id:b});l.asyncAll(p,({stack:_,id:b},A)=>{let M=this.entries[_];M||(M=this.entries[_]={glyphs:{},requests:{},ranges:{}});let P=M.glyphs[b];if(P!==void 0)return void A(null,{stack:_,id:b,glyph:P});if(P=this._tinySDF(M,_,b),P)return M.glyphs[b]=P,void A(null,{stack:_,id:b,glyph:P});const R=Math.floor(b/256);if(256*R>65535)return void A(new Error("glyphs > 65535 not supported"));if(M.ranges[R])return void A(null,{stack:_,id:b,glyph:P});let k=M.requests[R];k||(k=M.requests[R]=[],ve.loadGlyphRange(_,R,this.url,this.requestManager,(U,H)=>{if(H){for(const ie in H)this._doesCharSupportLocalGlyph(+ie)||(M.glyphs[+ie]=H[+ie]);M.ranges[R]=!0}for(const ie of k)ie(U,H);delete M.requests[R]})),k.push((U,H)=>{U?A(U):H&&A(null,{stack:_,id:b,glyph:H[b]||null})})},(_,b)=>{if(_)d(_);else if(b){const A={};for(const{stack:M,id:P,glyph:R}of b)(A[M]||(A[M]={}))[P]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};d(null,A)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](o)||l.unicodeBlockLookup["Hangul Syllables"](o)||l.unicodeBlockLookup.Hiragana(o)||l.unicodeBlockLookup.Katakana(o))}_tinySDF(o,d,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let b=o.tinySDF;if(!b){let M="400";/bold/i.test(d)?M="900":/medium/i.test(d)?M="500":/light/i.test(d)&&(M="200"),b=o.tinySDF=new ve.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:M})}const A=b.draw(String.fromCharCode(p));return{id:p,bitmap:new l.AlphaImage({width:A.width||30,height:A.height||30},A.data),metrics:{width:A.glyphWidth||24,height:A.glyphHeight||24,left:A.glyphLeft||0,top:A.glyphTop-27||-8,advance:A.glyphAdvance||24}}}}ve.loadGlyphRange=function(m,o,d,p,_){const b=256*o,A=b+255,M=p.transformRequest(d.replace("{fontstack}",m).replace("{range}",`${b}-${A}`),l.ResourceType.Glyphs);l.getArrayBuffer(M,(P,R)=>{if(P)_(P);else if(R){const k={};for(const U of l.parseGlyphPbf(R))k[U.id]=U;_(null,k)}})},ve.TinySDF=class{constructor({fontSize:m=24,buffer:o=3,radius:d=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:b="normal",fontStyle:A="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=d;const M=this.size=m+4*o,P=this._createCanvas(M),R=this.ctx=P.getContext("2d",{willReadFrequently:!0});R.font=`${A} ${b} ${m}px ${_}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(m){const o=document.createElement("canvas");return o.width=o.height=m,o}draw(m){const{width:o,actualBoundingBoxAscent:d,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:b}=this.ctx.measureText(m),A=Math.ceil(d),M=Math.min(this.size-this.buffer,Math.ceil(b-_)),P=Math.min(this.size-this.buffer,A+Math.ceil(p)),R=M+2*this.buffer,k=P+2*this.buffer,U=Math.max(R*k,0),H=new Uint8ClampedArray(U),ie={data:H,width:R,height:k,glyphWidth:M,glyphHeight:P,glyphTop:A,glyphLeft:0,glyphAdvance:o};if(M===0||P===0)return ie;const{ctx:te,buffer:ne,gridInner:fe,gridOuter:ge}=this;te.clearRect(ne,ne,M,P),te.fillText(m,ne,ne+A);const xe=te.getImageData(ne,ne,M,P);ge.fill(j,0,U),fe.fill(0,0,U);for(let re=0;re<P;re++)for(let Ee=0;Ee<M;Ee++){const be=xe.data[4*(re*M+Ee)+3]/255;if(be===0)continue;const Le=(re+ne)*R+Ee+ne;if(be===1)ge[Le]=0,fe[Le]=j;else{const Re=.5-be;ge[Le]=Re>0?Re*Re:0,fe[Le]=Re<0?Re*Re:0}}K(ge,0,0,R,k,R,this.f,this.v,this.z),K(fe,ne,ne,M,P,R,this.f,this.v,this.z);for(let re=0;re<U;re++){const Ee=Math.sqrt(ge[re])-Math.sqrt(fe[re]);H[re]=Math.round(255-255*(Ee/this.radius+this.cutoff))}return ie}};const Ie=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(m,o){return l.sphericalToCartesian(m.expression.evaluate(o))}interpolate(m,o,d){return{x:l.number(m.x,o.x,d),y:l.number(m.y,o.y,d),z:l.number(m.z,o.z,d)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),De="-transition";class Fe extends l.Evented{constructor(o){super(),this._transitionable=new l.Transitionable(Ie),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d={}){if(!this._validate(l.validateLight,o,d))for(const p in o){const _=o[p];p.endsWith(De)?this._transitionable.setTransition(p.slice(0,-De.length),_):this._transitionable.setValue(p,_)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,o.call(l.validateStyle,l.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class je{constructor(o,d){this.width=o,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,d){const p=o.join(",")+String(d);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,d)),this.dashEntry[p]}getDashRanges(o,d,p){const _=[];let b=o.length%2==1?-o[o.length-1]*p:0,A=o[0]*p,M=!0;_.push({left:b,right:A,isDash:M,zeroLength:o[0]===0});let P=o[0];for(let R=1;R<o.length;R++){M=!M;const k=o[R];b=P*p,P+=k,A=P*p,_.push({left:b,right:A,isDash:M,zeroLength:k===0})}return _}addRoundDash(o,d,p){const _=d/2;for(let b=-p;b<=p;b++){const A=this.width*(this.nextRow+p+b);let M=0,P=o[M];for(let R=0;R<this.width;R++){R/P.right>1&&(P=o[++M]);const k=Math.abs(R-P.left),U=Math.abs(R-P.right),H=Math.min(k,U);let ie;const te=b/p*(_+1);if(P.isDash){const ne=_-Math.abs(te);ie=Math.sqrt(H*H+ne*ne)}else ie=_-Math.sqrt(H*H+te*te);this.data[A+R]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(o){for(let M=o.length-1;M>=0;--M){const P=o[M],R=o[M+1];P.zeroLength?o.splice(M,1):R&&R.isDash===P.isDash&&(R.left=P.left,o.splice(M,1))}const d=o[0],p=o[o.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const _=this.width*this.nextRow;let b=0,A=o[b];for(let M=0;M<this.width;M++){M/A.right>1&&(A=o[++b]);const P=Math.abs(M-A.left),R=Math.abs(M-A.right),k=Math.min(P,R);this.data[_+M]=Math.max(0,Math.min(255,(A.isDash?k:-k)+128))}}addDash(o,d){const p=d?7:0,_=2*p+1;if(this.nextRow+_>this.height)return l.warnOnce("LineAtlas out of space"),null;let b=0;for(let M=0;M<o.length;M++)b+=o[M];if(b!==0){const M=this.width/b,P=this.getDashRanges(o,this.width,M);d?this.addRoundDash(P,M,p):this.addRegularDash(P)}const A={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=_,this.dirty=!0,A}bind(o){const d=o.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}class Ne{constructor(o,d){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const b=new Ne.Actor(p[_],d,this.id);b.name=`Worker ${_}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,d,p){l.asyncAll(this.actors,(_,b)=>{_.send(o,d,b)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function dt(m,o,d){const p=function(_,b){if(_)return d(_);if(b){const A=l.pick(l.extend(b,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(A.vectorLayers=b.vector_layers,A.vectorLayerIds=A.vectorLayers.map(M=>M.id)),d(null,A)}};return m.url?l.getJSON(o.transformRequest(m.url,l.ResourceType.Source),p):l.exported.frame(()=>p(null,m))}Ne.Actor=l.Actor;class Nt{constructor(o,d,p){this.bounds=l.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=d||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const d=Math.pow(2,o.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*d),_=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*d),b=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*d),A=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*d);return o.x>=p&&o.x<b&&o.y>=_&&o.y<A}}class Xt extends l.Evented{constructor(o,d,p,_){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(d,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dt(this._options,this.map._requestManager,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o?this.fire(new l.ErrorEvent(o)):d&&(l.extend(this,d),d.bounds&&(this.tileBounds=new Nt(d.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function b(A,M){return delete o.request,o.aborted?d(null):A&&A.status!==404?d(A):(M&&M.resourceTiming&&(o.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&o.setExpiryData(M),o.loadVectorData(M,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=d:o.request=o.actor.send("reloadTile",_,b.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",_,b.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Lt extends l.Evented{constructor(o,d,p,_){super(),this.id=o,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},d),l.extend(this,l.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dt(this._options,this.map._requestManager,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new l.ErrorEvent(o)):d&&(l.extend(this,d),d.bounds&&(this.tileBounds=new Nt(d.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(_,b,A)=>{if(delete o.request,o.aborted)o.state="unloaded",d(null);else if(_)o.state="errored",d(_);else if(b){this.map._refreshExpiredTiles&&o.setExpiryData(A);const M=this.map.painter.context,P=M.gl;o.texture=this.map.painter.getTileTexture(b.width),o.texture?o.texture.update(b,{useMipmap:!0}):(o.texture=new Z(M,b,P.RGBA,{useMipmap:!0}),o.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),M.extTextureFilterAnisotropic&&P.texParameterf(P.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax)),o.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),d(null)}})}abortTile(o,d){o.request&&(o.request.cancel(),delete o.request),d()}unloadTile(o,d){o.texture&&this.map.painter.saveTileTexture(o.texture),d()}hasTransition(){return!1}}let jn;class yt extends Lt{constructor(o,d,p,_){super(o,d,p,_),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(o,d){const p=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(b,A){b&&(o.state="errored",d(b)),A&&(o.dem=A,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded",d(null))}o.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),function(b,A){if(delete o.request,o.aborted)o.state="unloaded",d(null);else if(b)o.state="errored",d(b);else if(A){this.map._refreshExpiredTiles&&o.setExpiryData(A),delete A.cacheControl,delete A.expires;const M=l.isImageBitmap(A)&&(jn==null&&(jn=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),jn)?A:l.exported.getImageData(A,1),P={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:M,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",P,_.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)}_getNeighboringTiles(o){const d=o.canonical,p=Math.pow(2,d.z),_=(d.x-1+p)%p,b=d.x===0?o.wrap-1:o.wrap,A=(d.x+1+p)%p,M=d.x+1===p?o.wrap+1:o.wrap,P={};return P[new l.OverscaledTileID(o.overscaledZ,b,d.z,_,d.y).key]={backfilled:!1},P[new l.OverscaledTileID(o.overscaledZ,M,d.z,A,d.y).key]={backfilled:!1},d.y>0&&(P[new l.OverscaledTileID(o.overscaledZ,b,d.z,_,d.y-1).key]={backfilled:!1},P[new l.OverscaledTileID(o.overscaledZ,o.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},P[new l.OverscaledTileID(o.overscaledZ,M,d.z,A,d.y-1).key]={backfilled:!1}),d.y+1<p&&(P[new l.OverscaledTileID(o.overscaledZ,b,d.z,_,d.y+1).key]={backfilled:!1},P[new l.OverscaledTileID(o.overscaledZ,o.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},P[new l.OverscaledTileID(o.overscaledZ,M,d.z,A,d.y+1).key]={backfilled:!1}),P}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class Yn extends l.Evented{constructor(o,d,p,_){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(_),this._data=d.data,this._options=l.extend({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const b=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*b,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*b,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.EXTENT,radius:(d.clusterRadius||50)*b,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData("content"),this}getClusterExpansionZoom(o,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},d),this}getClusterChildren(o,d){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},d),this}getClusterLeaves(o,d,p,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:d,offset:p},_),this}_updateWorkerData(o){const d=l.extend({},this.workerOptions),p=this._data;typeof p=="string"?(d.request=this.map._requestManager.transformRequest(l.exported.resolveURL(p),l.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(p),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,d,(_,b)=>{if(this._pendingLoads--,this._removed||b&&b.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:o}));let A=null;if(b&&b.resourceTiming&&b.resourceTiming[this.id]&&(A=b.resourceTiming[this.id].slice(0)),_)return void this.fire(new l.ErrorEvent(_));const M={dataType:"source",sourceDataType:o};this._collectResourceTiming&&A&&A.length>0&&l.extend(M,{resourceTiming:A}),this.fire(new l.Event("data",M))})}loaded(){return this._pendingLoads===0}loadTile(o,d){const p=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const _={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(p,_,(b,A)=>(delete o.request,o.unloadVectorData(),o.aborted?d(null):b?d(b):(o.loadVectorData(A,this.map.painter,p==="reloadTile"),d(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ke=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class vt extends l.Evented{constructor(o,d,p,_){super(),this.id=o,this.dispatcher=p,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=d}load(o,d){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):_&&(this.image=_,o&&(this.coordinates=o),d&&d(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o;const d=o.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(_){let b=1/0,A=1/0,M=-1/0,P=-1/0;for(const H of _)b=Math.min(b,H.x),A=Math.min(A,H.y),M=Math.max(M,H.x),P=Math.max(P,H.y);const R=Math.max(M-b,P-A),k=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),U=Math.pow(2,k);return new l.CanonicalTileID(k,Math.floor((b+M)/2*U),Math.floor((A+P)/2*U))}(d),this.minzoom=this.maxzoom=this.tileID.z;const p=d.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,d=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Ke.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Z(o,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(o,d){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},d(null)):(o.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Et extends vt{constructor(o,d,p,_){super(o,d,p,_),this.roundZoom=!0,this.type="video",this.options=d}load(){this._loaded=!1;const o=this.options;this.urls=[];for(const d of o.urls)this.urls.push(this.map._requestManager.transformRequest(d,l.ResourceType.Source).url);l.getVideo(this.urls,(d,p)=>{this._loaded=!0,d?this.fire(new l.ErrorEvent(d)):p&&(this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const d=this.video.seekable;o<d.start(0)||o>d.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,d=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Ke.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new Z(o,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class en extends vt{constructor(o,d,p,_){super(o,d,p,_),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(A=>typeof A!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${o}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,p=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Ke.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Z(d,this.canvas,p.RGBA,{premultiply:!0});for(const _ in this.tiles){const b=this.tiles[_];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const sn={vector:Xt,raster:Lt,"raster-dem":yt,geojson:Yn,video:Et,image:vt,canvas:en};function ji(m,o){const d=l.create();return l.translate(d,d,[1,1,0]),l.scale(d,d,[.5*m.width,.5*m.height,1]),l.multiply(d,d,m.calculatePosMatrix(o.toUnwrapped()))}function pi(m,o,d,p,_,b){const A=function(U,H,ie){if(U)for(const te of U){const ne=H[te];if(ne&&ne.source===ie&&ne.type==="fill-extrusion")return!0}else for(const te in H){const ne=H[te];if(ne.source===ie&&ne.type==="fill-extrusion")return!0}return!1}(_&&_.layers,o,m.id),M=b.maxPitchScaleFactor(),P=m.tilesIn(p,M,A);P.sort(Di);const R=[];for(const U of P)R.push({wrappedTileID:U.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(o,d,m._state,U.queryGeometry,U.cameraQueryGeometry,U.scale,_,b,M,ji(m.transform,U.tileID))});const k=function(U){const H={},ie={};for(const te of U){const ne=te.queryResults,fe=te.wrappedTileID,ge=ie[fe]=ie[fe]||{};for(const xe in ne){const re=ne[xe],Ee=ge[xe]=ge[xe]||{},be=H[xe]=H[xe]||[];for(const Le of re)Ee[Le.featureIndex]||(Ee[Le.featureIndex]=!0,be.push(Le))}}return H}(R);for(const U in k)k[U].forEach(H=>{const ie=H.feature,te=m.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=te});return k}function Di(m,o){const d=m.tileID,p=o.tileID;return d.overscaledZ-p.overscaledZ||d.canonical.y-p.canonical.y||d.wrap-p.wrap||d.canonical.x-p.canonical.x}class mi{constructor(o,d){this.tileID=o,this.uid=l.uniqueId(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const d=o+this.timeAdded;d<l.exported.now()||this.fadeEndTime&&d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.textures.forEach(d=>o.saveTileTexture(d)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(o,d,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(_,b){const A={};if(!b)return A;for(const M of _){const P=M.layerIds.map(R=>b.getLayer(R)).filter(Boolean);if(P.length!==0){M.layers=P,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(R=>P.filter(k=>k.id===R)[0]));for(const R of P)A[R.id]=M}}return A}(o.buckets,d.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const b=this.buckets[_];if(b instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const b=this.buckets[_];if(b instanceof l.SymbolBucket&&b.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const b=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(_).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(o)}const d=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Z(o,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Z(o,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,d,p,_,b,A,M,P,R,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:b,scale:A,tileSize:this.tileSize,pixelPosMatrix:k,transform:P,params:M,queryPadding:this.queryPadding*R},o,d,p):{}}querySourceFeatures(o,d){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),b=d?d.sourceLayer:"",A=_._geojsonTileLayer||_[b];if(!A)return;const M=l.createFilter(d&&d.filter),{z:P,x:R,y:k}=this.tileID.canonical,U={z:P,x:R,y:k};for(let H=0;H<A.length;H++){const ie=A.feature(H);if(M.needGeometry){const fe=l.toEvaluationFeature(ie,!0);if(!M.filter(new l.EvaluationParameters(this.tileID.overscaledZ),fe,this.tileID.canonical))continue}else if(!M.filter(new l.EvaluationParameters(this.tileID.overscaledZ),ie))continue;const te=p.getId(ie,b),ne=new l.GeoJSONFeature(ie,P,R,k,te);ne.tile=U,o.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const d=this.expirationTime;if(o.cacheControl){const p=l.parseCacheControl(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(d)if(this.expirationTime<d)_=!0;else{const b=this.expirationTime-d;b?this.expirationTime=p+Math.max(b,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!d.style.hasLayer(_))continue;const b=this.buckets[_],A=b.layers[0].sourceLayer||"_geojsonTileLayer",M=p[A],P=o[A];if(!M||!P||Object.keys(P).length===0)continue;b.update(P,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=d&&d.style&&d.style.getLayer(_);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=l.exported.now()+o}setDependencies(o,d){const p={};for(const _ of d)p[_]=!0;this.dependencies[o]=p}hasDependency(o,d){for(const p of o){const _=this.dependencies[p];if(_){for(const b of d)if(_[b])return!0}}return!1}}class mn{constructor(o,d){this.max=o,this.onRemove=d,this.reset()}reset(){for(const o in this.data)for(const d of this.data[o])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(o,d,p){const _=o.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const b={value:d,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(o,b)},p)),this.data[_].push(b),this.order.push(_),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const d=this.data[o].shift();return d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),d.value}getByKey(o){const d=this.data[o];return d?d[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,d){if(!this.has(o))return this;const p=o.wrapped().key,_=d===void 0?0:this.data[p].indexOf(d),b=this.data[p][_];return this.data[p].splice(_,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(o){const d=[];for(const p in this.data)for(const _ of this.data[p])o(_.value)||d.push(_);for(const p of d)this.remove(p.value.tileID,p)}}class Oi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,d,p){const _=String(d);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][_]=this.stateChanges[o][_]||{},l.extend(this.stateChanges[o][_],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const b in this.state[o])b!==_&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][_]===null){this.deletedStates[o][_]={};for(const b in this.state[o][_])p[b]||(this.deletedStates[o][_][b]=null)}else for(const b in p)this.deletedStates[o]&&this.deletedStates[o][_]&&this.deletedStates[o][_][b]===null&&delete this.deletedStates[o][_][b]}removeFeatureState(o,d,p){if(this.deletedStates[o]===null)return;const _=String(d);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&d!==void 0)this.deletedStates[o][_]!==null&&(this.deletedStates[o][_]=this.deletedStates[o][_]||{},this.deletedStates[o][_][p]=null);else if(d!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][_])for(p in this.deletedStates[o][_]={},this.stateChanges[o][_])this.deletedStates[o][_][p]=null;else this.deletedStates[o][_]=null;else this.deletedStates[o]=null}getState(o,d){const p=String(d),_=l.extend({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const b=this.deletedStates[o][d];if(b===null)return{};for(const A in b)delete _[A]}return _}initializeTileState(o,d){o.setFeatureState(this.state,d)}coalesceChanges(o,d){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const b={};for(const A in this.stateChanges[_])this.state[_][A]||(this.state[_][A]={}),l.extend(this.state[_][A],this.stateChanges[_][A]),b[A]=this.state[_][A];p[_]=b}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const b={};if(this.deletedStates[_]===null)for(const A in this.state[_])b[A]={},this.state[_][A]={};else for(const A in this.deletedStates[_]){if(this.deletedStates[_][A]===null)this.state[_][A]={};else for(const M of Object.keys(this.deletedStates[_][A]))delete this.state[_][A][M];b[A]=this.state[_][A]}p[_]=p[_]||{},l.extend(p[_],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in o)o[_].setFeatureState(p,d)}}class Jt extends l.Evented{constructor(o,d,p){super(),this.id=o,this.dispatcher=p,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,b,A,M){const P=new sn[b.type](_,b,A,M);if(P.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${P.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],P),P}(o,d,p,this),this._tiles={},this._cache=new mn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Oi}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const d=this._tiles[o];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,d){return this._source.loadTile(o,d)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new l.Event("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const p=this._tiles[d];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Hn).map(o=>o.key)}getRenderableIds(o){const d=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&d.push(this._tiles[p]);return o?d.sort((p,_)=>{const b=p.tileID,A=_.tileID,M=new l.pointGeometry(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),P=new l.pointGeometry(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-A.overscaledZ||P.y-M.y||P.x-M.x}).map(p=>p.tileID.key):d.map(p=>p.tileID).sort(Hn).map(p=>p.key)}hasRenderableParent(o){const d=this.findLoadedParent(o,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(o,d){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(d||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,d){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=d),this._loadTile(p,this._tileLoaded.bind(this,p,o,d)))}_tileLoaded(o,d,p,_){if(_)return o.state="errored",void(_.status!==404?this._source.fire(new l.ErrorEvent(_,{tile:o})):this.update(this.transform,this.terrain));o.timeAdded=l.exported.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(d,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const d=this.getRenderableIds();for(let _=0;_<d.length;_++){const b=d[_];if(o.neighboringTiles&&o.neighboringTiles[b]){const A=this.getTileByID(b);p(o,A),p(A,o)}}function p(_,b){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let A=b.tileID.canonical.x-_.tileID.canonical.x;const M=b.tileID.canonical.y-_.tileID.canonical.y,P=Math.pow(2,_.tileID.canonical.z),R=b.tileID.key;A===0&&M===0||Math.abs(M)>1||(Math.abs(A)>1&&(Math.abs(A+P)===1?A+=P:Math.abs(A-P)===1&&(A-=P)),b.dem&&_.dem&&(_.dem.backfillBorder(b.dem,A,M),_.neighboringTiles&&_.neighboringTiles[R]&&(_.neighboringTiles[R].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,d,p,_){for(const b in this._tiles){let A=this._tiles[b];if(_[b]||!A.hasData()||A.tileID.overscaledZ<=d||A.tileID.overscaledZ>p)continue;let M=A.tileID;for(;A&&A.tileID.overscaledZ>d+1;){const R=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[R.key],A&&A.hasData()&&(M=R)}let P=M;for(;P.overscaledZ>d;)if(P=P.scaledTo(P.overscaledZ-1),o[P.key]){_[M.key]=M;break}}}findLoadedParent(o,d){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=d?p:null}for(let p=o.overscaledZ-1;p>=d;p--){const _=o.scaledTo(p),b=this._getLoadedTile(_);if(b)return b}}_getLoadedTile(o){const d=this._tiles[o.key];return d&&d.hasData()?d:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const d=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,_=Math.floor(d*p*5),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(b)}handleWrapJump(o){const d=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,d){const p={};for(const _ in this._tiles){const b=this._tiles[_];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+d),p[b.tileID.key]=b}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(o,d){if(this.transform=o,this.terrain=d,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(R=>new l.OverscaledTileID(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y)):(p=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(p=p.filter(R=>this._source.hasTile(R)))):p=[];const _=o.coveringZoomLevel(this._source),b=Math.max(_-Jt.maxOverzooming,this._source.minzoom),A=Math.max(_+Jt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const k of p)if(k.canonical.z>this._source.minzoom){const U=k.scaledTo(k.canonical.z-1);R[U.key]=U;const H=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));R[H.key]=H}p=p.concat(Object.values(R))}const M=this._updateRetainedTiles(p,_);if(As(this._source.type)){const R={},k={},U=Object.keys(M);for(const H of U){const ie=M[H],te=this._tiles[H];if(!te||te.fadeEndTime&&te.fadeEndTime<=l.exported.now())continue;const ne=this.findLoadedParent(ie,b);ne&&(this._addTile(ne.tileID),R[ne.tileID.key]=ne.tileID),k[H]=ie}this._retainLoadedChildren(k,_,A,M);for(const H in R)M[H]||(this._coveredTiles[H]=!0,M[H]=R[H]);if(d){const H={},ie={};for(const te of p)this._tiles[te.key].hasData()?H[te.key]=te:ie[te.key]=te;for(const te in ie){const ne=ie[te].children(this._source.maxzoom);this._tiles[ne[0].key]&&this._tiles[ne[1].key]&&this._tiles[ne[2].key]&&this._tiles[ne[3].key]&&(H[ne[0].key]=M[ne[0].key]=ne[0],H[ne[1].key]=M[ne[1].key]=ne[1],H[ne[2].key]=M[ne[2].key]=ne[2],H[ne[3].key]=M[ne[3].key]=ne[3],delete ie[te])}for(const te in ie){const ne=this.findLoadedParent(ie[te],this._source.minzoom);if(ne){H[ne.tileID.key]=M[ne.tileID.key]=ne.tileID;for(const fe in H)H[fe].isChildOf(ne.tileID)&&delete H[fe]}}for(const te in this._tiles)H[te]||(this._coveredTiles[te]=!0)}}for(const R in M)this._tiles[R].clearFadeHold();const P=l.keysDifference(this._tiles,M);for(const R of P){const k=this._tiles[R];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,d){const p={},_={},b=Math.max(d-Jt.maxOverzooming,this._source.minzoom),A=Math.max(d+Jt.maxUnderzooming,this._source.minzoom),M={};for(const P of o){const R=this._addTile(P);p[P.key]=P,R.hasData()||d<this._source.maxzoom&&(M[P.key]=P)}this._retainLoadedChildren(M,d,A,p);for(const P of o){let R=this._tiles[P.key];if(R.hasData())continue;if(d+1>this._source.maxzoom){const U=P.children(this._source.maxzoom)[0],H=this.getTile(U);if(H&&H.hasData()){p[U.key]=U;continue}}else{const U=P.children(this._source.maxzoom);if(p[U[0].key]&&p[U[1].key]&&p[U[2].key]&&p[U[3].key])continue}let k=R.wasRequested();for(let U=P.overscaledZ-1;U>=b;--U){const H=P.scaledTo(U);if(_[H.key]||(_[H.key]=!0,R=this.getTile(H),!R&&k&&(R=this._addTile(H)),R&&(p[H.key]=H,k=R.wasRequested(),R.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const d=[];let p,_=this._tiles[o].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}d.push(_.key);const b=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;_=b}for(const b of d)this._loadedParentTiles[b]=p}}_addTile(o){let d=this._tiles[o.key];if(d)return d;d=this._cache.getAndRemove(o),d&&(this._setTileReloadTimer(o.key,d),d.tileID=o,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,d)));const p=d;return d||(d=new mi(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,o.key,d.state))),d.uses++,this._tiles[o.key]=d,p||this._source.fire(new l.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(o,d){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=d.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const d=this._tiles[o];d&&(d.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,d,p){const _=[],b=this.transform;if(!b)return _;const A=p?b.getCameraQueryGeometry(o):o,M=o.map(te=>b.pointCoordinate(te,this.terrain)),P=A.map(te=>b.pointCoordinate(te,this.terrain)),R=this.getIds();let k=1/0,U=1/0,H=-1/0,ie=-1/0;for(const te of P)k=Math.min(k,te.x),U=Math.min(U,te.y),H=Math.max(H,te.x),ie=Math.max(ie,te.y);for(let te=0;te<R.length;te++){const ne=this._tiles[R[te]];if(ne.holdingForFade())continue;const fe=ne.tileID,ge=Math.pow(2,b.zoom-ne.tileID.overscaledZ),xe=d*ne.queryPadding*l.EXTENT/ne.tileSize/ge,re=[fe.getTilePoint(new l.MercatorCoordinate(k,U)),fe.getTilePoint(new l.MercatorCoordinate(H,ie))];if(re[0].x-xe<l.EXTENT&&re[0].y-xe<l.EXTENT&&re[1].x+xe>=0&&re[1].y+xe>=0){const Ee=M.map(Le=>fe.getTilePoint(Le)),be=P.map(Le=>fe.getTilePoint(Le));_.push({tile:ne,tileID:fe,queryGeometry:Ee,cameraQueryGeometry:be,scale:ge})}}return _}getVisibleCoordinates(o){const d=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);for(const p of d)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(As(this._source.type))for(const o in this._tiles){const d=this._tiles[o];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(o,d,p){this._state.updateState(o=o||"_geojsonTileLayer",d,p)}removeFeatureState(o,d,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",d,p)}getFeatureState(o,d){return this._state.getState(o=o||"_geojsonTileLayer",d)}setDependencies(o,d,p){const _=this._tiles[o];_&&_.setDependencies(d,p)}reloadTilesForDependencies(o,d){for(const p in this._tiles)this._tiles[p].hasDependency(o,d)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,d))}}function Hn(m,o){const d=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return m.overscaledZ-o.overscaledZ||p-d||o.canonical.y-m.canonical.y||o.canonical.x-m.canonical.x}function As(m){return m==="raster"||m==="image"||m==="video"}Jt.maxOverzooming=10,Jt.maxUnderzooming=3;const Hi="mapboxgl_preloaded_worker_pool";class ai{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<ai.workerCount;)this.workers.push(new Worker(na.workerUrl));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Hi]}numActive(){return Object.keys(this.active).length}}const Jr=Math.floor(l.exported.hardwareConcurrency/2);let tr;function Ti(){return tr||(tr=new ai),tr}function nr(m,o){const d={};for(const p in m)p!=="ref"&&(d[p]=m[p]);return l.refProperties.forEach(p=>{p in o&&(d[p]=o[p])}),d}function xo(m){m=m.slice();const o=Object.create(null);for(let d=0;d<m.length;d++)o[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=nr(m[d],o[m[d].ref]));return m}ai.workerCount=Math.max(Math.min(Jr,6),1);const Ht={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Wi(m,o,d){d.push({command:Ht.addSource,args:[m,o[m]]})}function Wn(m,o,d){o.push({command:Ht.removeSource,args:[m]}),d[m]=!0}function Es(m,o,d,p){Wn(m,d,p),Wi(m,o,d)}function Jo(m,o,d){let p;for(p in m[d])if(Object.prototype.hasOwnProperty.call(m[d],p)&&p!=="data"&&!C(m[d][p],o[d][p]))return!1;for(p in o[d])if(Object.prototype.hasOwnProperty.call(o[d],p)&&p!=="data"&&!C(m[d][p],o[d][p]))return!1;return!0}function Kr(m,o,d,p,_,b){let A;for(A in o=o||{},m=m||{})Object.prototype.hasOwnProperty.call(m,A)&&(C(m[A],o[A])||d.push({command:b,args:[p,A,o[A],_]}));for(A in o)Object.prototype.hasOwnProperty.call(o,A)&&!Object.prototype.hasOwnProperty.call(m,A)&&(C(m[A],o[A])||d.push({command:b,args:[p,A,o[A],_]}))}function Yr(m){return m.id}function bo(m,o){return m[o.id]=o,m}class Dr{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=l.clamp(o,0,1);let d=1,p=this._distances[d];const _=o*this.paddedLength+this.padding;for(;p<_&&d<this._distances.length;)p=this._distances[++d];const b=d-1,A=this._distances[b],M=p-A,P=M>0?(_-A)/M:0;return this.points[b].mult(1-P).add(this.points[d].mult(P))}}function Be(m,o){let d=!0;return m==="always"||m!=="never"&&o!=="never"||(d=!1),d}class $e{constructor(o,d,p){const _=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(d/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)_.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,p,_,b){this._forEachCell(d,p,_,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(b)}insertCircle(o,d,p,_){this._forEachCell(d-_,p-_,d+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(p),this.circles.push(_)}_insertBoxCell(o,d,p,_,b,A){this.boxCells[b].push(A)}_insertCircleCell(o,d,p,_,b,A){this.circleCells[b].push(A)}_query(o,d,p,_,b,A,M){if(p<0||o>this.width||_<0||d>this.height)return[];const P=[];if(o<=0&&d<=0&&this.width<=p&&this.height<=_){if(b)return[{key:null,x1:o,y1:d,x2:p,y2:_}];for(let R=0;R<this.boxKeys.length;R++)P.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const k=this.circles[3*R],U=this.circles[3*R+1],H=this.circles[3*R+2];P.push({key:this.circleKeys[R],x1:k-H,y1:U-H,x2:k+H,y2:U+H})}}else this._forEachCell(o,d,p,_,this._queryCell,P,{hitTest:b,overlapMode:A,seenUids:{box:{},circle:{}}},M);return P}query(o,d,p,_){return this._query(o,d,p,_,!1,null)}hitTest(o,d,p,_,b,A){return this._query(o,d,p,_,!0,b,A).length>0}hitTestCircle(o,d,p,_,b){const A=o-p,M=o+p,P=d-p,R=d+p;if(M<0||A>this.width||R<0||P>this.height)return!1;const k=[];return this._forEachCell(A,P,M,R,this._queryCellCircle,k,{hitTest:!0,overlapMode:_,circle:{x:o,y:d,radius:p},seenUids:{box:{},circle:{}}},b),k.length>0}_queryCell(o,d,p,_,b,A,M,P){const{seenUids:R,hitTest:k,overlapMode:U}=M,H=this.boxCells[b];if(H!==null){const te=this.bboxes;for(const ne of H)if(!R.box[ne]){R.box[ne]=!0;const fe=4*ne,ge=this.boxKeys[ne];if(o<=te[fe+2]&&d<=te[fe+3]&&p>=te[fe+0]&&_>=te[fe+1]&&(!P||P(ge))&&(!k||!Be(U,ge.overlapMode))&&(A.push({key:ge,x1:te[fe],y1:te[fe+1],x2:te[fe+2],y2:te[fe+3]}),k))return!0}}const ie=this.circleCells[b];if(ie!==null){const te=this.circles;for(const ne of ie)if(!R.circle[ne]){R.circle[ne]=!0;const fe=3*ne,ge=this.circleKeys[ne];if(this._circleAndRectCollide(te[fe],te[fe+1],te[fe+2],o,d,p,_)&&(!P||P(ge))&&(!k||!Be(U,ge.overlapMode))){const xe=te[fe],re=te[fe+1],Ee=te[fe+2];if(A.push({key:ge,x1:xe-Ee,y1:re-Ee,x2:xe+Ee,y2:re+Ee}),k)return!0}}}return!1}_queryCellCircle(o,d,p,_,b,A,M,P){const{circle:R,seenUids:k,overlapMode:U}=M,H=this.boxCells[b];if(H!==null){const te=this.bboxes;for(const ne of H)if(!k.box[ne]){k.box[ne]=!0;const fe=4*ne,ge=this.boxKeys[ne];if(this._circleAndRectCollide(R.x,R.y,R.radius,te[fe+0],te[fe+1],te[fe+2],te[fe+3])&&(!P||P(ge))&&!Be(U,ge.overlapMode))return A.push(!0),!0}}const ie=this.circleCells[b];if(ie!==null){const te=this.circles;for(const ne of ie)if(!k.circle[ne]){k.circle[ne]=!0;const fe=3*ne,ge=this.circleKeys[ne];if(this._circlesCollide(te[fe],te[fe+1],te[fe+2],R.x,R.y,R.radius)&&(!P||P(ge))&&!Be(U,ge.overlapMode))return A.push(!0),!0}}}_forEachCell(o,d,p,_,b,A,M,P){const R=this._convertToXCellCoord(o),k=this._convertToYCellCoord(d),U=this._convertToXCellCoord(p),H=this._convertToYCellCoord(_);for(let ie=R;ie<=U;ie++)for(let te=k;te<=H;te++)if(b.call(this,o,d,p,_,this.xCellCount*te+ie,A,M,P))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,p,_,b,A){const M=_-o,P=b-d,R=p+A;return R*R>M*M+P*P}_circleAndRectCollide(o,d,p,_,b,A,M){const P=(A-_)/2,R=Math.abs(o-(_+P));if(R>P+p)return!1;const k=(M-b)/2,U=Math.abs(d-(b+k));if(U>k+p)return!1;if(R<=P||U<=k)return!0;const H=R-P,ie=U-k;return H*H+ie*ie<=p*p}}function Ts(m,o,d,p,_){const b=l.create();return o?(l.scale(b,b,[1/_,1/_,1]),d||l.rotateZ(b,b,p.angle)):l.multiply(b,p.labelPlaneMatrix,m),b}function ki(m,o,d,p,_){if(o){const b=l.clone(m);return l.scale(b,b,[_,_,1]),d||l.rotateZ(b,b,-p.angle),b}return p.glCoordMatrix}function Gt(m,o,d){let p;d?(p=[m.x,m.y,d(m.x,m.y),1],l.transformMat4(p,p,o)):(p=[m.x,m.y,0,1],yr(p,p,o));const _=p[3];return{point:new l.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function ir(m,o){return .5+m/o*.5}function Xi(m,o){const d=m[0]/m[3],p=m[1]/m[3];return d>=-o[0]&&d<=o[0]&&p>=-o[1]&&p<=o[1]}function qi(m,o,d,p,_,b,A,M,P,R){const k=p?m.textSizeData:m.iconSizeData,U=l.evaluateSizeForZoom(k,d.transform.zoom),H=[256/d.width*2+1,256/d.height*2+1],ie=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ie.clear();const te=m.lineVertexArray,ne=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,fe=d.transform.width/d.transform.height;let ge=!1;for(let xe=0;xe<ne.length;xe++){const re=ne.get(xe);if(re.hidden||re.writingMode===l.WritingMode.vertical&&!ge){Ct(re.numGlyphs,ie);continue}let Ee;if(ge=!1,R?(Ee=[re.anchorX,re.anchorY,R(re.anchorX,re.anchorY),1],l.transformMat4(Ee,Ee,o)):(Ee=[re.anchorX,re.anchorY,0,1],yr(Ee,Ee,o)),!Xi(Ee,H)){Ct(re.numGlyphs,ie);continue}const be=ir(d.transform.cameraToCenterDistance,Ee[3]),Le=l.evaluateSizeForFeature(k,U,re),Re=A?Le/be:Le*be,Ue=new l.pointGeometry(re.anchorX,re.anchorY),Pe=Gt(Ue,_,R).point,it={},Ze=Mt(re,Re,!1,M,o,_,b,m.glyphOffsetArray,te,ie,Pe,Ue,it,fe,P,R);ge=Ze.useVertical,(Ze.notEnoughRoom||ge||Ze.needsFlipping&&Mt(re,Re,!0,M,o,_,b,m.glyphOffsetArray,te,ie,Pe,Ue,it,fe,P,R).notEnoughRoom)&&Ct(re.numGlyphs,ie)}p?m.text.dynamicLayoutVertexBuffer.updateData(ie):m.icon.dynamicLayoutVertexBuffer.updateData(ie)}function Ss(m,o,d,p,_,b,A,M,P,R,k,U,H){const ie=M.glyphStartIndex+M.numGlyphs,te=M.lineStartIndex,ne=M.lineStartIndex+M.lineLength,fe=o.getoffsetX(M.glyphStartIndex),ge=o.getoffsetX(ie-1),xe=li(m*fe,d,p,_,b,A,M.segment,te,ne,P,R,k,U,H);if(!xe)return null;const re=li(m*ge,d,p,_,b,A,M.segment,te,ne,P,R,k,U,H);return re?{first:xe,last:re}:null}function qe(m,o,d,p){return m===l.WritingMode.horizontal&&Math.abs(d.y-o.y)>Math.abs(d.x-o.x)*p?{useVertical:!0}:(m===l.WritingMode.vertical?o.y<d.y:o.x>d.x)?{needsFlipping:!0}:null}function Mt(m,o,d,p,_,b,A,M,P,R,k,U,H,ie,te,ne){const fe=o/24,ge=m.lineOffsetX*fe,xe=m.lineOffsetY*fe;let re;if(m.numGlyphs>1){const Ee=m.glyphStartIndex+m.numGlyphs,be=m.lineStartIndex,Le=m.lineStartIndex+m.lineLength,Re=Ss(fe,M,ge,xe,d,k,U,m,P,b,H,te,ne);if(!Re)return{notEnoughRoom:!0};const Ue=Gt(Re.first.point,A,ne).point,Pe=Gt(Re.last.point,A,ne).point;if(p&&!d){const it=qe(m.writingMode,Ue,Pe,ie);if(it)return it}re=[Re.first];for(let it=m.glyphStartIndex+1;it<Ee-1;it++)re.push(li(fe*M.getoffsetX(it),ge,xe,d,k,U,m.segment,be,Le,P,b,H,te,ne));re.push(Re.last)}else{if(p&&!d){const be=Gt(U,_,ne).point,Le=m.lineStartIndex+m.segment+1,Re=new l.pointGeometry(P.getx(Le),P.gety(Le)),Ue=Gt(Re,_,ne),Pe=Ue.signedDistanceFromCamera>0?Ue.point:It(U,Re,be,1,_,ne),it=qe(m.writingMode,be,Pe,ie);if(it)return it}const Ee=li(fe*M.getoffsetX(m.glyphStartIndex),ge,xe,d,k,U,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,P,b,H,te,ne);if(!Ee)return{notEnoughRoom:!0};re=[Ee]}for(const Ee of re)l.addDynamicAttributes(R,Ee.point,Ee.angle);return{}}function It(m,o,d,p,_,b){const A=Gt(m.add(m.sub(o)._unit()),_,b).point,M=d.sub(A);return d.add(M._mult(p/M.mag()))}function li(m,o,d,p,_,b,A,M,P,R,k,U,H,ie){const te=p?m-o:m+o;let ne=te>0?1:-1,fe=0;p&&(ne*=-1,fe=Math.PI),ne<0&&(fe+=Math.PI);let ge=ne>0?M+A:M+A+1,xe=_,re=_,Ee=0,be=0;const Le=Math.abs(te),Re=[];for(;Ee+be<=Le;){if(ge+=ne,ge<M||ge>=P)return null;if(re=xe,Re.push(xe),xe=U[ge],xe===void 0){const rt=new l.pointGeometry(R.getx(ge),R.gety(ge)),Bt=Gt(rt,k,ie);if(Bt.signedDistanceFromCamera>0)xe=U[ge]=Bt.point;else{const Ot=ge-ne;xe=It(Ee===0?b:new l.pointGeometry(R.getx(Ot),R.gety(Ot)),rt,re,Le-Ee+1,k,ie)}}Ee+=be,be=re.dist(xe)}const Ue=(Le-Ee)/be,Pe=xe.sub(re),it=Pe.mult(Ue)._add(re);it._add(Pe._unit()._perp()._mult(d*ne));const Ze=fe+Math.atan2(xe.y-re.y,xe.x-re.x);return Re.push(it),{point:it,angle:H?Ze:0,path:Re}}const Qr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ct(m,o){for(let d=0;d<m;d++){const p=o.length;o.resize(p+4),o.float32.set(Qr,3*p)}}function yr(m,o,d){const p=o[0],_=o[1];return m[0]=d[0]*p+d[4]*_+d[12],m[1]=d[1]*p+d[5]*_+d[13],m[3]=d[3]*p+d[7]*_+d[15],m}const Qn=100;class wo{constructor(o,d=new $e(o.width+200,o.height+200,25),p=new $e(o.width+200,o.height+200,25)){this.transform=o,this.grid=d,this.ignoredGrid=p,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Qn,this.screenBottomBoundary=o.height+Qn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,d,p,_,b,A){const M=this.projectAndGetPerspectiveRatio(_,o.anchorPointX,o.anchorPointY,A),P=p*M.perspectiveRatio,R=o.x1*P+M.point.x,k=o.y1*P+M.point.y,U=o.x2*P+M.point.x,H=o.y2*P+M.point.y;return!this.isInsideGrid(R,k,U,H)||d!=="always"&&this.grid.hitTest(R,k,U,H,d,b)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[R,k,U,H],offscreen:this.isOffscreen(R,k,U,H)}}placeCollisionCircles(o,d,p,_,b,A,M,P,R,k,U,H,ie,te){const ne=[],fe=new l.pointGeometry(d.anchorX,d.anchorY),ge=Gt(fe,A,te),xe=ir(this.transform.cameraToCenterDistance,ge.signedDistanceFromCamera),re=(k?b/xe:b*xe)/l.ONE_EM,Ee=Gt(fe,M,te).point,be=Ss(re,_,d.lineOffsetX*re,d.lineOffsetY*re,!1,Ee,fe,d,p,M,{},!1,te);let Le=!1,Re=!1,Ue=!0;if(be){const Pe=.5*H*xe+ie,it=new l.pointGeometry(-100,-100),Ze=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),rt=new Dr,Bt=be.first,Ot=be.last;let bt=[];for(let qt=Bt.path.length-1;qt>=1;qt--)bt.push(Bt.path[qt]);for(let qt=1;qt<Ot.path.length;qt++)bt.push(Ot.path[qt]);const ln=2.5*Pe;if(P){const qt=bt.map(Zt=>Gt(Zt,P,te));bt=qt.some(Zt=>Zt.signedDistanceFromCamera<=0)?[]:qt.map(Zt=>Zt.point)}let cn=[];if(bt.length>0){const qt=bt[0].clone(),Zt=bt[0].clone();for(let fn=1;fn<bt.length;fn++)qt.x=Math.min(qt.x,bt[fn].x),qt.y=Math.min(qt.y,bt[fn].y),Zt.x=Math.max(Zt.x,bt[fn].x),Zt.y=Math.max(Zt.y,bt[fn].y);cn=qt.x>=it.x&&Zt.x<=Ze.x&&qt.y>=it.y&&Zt.y<=Ze.y?[bt]:Zt.x<it.x||qt.x>Ze.x||Zt.y<it.y||qt.y>Ze.y?[]:l.clipLine([bt],it.x,it.y,Ze.x,Ze.y)}for(const qt of cn){rt.reset(qt,.25*Pe);let Zt=0;Zt=rt.length<=.5*Pe?1:Math.ceil(rt.paddedLength/ln)+1;for(let fn=0;fn<Zt;fn++){const _i=fn/Math.max(Zt-1,1),Ps=rt.lerp(_i),is=Ps.x+Qn,Bs=Ps.y+Qn;ne.push(is,Bs,Pe,0);const Lo=is-Pe,zr=Bs-Pe,sr=is+Pe,Ys=Bs+Pe;if(Ue=Ue&&this.isOffscreen(Lo,zr,sr,Ys),Re=Re||this.isInsideGrid(Lo,zr,sr,Ys),o!=="always"&&this.grid.hitTestCircle(is,Bs,Pe,o,U)&&(Le=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!R&&Le||!Re||xe<this.perspectiveRatioCutoff?[]:ne,offscreen:Ue,collisionDetected:Le}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let p=1/0,_=1/0,b=-1/0,A=-1/0;for(const k of o){const U=new l.pointGeometry(k.x+Qn,k.y+Qn);p=Math.min(p,U.x),_=Math.min(_,U.y),b=Math.max(b,U.x),A=Math.max(A,U.y),d.push(U)}const M=this.grid.query(p,_,b,A).concat(this.ignoredGrid.query(p,_,b,A)),P={},R={};for(const k of M){const U=k.key;if(P[U.bucketInstanceId]===void 0&&(P[U.bucketInstanceId]={}),P[U.bucketInstanceId][U.featureIndex])continue;const H=[new l.pointGeometry(k.x1,k.y1),new l.pointGeometry(k.x2,k.y1),new l.pointGeometry(k.x2,k.y2),new l.pointGeometry(k.x1,k.y2)];l.polygonIntersectsPolygon(d,H)&&(P[U.bucketInstanceId][U.featureIndex]=!0,R[U.bucketInstanceId]===void 0&&(R[U.bucketInstanceId]=[]),R[U.bucketInstanceId].push(U.featureIndex))}return R}insertCollisionBox(o,d,p,_,b,A){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:b,collisionGroupID:A,overlapMode:d},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,p,_,b,A){const M=p?this.ignoredGrid:this.grid,P={bucketInstanceId:_,featureIndex:b,collisionGroupID:A,overlapMode:d};for(let R=0;R<o.length;R+=4)M.insertCircle(P,o[R],o[R+1],o[R+2])}projectAndGetPerspectiveRatio(o,d,p,_){let b;return _?(b=[d,p,_(d,p),1],l.transformMat4(b,b,o)):(b=[d,p,0,1],yr(b,b,o)),{point:new l.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+Qn,(-b[1]/b[3]+1)/2*this.transform.height+Qn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(o,d,p,_){return p<Qn||o>=this.screenRightBoundary||_<Qn||d>this.screenBottomBoundary}isInsideGrid(o,d,p,_){return p>=0&&o<this.gridRightBoundary&&_>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=l.identity([]);return l.translate(o,o,[-100,-100,0]),o}}function Nn(m,o,d){return o*(l.EXTENT/(m.tileSize*Math.pow(2,d-m.tileID.overscaledZ)))}class gi{constructor(o,d,p,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class on{constructor(o,d,p,_,b){this.text=new gi(o?o.text:null,d,p,b),this.icon=new gi(o?o.icon:null,d,_,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ao{constructor(o,d,p){this.text=o,this.icon=d,this.skipFade=p}}class Or{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class kr{constructor(o,d,p,_,b){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=b}}class $s{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:p=>p.collisionGroupID===d}}return this.collisionGroups[o]}}function Eo(m,o,d,p,_){const{horizontalAlign:b,verticalAlign:A}=l.getAnchorAlignment(m),M=-(b-.5)*o,P=-(A-.5)*d,R=l.evaluateVariableOffset(m,p);return new l.pointGeometry(M+R[0]*_,P+R[1]*_)}function Cs(m,o,d,p,_,b){const{x1:A,x2:M,y1:P,y2:R,anchorPointX:k,anchorPointY:U}=m,H=new l.pointGeometry(o,d);return p&&H._rotate(_?b:-b),{x1:A+H.x,y1:P+H.y,x2:M+H.x,y2:R+H.y,anchorPointX:k,anchorPointY:U}}class ee{constructor(o,d,p,_,b){this.transform=o.clone(),this.terrain=d,this.collisionIndex=new wo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new $s(_),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,d,p,_){const b=p.getBucket(d),A=p.latestFeatureIndex;if(!b||!A||d.id!==b.layerIds[0])return;const M=p.collisionBoxArray,P=b.layers[0].layout,R=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),k=p.tileSize/l.EXTENT,U=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),H=P.get("text-pitch-alignment")==="map",ie=P.get("text-rotation-alignment")==="map",te=Nn(p,1,this.transform.zoom),ne=Ts(U,H,ie,this.transform,te);let fe=null;if(H){const xe=ki(U,H,ie,this.transform,te);fe=l.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[b.bucketInstanceId]=new kr(b.bucketInstanceId,A,b.sourceLayerIndex,b.index,p.tileID);const ge={bucket:b,layout:P,posMatrix:U,textLabelPlaneMatrix:ne,labelToScreenMatrix:fe,scale:R,textPixelRatio:k,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(_)for(const xe of b.sortKeyRanges){const{sortKey:re,symbolInstanceStart:Ee,symbolInstanceEnd:be}=xe;o.push({sortKey:re,symbolInstanceStart:Ee,symbolInstanceEnd:be,parameters:ge})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(o,d,p,_,b,A,M,P,R,k,U,H,ie,te,ne,fe){const ge=[H.textOffset0,H.textOffset1],xe=Eo(o,p,_,ge,b),re=this.collisionIndex.placeCollisionBox(Cs(d,xe.x,xe.y,A,M,this.transform.angle),U,P,R,k.predicate,fe);if((!ne||this.collisionIndex.placeCollisionBox(Cs(ne,xe.x,xe.y,A,M,this.transform.angle),U,P,R,k.predicate,fe).box.length!==0)&&re.box.length>0){let Ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:ge,width:p,height:_,anchor:o,textBoxScale:b,prevAnchor:Ee},this.markUsedJustification(ie,o,H,te),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,te,H),this.placedOrientations[H.crossTileID]=te),{shift:xe,placedGlyphBoxes:re}}}placeLayerBucketPart(o,d,p){const{bucket:_,layout:b,posMatrix:A,textLabelPlaneMatrix:M,labelToScreenMatrix:P,textPixelRatio:R,holdingForFade:k,collisionBoxArray:U,partiallyEvaluatedTextSize:H,collisionGroup:ie}=o.parameters,te=b.get("text-optional"),ne=b.get("icon-optional"),fe=l.getOverlapMode(b,"text-overlap","text-allow-overlap"),ge=fe==="always",xe=l.getOverlapMode(b,"icon-overlap","icon-allow-overlap"),re=xe==="always",Ee=b.get("text-rotation-alignment")==="map",be=b.get("text-pitch-alignment")==="map",Le=b.get("icon-text-fit")!=="none",Re=b.get("symbol-z-order")==="viewport-y",Ue=ge&&(re||!_.hasIconData()||ne),Pe=re&&(ge||!_.hasTextData()||te);!_.collisionArrays&&U&&_.deserializeCollisionBoxes(U);const it=(Ze,rt)=>{if(d[Ze.crossTileID])return;if(k)return void(this.placements[Ze.crossTileID]=new Ao(!1,!1,!1));let Bt=!1,Ot=!1,bt=!0,ln=null,cn={box:null,offscreen:null},qt={box:null,offscreen:null},Zt=null,fn=null,_i=null,Ps=0,is=0,Bs=0;rt.textFeatureIndex?Ps=rt.textFeatureIndex:Ze.useRuntimeCollisionCircles&&(Ps=Ze.featureIndex),rt.verticalTextFeatureIndex&&(is=rt.verticalTextFeatureIndex);const Lo=this.retainedQueryData[_.bucketInstanceId].tileID,zr=this.terrain?(ui,Ut)=>this.terrain.getElevation(Lo,ui,Ut):null;for(const ui of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Ut=rt[ui];Ut&&(Ut.elevation=zr?zr(Ut.anchorPointX,Ut.anchorPointY):0)}const sr=rt.textBox;if(sr){const ui=an=>{let yi=l.WritingMode.horizontal;if(_.allowVerticalPlacement&&!an&&this.prevPlacement){const vi=this.prevPlacement.placedOrientations[Ze.crossTileID];vi&&(this.placedOrientations[Ze.crossTileID]=vi,yi=vi,this.markUsedOrientation(_,yi,Ze))}return yi},Ut=(an,yi)=>{if(_.allowVerticalPlacement&&Ze.numVerticalGlyphVertices>0&&rt.verticalTextBox){for(const vi of _.writingModes)if(vi===l.WritingMode.vertical?(cn=yi(),qt=cn):cn=an(),cn&&cn.box&&cn.box.length)break}else cn=an()};if(b.get("text-variable-anchor")){let an=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ze.crossTileID]){const Mn=this.prevPlacement.variableOffsets[Ze.crossTileID];an.indexOf(Mn.anchor)>0&&(an=an.filter(Nr=>Nr!==Mn.anchor),an.unshift(Mn.anchor))}const yi=(Mn,Nr,ia)=>{const $h=Mn.x2-Mn.x1,Za=Mn.y2-Mn.y1,Bp=Ze.textBoxScale,Zh=Le&&xe==="never"?Nr:null;let Ro={box:[],offscreen:!1};const ra=fe!=="never"?2*an.length:an.length;for(let sa=0;sa<ra;++sa){const eu=this.attemptAnchorPlacement(an[sa%an.length],Mn,$h,Za,Bp,Ee,be,R,A,ie,sa>=an.length?fe:"never",Ze,_,ia,Zh,zr);if(eu&&(Ro=eu.placedGlyphBoxes,Ro&&Ro.box&&Ro.box.length)){Bt=!0,ln=eu.shift;break}}return Ro};Ut(()=>yi(sr,rt.iconBox,l.WritingMode.horizontal),()=>{const Mn=rt.verticalTextBox;return _.allowVerticalPlacement&&!(cn&&cn.box&&cn.box.length)&&Ze.numVerticalGlyphVertices>0&&Mn?yi(Mn,rt.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),cn&&(Bt=cn.box,bt=cn.offscreen);const vi=ui(cn&&cn.box);if(!Bt&&this.prevPlacement){const Mn=this.prevPlacement.variableOffsets[Ze.crossTileID];Mn&&(this.variableOffsets[Ze.crossTileID]=Mn,this.markUsedJustification(_,Mn.anchor,Ze,vi))}}else{const an=(yi,vi)=>{const Mn=this.collisionIndex.placeCollisionBox(yi,fe,R,A,ie.predicate,zr);return Mn&&Mn.box&&Mn.box.length&&(this.markUsedOrientation(_,vi,Ze),this.placedOrientations[Ze.crossTileID]=vi),Mn};Ut(()=>an(sr,l.WritingMode.horizontal),()=>{const yi=rt.verticalTextBox;return _.allowVerticalPlacement&&Ze.numVerticalGlyphVertices>0&&yi?an(yi,l.WritingMode.vertical):{box:null,offscreen:null}}),ui(cn&&cn.box&&cn.box.length)}}if(Zt=cn,Bt=Zt&&Zt.box&&Zt.box.length>0,bt=Zt&&Zt.offscreen,Ze.useRuntimeCollisionCircles){const ui=_.text.placedSymbolArray.get(Ze.centerJustifiedTextSymbolIndex),Ut=l.evaluateSizeForFeature(_.textSizeData,H,ui),an=b.get("text-padding");fn=this.collisionIndex.placeCollisionCircles(fe,ui,_.lineVertexArray,_.glyphOffsetArray,Ut,A,M,P,p,be,ie.predicate,Ze.collisionCircleDiameter,an,zr),fn.circles.length&&fn.collisionDetected&&!p&&l.warnOnce("Collisions detected, but collision boxes are not shown"),Bt=ge||fn.circles.length>0&&!fn.collisionDetected,bt=bt&&fn.offscreen}if(rt.iconFeatureIndex&&(Bs=rt.iconFeatureIndex),rt.iconBox){const ui=Ut=>{const an=Le&&ln?Cs(Ut,ln.x,ln.y,Ee,be,this.transform.angle):Ut;return this.collisionIndex.placeCollisionBox(an,xe,R,A,ie.predicate,zr)};qt&&qt.box&&qt.box.length&&rt.verticalIconBox?(_i=ui(rt.verticalIconBox),Ot=_i.box.length>0):(_i=ui(rt.iconBox),Ot=_i.box.length>0),bt=bt&&_i.offscreen}const Ys=te||Ze.numHorizontalGlyphVertices===0&&Ze.numVerticalGlyphVertices===0,Qc=ne||Ze.numIconVertices===0;if(Ys||Qc?Qc?Ys||(Ot=Ot&&Bt):Bt=Ot&&Bt:Ot=Bt=Ot&&Bt,Bt&&Zt&&Zt.box&&this.collisionIndex.insertCollisionBox(Zt.box,fe,b.get("text-ignore-placement"),_.bucketInstanceId,qt&&qt.box&&is?is:Ps,ie.ID),Ot&&_i&&this.collisionIndex.insertCollisionBox(_i.box,xe,b.get("icon-ignore-placement"),_.bucketInstanceId,Bs,ie.ID),fn&&(Bt&&this.collisionIndex.insertCollisionCircles(fn.circles,fe,b.get("text-ignore-placement"),_.bucketInstanceId,Ps,ie.ID),p)){const ui=_.bucketInstanceId;let Ut=this.collisionCircleArrays[ui];Ut===void 0&&(Ut=this.collisionCircleArrays[ui]=new Or);for(let an=0;an<fn.circles.length;an+=4)Ut.circles.push(fn.circles[an+0]),Ut.circles.push(fn.circles[an+1]),Ut.circles.push(fn.circles[an+2]),Ut.circles.push(fn.collisionDetected?1:0)}if(Ze.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ze.crossTileID]=new Ao(Bt||Ue,Ot||Pe,bt||_.justReloaded),d[Ze.crossTileID]=!0};if(Re){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ze=_.getSortedSymbolIndexes(this.transform.angle);for(let rt=Ze.length-1;rt>=0;--rt){const Bt=Ze[rt];it(_.symbolInstances.get(Bt),_.collisionArrays[Bt])}}else for(let Ze=o.symbolInstanceStart;Ze<o.symbolInstanceEnd;Ze++)it(_.symbolInstances.get(Ze),_.collisionArrays[Ze]);if(p&&_.bucketInstanceId in this.collisionCircleArrays){const Ze=this.collisionCircleArrays[_.bucketInstanceId];l.invert(Ze.invProjMatrix,A),Ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(o,d,p,_){let b;b=_===l.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(d)];const A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const M of A)M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=b>=0&&M!==b?0:p.crossTileID)}markUsedOrientation(o,d,p){const _=d===l.WritingMode.horizontal||d===l.WritingMode.horizontalOnly?d:0,b=d===l.WritingMode.vertical?d:0,A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const M of A)o.text.placedSymbolArray.get(M).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let p=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const _=d?d.symbolFadeChange(o):1,b=d?d.opacities:{},A=d?d.variableOffsets:{},M=d?d.placedOrientations:{};for(const P in this.placements){const R=this.placements[P],k=b[P];k?(this.opacities[P]=new on(k,_,R.text,R.icon),p=p||R.text!==k.text.placed||R.icon!==k.icon.placed):(this.opacities[P]=new on(null,_,R.text,R.icon,R.skipFade),p=p||R.text||R.icon)}for(const P in b){const R=b[P];if(!this.opacities[P]){const k=new on(R,_,!1,!1);k.isHidden()||(this.opacities[P]=k,p=p||R.text.placed||R.icon.placed)}}for(const P in A)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=A[P]);for(const P in M)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=M[P]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d){const p={};for(const _ of d){const b=_.getBucket(o);b&&_.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,p,_.collisionBoxArray)}}updateBucketOpacities(o,d,p){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const _=o.layers[0].layout,b=new on(null,0,!1,!1,!0),A=_.get("text-allow-overlap"),M=_.get("icon-allow-overlap"),P=_.get("text-variable-anchor"),R=_.get("text-rotation-alignment")==="map",k=_.get("text-pitch-alignment")==="map",U=_.get("icon-text-fit")!=="none",H=new on(null,0,A&&(M||!o.hasIconData()||_.get("icon-optional")),M&&(A||!o.hasTextData()||_.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const ie=(te,ne,fe)=>{for(let ge=0;ge<ne/4;ge++)te.opacityVertexArray.emplaceBack(fe)};for(let te=0;te<o.symbolInstances.length;te++){const ne=o.symbolInstances.get(te),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:ge,crossTileID:xe}=ne;let re=this.opacities[xe];d[xe]?re=b:re||(re=H,this.opacities[xe]=re),d[xe]=!0;const Ee=ne.numIconVertices>0,be=this.placedOrientations[ne.crossTileID],Le=be===l.WritingMode.vertical,Re=be===l.WritingMode.horizontal||be===l.WritingMode.horizontalOnly;if(fe>0||ge>0){const Ue=me(re.text);ie(o.text,fe,Le?Me:Ue),ie(o.text,ge,Re?Me:Ue);const Pe=re.text.isHidden();[ne.rightJustifiedTextSymbolIndex,ne.centerJustifiedTextSymbolIndex,ne.leftJustifiedTextSymbolIndex].forEach(rt=>{rt>=0&&(o.text.placedSymbolArray.get(rt).hidden=Pe||Le?1:0)}),ne.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ne.verticalPlacedTextSymbolIndex).hidden=Pe||Re?1:0);const it=this.variableOffsets[ne.crossTileID];it&&this.markUsedJustification(o,it.anchor,ne,be);const Ze=this.placedOrientations[ne.crossTileID];Ze&&(this.markUsedJustification(o,"left",ne,Ze),this.markUsedOrientation(o,Ze,ne))}if(Ee){const Ue=me(re.icon),Pe=!(U&&ne.verticalPlacedIconSymbolIndex&&Le);ne.placedIconSymbolIndex>=0&&(ie(o.icon,ne.numIconVertices,Pe?Ue:Me),o.icon.placedSymbolArray.get(ne.placedIconSymbolIndex).hidden=re.icon.isHidden()),ne.verticalPlacedIconSymbolIndex>=0&&(ie(o.icon,ne.numVerticalIconVertices,Pe?Me:Ue),o.icon.placedSymbolArray.get(ne.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ue=o.collisionArrays[te];if(Ue){let Pe=new l.pointGeometry(0,0);if(Ue.textBox||Ue.verticalTextBox){let Ze=!0;if(P){const rt=this.variableOffsets[xe];rt?(Pe=Eo(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textBoxScale),R&&Pe._rotate(k?this.transform.angle:-this.transform.angle)):Ze=!1}Ue.textBox&&D(o.textCollisionBox.collisionVertexArray,re.text.placed,!Ze||Le,Pe.x,Pe.y),Ue.verticalTextBox&&D(o.textCollisionBox.collisionVertexArray,re.text.placed,!Ze||Re,Pe.x,Pe.y)}const it=!!(!Re&&Ue.verticalIconBox);Ue.iconBox&&D(o.iconCollisionBox.collisionVertexArray,re.icon.placed,it,U?Pe.x:0,U?Pe.y:0),Ue.verticalIconBox&&D(o.iconCollisionBox.collisionVertexArray,re.icon.placed,!it,U?Pe.x:0,U?Pe.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const te=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=te.invProjMatrix,o.placementViewportMatrix=te.viewportMatrix,o.collisionCircleArray=te.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const p=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function D(m,o,d,p,_){m.emplaceBack(o?1:0,d?1:0,p||0,_||0),m.emplaceBack(o?1:0,d?1:0,p||0,_||0),m.emplaceBack(o?1:0,d?1:0,p||0,_||0),m.emplaceBack(o?1:0,d?1:0,p||0,_||0)}const N=Math.pow(2,25),J=Math.pow(2,24),Y=Math.pow(2,17),le=Math.pow(2,16),pe=Math.pow(2,9),he=Math.pow(2,8),ae=Math.pow(2,1);function me(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const o=m.placed?1:0,d=Math.floor(127*m.opacity);return d*N+o*J+d*Y+o*le+d*pe+o*he+d*ae+o}const Me=0;class ze{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,d,p,_,b){const A=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(A,_,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((M,P)=>M.sortKey-P.sortKey));this._currentPartIndex<A.length;)if(d.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class Ce{constructor(o,d,p,_,b,A,M,P){this.placement=new ee(o,d,A,M,P),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(o,d,p){const _=l.exported.now(),b=()=>{const A=l.exported.now()-_;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=d[o[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=M)&&(!A.maxzoom||A.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new ze(A)),this._inProgressLayer.continuePlacement(p[A.source],this.placement,this._showCollisionBoxes,A,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const ot=512/l.EXTENT/2;class ut{constructor(o,d,p){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<d.length;_++){const b=d.get(_),A=b.key;this.indexedSymbolInstances[A]||(this.indexedSymbolInstances[A]=[]),this.indexedSymbolInstances[A].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,o)})}}getScaledCoordinates(o,d){const p=ot/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*l.EXTENT+o.anchorX)*p),y:Math.floor((d.canonical.y*l.EXTENT+o.anchorY)*p)}}findMatches(o,d,p){const _=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let b=0;b<o.length;b++){const A=o.get(b);if(A.crossTileID)continue;const M=this.indexedSymbolInstances[A.key];if(!M)continue;const P=this.getScaledCoordinates(A,d);for(const R of M)if(Math.abs(R.coord.x-P.x)<=_&&Math.abs(R.coord.y-P.y)<=_&&!p[R.crossTileID]){p[R.crossTileID]=!0,A.crossTileID=R.crossTileID;break}}}}class Qe{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const p in this.indexes){const _=this.indexes[p],b={};for(const A in _){const M=_[A];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),b[M.tileID.key]=M}this.indexes[p]=b}this.lng=o}addBucket(o,d,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<d.symbolInstances.length;b++)d.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const _=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const A=this.indexes[b];if(Number(b)>o.overscaledZ)for(const M in A){const P=A[M];P.tileID.isChildOf(o)&&P.findMatches(d.symbolInstances,o,_)}else{const M=A[o.scaledTo(Number(b)).key];M&&M.findMatches(d.symbolInstances,o,_)}}for(let b=0;b<d.symbolInstances.length;b++){const A=d.symbolInstances.get(b);A.crossTileID||(A.crossTileID=p.generate(),_[A.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new ut(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const p in d.indexedSymbolInstances)for(const _ of d.indexedSymbolInstances[p])delete this.usedCrossTileIDs[o][_.crossTileID]}removeStaleBuckets(o){let d=!1;for(const p in this.indexes){const _=this.indexes[p];for(const b in _)o[_[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[b]),delete _[b],d=!0)}return d}}class pt{constructor(){this.layerIndexes={},this.crossTileIDs=new Qe,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,p){let _=this.layerIndexes[o.id];_===void 0&&(_=this.layerIndexes[o.id]=new xt);let b=!1;const A={};_.handleWrapJump(p);for(const M of d){const P=M.getBucket(o);P&&o.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(M.tileID,P,this.crossTileIDs)&&(b=!0),A[P.bucketInstanceId]=!0)}return _.removeStaleBuckets(A)&&(b=!0),b}pruneUnusedLayers(o){const d={};o.forEach(p=>{d[p]=!0});for(const p in this.layerIndexes)d[p]||delete this.layerIndexes[p]}}var Rt=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class At extends l.Evented{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=o._cache.max,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const o in this._tiles){const d=this._tiles[o];d.textures.forEach(p=>p.destroy()),d.textures=[]}}update(o,d){this.sourceCache.update(o,d),this._renderableTilesKeys=[];for(const p of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.ortho(p.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[p.key]=new mi(p,this.tileSize))}removeOutdated(o){const d={};this.renderHistory=this.renderHistory.filter((p,_)=>this.renderHistory.indexOf(p)===_).slice(0,this.renderHistorySize);for(const p of this._renderableTilesKeys)d[p]=!0;for(const p of this.renderHistory)d[p]=!0;for(const p in this._tiles)d[p]||(this._tiles[p].clearTextures(o),delete this._tiles[p])}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const d={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID;if(_.canonical.equals(o.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16),l.ortho(b.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),d[p]=b}else if(_.canonical.isChildOf(o.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16);const A=_.canonical.z-o.canonical.z,M=_.canonical.x-(_.canonical.x>>A<<A),P=_.canonical.y-(_.canonical.y>>A<<A),R=l.EXTENT>>A;l.ortho(b.posMatrix,0,R,0,R,0,1),l.translate(b.posMatrix,b.posMatrix,[-M*R,-P*R,0]),d[p]=b}else if(o.canonical.isChildOf(_.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16);const A=o.canonical.z-_.canonical.z,M=o.canonical.x-(o.canonical.x>>A<<A),P=o.canonical.y-(o.canonical.y>>A<<A),R=l.EXTENT>>A;l.ortho(b.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(b.posMatrix,b.posMatrix,[M*R,P*R,0]),l.scale(b.posMatrix,b.posMatrix,[1/2**A,1/2**A,0]),d[p]=b}}return d}getSourceTile(o,d){const p=this.sourceCache._source;let _=o.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(_).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!b||!b.dem)&&d)for(;_>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(o.scaledTo(_--).key);return b}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(d=>d.timeLoaded>=o)}}class St{constructor(o,d,p){this.style=o,this.sourceCache=new At(d),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.elevationOffset=typeof p.elevationOffset=="number"?p.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(o,d,p,_=l.EXTENT){if(!(d>=0&&d<_&&p>=0&&p<_))return this.elevationOffset;let b=0;const A=this.getTerrainData(o);if(A.tile&&A.tile.dem){const M=l.transformMat4$1([],[d/_*l.EXTENT,p/_*l.EXTENT],A.u_terrain_matrix),P=[M[0]*A.tile.dem.dim,M[1]*A.tile.dem.dim],R=[Math.floor(P[0]),Math.floor(P[1])],k=A.tile.dem.get(R[0],R[1]),U=A.tile.dem.get(R[0],R[1]+1),H=A.tile.dem.get(R[0]+1,R[1]),ie=A.tile.dem.get(R[0]+1,R[1]+1);b=l.number(l.number(k,U,P[0]-R[0]),l.number(H,ie,P[0]-R[0]),P[1]-R[1])}return b}rememberForRerender(o,d){for(const p in this.sourceCache._tiles){const _=this.sourceCache._tiles[p];(_.tileID.equals(d)||_.tileID.isChildOf(d))&&(o===this.sourceCache.sourceCache.id&&(_.timeLoaded=Date.now()),this._rerender[o]=this._rerender[o]||{},this._rerender[o][_.tileID.key]=!0)}}needsRerender(o,d){return this._rerender[o]&&this._rerender[o][d.key]}clearRerenderCache(){this._rerender={}}getElevation(o,d,p,_=l.EXTENT){return(this.getDEMElevation(o,d,p,_)+this.elevationOffset)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const _=this.style.map.painter.context,b=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Z(_,b,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Z(_,new l.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const d=this.sourceCache.getSourceTile(o,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const _=this.style.map.painter.context;d.demTexture=this.style.map.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new Z(_,d.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),d.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const p=d&&d+d.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let b=o.canonical.z-d.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=_?b=o.canonical.z-_:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const A=o.canonical.x-(o.canonical.x>>b<<b),M=o.canonical.y-(o.canonical.y>>b<<b),P=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<b),1/(l.EXTENT<<b),0]);l.translate(P,P,[A*l.EXTENT,M*l.EXTENT,0]),this._demMatrixCache[o.key]={matrix:P,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getRTTFramebuffer(){const o=this.style.map.painter;if(!this._rttFramebuffer){const d=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=o.context.createFramebuffer(d,d,!0),this._rttFramebuffer.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,d,d))}return this._rttFramebuffer}getFramebuffer(o){const d=this.style.map.painter,p=d.width/devicePixelRatio,_=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Z(d.context,{width:p,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Z(d.context,{width:p,height:_,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(p,_,!0),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,A=0;b<this._coordsTextureSize;b++)for(let M=0;M<this._coordsTextureSize;M++,A+=4)d[A+0]=255&M,d[A+1]=255&b,d[A+2]=M>>8<<4|b>>8,d[A+3]=0;const p=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),_=new Z(o,p,o.gl.RGBA,{premultiply:!1});return _.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(o){const d=new Uint8Array(4),p=this.style.map.painter,_=p.context,b=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(o.x,p.height/devicePixelRatio-o.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null);const A=d[0]+(d[2]>>4<<8),M=d[1]+((15&d[2])<<8),P=this.coordsIndex[255-d[3]],R=P&&this.sourceCache.getTileByID(P);if(!R)return null;const k=this._coordsTextureSize,U=(1<<R.tileID.canonical.z)*k;return new l.MercatorCoordinate((R.tileID.canonical.x*k+A)/U,(R.tileID.canonical.y*k+M)/U,this.getElevation(R.tileID,A,M,k))}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.style.map.painter.context,d=new l.PosArray,p=new l.TriangleIndexArray,_=this.meshSize,b=l.EXTENT/_,A=_*_;for(let M=0;M<=_;M++)for(let P=0;P<=_;P++)d.emplaceBack(P*b,M*b);for(let M=0;M<A;M+=_+1)for(let P=0;P<_;P++)p.emplaceBack(P+M,_+P+M+1,_+P+M+2),p.emplaceBack(P+M,_+P+M+2,P+M+1);return this._mesh={indexBuffer:o.createIndexBuffer(p),vertexBuffer:o.createVertexBuffer(d,Rt.members),segments:l.SegmentVector.simpleSegment(0,0,d.length,p.length)},this._mesh}getMinMaxElevation(o){const d=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return d&&d.dem&&(p.minElevation=(d.dem.min+this.elevationOffset)*this.exaggeration,p.maxElevation=(d.dem.max+this.elevationOffset)*this.exaggeration),p}}const Ft=(m,o)=>l.emitValidationErrors(m,o&&o.filter(d=>d.identifier!=="source.canvas")),Vt=l.pick(Ht,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),yn=l.pick(Ht,["setCenter","setZoom","setBearing","setPitch"]),vn=function(){const m={},o=l.spec.$version;for(const d in l.spec.$root){const p=l.spec.$root[d];if(p.required){let _=null;_=d==="version"?o:p.type==="array"?[]:{},_!=null&&(m[d]=_)}}return m}();class ci extends l.Evented{constructor(o,d={}){super(),this.map=o,this.dispatcher=new Ne(Ti(),this),this.imageManager=new q,this.imageManager.setEventedParent(this),this.glyphManager=new ve(o._requestManager,d.localIdeographFontFamily),this.lineAtlas=new je(256,512),this.crossTileSymbolIndex=new pt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=ci.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(b,A)=>{if(l.triggerPluginCompletionEvent(b),A&&A.every(M=>M))for(const M in p.sourceCaches)p.sourceCaches[M].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const b=this.sourceCaches[_.sourceId];if(!b)return;const A=b.getSource();if(A&&A.vectorLayerIds)for(const M in this._layers){const P=this._layers[M];P.source===A.id&&this._validateLayer(P)}})}loadURL(o,d={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const p=typeof d.validate!="boolean"||d.validate,_=this.map._requestManager.transformRequest(o,l.ResourceType.Style);this._request=l.getJSON(_,(b,A)=>{this._request=null,b?this.fire(new l.ErrorEvent(b)):A&&this._load(A,p)})}loadJSON(o,d={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(o,d.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(vn,!1)}_load(o,d){if(d&&Ft(this,l.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o;for(const _ in o.sources)this.addSource(_,o.sources[_],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);const p=xo(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=l.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Fe(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(o){this._spriteRequest=function(d,p,_,b){let A,M,P;const R=_>1?"@2x":"";let k=l.getJSON(p.transformRequest(p.normalizeSpriteURL(d,R,".json"),l.ResourceType.SpriteJSON),(ie,te)=>{k=null,P||(P=ie,A=te,H())}),U=l.getImage(p.transformRequest(p.normalizeSpriteURL(d,R,".png"),l.ResourceType.SpriteImage),(ie,te)=>{U=null,P||(P=ie,M=te,H())});function H(){if(P)b(P);else if(A&&M){const ie=l.exported.getImageData(M),te={};for(const ne in A){const{width:fe,height:ge,x:xe,y:re,sdf:Ee,pixelRatio:be,stretchX:Le,stretchY:Re,content:Ue}=A[ne],Pe=new l.RGBAImage({width:fe,height:ge});l.RGBAImage.copy(ie,Pe,{x:xe,y:re},{x:0,y:0},{width:fe,height:ge}),te[ne]={data:Pe,pixelRatio:be,sdf:Ee,stretchX:Le,stretchY:Re,content:Ue}}b(null,te)}}return{cancel(){k&&(k.cancel(),k=null),U&&(U.cancel(),U=null)}}}(o,this.map._requestManager,this.map.getPixelRatio(),(d,p)=>{if(this._spriteRequest=null,d)this.fire(new l.ErrorEvent(d));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(o){const d=this.sourceCaches[o.source];if(!d)return;const p=o.sourceLayer;if(!p)return;const _=d.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const d=[];for(const p of o){const _=this._layers[p];_.type!=="custom"&&d.push(_.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const d=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(_.length||b.length)&&this._updateWorkerLayers(_,b);for(const A in this._updatedSources){const M=this._updatedSources[A];if(M==="reload")this._reloadSource(A);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(A)}}this._updateTilesForChangedImages();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const b=this.sourceCaches[_];p[_]=b.used,b.used=!1}for(const _ of this._order){const b=this._layers[_];b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const _ in p){const b=this.sourceCaches[_];p[_]!==b.used&&b.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(o),this.z=o.zoom,d&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(o){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),o){const d=this.sourceCaches[o.source];if(!d)throw new Error(`cannot load terrain, because there exists no source with ID: ${o.source}`);this.terrain=new St(this,d,o),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=p=>{p.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=p=>{p.tile&&(p.sourceId===o.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(p.sourceId,p.tile.tileID)):p.source.type==="geojson"&&this.terrain.rememberForRerender(p.sourceId,p.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:o}))}setState(o){if(this._checkLoaded(),Ft(this,l.validateStyle(o)))return!1;(o=l.clone$1(o)).layers=xo(o.layers);const d=function(_,b){if(!_)return[{command:Ht.setStyle,args:[b]}];let A=[];try{if(!C(_.version,b.version))return[{command:Ht.setStyle,args:[b]}];C(_.center,b.center)||A.push({command:Ht.setCenter,args:[b.center]}),C(_.zoom,b.zoom)||A.push({command:Ht.setZoom,args:[b.zoom]}),C(_.bearing,b.bearing)||A.push({command:Ht.setBearing,args:[b.bearing]}),C(_.pitch,b.pitch)||A.push({command:Ht.setPitch,args:[b.pitch]}),C(_.sprite,b.sprite)||A.push({command:Ht.setSprite,args:[b.sprite]}),C(_.glyphs,b.glyphs)||A.push({command:Ht.setGlyphs,args:[b.glyphs]}),C(_.transition,b.transition)||A.push({command:Ht.setTransition,args:[b.transition]}),C(_.light,b.light)||A.push({command:Ht.setLight,args:[b.light]});const M={},P=[];(function(k,U,H,ie){let te;for(te in U=U||{},k=k||{})Object.prototype.hasOwnProperty.call(k,te)&&(Object.prototype.hasOwnProperty.call(U,te)||Wn(te,H,ie));for(te in U)Object.prototype.hasOwnProperty.call(U,te)&&(Object.prototype.hasOwnProperty.call(k,te)?C(k[te],U[te])||(k[te].type==="geojson"&&U[te].type==="geojson"&&Jo(k,U,te)?H.push({command:Ht.setGeoJSONSourceData,args:[te,U[te].data]}):Es(te,U,H,ie)):Wi(te,U,H))})(_.sources,b.sources,P,M);const R=[];_.layers&&_.layers.forEach(k=>{M[k.source]?A.push({command:Ht.removeLayer,args:[k.id]}):R.push(k)}),A=A.concat(P),function(k,U,H){U=U||[];const ie=(k=k||[]).map(Yr),te=U.map(Yr),ne=k.reduce(bo,{}),fe=U.reduce(bo,{}),ge=ie.slice(),xe=Object.create(null);let re,Ee,be,Le,Re,Ue,Pe;for(re=0,Ee=0;re<ie.length;re++)be=ie[re],Object.prototype.hasOwnProperty.call(fe,be)?Ee++:(H.push({command:Ht.removeLayer,args:[be]}),ge.splice(ge.indexOf(be,Ee),1));for(re=0,Ee=0;re<te.length;re++)be=te[te.length-1-re],ge[ge.length-1-re]!==be&&(Object.prototype.hasOwnProperty.call(ne,be)?(H.push({command:Ht.removeLayer,args:[be]}),ge.splice(ge.lastIndexOf(be,ge.length-Ee),1)):Ee++,Ue=ge[ge.length-re],H.push({command:Ht.addLayer,args:[fe[be],Ue]}),ge.splice(ge.length-re,0,be),xe[be]=!0);for(re=0;re<te.length;re++)if(be=te[re],Le=ne[be],Re=fe[be],!xe[be]&&!C(Le,Re))if(C(Le.source,Re.source)&&C(Le["source-layer"],Re["source-layer"])&&C(Le.type,Re.type)){for(Pe in Kr(Le.layout,Re.layout,H,be,null,Ht.setLayoutProperty),Kr(Le.paint,Re.paint,H,be,null,Ht.setPaintProperty),C(Le.filter,Re.filter)||H.push({command:Ht.setFilter,args:[be,Re.filter]}),C(Le.minzoom,Re.minzoom)&&C(Le.maxzoom,Re.maxzoom)||H.push({command:Ht.setLayerZoomRange,args:[be,Re.minzoom,Re.maxzoom]}),Le)Object.prototype.hasOwnProperty.call(Le,Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?Kr(Le[Pe],Re[Pe],H,be,Pe.slice(6),Ht.setPaintProperty):C(Le[Pe],Re[Pe])||H.push({command:Ht.setLayerProperty,args:[be,Pe,Re[Pe]]}));for(Pe in Re)Object.prototype.hasOwnProperty.call(Re,Pe)&&!Object.prototype.hasOwnProperty.call(Le,Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?Kr(Le[Pe],Re[Pe],H,be,Pe.slice(6),Ht.setPaintProperty):C(Le[Pe],Re[Pe])||H.push({command:Ht.setLayerProperty,args:[be,Pe,Re[Pe]]}))}else H.push({command:Ht.removeLayer,args:[be]}),Ue=ge[ge.lastIndexOf(be)+1],H.push({command:Ht.addLayer,args:[Re,Ue]})}(R,b.layers,A)}catch(M){console.warn("Unable to compute style diff:",M),A=[{command:Ht.setStyle,args:[b]}]}return A}(this.serialize(),o).filter(_=>!(_.command in yn));if(d.length===0)return!1;const p=d.filter(_=>!(_.command in Vt));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return d.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=o,!0}addImage(o,d){if(this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,d),this._afterImageUpdated(o)}updateImage(o,d){this.imageManager.updateImage(o,d)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new l.ErrorEvent(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,d,p={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.validateStyle.source,`sources.${o}`,d,null,p))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const _=this.sourceCaches[o]=new Jt(o,d,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:o})),_.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new l.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const d=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],d.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,d){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(d),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,d,p={}){this._checkLoaded();const _=o.id;if(this.getLayer(_))return void this.fire(new l.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let b;if(o.type==="custom"){if(Ft(this,l.validateCustomStyleLayer(o)))return;b=l.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=l.clone$1(o),o=l.extend(o,{source:_})),this._validate(l.validateStyle.layer,`layers.${_}`,o,{arrayIndex:-1},p))return;b=l.createStyleLayer(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[b.id]=b.serialize()}const A=d?this._order.indexOf(d):this._order.length;if(d&&A===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${d}".`)));else{if(this._order.splice(A,0,_),this._layerOrderChanged=!0,this._layers[_]=b,this._removedLayers[_]&&b.source&&b.type!=="custom"){const M=this._removedLayers[_];delete this._removedLayers[_],M.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(o,d){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new l.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===d)return;const p=this._order.indexOf(o);this._order.splice(p,1);const _=d?this._order.indexOf(d):this._order.length;d&&_===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${o}" before non-existing layer "${d}".`))):(this._order.splice(_,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const d=this._layers[o];if(!d)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${o}".`)));d.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=d,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],d.onRemove&&d.onRemove(this.map)}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,d,p){this._checkLoaded();const _=this.getLayer(o);_?_.minzoom===d&&_.maxzoom===p||(d!=null&&(_.minzoom=d),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,d,p={}){this._checkLoaded();const _=this.getLayer(o);if(_){if(!C(_.filter,d))return d==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(l.validateStyle.filter,`layers.${_.id}.filter`,d,null,p)||(_.filter=l.clone$1(d),this._updateLayer(_)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return l.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,d,p,_={}){this._checkLoaded();const b=this.getLayer(o);b?C(b.getLayoutProperty(d),p)||(b.setLayoutProperty(d,p,_),this._updateLayer(b)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,d){const p=this.getLayer(o);if(p)return p.getLayoutProperty(d);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,d,p,_={}){this._checkLoaded();const b=this.getLayer(o);b?C(b.getPaintProperty(d),p)||(b.setPaintProperty(d,p,_)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,d){return this.getLayer(o).getPaintProperty(d)}setFeatureState(o,d){this._checkLoaded();const p=o.source,_=o.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const A=b.getSource().type;A==="geojson"&&_?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):A!=="vector"||_?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),b.setFeatureState(_,o.id,d)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,d){this._checkLoaded();const p=o.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const b=_.getSource().type,A=b==="vector"?o.sourceLayer:void 0;b!=="vector"||A?d&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(A,o.id,d):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const d=o.source,p=o.sourceLayer,_=this.sourceCaches[d];if(_!==void 0)return _.getSource().type!=="vector"||p?(o.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,o.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,o=>o.serialize()),layers:this._serializeLayers(this._order)},o=>o!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(o){const d=A=>this._layers[A].type==="fill-extrusion",p={},_=[];for(let A=this._order.length-1;A>=0;A--){const M=this._order[A];if(d(M)){p[M]=A;for(const P of o){const R=P[M];if(R)for(const k of R)_.push(k)}}}_.sort((A,M)=>M.intersectionZ-A.intersectionZ);const b=[];for(let A=this._order.length-1;A>=0;A--){const M=this._order[A];if(d(M))for(let P=_.length-1;P>=0;P--){const R=_[P].feature;if(p[R.layer.id]<A)break;b.push(R),_.pop()}else for(const P of o){const R=P[M];if(R)for(const k of R)b.push(k.feature)}}return b}queryRenderedFeatures(o,d,p){d&&d.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);const _={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of d.layers){const M=this._layers[A];if(!M)return this.fire(new l.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];_[M.source]=!0}}const b=[];d.availableImages=this._availableImages;for(const A in this.sourceCaches)d.layers&&!_[A]||b.push(pi(this.sourceCaches[A],this._layers,this._serializedLayers,o,d,p));return this.placement&&b.push(function(A,M,P,R,k,U,H){const ie={},te=U.queryRenderedSymbols(R),ne=[];for(const fe of Object.keys(te).map(Number))ne.push(H[fe]);ne.sort(Di);for(const fe of ne){const ge=fe.featureIndex.lookupSymbolFeatures(te[fe.bucketInstanceId],M,fe.bucketIndex,fe.sourceLayerIndex,k.filter,k.layers,k.availableImages,A);for(const xe in ge){const re=ie[xe]=ie[xe]||[],Ee=ge[xe];Ee.sort((be,Le)=>{const Re=fe.featureSortOrder;if(Re){const Ue=Re.indexOf(be.featureIndex);return Re.indexOf(Le.featureIndex)-Ue}return Le.featureIndex-be.featureIndex});for(const be of Ee)re.push(be)}}for(const fe in ie)ie[fe].forEach(ge=>{const xe=ge.feature,re=P[A[fe].source].getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=re});return ie}(this._layers,this._serializedLayers,this.sourceCaches,o,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,d){d&&d.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);const p=this.sourceCaches[o];return p?function(_,b){const A=_.getRenderableIds().map(R=>_.getTileByID(R)),M=[],P={};for(let R=0;R<A.length;R++){const k=A[R],U=k.tileID.canonical.key;P[U]||(P[U]=!0,k.querySourceFeatures(M,b))}return M}(p,d):[]}addSourceType(o,d,p){return ci.getSourceType(o)?p(new Error(`A source type called "${o}" already exists.`)):(ci.setSourceType(o,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:d.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(o,d={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const A in o)if(!C(o[A],p[A])){_=!0;break}if(!_)return;const b={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,d),this.light.updateTransitions(b)}_validate(o,d,p,_,b={}){return(!b||b.validate!==!1)&&Ft(this,o.call(l.validateStyle,l.extend({key:d,style:this.serialize(),value:p,styleSpec:l.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const d=this.sourceCaches[o];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const d in this.sourceCaches)this.sourceCaches[d].update(o,this.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,d,p,_,b=!1){let A=!1,M=!1;const P={};for(const R of this._order){const k=this._layers[R];if(k.type!=="symbol")continue;if(!P[k.source]){const H=this.sourceCaches[k.source];P[k.source]=H.getRenderableIds(!0).map(ie=>H.getTileByID(ie)).sort((ie,te)=>te.tileID.overscaledZ-ie.tileID.overscaledZ||(ie.tileID.isLessThan(te.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(k,P[k.source],o.center.lng);A=A||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),o.zoom))&&(this.pauseablePlacement=new Ce(o,this.terrain,this._order,b,d,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),M=!0),A&&this.pauseablePlacement.placement.setStale()),M||A)for(const R of this._order){const k=this._layers[R];k.type==="symbol"&&this.placement.updateLayerOpacities(k,P[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,d,p){this.imageManager.getImages(d.icons,p),this._updateTilesForChangedImages();const _=this.sourceCaches[d.source];_&&_.setDependencies(d.tileID.key,d.type,d.icons)}getGlyphs(o,d,p){this.glyphManager.getGlyphs(d.stacks,p)}getResource(o,d,p){return l.makeRequest(d,p)}}ci.getSourceType=function(m){return sn[m]},ci.setSourceType=function(m,o){sn[m]=o},ci.registerForPluginStateChange=l.registerForPluginStateChange;var es="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Si={prelude:Kt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Kt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Kt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Kt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Kt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Kt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Kt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Kt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Kt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Kt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Kt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Kt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Kt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Kt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Kt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Kt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Kt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Kt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Kt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Kt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Kt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",es),terrainDepth:Kt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",es),terrainCoords:Kt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",es)};function Kt(m,o){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute ([\w]+) ([\w]+)/g),_=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=b?b.concat(_):_,M={};return{fragmentSource:m=m.replace(d,(P,R,k,U,H)=>(M[H]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${H}
varying ${k} ${U} ${H};
#else
uniform ${k} ${U} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${k} ${U} ${H} = u_${H};
#endif
`)),vertexSource:o=o.replace(d,(P,R,k,U,H)=>{const ie=U==="float"?"vec2":"vec4",te=H.match(/color/)?"color":ie;return M[H]?R==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${k} ${ie} a_${H};
varying ${k} ${U} ${H};
#else
uniform ${k} ${U} u_${H};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${k} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${te}(a_${H}, u_${H}_t);
#else
    ${k} ${U} ${H} = u_${H};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${k} ${ie} a_${H};
#else
uniform ${k} ${U} u_${H};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${k} ${U} ${H} = a_${H};
#else
    ${k} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${k} ${U} ${H} = unpack_mix_${te}(a_${H}, u_${H}_t);
#else
    ${k} ${U} ${H} = u_${H};
#endif
`}),staticAttributes:p,staticUniforms:A}}class Ko{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,d,p,_,b,A,M,P,R){this.context=o;let k=this.boundPaintVertexBuffers.length!==_.length;for(let U=0;!k&&U<_.length;U++)this.boundPaintVertexBuffers[U]!==_[U]&&(k=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===p&&!k&&this.boundIndexBuffer===b&&this.boundVertexOffset===A&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===P&&this.boundDynamicVertexBuffer3===R?(o.bindVertexArrayOES.set(this.vao),M&&M.bind(),b&&b.dynamicDraw&&b.bind(),P&&P.bind(),R&&R.bind()):this.freshBind(d,p,_,b,A,M,P,R)}freshBind(o,d,p,_,b,A,M,P){let R;const k=o.numAttributes,U=this.context,H=U.gl;if(U.extVertexArrayObject)this.vao&&this.destroy(),this.vao=U.extVertexArrayObject.createVertexArrayOES(),U.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=P;else{R=U.currentNumAttributes||0;for(let ie=k;ie<R;ie++)H.disableVertexAttribArray(ie)}d.enableAttributes(H,o);for(const ie of p)ie.enableAttributes(H,o);A&&A.enableAttributes(H,o),M&&M.enableAttributes(H,o),P&&P.enableAttributes(H,o),d.bind(),d.setVertexAttribPointers(H,o,b);for(const ie of p)ie.bind(),ie.setVertexAttribPointers(H,o,b);A&&(A.bind(),A.setVertexAttribPointers(H,o,b)),_&&_.bind(),M&&(M.bind(),M.setVertexAttribPointers(H,o,b)),P&&(P.bind(),P.setVertexAttribPointers(H,o,b)),U.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Yo(m){const o=[];for(let d=0;d<m.length;d++){if(m[d]===null)continue;const p=m[d].split(" ");o.push(p.pop())}return o}class Oa{constructor(o,d,p,_,b,A,M){const P=o.gl;this.program=P.createProgram();const R=Yo(p.staticAttributes),k=_?_.getBinderAttributes():[],U=R.concat(k),H=Si.prelude.staticUniforms?Yo(Si.prelude.staticUniforms):[],ie=p.staticUniforms?Yo(p.staticUniforms):[],te=_?_.getBinderUniforms():[],ne=H.concat(ie).concat(te),fe=[];for(const Re of ne)fe.indexOf(Re)<0&&fe.push(Re);const ge=_?_.defines():[];A&&ge.push("#define OVERDRAW_INSPECTOR;"),M&&ge.push("#define TERRAIN3D;");const xe=ge.concat(Si.prelude.fragmentSource,p.fragmentSource).join(`
`),re=ge.concat(Si.prelude.vertexSource,p.vertexSource).join(`
`),Ee=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(Ee,xe),P.compileShader(Ee),P.attachShader(this.program,Ee);const be=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(be,re),P.compileShader(be),P.attachShader(this.program,be),this.attributes={};const Le={};this.numAttributes=U.length;for(let Re=0;Re<this.numAttributes;Re++)U[Re]&&(P.bindAttribLocation(this.program,Re,U[Re]),this.attributes[U[Re]]=Re);P.linkProgram(this.program),P.deleteShader(be),P.deleteShader(Ee);for(let Re=0;Re<fe.length;Re++){const Ue=fe[Re];if(Ue&&!Le[Ue]){const Pe=P.getUniformLocation(this.program,Ue);Pe&&(Le[Ue]=Pe)}}this.fixedUniforms=b(o,Le),this.terrainUniforms=((Re,Ue)=>({u_depth:new l.Uniform1i(Re,Ue.u_depth),u_terrain:new l.Uniform1i(Re,Ue.u_terrain),u_terrain_dim:new l.Uniform1f(Re,Ue.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(Re,Ue.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(Re,Ue.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(Re,Ue.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(Re,Ue.u_terrain_exaggeration)}))(o,Le),this.binderUniforms=_?_.getUniforms(o,Le):[]}draw(o,d,p,_,b,A,M,P,R,k,U,H,ie,te,ne,fe,ge,xe){const re=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(_),o.setColorMode(b),o.setCullFace(A),P){o.activeTexture.set(re.TEXTURE2),re.bindTexture(re.TEXTURE_2D,P.depthTexture),o.activeTexture.set(re.TEXTURE3),re.bindTexture(re.TEXTURE_2D,P.texture);for(const be in this.terrainUniforms)this.terrainUniforms[be].set(P[be])}for(const be in this.fixedUniforms)this.fixedUniforms[be].set(M[be]);ne&&ne.setUniforms(o,this.binderUniforms,ie,{zoom:te});let Ee=0;switch(d){case re.LINES:Ee=2;break;case re.TRIANGLES:Ee=3;break;case re.LINE_STRIP:Ee=1}for(const be of H.get()){const Le=be.vaos||(be.vaos={});(Le[R]||(Le[R]=new Ko)).bind(o,this,k,ne?ne.getPaintVertexBuffers():[],U,be.vertexOffset,fe,ge,xe),re.drawElements(d,be.primitiveLength*Ee,re.UNSIGNED_SHORT,be.primitiveOffset*Ee*2)}}}function ka(m,o,d){const p=1/Nn(d,1,o.transform.tileZoom),_=Math.pow(2,d.tileID.overscaledZ),b=d.tileSize*Math.pow(2,o.transform.tileZoom)/_,A=b*(d.tileID.canonical.x+d.tileID.wrap*_),M=b*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[p,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[A>>16,M>>16],u_pixel_coord_lower:[65535&A,65535&M]}}const To=(m,o,d,p)=>{const _=o.style.light,b=_.properties.get("position"),A=[b.x,b.y,b.z],M=l.create$1();_.properties.get("anchor")==="viewport"&&l.fromRotation(M,-o.transform.angle),l.transformMat3(A,A,M);const P=_.properties.get("color");return{u_matrix:m,u_lightpos:A,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+d,u_opacity:p}},ts=(m,o,d,p,_,b,A)=>l.extend(To(m,o,d,p),ka(b,o,A),{u_height_factor:-Math.pow(2,_.overscaledZ)/A.tileSize/8}),Fa=m=>({u_matrix:m}),za=(m,o,d,p)=>l.extend(Fa(m),ka(d,o,p)),Na=(m,o)=>({u_matrix:m,u_world:o}),Dl=(m,o,d,p,_)=>l.extend(za(m,o,d,p),{u_world:_}),Fc=(m,o,d,p)=>{const _=m.transform;let b,A;if(p.paint.get("circle-pitch-alignment")==="map"){const M=Nn(d,1,_.zoom);b=!0,A=[M,M]}else b=!1,A=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(o.posMatrix,d,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:A}},Zs=(m,o,d)=>{const p=Nn(d,1,o.zoom),_=Math.pow(2,o.zoom-d.tileID.overscaledZ),b=d.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[o.pixelsToGLUnits[0]/(p*_),o.pixelsToGLUnits[1]/(p*_)],u_overscale_factor:b}},W=(m,o,d=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:d}),Q=m=>({u_matrix:m}),ce=(m,o,d,p)=>({u_matrix:m,u_extrude_scale:Nn(o,1,d),u_intensity:p});function Se(m,o){const d=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new l.MercatorCoordinate(0,p/d).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/d).toLngLat().lat]}const Ge=(m,o,d,p)=>{const _=m.transform;return{u_matrix:Xn(m,o,d,p),u_ratio:1/Nn(o,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},ct=(m,o,d,p,_)=>l.extend(Ge(m,o,d,_),{u_image:0,u_image_height:p}),zt=(m,o,d,p,_)=>{const b=m.transform,A=Dt(o,b);return{u_matrix:Xn(m,o,d,_),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Nn(o,1,b.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[A,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Bn=(m,o,d,p,_,b)=>{const A=m.lineAtlas,M=Dt(o,m.transform),P=d.layout.get("line-cap")==="round",R=A.getDash(p.from,P),k=A.getDash(p.to,P),U=R.width*_.fromScale,H=k.width*_.toScale;return l.extend(Ge(m,o,d,b),{u_patternscale_a:[M/U,-R.height/2],u_patternscale_b:[M/H,-k.height/2],u_sdfgamma:A.width/(256*Math.min(U,H)*m.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:k.y,u_mix:_.t})};function Dt(m,o){return 1/Nn(m,1,o.tileZoom)}function Xn(m,o,d,p){return m.translatePosMatrix(p?p.posMatrix:o.tileID.posMatrix,o,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const vr=(m,o,d,p,_)=>{return{u_matrix:m,u_tl_parent:o,u_scale_parent:d,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(A=_.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(b=_.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Qf(_.paint.get("raster-hue-rotate"))};var b,A};function Qf(m){m*=Math.PI/180;const o=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const bh=(m,o,d,p,_,b,A,M,P,R)=>{const k=_.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:k.cameraToCenterDistance,u_pitch:k.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:k.width/k.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:A,u_coord_matrix:M,u_is_text:+P,u_pitch_with_map:+p,u_texsize:R,u_texture:0}},zc=(m,o,d,p,_,b,A,M,P,R,k)=>{const U=_.transform;return l.extend(bh(m,o,d,p,_,b,A,M,P,R),{u_gamma_scale:p?Math.cos(U._pitch)*U.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+k})},ep=(m,o,d,p,_,b,A,M,P,R)=>l.extend(zc(m,o,d,p,_,b,A,M,!0,P,!0),{u_texsize_icon:R,u_texture_icon:1}),C_=(m,o,d)=>({u_matrix:m,u_opacity:o,u_color:d}),I_=(m,o,d,p,_,b)=>l.extend(function(A,M,P,R){const k=P.imageManager.getPattern(A.from.toString()),U=P.imageManager.getPattern(A.to.toString()),{width:H,height:ie}=P.imageManager.getPixelSize(),te=Math.pow(2,R.tileID.overscaledZ),ne=R.tileSize*Math.pow(2,P.transform.tileZoom)/te,fe=ne*(R.tileID.canonical.x+R.tileID.wrap*te),ge=ne*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[H,ie],u_mix:M.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Nn(R,1,P.transform.tileZoom),u_pixel_coord_upper:[fe>>16,ge>>16],u_pixel_coord_lower:[65535&fe,65535&ge]}}(p,b,d,_),{u_matrix:m,u_opacity:o}),wh={fillExtrusion:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_lightpos:new l.Uniform3f(m,o.u_lightpos),u_lightintensity:new l.Uniform1f(m,o.u_lightintensity),u_lightcolor:new l.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,o.u_vertical_gradient),u_opacity:new l.Uniform1f(m,o.u_opacity)}),fillExtrusionPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_lightpos:new l.Uniform3f(m,o.u_lightpos),u_lightintensity:new l.Uniform1f(m,o.u_lightintensity),u_lightcolor:new l.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,o.u_vertical_gradient),u_height_factor:new l.Uniform1f(m,o.u_height_factor),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade),u_opacity:new l.Uniform1f(m,o.u_opacity)}),fill:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),fillPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),fillOutline:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world)}),fillOutlinePattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world),u_image:new l.Uniform1i(m,o.u_image),u_texsize:new l.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),circle:(m,o)=>({u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(m,o.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(m,o.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),collisionBox:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(m,o.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(m,o.u_extrude_scale),u_overscale_factor:new l.Uniform1f(m,o.u_overscale_factor)}),collisionCircle:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_inv_matrix:new l.UniformMatrix4f(m,o.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(m,o.u_viewport_size)}),debug:(m,o)=>({u_color:new l.UniformColor(m,o.u_color),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_overlay:new l.Uniform1i(m,o.u_overlay),u_overlay_scale:new l.Uniform1f(m,o.u_overlay_scale)}),clippingMask:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),heatmap:(m,o)=>({u_extrude_scale:new l.Uniform1f(m,o.u_extrude_scale),u_intensity:new l.Uniform1f(m,o.u_intensity),u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),heatmapTexture:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_world:new l.Uniform2f(m,o.u_world),u_image:new l.Uniform1i(m,o.u_image),u_color_ramp:new l.Uniform1i(m,o.u_color_ramp),u_opacity:new l.Uniform1f(m,o.u_opacity)}),hillshade:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_latrange:new l.Uniform2f(m,o.u_latrange),u_light:new l.Uniform2f(m,o.u_light),u_shadow:new l.UniformColor(m,o.u_shadow),u_highlight:new l.UniformColor(m,o.u_highlight),u_accent:new l.UniformColor(m,o.u_accent)}),hillshadePrepare:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_image:new l.Uniform1i(m,o.u_image),u_dimension:new l.Uniform2f(m,o.u_dimension),u_zoom:new l.Uniform1f(m,o.u_zoom),u_unpack:new l.Uniform4f(m,o.u_unpack)}),line:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels)}),lineGradient:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_image:new l.Uniform1i(m,o.u_image),u_image_height:new l.Uniform1f(m,o.u_image_height)}),linePattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texsize:new l.Uniform2f(m,o.u_texsize),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_image:new l.Uniform1i(m,o.u_image),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_scale:new l.Uniform3f(m,o.u_scale),u_fade:new l.Uniform1f(m,o.u_fade)}),lineSDF:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_ratio:new l.Uniform1f(m,o.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,o.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(m,o.u_patternscale_a),u_patternscale_b:new l.Uniform2f(m,o.u_patternscale_b),u_sdfgamma:new l.Uniform1f(m,o.u_sdfgamma),u_image:new l.Uniform1i(m,o.u_image),u_tex_y_a:new l.Uniform1f(m,o.u_tex_y_a),u_tex_y_b:new l.Uniform1f(m,o.u_tex_y_b),u_mix:new l.Uniform1f(m,o.u_mix)}),raster:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_tl_parent:new l.Uniform2f(m,o.u_tl_parent),u_scale_parent:new l.Uniform1f(m,o.u_scale_parent),u_buffer_scale:new l.Uniform1f(m,o.u_buffer_scale),u_fade_t:new l.Uniform1f(m,o.u_fade_t),u_opacity:new l.Uniform1f(m,o.u_opacity),u_image0:new l.Uniform1i(m,o.u_image0),u_image1:new l.Uniform1i(m,o.u_image1),u_brightness_low:new l.Uniform1f(m,o.u_brightness_low),u_brightness_high:new l.Uniform1f(m,o.u_brightness_high),u_saturation_factor:new l.Uniform1f(m,o.u_saturation_factor),u_contrast_factor:new l.Uniform1f(m,o.u_contrast_factor),u_spin_weights:new l.Uniform3f(m,o.u_spin_weights)}),symbolIcon:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texture:new l.Uniform1i(m,o.u_texture)}),symbolSDF:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texture:new l.Uniform1i(m,o.u_texture),u_gamma_scale:new l.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,o.u_is_halo)}),symbolTextAndIcon:(m,o)=>({u_is_size_zoom_constant:new l.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,o.u_size_t),u_size:new l.Uniform1f(m,o.u_size),u_camera_to_center_distance:new l.Uniform1f(m,o.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,o.u_pitch),u_rotate_symbol:new l.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,o.u_fade_change),u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new l.Uniform1i(m,o.u_is_text),u_pitch_with_map:new l.Uniform1i(m,o.u_pitch_with_map),u_texsize:new l.Uniform2f(m,o.u_texsize),u_texsize_icon:new l.Uniform2f(m,o.u_texsize_icon),u_texture:new l.Uniform1i(m,o.u_texture),u_texture_icon:new l.Uniform1i(m,o.u_texture_icon),u_gamma_scale:new l.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,o.u_is_halo)}),background:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_opacity:new l.Uniform1f(m,o.u_opacity),u_color:new l.UniformColor(m,o.u_color)}),backgroundPattern:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_opacity:new l.Uniform1f(m,o.u_opacity),u_image:new l.Uniform1i(m,o.u_image),u_pattern_tl_a:new l.Uniform2f(m,o.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(m,o.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(m,o.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(m,o.u_pattern_br_b),u_texsize:new l.Uniform2f(m,o.u_texsize),u_mix:new l.Uniform1f(m,o.u_mix),u_pattern_size_a:new l.Uniform2f(m,o.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(m,o.u_pattern_size_b),u_scale_a:new l.Uniform1f(m,o.u_scale_a),u_scale_b:new l.Uniform1f(m,o.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,o.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(m,o.u_tile_units_to_pixels)}),terrain:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texture:new l.Uniform1i(m,o.u_texture)}),terrainDepth:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix)}),terrainCoords:(m,o)=>({u_matrix:new l.UniformMatrix4f(m,o.u_matrix),u_texture:new l.Uniform1i(m,o.u_texture),u_terrain_coords_id:new l.Uniform1f(m,o.u_terrain_coords_id)})};class Ah{constructor(o,d,p){this.context=o;const _=o.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Eh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Th{constructor(o,d,p,_){this.length=d.length,this.attributes=p,this.itemSize=d.bytesPerElement,this.dynamicDraw=_,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let p=0;p<this.attributes.length;p++){const _=d.attributes[this.attributes[p].name];_!==void 0&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,d,p){for(let _=0;_<this.attributes.length;_++){const b=this.attributes[_],A=d.attributes[b.name];A!==void 0&&o.vertexAttribPointer(A,b.components,o[Eh[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class tn{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class tp extends tn{getDefault(){return l.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class M_ extends tn{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Ol extends tn{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class kl extends tn{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class np extends tn{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class xr extends tn{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Sh extends tn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Nc extends tn{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Uc extends tn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class Ch extends tn{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ih extends tn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class Gc extends tn{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Mh extends tn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class Ph extends tn{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Vc extends tn{getDefault(){return l.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ip extends tn{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class rp extends tn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class Ua extends tn{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class P_ extends tn{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class B_ extends tn{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class L_ extends tn{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class R_ extends tn{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class D_ extends tn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class O_ extends tn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Bh extends tn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class jc extends tn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Lh extends tn{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Rh extends tn{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class Ga extends tn{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class sp extends tn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class op extends tn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Hc extends tn{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class Qo extends Hc{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class ap extends Hc{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Va{constructor(o,d,p,_){this.context=o,this.width=d,this.height=p;const b=o.gl,A=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new Qo(o,A),_&&(this.depthAttachment=new ap(o,A)),b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,d=this.colorAttachment.get();if(d&&o.deleteTexture(d),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class En{constructor(o,d,p){this.blendFunction=o,this.blendColor=d,this.mask=p}}En.Replace=[1,0],En.disabled=new En(En.Replace,l.Color.transparent,[!1,!1,!1,!1]),En.unblended=new En(En.Replace,l.Color.transparent,[!0,!0,!0,!0]),En.alphaBlended=new En([1,771],l.Color.transparent,[!0,!0,!0,!0]);class lp{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new tp(this),this.clearDepth=new M_(this),this.clearStencil=new Ol(this),this.colorMask=new kl(this),this.depthMask=new np(this),this.stencilMask=new xr(this),this.stencilFunc=new Sh(this),this.stencilOp=new Nc(this),this.stencilTest=new Uc(this),this.depthRange=new Ch(this),this.depthTest=new Ih(this),this.depthFunc=new Gc(this),this.blend=new Mh(this),this.blendFunc=new Ph(this),this.blendColor=new Vc(this),this.blendEquation=new ip(this),this.cullFace=new rp(this),this.cullFaceSide=new Ua(this),this.frontFace=new P_(this),this.program=new B_(this),this.activeTexture=new L_(this),this.viewport=new R_(this),this.bindFramebuffer=new D_(this),this.bindRenderbuffer=new O_(this),this.bindTexture=new Bh(this),this.bindVertexBuffer=new jc(this),this.bindElementBuffer=new Lh(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Rh(this),this.pixelStoreUnpack=new Ga(this),this.pixelStoreUnpackPremultiplyAlpha=new sp(this),this.pixelStoreUnpackFlipY=new op(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d){return new Ah(this,o,d)}createVertexBuffer(o,d,p){return new Th(this,o,d,p)}createRenderbuffer(o,d,p){const _=this.gl,b=_.createRenderbuffer();return this.bindRenderbuffer.set(b),_.renderbufferStorage(_.RENDERBUFFER,o,d,p),this.bindRenderbuffer.set(null),b}createFramebuffer(o,d,p){return new Va(this,o,d,p)}clear({color:o,depth:d}){const p=this.gl;let _=0;o&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),p.clear(_)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){C(o.blendFunction,En.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Wt{constructor(o,d,p){this.func=o,this.mask=d,this.range=p}}Wt.ReadOnly=!1,Wt.ReadWrite=!0,Wt.disabled=new Wt(519,Wt.ReadOnly,[0,1]);const nn=7680;class bn{constructor(o,d,p,_,b,A){this.test=o,this.ref=d,this.mask=p,this.fail=_,this.depthFail=b,this.pass=A}}bn.disabled=new bn({func:519,mask:0},0,0,nn,nn,nn);class Cn{constructor(o,d,p){this.enable=o,this.mode=d,this.frontFace=p}}let Fl;function ja(m,o,d,p,_,b,A){const M=m.context,P=M.gl,R=m.useProgram("collisionBox"),k=[];let U=0,H=0;for(let re=0;re<p.length;re++){const Ee=p[re],be=o.getTile(Ee),Le=be.getBucket(d);if(!Le)continue;let Re=Ee.posMatrix;_[0]===0&&_[1]===0||(Re=m.translatePosMatrix(Ee.posMatrix,be,_,b));const Ue=A?Le.textCollisionBox:Le.iconCollisionBox,Pe=Le.collisionCircleArray;if(Pe.length>0){const it=l.create(),Ze=Re;l.mul(it,Le.placementInvProjMatrix,m.transform.glCoordMatrix),l.mul(it,it,Le.placementViewportMatrix),k.push({circleArray:Pe,circleOffset:H,transform:Ze,invTransform:it,coord:Ee}),U+=Pe.length/4,H=U}Ue&&R.draw(M,P.LINES,Wt.disabled,bn.disabled,m.colorModeForRenderPass(),Cn.disabled,Zs(Re,m.transform,be),m.style.terrain&&m.style.terrain.getTerrainData(Ee),d.id,Ue.layoutVertexBuffer,Ue.indexBuffer,Ue.segments,null,m.transform.zoom,null,null,Ue.collisionVertexBuffer)}if(!A||!k.length)return;const ie=m.useProgram("collisionCircle"),te=new l.CollisionCircleLayoutArray;te.resize(4*U),te._trim();let ne=0;for(const re of k)for(let Ee=0;Ee<re.circleArray.length/4;Ee++){const be=4*Ee,Le=re.circleArray[be+0],Re=re.circleArray[be+1],Ue=re.circleArray[be+2],Pe=re.circleArray[be+3];te.emplace(ne++,Le,Re,Ue,Pe,0),te.emplace(ne++,Le,Re,Ue,Pe,1),te.emplace(ne++,Le,Re,Ue,Pe,2),te.emplace(ne++,Le,Re,Ue,Pe,3)}(!Fl||Fl.length<2*U)&&(Fl=function(re){const Ee=2*re,be=new l.QuadTriangleArray;be.resize(Ee),be._trim();for(let Le=0;Le<Ee;Le++){const Re=6*Le;be.uint16[Re+0]=4*Le+0,be.uint16[Re+1]=4*Le+1,be.uint16[Re+2]=4*Le+2,be.uint16[Re+3]=4*Le+2,be.uint16[Re+4]=4*Le+3,be.uint16[Re+5]=4*Le+0}return be}(U));const fe=M.createIndexBuffer(Fl,!0),ge=M.createVertexBuffer(te,l.collisionCircleLayout.members,!0);for(const re of k){const Ee={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(xe=m.transform).cameraToCenterDistance,u_viewport_size:[xe.width,xe.height]};ie.draw(M,P.TRIANGLES,Wt.disabled,bn.disabled,m.colorModeForRenderPass(),Cn.disabled,Ee,m.style.terrain&&m.style.terrain.getTerrainData(re.coord),d.id,ge,fe,l.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,m.transform.zoom,null,null,null)}var xe;ge.destroy(),fe.destroy()}Cn.disabled=new Cn(!1,1029,2305),Cn.backCCW=new Cn(!0,1029,2305);const k_=l.identity(new Float32Array(16));function F_(m,o,d,p,_,b){const{horizontalAlign:A,verticalAlign:M}=l.getAnchorAlignment(m),P=-(A-.5)*o,R=-(M-.5)*d,k=l.evaluateVariableOffset(m,p);return new l.pointGeometry((P/_+k[0])*b,(R/_+k[1])*b)}function cp(m,o,d,p,_,b,A,M,P,R,k){const U=m.text.placedSymbolArray,H=m.text.dynamicLayoutVertexArray,ie=m.icon.dynamicLayoutVertexArray,te={};H.clear();for(let ne=0;ne<U.length;ne++){const fe=U.get(ne),ge=m.allowVerticalPlacement&&!fe.placedOrientation,xe=fe.hidden||!fe.crossTileID||ge?null:p[fe.crossTileID];if(xe){const re=new l.pointGeometry(fe.anchorX,fe.anchorY),Ee=Gt(re,d?A:b,k),be=ir(_.cameraToCenterDistance,Ee.signedDistanceFromCamera);let Le=l.evaluateSizeForFeature(m.textSizeData,P,fe)*be/l.ONE_EM;d&&(Le*=m.tilePixelRatio/M);const{width:Re,height:Ue,anchor:Pe,textOffset:it,textBoxScale:Ze}=xe,rt=F_(Pe,Re,Ue,it,Ze,Le),Bt=d?Gt(re.add(rt),b,k).point:Ee.point.add(o?rt.rotate(-_.angle):rt),Ot=m.allowVerticalPlacement&&fe.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let bt=0;bt<fe.numGlyphs;bt++)l.addDynamicAttributes(H,Bt,Ot);R&&fe.associatedIconIndex>=0&&(te[fe.associatedIconIndex]={shiftedAnchor:Bt,angle:Ot})}else Ct(fe.numGlyphs,H)}if(R){ie.clear();const ne=m.icon.placedSymbolArray;for(let fe=0;fe<ne.length;fe++){const ge=ne.get(fe);if(ge.hidden)Ct(ge.numGlyphs,ie);else{const xe=te[fe];if(xe)for(let re=0;re<ge.numGlyphs;re++)l.addDynamicAttributes(ie,xe.shiftedAnchor,xe.angle);else Ct(ge.numGlyphs,ie)}}m.icon.dynamicLayoutVertexBuffer.updateData(ie)}m.text.dynamicLayoutVertexBuffer.updateData(H)}function z_(m,o,d){return d.iconsInText&&o?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Wc(m,o,d,p,_,b,A,M,P,R,k,U){const H=m.context,ie=H.gl,te=m.transform,ne=M==="map",fe=P==="map",ge=M!=="viewport"&&d.layout.get("symbol-placement")!=="point",xe=ne&&!fe&&!ge,re=!d.layout.get("symbol-sort-key").isConstant();let Ee=!1;const be=m.depthModeForSublayer(0,Wt.ReadOnly),Le=d.layout.get("text-variable-anchor"),Re=[];for(const Ue of p){const Pe=o.getTile(Ue),it=Pe.getBucket(d);if(!it)continue;const Ze=_?it.text:it.icon;if(!Ze||!Ze.segments.get().length)continue;const rt=Ze.programConfigurations.get(d.id),Bt=_||it.sdfIcons,Ot=_?it.textSizeData:it.iconSizeData,bt=fe||te.pitch!==0,ln=m.useProgram(z_(Bt,_,it),rt),cn=l.evaluateSizeForZoom(Ot,te.zoom),qt=m.style.terrain&&m.style.terrain.getTerrainData(Ue);let Zt,fn,_i,Ps,is=[0,0],Bs=null;if(_){if(fn=Pe.glyphAtlasTexture,_i=ie.LINEAR,Zt=Pe.glyphAtlasTexture.size,it.iconsInText){is=Pe.imageAtlasTexture.size,Bs=Pe.imageAtlasTexture;const Nr=Ot.kind==="composite"||Ot.kind==="camera";Ps=bt||m.options.rotating||m.options.zooming||Nr?ie.LINEAR:ie.NEAREST}}else{const Nr=d.layout.get("icon-size").constantOr(0)!==1||it.iconsNeedLinear;fn=Pe.imageAtlasTexture,_i=Bt||m.options.rotating||m.options.zooming||Nr||bt?ie.LINEAR:ie.NEAREST,Zt=Pe.imageAtlasTexture.size}const Lo=Nn(Pe,1,m.transform.zoom),zr=Ts(Ue.posMatrix,fe,ne,m.transform,Lo),sr=ki(Ue.posMatrix,fe,ne,m.transform,Lo),Ys=Le&&it.hasTextData(),Qc=d.layout.get("icon-text-fit")!=="none"&&Ys&&it.hasIconData();if(ge){const Nr=m.style.terrain?($h,Za)=>m.style.terrain.getElevation(Ue,$h,Za):null,ia=d.layout.get("text-rotation-alignment")==="map";qi(it,Ue.posMatrix,m,_,zr,sr,fe,R,ia,Nr)}const ui=m.translatePosMatrix(Ue.posMatrix,Pe,b,A),Ut=ge||_&&Le||Qc?k_:zr,an=m.translatePosMatrix(sr,Pe,b,A,!0),yi=Bt&&d.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let vi;vi=Bt?it.iconsInText?ep(Ot.kind,cn,xe,fe,m,ui,Ut,an,Zt,is):zc(Ot.kind,cn,xe,fe,m,ui,Ut,an,_,Zt,!0):bh(Ot.kind,cn,xe,fe,m,ui,Ut,an,_,Zt);const Mn={program:ln,buffers:Ze,uniformValues:vi,atlasTexture:fn,atlasTextureIcon:Bs,atlasInterpolation:_i,atlasInterpolationIcon:Ps,isSDF:Bt,hasHalo:yi};if(re&&it.canOverlap){Ee=!0;const Nr=Ze.segments.get();for(const ia of Nr)Re.push({segments:new l.SegmentVector([ia]),sortKey:ia.sortKey,state:Mn,terrainData:qt})}else Re.push({segments:Ze.segments,sortKey:0,state:Mn,terrainData:qt})}Ee&&Re.sort((Ue,Pe)=>Ue.sortKey-Pe.sortKey);for(const Ue of Re){const Pe=Ue.state;if(H.activeTexture.set(ie.TEXTURE0),Pe.atlasTexture.bind(Pe.atlasInterpolation,ie.CLAMP_TO_EDGE),Pe.atlasTextureIcon&&(H.activeTexture.set(ie.TEXTURE1),Pe.atlasTextureIcon&&Pe.atlasTextureIcon.bind(Pe.atlasInterpolationIcon,ie.CLAMP_TO_EDGE)),Pe.isSDF){const it=Pe.uniformValues;Pe.hasHalo&&(it.u_is_halo=1,zl(Pe.buffers,Ue.segments,d,m,Pe.program,be,k,U,it,Ue.terrainData)),it.u_is_halo=0}zl(Pe.buffers,Ue.segments,d,m,Pe.program,be,k,U,Pe.uniformValues,Ue.terrainData)}}function zl(m,o,d,p,_,b,A,M,P,R){const k=p.context;_.draw(k,k.gl.TRIANGLES,b,A,M,Cn.disabled,P,R,d.id,m.layoutVertexBuffer,m.indexBuffer,o,d.paint,p.transform.zoom,m.programConfigurations.get(d.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Nl(m,o,d,p,_,b,A){const M=m.context.gl,P=d.paint.get("fill-pattern"),R=P&&P.constantOr(1),k=d.getCrossfadeParameters();let U,H,ie,te,ne;A?(H=R&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=M.LINES):(H=R?"fillPattern":"fill",U=M.TRIANGLES);for(const fe of p){const ge=o.getTile(fe);if(R&&!ge.patternsLoaded())continue;const xe=ge.getBucket(d);if(!xe)continue;const re=xe.programConfigurations.get(d.id),Ee=m.useProgram(H,re),be=m.style.terrain&&m.style.terrain.getTerrainData(fe);R&&(m.context.activeTexture.set(M.TEXTURE0),ge.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),re.updatePaintBuffers(k));const Le=P.constantOr(null);if(Le&&ge.imageAtlas){const Pe=ge.imageAtlas,it=Pe.patternPositions[Le.to.toString()],Ze=Pe.patternPositions[Le.from.toString()];it&&Ze&&re.setConstantPatternPositions(it,Ze)}const Re=be?fe:null,Ue=m.translatePosMatrix(Re?Re.posMatrix:fe.posMatrix,ge,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(A){te=xe.indexBuffer2,ne=xe.segments2;const Pe=[M.drawingBufferWidth,M.drawingBufferHeight];ie=H==="fillOutlinePattern"&&R?Dl(Ue,m,k,ge,Pe):Na(Ue,Pe)}else te=xe.indexBuffer,ne=xe.segments,ie=R?za(Ue,m,k,ge):Fa(Ue);Ee.draw(m.context,U,_,m.stencilModeForClipping(fe),b,Cn.disabled,ie,be,d.id,xe.layoutVertexBuffer,te,ne,d.paint,m.transform.zoom,re)}}function Ul(m,o,d,p,_,b,A){const M=m.context,P=M.gl,R=d.paint.get("fill-extrusion-pattern"),k=R.constantOr(1),U=d.getCrossfadeParameters(),H=d.paint.get("fill-extrusion-opacity");for(const ie of p){const te=o.getTile(ie),ne=te.getBucket(d);if(!ne)continue;const fe=m.style.terrain&&m.style.terrain.getTerrainData(ie),ge=ne.programConfigurations.get(d.id),xe=m.useProgram(k?"fillExtrusionPattern":"fillExtrusion",ge);k&&(m.context.activeTexture.set(P.TEXTURE0),te.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ge.updatePaintBuffers(U));const re=R.constantOr(null);if(re&&te.imageAtlas){const Re=te.imageAtlas,Ue=Re.patternPositions[re.to.toString()],Pe=Re.patternPositions[re.from.toString()];Ue&&Pe&&ge.setConstantPatternPositions(Ue,Pe)}const Ee=m.translatePosMatrix(ie.posMatrix,te,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),be=d.paint.get("fill-extrusion-vertical-gradient"),Le=k?ts(Ee,m,be,H,ie,U,te):To(Ee,m,be,H);xe.draw(M,M.gl.TRIANGLES,_,b,A,Cn.backCCW,Le,fe,d.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,d.paint,m.transform.zoom,ge,m.style.terrain&&ne.centroidVertexBuffer)}}function Dh(m,o,d,p,_,b,A){const M=m.context,P=M.gl,R=d.fbo;if(!R)return;const k=m.useProgram("hillshade"),U=m.style.terrain&&m.style.terrain.getTerrainData(o);M.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,R.colorAttachment.get()),k.draw(M,P.TRIANGLES,_,b,A,Cn.disabled,((H,ie,te,ne)=>{const fe=te.paint.get("hillshade-shadow-color"),ge=te.paint.get("hillshade-highlight-color"),xe=te.paint.get("hillshade-accent-color");let re=te.paint.get("hillshade-illumination-direction")*(Math.PI/180);te.paint.get("hillshade-illumination-anchor")==="viewport"&&(re-=H.transform.angle);const Ee=!H.options.moving;return{u_matrix:ne?ne.posMatrix:H.transform.calculatePosMatrix(ie.tileID.toUnwrapped(),Ee),u_image:0,u_latrange:Se(0,ie.tileID),u_light:[te.paint.get("hillshade-exaggeration"),re],u_shadow:fe,u_highlight:ge,u_accent:xe}})(m,d,p,U?o:null),U,p.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function up(m,o,d,p,_,b){const A=m.context,M=A.gl,P=o.dem;if(P&&P.data){const R=P.dim,k=P.stride,U=P.getPixels();if(A.activeTexture.set(M.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(k),o.demTexture){const ie=o.demTexture;ie.update(U,{premultiply:!1}),ie.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else o.demTexture=new Z(A,U,M.RGBA,{premultiply:!1}),o.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);A.activeTexture.set(M.TEXTURE0);let H=o.fbo;if(!H){const ie=new Z(A,{width:R,height:R,data:null},M.RGBA);ie.bind(M.LINEAR,M.CLAMP_TO_EDGE),H=o.fbo=A.createFramebuffer(R,R,!0),H.colorAttachment.set(ie.texture)}A.bindFramebuffer.set(H.framebuffer),A.viewport.set([0,0,R,R]),m.useProgram("hillshadePrepare").draw(A,M.TRIANGLES,p,_,b,Cn.disabled,((ie,te)=>{const ne=te.stride,fe=l.create();return l.ortho(fe,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(fe,fe,[0,-l.EXTENT,0]),{u_matrix:fe,u_image:1,u_dimension:[ne,ne],u_zoom:ie.overscaledZ,u_unpack:te.getUnpackVector()}})(o.tileID,P),null,d.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function Xc(m,o,d,p,_,b){const A=p.paint.get("raster-fade-duration");if(!b&&A>0){const M=l.exported.now(),P=(M-m.timeAdded)/A,R=o?(M-o.timeAdded)/A:-1,k=d.getSource(),U=_.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),H=!o||Math.abs(o.tileID.overscaledZ-U)>Math.abs(m.tileID.overscaledZ-U),ie=H&&m.refreshedUponExpiration?1:l.clamp(H?P:1-R,0,1);return m.refreshedUponExpiration&&P>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-ie}:{opacity:ie,mix:0}}return{opacity:1,mix:0}}const qc=new l.Color(1,0,0,1),ns=new l.Color(0,1,0,1),hp=new l.Color(0,0,1,1),Oh=new l.Color(1,0,1,1),dp=new l.Color(0,1,1,1);function ea(m,o,d,p){Ha(m,0,o+d/2,m.transform.width,d,p)}function Gl(m,o,d,p){Ha(m,o-d/2,0,d,m.transform.height,p)}function Ha(m,o,d,p,_,b){const A=m.context,M=A.gl;M.enable(M.SCISSOR_TEST),M.scissor(o*m.pixelRatio,d*m.pixelRatio,p*m.pixelRatio,_*m.pixelRatio),A.clear({color:b}),M.disable(M.SCISSOR_TEST)}function N_(m,o,d){const p=m.context,_=p.gl,b=d.posMatrix,A=m.useProgram("debug"),M=Wt.disabled,P=bn.disabled,R=m.colorModeForRenderPass(),k="$debug",U=m.style.terrain&&m.style.terrain.getTerrainData(d);p.activeTexture.set(_.TEXTURE0),m.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const H=o.getTileByID(d.key).latestRawTileData,ie=Math.floor((H&&H.byteLength||0)/1024),te=o.getTile(d).tileSize,ne=512/Math.min(te,512)*(d.overscaledZ/m.transform.zoom)*.5;let fe=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(fe+=` => ${d.overscaledZ}`),function(ge,xe){ge.initDebugOverlayCanvas();const re=ge.debugOverlayCanvas,Ee=ge.context.gl,be=ge.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,re.width,re.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(xe,5,5),be.strokeText(xe,5,5),ge.debugOverlayTexture.update(re),ge.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}(m,`${fe} ${ie}kB`),A.draw(p,_.TRIANGLES,M,P,En.alphaBlended,Cn.disabled,W(b,l.Color.transparent,ne),null,k,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),A.draw(p,_.LINE_STRIP,M,P,R,Cn.disabled,W(b,l.Color.red),U,k,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function $c(m,o,d){const p=m.context,_=p.gl,b=m.colorModeForRenderPass(),A=new Wt(_.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D),M=m.useProgram("terrain"),P=o.getTerrainMesh(),R=o.getTerrainData(d.tileID);p.bindFramebuffer.set(null),p.viewport.set([0,0,m.width,m.height]),p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,o.getRTTFramebuffer().colorAttachment.get());const k=m.transform.calculatePosMatrix(d.tileID.toUnwrapped());M.draw(p,_.TRIANGLES,A,bn.disabled,b,Cn.backCCW,{u_matrix:k,u_texture:0},R,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}function fp(m,o,d,p){const _=m.context,b=d.tileSize*o.qualityFactor;d.textures[p]||(d.textures[p]=m.getTileTexture(b)||new Z(_,{width:b,height:b,data:null},_.gl.RGBA),d.textures[p].bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),p===0&&o.sourceCache.renderHistory.unshift(d.tileID.key));const A=o.getRTTFramebuffer();A.colorAttachment.set(d.textures[p].texture),_.bindFramebuffer.set(A.framebuffer),_.viewport.set([0,0,b,b])}class pp{constructor(o){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=o,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=o.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const o=this.painter.style,d=o.terrain;for(const p in o.sourceCaches){this._coordsDescendingInv[p]={};const _=o.sourceCaches[p].getVisibleCoordinates();for(const b of _){const A=d.sourceCache.getTerrainCoords(b);for(const M in A)this._coordsDescendingInv[p][M]||(this._coordsDescendingInv[p][M]=[]),this._coordsDescendingInv[p][M].push(A[M])}}for(const p of o._order){const _=o._layers[p],b=_.source;if(this._renderToTexture[_.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const A in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][A]=this._coordsDescendingInv[b][A].map(M=>M.key).sort().join()}}return this._renderableTiles.forEach(p=>{for(const _ in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[_][p.tileID.key];b&&b!==p.textureCoords[_]&&p.clearTextures(this.painter),d.needsRerender(_,p.tileID)&&p.clearTextures(this.painter)}this._rerender[p.tileID.key]=!p.textures.length}),d.clearRerenderCache(),d.sourceCache.removeOutdated(this.painter),this}renderLayer(o){const d=o.type,p=this.painter,_=p.style._order,b=p.currentLayer,A=b+1===_.length;if(this._renderToTexture[d]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(_[b]),!A))return!0;if(this._renderToTexture[this._prevType]||d==="hillshade"||this._renderToTexture[d]&&A){this._prevType=d;const M=this._stacks.length-1,P=this._stacks[M]||[];for(const R of this._renderableTiles){if(fp(p,p.style.terrain,R,M),this._rerender[R.tileID.key]){p.context.clear({color:l.Color.transparent});for(let k=0;k<P.length;k++){const U=p.style._layers[P[k]],H=U.source?this._coordsDescendingInv[U.source][R.tileID.key]:[R.tileID];p._renderTileClippingMasks(U,H),p.renderLayer(p,p.style.sourceCaches[U.source],U,H),U.source&&(R.textureCoords[U.source]=this._coordsDescendingInvStr[U.source][R.tileID.key])}}$c(p,p.style.terrain,R)}if(d==="hillshade"){this._stacks.push([_[b]]);for(const R of this._renderableTiles){const k=this._coordsDescendingInv[o.source][R.tileID.key];fp(p,p.style.terrain,R,this._stacks.length-1),p.context.clear({color:l.Color.transparent}),p._renderTileClippingMasks(o,k),p.renderLayer(p,p.style.sourceCaches[o.source],o,k),$c(p,p.style.terrain,R)}return!0}return this._renderToTexture[d]}return!1}}const Vl={symbol:function(m,o,d,p,_){if(m.renderPass!=="translucent")return;const b=bn.disabled,A=m.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(M,P,R,k,U,H,ie){const te=P.transform,ne=U==="map",fe=H==="map";for(const ge of M){const xe=k.getTile(ge),re=xe.getBucket(R);if(!re||!re.text||!re.text.segments.get().length)continue;const Ee=l.evaluateSizeForZoom(re.textSizeData,te.zoom),be=Nn(xe,1,P.transform.zoom),Le=Ts(ge.posMatrix,fe,ne,P.transform,be),Re=R.layout.get("icon-text-fit")!=="none"&&re.hasIconData();if(Ee){const Ue=Math.pow(2,te.zoom-xe.tileID.overscaledZ);cp(re,ne,fe,ie,te,Le,ge.posMatrix,Ue,Ee,Re,P.style.terrain?(Pe,it)=>P.style.terrain.getElevation(ge,Pe,it):null)}}}(p,m,d,o,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),_),d.paint.get("icon-opacity").constantOr(1)!==0&&Wc(m,o,d,p,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),b,A),d.paint.get("text-opacity").constantOr(1)!==0&&Wc(m,o,d,p,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),b,A),o.map.showCollisionBoxes&&(ja(m,o,d,p,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),ja(m,o,d,p,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,d,p){if(m.renderPass!=="translucent")return;const _=d.paint.get("circle-opacity"),b=d.paint.get("circle-stroke-width"),A=d.paint.get("circle-stroke-opacity"),M=!d.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(b.constantOr(1)===0||A.constantOr(1)===0))return;const P=m.context,R=P.gl,k=m.depthModeForSublayer(0,Wt.ReadOnly),U=bn.disabled,H=m.colorModeForRenderPass(),ie=[];for(let te=0;te<p.length;te++){const ne=p[te],fe=o.getTile(ne),ge=fe.getBucket(d);if(!ge)continue;const xe=ge.programConfigurations.get(d.id),re=m.useProgram("circle",xe),Ee=ge.layoutVertexBuffer,be=ge.indexBuffer,Le=m.style.terrain&&m.style.terrain.getTerrainData(ne),Re={programConfiguration:xe,program:re,layoutVertexBuffer:Ee,indexBuffer:be,uniformValues:Fc(m,ne,fe,d),terrainData:Le};if(M){const Ue=ge.segments.get();for(const Pe of Ue)ie.push({segments:new l.SegmentVector([Pe]),sortKey:Pe.sortKey,state:Re})}else ie.push({segments:ge.segments,sortKey:0,state:Re})}M&&ie.sort((te,ne)=>te.sortKey-ne.sortKey);for(const te of ie){const{programConfiguration:ne,program:fe,layoutVertexBuffer:ge,indexBuffer:xe,uniformValues:re,terrainData:Ee}=te.state;fe.draw(P,R.TRIANGLES,k,U,H,Cn.disabled,re,Ee,d.id,ge,xe,te.segments,d.paint,m.transform.zoom,ne)}},heatmap:function(m,o,d,p){if(d.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const _=m.context,b=_.gl,A=bn.disabled,M=new En([b.ONE,b.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(P,R,k){const U=P.gl;P.activeTexture.set(U.TEXTURE1),P.viewport.set([0,0,R.width/4,R.height/4]);let H=k.heatmapFbo;if(H)U.bindTexture(U.TEXTURE_2D,H.colorAttachment.get()),P.bindFramebuffer.set(H.framebuffer);else{const ie=U.createTexture();U.bindTexture(U.TEXTURE_2D,ie),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),H=k.heatmapFbo=P.createFramebuffer(R.width/4,R.height/4,!1),function(te,ne,fe,ge){const xe=te.gl;xe.texImage2D(xe.TEXTURE_2D,0,xe.RGBA,ne.width/4,ne.height/4,0,xe.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:xe.UNSIGNED_BYTE,null),ge.colorAttachment.set(fe)}(P,R,ie,H)}})(_,m,d),_.clear({color:l.Color.transparent});for(let P=0;P<p.length;P++){const R=p[P];if(o.hasRenderableParent(R))continue;const k=o.getTile(R),U=k.getBucket(d);if(!U)continue;const H=U.programConfigurations.get(d.id),ie=m.useProgram("heatmap",H),{zoom:te}=m.transform;ie.draw(_,b.TRIANGLES,Wt.disabled,A,M,Cn.disabled,ce(R.posMatrix,k,te,d.paint.get("heatmap-intensity")),null,d.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,d.paint,m.transform.zoom,H)}_.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(_,b){const A=_.context,M=A.gl,P=b.heatmapFbo;if(!P)return;A.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get()),A.activeTexture.set(M.TEXTURE1);let R=b.colorRampTexture;R||(R=b.colorRampTexture=new Z(A,b.colorRamp,M.RGBA)),R.bind(M.LINEAR,M.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(A,M.TRIANGLES,Wt.disabled,bn.disabled,_.colorModeForRenderPass(),Cn.disabled,((k,U,H,ie)=>{const te=l.create();l.ortho(te,0,k.width,k.height,0,0,1);const ne=k.context.gl;return{u_matrix:te,u_world:[ne.drawingBufferWidth,ne.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}})(_,b),null,b.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,b.paint,_.transform.zoom)}(m,d))},line:function(m,o,d,p){if(m.renderPass!=="translucent")return;const _=d.paint.get("line-opacity"),b=d.paint.get("line-width");if(_.constantOr(1)===0||b.constantOr(1)===0)return;const A=m.depthModeForSublayer(0,Wt.ReadOnly),M=m.colorModeForRenderPass(),P=d.paint.get("line-dasharray"),R=d.paint.get("line-pattern"),k=R.constantOr(1),U=d.paint.get("line-gradient"),H=d.getCrossfadeParameters(),ie=k?"linePattern":P?"lineSDF":U?"lineGradient":"line",te=m.context,ne=te.gl;let fe=!0;for(const ge of p){const xe=o.getTile(ge);if(k&&!xe.patternsLoaded())continue;const re=xe.getBucket(d);if(!re)continue;const Ee=re.programConfigurations.get(d.id),be=m.context.program.get(),Le=m.useProgram(ie,Ee),Re=fe||Le.program!==be,Ue=m.style.terrain&&m.style.terrain.getTerrainData(ge),Pe=R.constantOr(null);if(Pe&&xe.imageAtlas){const rt=xe.imageAtlas,Bt=rt.patternPositions[Pe.to.toString()],Ot=rt.patternPositions[Pe.from.toString()];Bt&&Ot&&Ee.setConstantPatternPositions(Bt,Ot)}const it=Ue?ge:null,Ze=k?zt(m,xe,d,H,it):P?Bn(m,xe,d,P,H,it):U?ct(m,xe,d,re.lineClipsArray.length,it):Ge(m,xe,d,it);if(k)te.activeTexture.set(ne.TEXTURE0),xe.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Ee.updatePaintBuffers(H);else if(P&&(Re||m.lineAtlas.dirty))te.activeTexture.set(ne.TEXTURE0),m.lineAtlas.bind(te);else if(U){const rt=re.gradients[d.id];let Bt=rt.texture;if(d.gradientVersion!==rt.version){let Ot=256;if(d.stepInterpolant){const bt=o.getSource().maxzoom,ln=ge.canonical.z===bt?Math.ceil(1<<m.transform.maxZoom-ge.canonical.z):1;Ot=l.clamp(l.nextPowerOfTwo(re.maxLineLength/l.EXTENT*1024*ln),256,te.maxTextureSize)}rt.gradient=l.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:rt.gradient||void 0,clips:re.lineClipsArray}),rt.texture?rt.texture.update(rt.gradient):rt.texture=new Z(te,rt.gradient,ne.RGBA),rt.version=d.gradientVersion,Bt=rt.texture}te.activeTexture.set(ne.TEXTURE0),Bt.bind(d.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}Le.draw(te,ne.TRIANGLES,A,m.stencilModeForClipping(ge),M,Cn.disabled,Ze,Ue,d.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,d.paint,m.transform.zoom,Ee,re.layoutVertexBuffer2),fe=!1}},fill:function(m,o,d,p){const _=d.paint.get("fill-color"),b=d.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const A=m.colorModeForRenderPass(),M=d.paint.get("fill-pattern"),P=m.opaquePassEnabledForLayer()&&!M.constantOr(1)&&_.constantOr(l.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===P){const R=m.depthModeForSublayer(1,m.renderPass==="opaque"?Wt.ReadWrite:Wt.ReadOnly);Nl(m,o,d,p,R,A,!1)}if(m.renderPass==="translucent"&&d.paint.get("fill-antialias")){const R=m.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,Wt.ReadOnly);Nl(m,o,d,p,R,A,!0)}},"fill-extrusion":function(m,o,d,p){const _=d.paint.get("fill-extrusion-opacity");if(_!==0&&m.renderPass==="translucent"){const b=new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D);if(_!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))Ul(m,o,d,p,b,bn.disabled,En.disabled),Ul(m,o,d,p,b,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const A=m.colorModeForRenderPass();Ul(m,o,d,p,b,bn.disabled,A)}}},hillshade:function(m,o,d,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const _=m.context,b=m.depthModeForSublayer(0,Wt.ReadOnly),A=m.colorModeForRenderPass(),[M,P]=m.renderPass==="translucent"?m.stencilConfigForOverlap(p):[{},p];for(const R of P){const k=o.getTile(R);k.needsHillshadePrepare!==void 0&&k.needsHillshadePrepare&&m.renderPass==="offscreen"?up(m,k,d,b,bn.disabled,A):m.renderPass==="translucent"&&Dh(m,R,k,d,b,M[R.overscaledZ],A)}_.viewport.set([0,0,m.width,m.height])},raster:function(m,o,d,p){if(m.renderPass!=="translucent"||d.paint.get("raster-opacity")===0||!p.length)return;const _=m.context,b=_.gl,A=o.getSource(),M=m.useProgram("raster"),P=m.colorModeForRenderPass(),[R,k]=A instanceof vt?[{},p]:m.stencilConfigForOverlap(p),U=k[k.length-1].overscaledZ,H=!m.options.moving;for(const ie of k){const te=m.depthModeForSublayer(ie.overscaledZ-U,d.paint.get("raster-opacity")===1?Wt.ReadWrite:Wt.ReadOnly,b.LESS),ne=o.getTile(ie);ne.registerFadeDuration(d.paint.get("raster-fade-duration"));const fe=o.findLoadedParent(ie,0),ge=Xc(ne,fe,o,d,m.transform,m.style.terrain);let xe,re;const Ee=d.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;_.activeTexture.set(b.TEXTURE0),ne.texture.bind(Ee,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(b.TEXTURE1),fe?(fe.texture.bind(Ee,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),xe=Math.pow(2,fe.tileID.overscaledZ-ne.tileID.overscaledZ),re=[ne.tileID.canonical.x*xe%1,ne.tileID.canonical.y*xe%1]):ne.texture.bind(Ee,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);const be=m.style.terrain&&m.style.terrain.getTerrainData(ie),Le=be?ie:null,Re=Le?Le.posMatrix:m.transform.calculatePosMatrix(ie.toUnwrapped(),H),Ue=vr(Re,re||[0,0],xe||1,ge,d);A instanceof vt?M.draw(_,b.TRIANGLES,te,bn.disabled,P,Cn.disabled,Ue,be,d.id,A.boundsBuffer,m.quadTriangleIndexBuffer,A.boundsSegments):M.draw(_,b.TRIANGLES,te,R[ie.overscaledZ],P,Cn.disabled,Ue,be,d.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,o,d,p){const _=d.paint.get("background-color"),b=d.paint.get("background-opacity");if(b===0)return;const A=m.context,M=A.gl,P=m.transform,R=P.tileSize,k=d.paint.get("background-pattern");if(m.isPatternMissing(k))return;const U=!k&&_.a===1&&b===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==U)return;const H=bn.disabled,ie=m.depthModeForSublayer(0,U==="opaque"?Wt.ReadWrite:Wt.ReadOnly),te=m.colorModeForRenderPass(),ne=m.useProgram(k?"backgroundPattern":"background"),fe=p||P.coveringTiles({tileSize:R,terrain:m.style.terrain});k&&(A.activeTexture.set(M.TEXTURE0),m.imageManager.bind(m.context));const ge=d.getCrossfadeParameters();for(const xe of fe){const re=p?xe.posMatrix:m.transform.calculatePosMatrix(xe.toUnwrapped()),Ee=k?I_(re,b,m,k,{tileID:xe,tileSize:R},ge):C_(re,b,_),be=m.style.terrain&&m.style.terrain.getTerrainData(xe);ne.draw(A,M.TRIANGLES,ie,H,te,Cn.disabled,Ee,be,d.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,o,d){for(let p=0;p<d.length;p++)N_(m,o,d[p])},custom:function(m,o,d){const p=m.context,_=d.implementation;if(m.renderPass==="offscreen"){const b=_.prerender;b&&(m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),b.call(_,p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),p.setStencilMode(bn.disabled);const b=_.renderingMode==="3d"?new Wt(m.context.gl.LEQUAL,Wt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Wt.ReadOnly);p.setDepthMode(b),_.render(p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState(),p.bindFramebuffer.set(null)}}};class kh{constructor(o,d){this.context=new lp(o),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=Jt.maxUnderzooming+Jt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new pt,this.gpuTimers={}}resize(o,d,p){if(this.width=o*p,this.height=d*p,this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const o=this.context,d=new l.PosArray;d.emplaceBack(0,0),d.emplaceBack(l.EXTENT,0),d.emplaceBack(0,l.EXTENT),d.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(d,Rt.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.PosArray;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=o.createVertexBuffer(p,Rt.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const _=new l.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(l.EXTENT,0,l.EXTENT,0),_.emplaceBack(0,l.EXTENT,0,l.EXTENT),_.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(_,Ke.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const b=new l.PosArray;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,Rt.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const A=new l.LineStripIndexArray;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(A);const M=new l.TriangleIndexArray;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(M),this.emptyTexture=new Z(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA);const P=this.context.gl;this.stencilClearMode=new bn({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO)}clearStencil(){const o=this.context,d=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.create();l.ortho(p,0,this.width,this.height,0,0,1),l.scale(p,p,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,d.TRIANGLES,Wt.disabled,this.stencilClearMode,En.disabled,Cn.disabled,Q(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,d){if(this.currentStencilSource===o.source||!o.isTileClipped()||!d||!d.length)return;this.currentStencilSource=o.source;const p=this.context,_=p.gl;this.nextStencilID+d.length>256&&this.clearStencil(),p.setColorMode(En.disabled),p.setDepthMode(Wt.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of d){const M=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,P=this.style.terrain&&this.style.terrain.getTerrainData(A);b.draw(p,_.TRIANGLES,Wt.disabled,new bn({func:_.ALWAYS,mask:0},M,255,_.KEEP,_.KEEP,_.REPLACE),En.disabled,Cn.disabled,Q(A.posMatrix),P,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new bn({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){const d=this.context.gl;return new bn({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,p=o.sort((A,M)=>M.overscaledZ-A.overscaledZ),_=p[p.length-1].overscaledZ,b=p[0].overscaledZ-_+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const A={};for(let M=0;M<b;M++)A[M+_]=new bn({func:d.GEQUAL,mask:255},M+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=b,[A,p]}return[{[_]:bn.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new En([o.CONSTANT_COLOR,o.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?En.unblended:En.alphaBlended}depthModeForSublayer(o,d,p){if(!this.opaquePassEnabledForLayer())return Wt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Wt(p||this.context.gl.LEQUAL,d,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,d){this.style=o,this.options=d,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const p=this.style._order,_=this.style.sourceCaches,b=this.style.terrain&&new pp(this);for(const R in _){const k=_[R];k.used&&k.prepare(this.context)}const A={},M={},P={};for(const R in _){const k=_[R];A[R]=k.getVisibleCoordinates(),M[R]=A[R].slice().reverse(),P[R]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<p.length;R++)if(this.style._layers[p[R]].is3D()){this.opaquePassCutoff=R;break}if(b){this.opaquePassCutoff=0;const R=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||R.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(k,U){const H=k.context,ie=H.gl,te=En.unblended,ne=new Wt(ie.LEQUAL,Wt.ReadWrite,[0,1]),fe=U.getTerrainMesh(),ge=U.sourceCache.getRenderableTiles(),xe=k.useProgram("terrainDepth");H.bindFramebuffer.set(U.getFramebuffer("depth").framebuffer),H.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),H.clear({color:l.Color.transparent,depth:1});for(const re of ge){const Ee=U.getTerrainData(re.tileID),be=k.transform.calculatePosMatrix(re.tileID.toUnwrapped());xe.draw(H,ie.TRIANGLES,ne,bn.disabled,te,Cn.backCCW,{u_matrix:be},Ee,"terrain",fe.vertexBuffer,fe.indexBuffer,fe.segments)}H.bindFramebuffer.set(null),H.viewport.set([0,0,k.width,k.height])}(this,this.style.terrain),function(k,U){const H=k.context,ie=H.gl,te=En.unblended,ne=new Wt(ie.LEQUAL,Wt.ReadWrite,[0,1]),fe=U.getTerrainMesh(),ge=U.getCoordsTexture(),xe=U.sourceCache.getRenderableTiles(),re=k.useProgram("terrainCoords");H.bindFramebuffer.set(U.getFramebuffer("coords").framebuffer),H.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),H.clear({color:l.Color.transparent,depth:1}),U.coordsIndex=[];for(const Ee of xe){const be=U.getTerrainData(Ee.tileID);H.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_2D,ge.texture);const Le=k.transform.calculatePosMatrix(Ee.tileID.toUnwrapped());re.draw(H,ie.TRIANGLES,ne,bn.disabled,te,Cn.backCCW,{u_matrix:Le,u_terrain_coords_id:(255-U.coordsIndex.length)/255,u_texture:0},be,"terrain",fe.vertexBuffer,fe.indexBuffer,fe.segments),U.coordsIndex.push(Ee.tileID.key)}H.bindFramebuffer.set(null),H.viewport.set([0,0,k.width,k.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const R of p){const k=this.style._layers[R];if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const U=M[k.source];(k.type==="custom"||U.length)&&this.renderLayer(this,_[k.source],k,U)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!b)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[p[this.currentLayer]],k=_[R.source],U=A[R.source];this._renderTileClippingMasks(R,U),this.renderLayer(this,k,R,U)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const R=this.style._layers[p[this.currentLayer]],k=_[R.source];if(b&&b.renderLayer(R))continue;const U=(R.type==="symbol"?P:M)[R.source];this._renderTileClippingMasks(R,A[R.source]),this.renderLayer(this,k,R,U)}if(this.options.showTileBoundaries){let R,k;Object.values(this.style._layers).forEach(U=>{U.source&&!U.isHidden(this.transform.zoom)&&(U.source!==(k&&k.id)&&(k=this.style.sourceCaches[U.source]),(!R||R.getSource().maxzoom<k.getSource().maxzoom)&&(R=k))}),R&&Vl.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const k=R.transform.padding;ea(R,R.transform.height-(k.top||0),3,qc),ea(R,k.bottom||0,3,ns),Gl(R,k.left||0,3,hp),Gl(R,R.transform.width-(k.right||0),3,Oh);const U=R.transform.centerPoint;(function(H,ie,te,ne){Ha(H,ie-1,te-10,2,20,ne),Ha(H,ie-10,te-1,20,2,ne)})(R,U.x,R.transform.height-U.y,dp)}(this),this.context.setDefault()}renderLayer(o,d,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(_||[]).length)&&(this.id=p.id,this.gpuTimingStart(p),Vl[p.type](o,d,p,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let p=this.gpuTimers[o.id];p||(p=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),p.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const d={};for(const p in o){const _=o[p],b=this.context.extTimerQuery,A=b.getQueryObjectEXT(_.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(_.query),d[p]=A}return d}translatePosMatrix(o,d,p,_,b){if(!p[0]&&!p[1])return o;const A=b?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(A){const R=Math.sin(A),k=Math.cos(A);p=[p[0]*k-p[1]*R,p[0]*R+p[1]*k]}const M=[b?p[0]:Nn(d,p[0],this.transform.zoom),b?p[1]:Nn(d,p[1],this.transform.zoom),0],P=new Float32Array(16);return l.translate(P,o,M),P}saveTileTexture(o){const d=this._tileTextures[o.size[0]];d?d.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const d=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!d||!p}useProgram(o,d){this.cache=this.cache||{};const p=o+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Oa(this.context,o,Si[o],d,wh[o],this._showOverdrawInspector,this.style.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Z(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Zc{constructor(o,d){this.points=o,this.planes=d}static fromInvProjectionMatrix(o,d,p){const _=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const P=1/(M=l.transformMat4([],M,o))[3]/d*_;return l.mul$1(M,M,[P,P,1/M[3],P])}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const P=l.sub([],b[M[0]],b[M[1]]),R=l.sub([],b[M[2]],b[M[1]]),k=l.normalize([],l.cross([],P,R)),U=-l.dot(k,b[M[1]]);return k.concat(U)});return new Zc(b,A)}}class jl{constructor(o,d){this.min=o,this.max=d,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(o){const d=[o%2==0,o<2],p=l.clone$2(this.min),_=l.clone$2(this.max);for(let b=0;b<d.length;b++)p[b]=d[b]?this.min[b]:this.center[b],_[b]=d[b]?this.center[b]:this.max[b];return _[2]=this.max[2],new jl(p,_)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<o.planes.length;_++){const b=o.planes[_];let A=0;for(let M=0;M<d.length;M++)l.dot$1(b,d[M])>=0&&A++;if(A===0)return 0;A!==d.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let b=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let M=0;M<o.points.length;M++){const P=o.points[M][_]-this.min[_];b=Math.min(b,P),A=Math.max(A,P)}if(A<0||b>this.max[_]-this.min[_])return 0}return 1}}class Wa{constructor(o=0,d=0,p=0,_=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=p,this.right=_}interpolate(o,d,p){return d.top!=null&&o.top!=null&&(this.top=l.number(o.top,d.top,p)),d.bottom!=null&&o.bottom!=null&&(this.bottom=l.number(o.bottom,d.bottom,p)),d.left!=null&&o.left!=null&&(this.left=l.number(o.left,d.left,p)),d.right!=null&&o.right!=null&&(this.right=l.number(o.right,d.right,p)),this}getCenter(o,d){const p=l.clamp((this.left+o-this.right)/2,0,o),_=l.clamp((this.top+d-this.bottom)/2,0,d);return new l.pointGeometry(p,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Wa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Hl{constructor(o,d,p,_,b){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=b===void 0||!!b,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=p??0,this._maxPitch=_??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Wa,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const o=new Hl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.tileSize=this.tileSize,o.latRange=this.latRange,o.width=this.width,o.height=this.height,o._center=this._center,o._elevation=this._elevation,o.zoom=this.zoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const d=-l.wrap(o,-180,180)*Math.PI/180;var p;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(p=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,b,A){var M=b[0],P=b[1],R=b[2],k=b[3],U=Math.sin(A),H=Math.cos(A);_[0]=M*H+R*U,_[1]=P*H+k*U,_[2]=M*-U+R*H,_[3]=P*-U+k*H}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=l.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,p){this._unmodified=!1,this._edgeInsets.interpolate(o,d,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new l.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.pointGeometry(0,0)),_=this.pointCoordinate(new l.pointGeometry(this.width,0)),b=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),A=this.pointCoordinate(new l.pointGeometry(0,this.height)),M=Math.floor(Math.min(p.x,_.x,b.x,A.x)),P=Math.floor(Math.max(p.x,_.x,b.x,A.x)),R=1;for(let k=M-R;k<=P+R;k++)k!==0&&d.push(new l.UnwrappedTileID(k,o))}return d}coveringTiles(o){var d,p;let _=this.coveringZoomLevel(o);const b=_;if(o.minzoom!==void 0&&_<o.minzoom)return[];o.maxzoom!==void 0&&_>o.maxzoom&&(_=o.maxzoom);const A=this.pointCoordinate(this.getCameraPoint()),M=l.MercatorCoordinate.fromLngLat(this.center),P=Math.pow(2,_),R=[P*A.x,P*A.y,0],k=[P*M.x,P*M.y,0],U=Zc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let H=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(H=_);const ie=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,te=re=>({aabb:new jl([re*P,0,0],[(re+1)*P,P,0]),zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),ne=[],fe=[],ge=_,xe=o.reparseOverscaled?b:_;if(this._renderWorldCopies)for(let re=1;re<=3;re++)ne.push(te(-re)),ne.push(te(re));for(ne.push(te(0));ne.length>0;){const re=ne.pop(),Ee=re.x,be=re.y;let Le=re.fullyVisible;if(!Le){const rt=re.aabb.intersects(U);if(rt===0)continue;Le=rt===2}const Re=o.terrain?R:k,Ue=re.aabb.distanceX(Re),Pe=re.aabb.distanceY(Re),it=Math.max(Math.abs(Ue),Math.abs(Pe)),Ze=ie+(1<<ge-re.zoom)-2;if(re.zoom===ge||it>Ze&&re.zoom>=H){const rt=ge-re.zoom,Bt=R[0]-.5-(Ee<<rt),Ot=R[1]-.5-(be<<rt);fe.push({tileID:new l.OverscaledTileID(re.zoom===ge?xe:re.zoom,re.wrap,re.zoom,Ee,be),distanceSq:l.sqrLen([k[0]-.5-Ee,k[1]-.5-be]),tileDistanceToCamera:Math.sqrt(Bt*Bt+Ot*Ot)})}else for(let rt=0;rt<4;rt++){const Bt=(Ee<<1)+rt%2,Ot=(be<<1)+(rt>>1),bt=re.zoom+1;let ln=re.aabb.quadrant(rt);if(o.terrain){const cn=new l.OverscaledTileID(bt,re.wrap,bt,Bt,Ot),qt=o.terrain.getMinMaxElevation(cn),Zt=(d=qt.minElevation)!==null&&d!==void 0?d:this.elevation,fn=(p=qt.maxElevation)!==null&&p!==void 0?p:this.elevation;ln=new jl([ln.min[0],ln.min[1],Zt],[ln.max[0],ln.max[1],fn])}ne.push({aabb:ln,zoom:bt,x:Bt,y:Ot,wrap:re.wrap,fullyVisible:Le})}}return fe.sort((re,Ee)=>re.distanceSq-Ee.distanceSq).map(re=>re.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const d=l.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(o.lng)*this.worldSize,l.mercatorYfromLat(d)*this.worldSize)}unproject(o){return new l.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(o){this.freezeElevation||(this.elevation=o?this.getElevation(this._center,o):0)}getElevation(o,d){const p=l.MercatorCoordinate.fromLngLat(o),_=(1<<this.tileZoom)*l.EXTENT,b=p.x*_,A=p.y*_,M=Math.floor(b/l.EXTENT),P=Math.floor(A/l.EXTENT),R=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,M,P);return d.getElevation(R,b%l.EXTENT,A%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const d=this.pointLocation(this.centerPoint,o),p=this.getElevation(d,o);if(!(this.elevation-p))return;const _=this.getCameraPosition(),b=l.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),A=l.MercatorCoordinate.fromLngLat(d,p),M=b.x-A.x,P=b.y-A.y,R=b.z-A.z,k=Math.sqrt(M*M+P*P+R*R),U=this.scaleZoom(this.cameraToCenterDistance/k/this.tileSize);this._elevation=p,this._center=d,this.zoom=U}setLocationAtPoint(o,d){const p=this.pointCoordinate(d),_=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(o),A=new l.MercatorCoordinate(b.x-(p.x-_.x),b.y-(p.y-_.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,d){return d?this.coordinatePoint(this.locationCoordinate(o),this.getElevation(o,d),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,d){return this.coordinateLocation(this.pointCoordinate(o,d))}locationCoordinate(o){return l.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,d){if(d){const H=d.pointCoordinate(o);if(H!=null)return H}const p=[o.x,o.y,0,1],_=[o.x,o.y,1,1];l.transformMat4(p,p,this.pixelMatrixInverse),l.transformMat4(_,_,this.pixelMatrixInverse);const b=p[3],A=_[3],M=p[1]/b,P=_[1]/A,R=p[2]/b,k=_[2]/A,U=R===k?0:(0-R)/(k-R);return new l.MercatorCoordinate(l.number(p[0]/b,_[0]/A,U)/this.worldSize,l.number(M,P,U)/this.worldSize)}coordinatePoint(o,d=0,p=this.pixelMatrix){const _=[o.x*this.worldSize,o.y*this.worldSize,d,1];return l.transformMat4(_,_,p),new l.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,o))).extend(this.pointLocation(new l.pointGeometry(this.width,o))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,d=!1){const p=o.key,_=d?this._alignedPosMatrixCache:this._posMatrixCache;if(_[p])return _[p];const b=o.canonical,A=this.worldSize/this.zoomScale(b.z),M=b.x+Math.pow(2,b.z)*o.wrap,P=l.identity(new Float64Array(16));return l.translate(P,P,[M*A,b.y*A,0]),l.scale(P,P,[A/l.EXTENT,A/l.EXTENT,1]),l.multiply(P,d?this.alignedProjMatrix:this.projMatrix,P),_[p]=new Float32Array(P),_[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,d,p,_,b=-90,A=90,M=-180,P=180;const R=this.size,k=this._unmodified;if(this.latRange){const ie=this.latRange;b=l.mercatorYfromLat(ie[1])*this.worldSize,A=l.mercatorYfromLat(ie[0])*this.worldSize,o=A-b<R.y?R.y/(A-b):0}if(this.lngRange){const ie=this.lngRange;M=l.wrap(l.mercatorXfromLng(ie[0])*this.worldSize,0,this.worldSize),P=l.wrap(l.mercatorXfromLng(ie[1])*this.worldSize,0,this.worldSize),P<M&&(P+=this.worldSize),d=P-M<R.x?R.x/(P-M):0}const U=this.point,H=Math.max(d||0,o||0);if(H)return this.center=this.unproject(new l.pointGeometry(d?(P+M)/2:U.x,o?(A+b)/2:U.y)),this.zoom+=this.scaleZoom(H),this._unmodified=k,void(this._constraining=!1);if(this.latRange){const ie=U.y,te=R.y/2;ie-te<b&&(_=b+te),ie+te>A&&(_=A-te)}if(this.lngRange){const ie=(M+P)/2,te=l.wrap(U.x,ie-this.worldSize/2,ie+this.worldSize/2),ne=R.x/2;te-ne<M&&(p=M+ne),te+ne>P&&(p=P-ne)}p===void 0&&_===void 0||(this.center=this.unproject(new l.pointGeometry(p!==void 0?p:U.x,_!==void 0?_:U.y)).wrap()),this._unmodified=k,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,d=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=l.identity(new Float64Array(16));l.scale(_,_,[this.width/2,-this.height/2,1]),l.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=l.identity(new Float64Array(16)),l.scale(_,_,[1,-1,1]),l.translate(_,_,[-1,-1,0]),l.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const b=Math.PI/2+this._pitch,A=this._fov*(.5+o.y/this.height),M=Math.sin(A)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-b-A,.01,Math.PI-.01)),P=this.getHorizon(),R=2*Math.atan(P/this.cameraToCenterDistance)*(.5+o.y/(2*P)),k=Math.sin(R)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-b-R,.01,Math.PI-.01)),U=Math.cos(Math.PI/2-this._pitch)*M+this.cameraToSeaLevelDistance,H=Math.cos(Math.PI/2-this._pitch)*k+this.cameraToSeaLevelDistance,ie=1.01*Math.min(U,H),te=this.height/50;_=new Float64Array(16),l.perspective(_,this._fov,this.width/this.height,te,ie),_[8]=2*-o.x/this.width,_[9]=2*o.y/this.height,l.scale(_,_,[1,-1,1]),l.translate(_,_,[0,0,-this.cameraToCenterDistance]),l.rotateX(_,_,this._pitch),l.rotateZ(_,_,this.angle),l.translate(_,_,[-d,-p,0]),this.mercatorMatrix=l.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),l.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_),l.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=l.invert([],_),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const ne=this.width%2/2,fe=this.height%2/2,ge=Math.cos(this.angle),xe=Math.sin(this.angle),re=d-Math.round(d)+ge*ne+xe*fe,Ee=p-Math.round(p)+ge*fe+xe*ne,be=new Float64Array(_);if(l.translate(be,be,[re>.5?re-1:re,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=be,_=l.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new l.pointGeometry(0,0)),d=[o.x*this.worldSize,o.y*this.worldSize,0,1];return l.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,o))}getCameraQueryGeometry(o){const d=this.getCameraPoint();if(o.length===1)return[o[0],d];{let p=d.x,_=d.y,b=d.x,A=d.y;for(const M of o)p=Math.min(p,M.x),_=Math.min(_,M.y),b=Math.max(b,M.x),A=Math.max(A,M.y);return[new l.pointGeometry(p,_),new l.pointGeometry(b,_),new l.pointGeometry(b,A),new l.pointGeometry(p,A),new l.pointGeometry(p,_)]}}}class mp{constructor(o){this._hashName=o&&encodeURIComponent(o),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(d,p){let _=!1,b=null;const A=()=>{b=null,_&&(d(),b=setTimeout(A,300),_=!1)};return()=>(_=!0,b||A(),b)}(this._updateHashUnthrottled.bind(this))}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const d=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,_),A=Math.round(d.lng*b)/b,M=Math.round(d.lat*b)/b,P=this._map.getBearing(),R=this._map.getPitch();let k="";if(k+=o?`/${A}/${M}/${p}`:`${p}/${M}/${A}`,(P||R)&&(k+="/"+Math.round(10*P)/10),R&&(k+=`/${Math.round(R)}`),this._hashName){const U=this._hashName;let H=!1;const ie=window.location.hash.slice(1).split("&").map(te=>{const ne=te.split("=")[0];return ne===U?(H=!0,`${ne}=${k}`):te}).filter(te=>te);return H||ie.push(`${U}=${k}`),`#${ie.join("&")}`}return`#${k}`}_getCurrentHash(){const o=window.location.hash.replace("#","");if(this._hashName){let d;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(d=p)}),(d&&d[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:d,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,o)}catch{}}}const Wl={linearity:.3,easing:l.bezier(0,0,.3,1)},gp=l.extend({deceleration:2500,maxSpeed:1400},Wl),_p=l.extend({deceleration:20,maxSpeed:1400},Wl),yp=l.extend({deceleration:1e3,maxSpeed:360},Wl),Xa=l.extend({deceleration:1e3,maxSpeed:90},Wl);class vp{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=l.exported.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)d.zoom+=b.zoomDelta||0,d.bearing+=b.bearingDelta||0,d.pitch+=b.pitchDelta||0,b.panDelta&&d.pan._add(b.panDelta),b.around&&(d.around=b.around),b.pinchAround&&(d.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(d.pan.mag()){const b=ql(d.pan.mag(),p,l.extend({},gp,o||{}));_.offset=d.pan.mult(b.amount/d.pan.mag()),_.center=this._map.transform.center,Xl(_,b)}if(d.zoom){const b=ql(d.zoom,p,_p);_.zoom=this._map.transform.zoom+b.amount,Xl(_,b)}if(d.bearing){const b=ql(d.bearing,p,yp);_.bearing=this._map.transform.bearing+l.clamp(b.amount,-179,179),Xl(_,b)}if(d.pitch){const b=ql(d.pitch,p,Xa);_.pitch=this._map.transform.pitch+b.amount,Xl(_,b)}if(_.zoom||_.bearing){const b=d.pinchAround===void 0?d.around:d.pinchAround;_.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),l.extend(_,{noMoveStart:!0})}}function Xl(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function ql(m,o,d){const{maxSpeed:p,linearity:_,deceleration:b}=d,A=l.clamp(m*_/(o/1e3),-p,p),M=Math.abs(A)/(b*_);return{easing:d.easing,duration:1e3*M,amount:A*(M/2)}}class br extends l.Event{constructor(o,d,p,_={}){const b=S.mousePos(d.getCanvasContainer(),p),A=d.unproject(b);super(o,l.extend({point:b,lngLat:A,originalEvent:p},_)),this._defaultPrevented=!1,this.target=d}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class $l extends l.Event{constructor(o,d,p){const _=o==="touchend"?p.changedTouches:p.touches,b=S.touchPos(d.getCanvasContainer(),_),A=b.map(P=>d.unproject(P)),M=b.reduce((P,R,k,U)=>P.add(R.div(U.length)),new l.pointGeometry(0,0));super(o,{points:b,point:M,lngLats:A,lngLat:d.unproject(M),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class wr extends l.Event{constructor(o,d,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class U_{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new wr(o.type,this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new br(o.type,this._map,o))}mouseup(o){this._map.fire(new br(o.type,this._map,o))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new br(o.type,this._map,o))}dblclick(o){return this._firePreventable(new br(o.type,this._map,o))}mouseover(o){this._map.fire(new br(o.type,this._map,o))}mouseout(o){this._map.fire(new br(o.type,this._map,o))}touchstart(o){return this._firePreventable(new $l(o.type,this._map,o))}touchmove(o){this._map.fire(new $l(o.type,this._map,o))}touchend(o){this._map.fire(new $l(o.type,this._map,o))}touchcancel(o){this._map.fire(new $l(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class So{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new br(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new br(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xp{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(S.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const p=d;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=S.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(_.x,p.x),A=Math.max(_.x,p.x),M=Math.min(_.y,p.y),P=Math.max(_.y,p.y);S.setTransform(this._box,`translate(${b}px,${M}px)`),this._box.style.width=A-b+"px",this._box.style.height=P-M+"px"}mouseupWindow(o,d){if(!this._active||o.button!==0)return;const p=this._startPos,_=d;if(this.reset(),S.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(S.remove(this._box),this._box=null),S.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new l.Event(o,{originalEvent:d}))}}function Js(m,o){if(m.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${o.length}`);const d={};for(let p=0;p<m.length;p++)d[m[p].identifier]=o[p];return d}class Zl{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,d,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const b=new l.pointGeometry(0,0);for(const A of _)b._add(A);return b.div(_.length)}(d),this.touches=Js(p,d)))}touchmove(o,d,p){if(this.aborted||!this.centroid)return;const _=Js(p,d);for(const b in this.touches){const A=this.touches[b],M=_[b];(!M||M.dist(A)>30)&&(this.aborted=!0)}}touchend(o,d,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Fh{constructor(o){this.singleTap=new Zl(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,d,p){this.singleTap.touchstart(o,d,p)}touchmove(o,d,p){this.singleTap.touchmove(o,d,p)}touchend(o,d,p){const _=this.singleTap.touchend(o,d,p);if(_){const b=o.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(_)<30;if(b&&A||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class G_{constructor(){this._zoomIn=new Fh({numTouches:1,numTaps:2}),this._zoomOut=new Fh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,p){this._zoomIn.touchstart(o,d,p),this._zoomOut.touchstart(o,d,p)}touchmove(o,d,p){this._zoomIn.touchmove(o,d,p),this._zoomOut.touchmove(o,d,p)}touchend(o,d,p){const _=this._zoomIn.touchend(o,d,p),b=this._zoomOut.touchend(o,d,p);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(_)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const V_={0:1,2:2};class Jc{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,d){return!1}_move(o,d){return{}}mousedown(o,d){if(this._lastPoint)return;const p=S.mouseButton(o);this._correctButton(o,p)&&(this._lastPoint=d,this._eventButton=p)}mousemoveWindow(o,d){const p=this._lastPoint;if(p){if(o.preventDefault(),function(_,b){const A=V_[b];return _.buttons===void 0||(_.buttons&A)!==A}(o,this._eventButton))this.reset();else if(this._moved||!(d.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(p,d)}}mouseupWindow(o){this._lastPoint&&S.mouseButton(o)===this._eventButton&&(this._moved&&S.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jl extends Jc{mousedown(o,d){super.mousedown(o,d),this._lastPoint&&(this._active=!0)}_correctButton(o,d){return d===0&&!o.ctrlKey}_move(o,d){return{around:d,panDelta:d.sub(o)}}}class Ks extends Jc{_correctButton(o,d){return d===0&&o.ctrlKey||d===2}_move(o,d){const p=.8*(d.x-o.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(o){o.preventDefault()}}class at extends Jc{_correctButton(o,d){return d===0&&o.ctrlKey||d===2}_move(o,d){const p=-.5*(d.y-o.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(o){o.preventDefault()}}class bp{constructor(o,d){this._minTouches=o.cooperativeGestures?2:1,this._clickTolerance=o.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(o,d,p){return this._calculateTransform(o,d,p)}touchmove(o,d,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(o,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,d,p)}touchend(o,d,p){this._calculateTransform(o,d,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,p){p.length>0&&(this._active=!0);const _=Js(p,d),b=new l.pointGeometry(0,0),A=new l.pointGeometry(0,0);let M=0;for(const R in _){const k=_[R],U=this._touches[R];U&&(b._add(k),A._add(k.sub(U)),M++,_[R]=k)}if(this._touches=_,M<this._minTouches||!A.mag())return;const P=A.div(M);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ta{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,d,p){return{}}touchstart(o,d,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,p){if(!this._firstTwoTouches)return;o.preventDefault();const[_,b]=this._firstTwoTouches,A=Co(p,d,_),M=Co(p,d,b);if(!A||!M)return;const P=this._aroundCenter?null:A.add(M).div(2);return this._move([A,M],P,o)}touchend(o,d,p){if(!this._firstTwoTouches)return;const[_,b]=this._firstTwoTouches,A=Co(p,d,_),M=Co(p,d,b);A&&M||(this._active&&S.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Co(m,o,d){for(let p=0;p<m.length;p++)if(m[p].identifier===d)return o[p]}function zh(m,o){return Math.log(m/o)/Math.LN2}class et extends ta{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(zh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zh(this._distance,p),pinchAround:d}}}function Kc(m,o){return 180*m.angleWith(o)/Math.PI}class j_ extends ta{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d){const p=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Kc(this._vector,p),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,p=Kc(o,this._startVector);return Math.abs(p)<d}}function Nh(m){return Math.abs(m.y)>Math.abs(m.x)}class Uh extends ta{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,d,p){super.touchstart(o,d,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,Nh(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=o[0].sub(this._lastPoints[0]),b=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,b,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(_.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(o,d,p){if(this._valid!==void 0)return this._valid;const _=o.mag()>=2,b=d.mag()>=2;if(!_&&!b)return;if(!_||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=o.y>0==d.y>0;return Nh(o)&&Nh(d)&&A}}const wp={panStep:100,bearingStep:15,pitchStep:10};class Ap{constructor(){const o=wp;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,p=0,_=0,b=0,A=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),A=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:M=>{const P=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:H_,zoom:d?Math.round(P)+d*(o.shiftKey?2:1):P,bearing:M.getBearing()+p*this._bearingStep,pitch:M.getPitch()+_*this._pitchStep,offset:[-b*this._panStep,-A*this._panStep],center:M.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function H_(m){return m*(2-m)}const Ep=4.000244140625;class Gh{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;o.preventDefault()}let d=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=l.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,d!==0&&d%Ep==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=S.mousePos(this._el,o);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Ep?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&P!==0&&(P=1/P);const R=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(R*P))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,p=this._startZoom,_=this._easing;let b,A=!1;if(this._type==="wheel"&&p&&_){const M=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),P=_(M);b=l.number(p,d,P),M<1?this._frameId||(this._frameId=!0):A=!0}else b=d,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:b-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=l.ease;if(this._prevEase){const p=this._prevEase,_=(l.exported.now()-p.start)/p.duration,b=p.easing(_+.01)-p.easing(_),A=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-A*A);d=l.bezier(A,M,.25,1)}return this._prevEase={start:l.exported.now(),duration:o,easing:d},d}reset(){this._active=!1}}class Vh{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jh{constructor(){this.reset()}reset(){this._active=!1}dblclick(o,d){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(o.shiftKey?-1:1),around:p.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hh{constructor(){this._tap=new Fh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,d,p){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=d[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(o,d,p))}touchmove(o,d,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=d[0],b=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,d,p)}touchend(o,d,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(o,d,p)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rr{constructor(o,d,p){this._el=o,this._mousePan=d,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Io{constructor(o,d,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Tp{constructor(o,d,p,_){this._el=o,this._touchZoom=d,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qa=m=>m.zoom||m.drag||m.pitch||m.rotate;class Wh extends l.Event{}function Kl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Sp{constructor(o,d){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vp(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),l.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,b,A]of this._listeners)S.addEventListener(_,b,_===document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[o,d,p]of this._listeners)S.removeEventListener(o,d,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const d=this._map,p=d.getCanvasContainer();this._add("mapEvent",new U_(d,o));const _=d.boxZoom=new xp(d,o);this._add("boxZoom",_);const b=new G_,A=new jh;d.doubleClickZoom=new Vh(A,b),this._add("tapZoom",b),this._add("clickZoom",A);const M=new Hh;this._add("tapDragZoom",M);const P=d.touchPitch=new Uh(d);this._add("touchPitch",P);const R=new Ks(o),k=new at(o);d.dragRotate=new Io(o,R,k),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const U=new Jl(o),H=new bp(o,d);d.dragPan=new rr(p,U,H),this._add("mousePan",U),this._add("touchPan",H,["touchZoom","touchRotate"]);const ie=new j_,te=new et;d.touchZoomRotate=new Tp(p,te,ie,M),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]);const ne=d.scrollZoom=new Gh(d,this);this._add("scrollZoom",ne,["mousePan"]);const fe=d.keyboard=new Ap;this._add("keyboard",fe),this._add("blockableMapEvent",new So(d));for(const ge of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[ge]&&d[ge].enable(o[ge])}_add(o,d,p){this._handlers.push({handlerName:o,handler:d,allowed:p}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qa(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,d,p){for(const _ in o)if(_!==p&&(!d||d.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const d=[];for(const p of o)this._el.contains(p.target)&&d.push(p);return d}handleEvent(o,d){if(o.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const p=o.type==="renderFrame"?void 0:o,_={needsRenderFrame:!1},b={},A={},M=o.touches,P=M?this._getMapTouches(M):void 0,R=P?S.touchPos(this._el,P):S.mousePos(this._el,o);for(const{handlerName:H,handler:ie,allowed:te}of this._handlers){if(!ie.isEnabled())continue;let ne;this._blockedByActive(A,te,H)?ie.reset():ie[d||o.type]&&(ne=ie[d||o.type](o,R,P),this.mergeHandlerResult(_,b,ne,H,p),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||ie.isActive())&&(A[H]=ie)}const k={};for(const H in this._previousActiveHandlers)A[H]||(k[H]=p);this._previousActiveHandlers=A,(Object.keys(k).length||Kl(_))&&(this._changes.push([_,b,k]),this._triggerRenderFrame()),(Object.keys(A).length||Kl(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=_;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(o,d,p,_,b){if(!p)return;l.extend(o,p);const A={handlerName:_,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(d.zoom=A),p.panDelta!==void 0&&(d.drag=A),p.pitchDelta!==void 0&&(d.pitch=A),p.bearingDelta!==void 0&&(d.rotate=A)}_applyChanges(){const o={},d={},p={};for(const[_,b,A]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new l.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),l.extend(d,b),l.extend(p,A);this._updateMapTransform(o,d,p),this._changes=[]}_updateMapTransform(o,d,p){const _=this._map,b=_.transform,A=_.style&&_.style.terrain;if(!(Kl(o)||A&&this._drag))return this._fireEvents(d,p,!0);let{panDelta:M,zoomDelta:P,bearingDelta:R,pitchDelta:k,around:U,pinchAround:H}=o;H!==void 0&&(U=H),_._stop(!0),U=U||_.transform.centerPoint;const ie=b.pointLocation(M?U.sub(M):U);R&&(b.bearing+=R),k&&(b.pitch+=k),P&&(b.zoom+=P),A?d.drag&&!this._drag?(this._drag={center:b.centerPoint,lngLat:b.pointLocation(U),point:U,handlerName:d.drag.handlerName},_.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&p[this._drag.handlerName]?(_.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):d.drag&&this._drag&&(b.center=b.pointLocation(b.centerPoint.sub(M))):b.setLocationAtPoint(ie,U),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,p,!0)}_fireEvents(o,d,p){const _=qa(this._eventsInProgress),b=qa(o),A={};for(const k in o){const{originalEvent:U}=o[k];this._eventsInProgress[k]||(A[`${k}start`]=U),this._eventsInProgress[k]=o[k]}!_&&b&&this._fireEvent("movestart",b.originalEvent);for(const k in A)this._fireEvent(k,A[k]);b&&this._fireEvent("move",b.originalEvent);for(const k in o){const{originalEvent:U}=o[k];this._fireEvent(k,U)}const M={};let P;for(const k in this._eventsInProgress){const{handlerName:U,originalEvent:H}=this._eventsInProgress[k];this._handlersById[U].isActive()||(delete this._eventsInProgress[k],P=d[U]||H,M[`${k}end`]=P)}for(const k in M)this._fireEvent(k,M[k]);const R=qa(this._eventsInProgress);if(p&&(_||b)&&!R){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;k?(U(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:P})):(this._map.fire(new l.Event("moveend",{originalEvent:P})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new l.Event(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Wh("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Fr={extend:(m,...o)=>l.extend(m,...o),run(m){m()},logToElement(m,o=!1,d="log"){const p=window.document.getElementById(d);p&&(o&&(p.innerHTML=""),p.innerHTML+=`<br>${m}`)}};class In extends l.Evented{constructor(o,d){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,p){return o=l.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,l.extend({offset:o},d),p)}panTo(o,d,p){return this.easeTo(l.extend({center:o},d),p)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,p){return this.easeTo(l.extend({zoom:o},d),p)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,p){return this.easeTo(l.extend({bearing:o},d),p)}resetNorth(o,d){return this.rotateTo(0,l.extend({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=l.LngLatBounds.convert(o);const p=d&&d.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,d)}_cameraForBoxAndBearing(o,d,p,_){const b={top:0,bottom:0,right:0,left:0};if(typeof(_=l.extend({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const be=_.padding;_.padding={top:be,bottom:be,right:be,left:be}}_.padding=l.extend(b,_.padding);const A=this.transform,M=A.padding,P=A.project(l.LngLat.convert(o)),R=A.project(l.LngLat.convert(d)),k=P.rotate(-p*Math.PI/180),U=R.rotate(-p*Math.PI/180),H=new l.pointGeometry(Math.max(k.x,U.x),Math.max(k.y,U.y)),ie=new l.pointGeometry(Math.min(k.x,U.x),Math.min(k.y,U.y)),te=H.sub(ie),ne=(A.width-(M.left+M.right+_.padding.left+_.padding.right))/te.x,fe=(A.height-(M.top+M.bottom+_.padding.top+_.padding.bottom))/te.y;if(fe<0||ne<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ge=Math.min(A.scaleZoom(A.scale*Math.min(ne,fe)),_.maxZoom),xe=l.pointGeometry.convert(_.offset),re=new l.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(p*Math.PI/180),Ee=xe.add(re).mult(A.scale/A.zoomScale(ge));return{center:A.unproject(P.add(R).div(2).sub(Ee)),zoom:ge,bearing:p}}fitBounds(o,d,p){return this._fitInternal(this.cameraForBounds(o,d),d,p)}fitScreenCoordinates(o,d,p,_,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(o)),this.transform.pointLocation(l.pointGeometry.convert(d)),p,_),_,b)}_fitInternal(o,d,p){return o?(delete(d=l.extend(o,d)).padding,d.linear?this.easeTo(d,p):this.flyTo(d,p)):this}jumpTo(o,d){this.stop();const p=this.transform;let _=!1,b=!1,A=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(_=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=l.LngLat.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(b=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(A=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),this.fire(new l.Event("movestart",d)).fire(new l.Event("move",d)),_&&this.fire(new l.Event("zoomstart",d)).fire(new l.Event("zoom",d)).fire(new l.Event("zoomend",d)),b&&this.fire(new l.Event("rotatestart",d)).fire(new l.Event("rotate",d)).fire(new l.Event("rotateend",d)),A&&this.fire(new l.Event("pitchstart",d)).fire(new l.Event("pitch",d)).fire(new l.Event("pitchend",d)),this.fire(new l.Event("moveend",d))}calculateCameraOptionsFromTo(o,d,p,_=0){const b=l.MercatorCoordinate.fromLngLat(o,d),A=l.MercatorCoordinate.fromLngLat(p,_),M=A.x-b.x,P=A.y-b.y,R=A.z-b.z,k=Math.hypot(M,P,R);if(k===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(M,P),H=this.transform.scaleZoom(this.transform.cameraToCenterDistance/k/this.transform.tileSize),ie=180*Math.atan2(M,-P)/Math.PI;let te=180*Math.acos(U/k)/Math.PI;return te=R<0?90-te:90+te,{center:A.toLngLat(),zoom:H,pitch:te,bearing:ie}}easeTo(o,d){this._stop(!1,o.easeId),((o=l.extend({offset:[0,0],duration:500,easing:l.ease},o)).animate===!1||!o.essential&&l.exported.prefersReducedMotion)&&(o.duration=0);const p=this.transform,_=this.getZoom(),b=this.getBearing(),A=this.getPitch(),M=this.getPadding(),P="zoom"in o?+o.zoom:_,R="bearing"in o?this._normalizeBearing(o.bearing,b):b,k="pitch"in o?+o.pitch:A,U="padding"in o?o.padding:p.padding,H=l.pointGeometry.convert(o.offset);let ie=p.centerPoint.add(H);const te=p.pointLocation(ie),ne=l.LngLat.convert(o.center||te);this._normalizeCenter(ne);const fe=p.project(te),ge=p.project(ne).sub(fe),xe=p.zoomScale(P-_);let re,Ee;o.around&&(re=l.LngLat.convert(o.around),Ee=p.locationPoint(re));const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||P!==_,this._rotating=this._rotating||b!==R,this._pitching=this._pitching||k!==A,this._padding=!p.isPaddingEqual(U),this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,be),this._ease(Le=>{if(this._zooming&&(p.zoom=l.number(_,P,Le)),this._rotating&&(p.bearing=l.number(b,R,Le)),this._pitching&&(p.pitch=l.number(A,k,Le)),this._padding&&(p.interpolatePadding(M,U,Le),ie=p.centerPoint.add(H)),re)p.setLocationAtPoint(re,Ee);else{const Re=p.zoomScale(p.zoom-_),Ue=P>_?Math.min(2,xe):Math.max(.5,xe),Pe=Math.pow(Ue,1-Le),it=p.unproject(fe.add(ge.mult(Le*Pe)).mult(Re));p.setLocationAtPoint(p.renderWorldCopies?it.wrap():it,ie)}this._fireMoveEvents(d)},Le=>{this._afterEase(d,Le)},o),this}_prepareEase(o,d,p={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),d||p.moving||this.fire(new l.Event("movestart",o)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new l.Event("move",o)),this._zooming&&this.fire(new l.Event("zoom",o)),this._rotating&&this.fire(new l.Event("rotate",o)),this._pitching&&this.fire(new l.Event("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const p=this._zooming,_=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",o)),_&&this.fire(new l.Event("rotateend",o)),b&&this.fire(new l.Event("pitchend",o)),this.fire(new l.Event("moveend",o))}flyTo(o,d){if(!o.essential&&l.exported.prefersReducedMotion){const bt=l.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(bt,d)}this.stop(),o=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},o);const p=this.transform,_=this.getZoom(),b=this.getBearing(),A=this.getPitch(),M=this.getPadding(),P="zoom"in o?l.clamp(+o.zoom,p.minZoom,p.maxZoom):_,R="bearing"in o?this._normalizeBearing(o.bearing,b):b,k="pitch"in o?+o.pitch:A,U="padding"in o?o.padding:p.padding,H=p.zoomScale(P-_),ie=l.pointGeometry.convert(o.offset);let te=p.centerPoint.add(ie);const ne=p.pointLocation(te),fe=l.LngLat.convert(o.center||ne);this._normalizeCenter(fe);const ge=p.project(ne),xe=p.project(fe).sub(ge);let re=o.curve;const Ee=Math.max(p.width,p.height),be=Ee/H,Le=xe.mag();if("minZoom"in o){const bt=l.clamp(Math.min(o.minZoom,_,P),p.minZoom,p.maxZoom),ln=Ee/p.zoomScale(bt-_);re=Math.sqrt(ln/Le*2)}const Re=re*re;function Ue(bt){const ln=(be*be-Ee*Ee+(bt?-1:1)*Re*Re*Le*Le)/(2*(bt?be:Ee)*Re*Le);return Math.log(Math.sqrt(ln*ln+1)-ln)}function Pe(bt){return(Math.exp(bt)-Math.exp(-bt))/2}function it(bt){return(Math.exp(bt)+Math.exp(-bt))/2}const Ze=Ue(0);let rt=function(bt){return it(Ze)/it(Ze+re*bt)},Bt=function(bt){return Ee*((it(Ze)*(Pe(ln=Ze+re*bt)/it(ln))-Pe(Ze))/Re)/Le;var ln},Ot=(Ue(1)-Ze)/re;if(Math.abs(Le)<1e-6||!isFinite(Ot)){if(Math.abs(Ee-be)<1e-6)return this.easeTo(o,d);const bt=be<Ee?-1:1;Ot=Math.abs(Math.log(be/Ee))/re,Bt=function(){return 0},rt=function(ln){return Math.exp(bt*re*ln)}}return o.duration="duration"in o?+o.duration:1e3*Ot/("screenSpeed"in o?+o.screenSpeed/re:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=b!==R,this._pitching=k!==A,this._padding=!p.isPaddingEqual(U),this._prepareEase(d,!1),this._ease(bt=>{const ln=bt*Ot,cn=1/rt(ln);p.zoom=bt===1?P:_+p.scaleZoom(cn),this._rotating&&(p.bearing=l.number(b,R,bt)),this._pitching&&(p.pitch=l.number(A,k,bt)),this._padding&&(p.interpolatePadding(M,U,bt),te=p.centerPoint.add(ie));const qt=bt===1?fe:p.unproject(ge.add(xe.mult(Bt(ln))).mult(cn));p.setLocationAtPoint(p.renderWorldCopies?qt.wrap():qt,te),this._fireMoveEvents(d)},()=>this._afterEase(d),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,d)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,d,p){p.animate===!1||p.duration===0?(o(1),d()):(this._easeStart=l.exported.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,d){o=l.wrap(o,-180,180);const p=Math.abs(o-d);return Math.abs(o-360-d)<p&&(o-=360),Math.abs(o+360-d)<p&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const p=o.lng-d.center.lng;o.lng+=p>180?-360:p<-180?360:0}}class Yl{constructor(o={}){this.options=o,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=S.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=S.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=S.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){S.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,d){const p=this._map._getUIString(`AttributionControl.${d}`);o.title=p,o.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const d=this._map.style.sourceCaches;for(const _ in d){const b=d[_];if(b.used||b.usedForTerrain){const A=b.getSource();A.attribution&&o.indexOf(A.attribution)<0&&o.push(A.attribution)}}o=o.filter(_=>String(_).trim()),o.sort((_,b)=>_.length-b.length),o=o.filter((_,b)=>{for(let A=b+1;A<o.length;A++)if(o[A].indexOf(_)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Yc{constructor(o={}){this.options=o,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=S.create("div","maplibregl-ctrl mapboxgl-ctrl");const d=S.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){S.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const o=this._container.children;if(o.length){const d=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact","mapboxgl-compact"):d.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Cp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,p=d?this._queue.concat(d):this._queue;for(const _ of p)if(_.id===o)return void(_.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const p of d)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Ip={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Mp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},W_={showCompass:!0,showZoom:!0,visualizePitch:!1};class Is{constructor(o,d,p=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Ks({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,p&&(this.mousePitch=new at({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),S.addEventListener(d,"mousedown",this.mousedown),S.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),S.addEventListener(d,"touchmove",this.touchmove),S.addEventListener(d,"touchend",this.touchend),S.addEventListener(d,"touchcancel",this.reset)}down(o,d){this.mouseRotate.mousedown(o,d),this.mousePitch&&this.mousePitch.mousedown(o,d),S.disableDrag()}move(o,d){const p=this.map,_=this.mouseRotate.mousemoveWindow(o,d);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(o,d);b&&b.pitchDelta&&p.setPitch(p.getPitch()+b.pitchDelta)}}off(){const o=this.element;S.removeEventListener(o,"mousedown",this.mousedown),S.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),S.removeEventListener(o,"touchmove",this.touchmove),S.removeEventListener(o,"touchend",this.touchend),S.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){S.enableDrag(),S.removeEventListener(window,"mousemove",this.mousemove),S.removeEventListener(window,"mouseup",this.mouseup)}mousedown(o){this.down(l.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),S.mousePos(this.element,o)),S.addEventListener(window,"mousemove",this.mousemove),S.addEventListener(window,"mouseup",this.mouseup)}mousemove(o){this.move(o,S.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=S.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=S.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ql(m,o,d){if(m=new l.LngLat(m.lng,m.lat),o){const p=new l.LngLat(m.lng-360,m.lat),_=new l.LngLat(m.lng+360,m.lat),b=d.locationPoint(m).distSqr(o);d.locationPoint(p).distSqr(o)<b?m=p:d.locationPoint(_).distSqr(o)<b&&(m=_)}for(;Math.abs(m.lng-d.center.lng)>180;){const p=d.locationPoint(m);if(p.x>=0&&p.y>=0&&p.x<=d.width&&p.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}const ft={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Tt(m,o,d){const p=m.classList;for(const _ in ft)p.remove(`maplibregl-${d}-anchor-${_}`,`mapboxgl-${d}-anchor-${_}`);p.add(`maplibregl-${d}-anchor-${o}`,`mapboxgl-${d}-anchor-${o}`)}class $a extends l.Evented{constructor(o,d){if(super(),(o instanceof HTMLElement||d)&&(o=l.extend({element:o},d)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=l.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=S.create("div"),this._element.setAttribute("aria-label","Map marker");const p=S.createNS("http://www.w3.org/2000/svg","svg"),_=41,b=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${_}px`),p.setAttributeNS(null,"width",`${b}px`),p.setAttributeNS(null,"viewBox",`0 0 ${b} ${_}`);const A=S.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");const M=S.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const P=S.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const R=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xe of R){const re=S.createNS("http://www.w3.org/2000/svg","ellipse");re.setAttributeNS(null,"opacity","0.04"),re.setAttributeNS(null,"cx","10.5"),re.setAttributeNS(null,"cy","5.80029008"),re.setAttributeNS(null,"rx",xe.rx),re.setAttributeNS(null,"ry",xe.ry),P.appendChild(re)}const k=S.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const U=S.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(U);const H=S.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"fill","#000000");const ie=S.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),H.appendChild(ie);const te=S.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const ne=S.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(8.0, 8.0)");const fe=S.createNS("http://www.w3.org/2000/svg","circle");fe.setAttributeNS(null,"fill","#000000"),fe.setAttributeNS(null,"opacity","0.25"),fe.setAttributeNS(null,"cx","5.5"),fe.setAttributeNS(null,"cy","5.5"),fe.setAttributeNS(null,"r","5.4999962");const ge=S.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#FFFFFF"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962"),ne.appendChild(fe),ne.appendChild(ge),M.appendChild(P),M.appendChild(k),M.appendChild(H),M.appendChild(te),M.appendChild(ne),p.appendChild(M),p.setAttributeNS(null,"height",_*this._scale+"px"),p.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(p),this._offset=l.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),Tt(this._element,this._anchor,"marker"),this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),S.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=l.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(o){const d=o.code,p=o.charCode||o.keyCode;d!=="Space"&&d!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(o){const d=o.originalEvent.target,p=this._element;this._popup&&(d===p||p.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}_update(o){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Ql(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),o&&o.type!=="moveend"||(this._pos=this._pos.round()),S.setTransform(this._element,`${ft[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${d}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),b=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*b?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(o){return this._offset=l.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Xh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Mo,Ci=0,Po=!1;const Ms={maxWidth:100,unit:"metric"};function Pp(m,o,d){const p=d&&d.maxWidth||100,_=m._container.clientHeight/2,b=m.unproject([0,_]),A=m.unproject([p,_]),M=b.distanceTo(A);if(d&&d.unit==="imperial"){const P=3.2808*M;P>5280?Bo(o,p,P/5280,m._getUIString("ScaleControl.Miles")):Bo(o,p,P,m._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Bo(o,p,M/1852,m._getUIString("ScaleControl.NauticalMiles")):M>=1e3?Bo(o,p,M/1e3,m._getUIString("ScaleControl.Kilometers")):Bo(o,p,M,m._getUIString("ScaleControl.Meters"))}function Bo(m,o,d,p){const _=function(b){const A=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/A;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(P){const R=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*R)/R}(M),A*M}(d);m.style.width=o*(_/d)+"px",m.innerHTML=`${_}&nbsp;${p}`}const Un={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ei=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function qh(m){if(m){if(typeof m=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,m),"top-left":new l.pointGeometry(o,o),"top-right":new l.pointGeometry(-o,o),bottom:new l.pointGeometry(0,-m),"bottom-left":new l.pointGeometry(o,-o),"bottom-right":new l.pointGeometry(-o,-o),left:new l.pointGeometry(m,0),right:new l.pointGeometry(-m,0)}}if(m instanceof l.pointGeometry||Array.isArray(m)){const o=l.pointGeometry.convert(m);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:l.pointGeometry.convert(m.center||[0,0]),top:l.pointGeometry.convert(m.top||[0,0]),"top-left":l.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(m["top-right"]||[0,0]),bottom:l.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(m["bottom-right"]||[0,0]),left:l.pointGeometry.convert(m.left||[0,0]),right:l.pointGeometry.convert(m.right||[0,0])}}return qh(new l.pointGeometry(0,0))}const na={supported:y,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends In{constructor(m){var o;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(m=l.extend({},Mp,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Hl(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Cp,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Ip,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=(o=m.pixelRatio)!==null&&o!==void 0?o:devicePixelRatio,this._requestManager=new z(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Sp(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new mp(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,l.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Yl({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new Yc,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new l.Event(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new l.Event(`${d.dataType}dataloading`,d))}),this.on("dataabort",d=>{this.fire(new l.Event("sourcedataabort",d))})}_getMapId(){return this._mapId}addControl(m,o){if(o===void 0&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(d,p.firstChild):p.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,o,d,p){return p==null&&this.style.terrain&&(p=this.transform.getElevation(d,this.style.terrain)),super.calculateCameraOptionsFromTo(m,o,d,p)}resize(m){const o=this._containerDimensions(),d=o[0],p=o[1];this._resizeCanvas(d,p,this.getPixelRatio()),this.transform.resize(d,p),this.painter.resize(d,p,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new l.Event("movestart",m)).fire(new l.Event("move",m))),this.fire(new l.Event("resize",m)),_&&this.fire(new l.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[o,d]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(o,d,m),this.painter.resize(o,d,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(l.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(l.LngLat.convert(m),this.style&&this.style.terrain)}unproject(m){return this.transform.pointLocation(l.pointGeometry.convert(m),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,o,d){if(m==="mouseenter"||m==="mouseover"){let p=!1;return{layer:o,listener:d,delegates:{mousemove:b=>{const A=this.getLayer(o)?this.queryRenderedFeatures(b.point,{layers:[o]}):[];A.length?p||(p=!0,d.call(this,new br(m,this,b.originalEvent,{features:A}))):p=!1},mouseout:()=>{p=!1}}}}if(m==="mouseleave"||m==="mouseout"){let p=!1;return{layer:o,listener:d,delegates:{mousemove:A=>{(this.getLayer(o)?this.queryRenderedFeatures(A.point,{layers:[o]}):[]).length?p=!0:p&&(p=!1,d.call(this,new br(m,this,A.originalEvent)))},mouseout:A=>{p&&(p=!1,d.call(this,new br(m,this,A.originalEvent)))}}}}{const p=_=>{const b=this.getLayer(o)?this.queryRenderedFeatures(_.point,{layers:[o]}):[];b.length&&(_.features=b,d.call(this,_),delete _.features)};return{layer:o,listener:d,delegates:{[m]:p}}}}on(m,o,d){if(d===void 0)return super.on(m,o);const p=this._createDelegatedListener(m,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(m,o,d){if(d===void 0)return super.once(m,o);const p=this._createDelegatedListener(m,o,d);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(m,o,d){return d===void 0?super.off(m,o):(this._delegatedListeners&&this._delegatedListeners[m]&&(p=>{const _=this._delegatedListeners[m];for(let b=0;b<_.length;b++){const A=_[b];if(A.layer===o&&A.listener===d){for(const M in A.delegates)this.off(M,A.delegates[M]);return _.splice(b,1),this}}})(),this)}queryRenderedFeatures(m,o){if(!this.style)return[];let d;if(o!==void 0||m===void 0||m instanceof l.pointGeometry||Array.isArray(m)||(o=m,m=void 0),o=o||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof m[0]=="number")d=[l.pointGeometry.convert(m)];else{const p=l.pointGeometry.convert(m[0]),_=l.pointGeometry.convert(m[1]);d=[p,new l.pointGeometry(_.x,p.y),_,new l.pointGeometry(p.x,_.y),p]}return this.style.queryRenderedFeatures(d,o,this.transform)}querySourceFeatures(m,o){return this.style.querySourceFeatures(m,o)}setStyle(m,o){return(o=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(m,o))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const o=this._locale[m];if(o==null)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new ci(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ci(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,o){if(typeof m=="string"){const d=this._requestManager.transformRequest(m,l.ResourceType.Style);l.getJSON(d,(p,_)=>{p?this.fire(new l.ErrorEvent(p)):_&&this._updateDiff(_,o)})}else typeof m=="object"&&this._updateDiff(m,o)}_updateDiff(m,o){try{this.style.setState(m)&&this._update(!0)}catch(d){l.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(m,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(m,o){return this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)}isSourceLoaded(m){const o=this.style&&this.style.sourceCaches[m];if(o!==void 0)return o.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){return this.style.setTerrain(m),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const o in m){const d=m[o]._tiles;for(const p in d){const _=d[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(m,o,d){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,d)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,o,{pixelRatio:d=1,sdf:p=!1,stretchX:_,stretchY:b,content:A}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||l.isImageBitmap(o)){const{width:M,height:P,data:R}=l.exported.getImageData(o);this.style.addImage(m,{data:new l.RGBAImage({width:M,height:P},R),pixelRatio:d,stretchX:_,stretchY:b,content:A,sdf:p,version:0})}else{if(o.width===void 0||o.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:P,data:R}=o,k=o;this.style.addImage(m,{data:new l.RGBAImage({width:M,height:P},new Uint8Array(R)),pixelRatio:d,stretchX:_,stretchY:b,content:A,sdf:p,version:0,userImage:k}),k.onAdd&&k.onAdd(this,m)}}}updateImage(m,o){const d=this.style.getImage(m);if(!d)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||l.isImageBitmap(o)?l.exported.getImageData(o):o,{width:_,height:b,data:A}=p;if(_===void 0||b===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==d.data.width||b!==d.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(o instanceof HTMLImageElement||l.isImageBitmap(o));d.data.replace(A,M),this.style.updateImage(m,d)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,o){l.getImage(this._requestManager.transformRequest(m,l.ResourceType.Image),o)}listImages(){return this.style.listImages()}addLayer(m,o){return this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)}moveLayer(m,o){return this.style.moveLayer(m,o),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,o,d){return this.style.setLayerZoomRange(m,o,d),this._update(!0)}setFilter(m,o,d={}){return this.style.setFilter(m,o,d),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,o,d,p={}){return this.style.setPaintProperty(m,o,d,p),this._update(!0)}getPaintProperty(m,o){return this.style.getPaintProperty(m,o)}setLayoutProperty(m,o,d,p={}){return this.style.setLayoutProperty(m,o,d,p),this._update(!0)}getLayoutProperty(m,o){return this.style.getLayoutProperty(m,o)}setLight(m,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,o){return this.style.setFeatureState(m,o),this._update()}removeFeatureState(m,o){return this.style.removeFeatureState(m,o),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,o=0;return this._container&&(m=this._container.clientWidth||400,o=this._container.clientHeight||300),[m,o]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const o=this._canvasContainer=S.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&o.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=S.create("canvas","maplibregl-canvas mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions();this._resizeCanvas(d[0],d[1],this.getPixelRatio());const p=this._controlContainer=S.create("div","maplibregl-control-container mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{_[b]=S.create("div",`maplibregl-ctrl-${b} mapboxgl-ctrl-${b}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const m=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=S.create("div","maplibregl-cooperative-gesture-screen",m);let o="Control",d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",o="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${d}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",p=>{p.key===o&&(this._metaPress=!0)}),document.addEventListener("keyup",p=>{p.key===o&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",p=>{this._onCooperativeGesture(p,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(m,o,d){this._canvas.width=d*m,this._canvas.height=d*o,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const m=l.extend({},y.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);o?(this.painter=new kh(o,this.transform),l.exported$1.testSupport(o)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(m,o,d){return!o&&d<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let o,d=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(o=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,o),d=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,M=l.exported.now();this.style.zoomHistory.update(A,M);const P=new l.EvaluationParameters(A,{now:M,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=P.crossFadingFactor();R===1&&R===this._crossFadingFactor||(_=!0,this._crossFadingFactor=R),this.style.update(P)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const A=l.exported.now()-d;p.endQueryEXT(p.TIME_ELAPSED_EXT,o),setTimeout(()=>{const M=p.getQueryObjectEXT(o,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(o),this.fire(new l.Event("gpu-timing-frame",{cpuTime:A,gpuTime:M}))},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(A);this.fire(new l.Event("gpu-timing-layer",{layerTimes:M}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty;return b||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),S.remove(this._canvasContainer),S.remove(this._controlContainer),this._cooperativeGestures&&S.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(m=>{l.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,o){l.setCacheLimits(m,o)}get version(){return"2.4.0"}},NavigationControl:class{constructor(m){this.options=l.extend({},W_,m),this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),o=m===this._map.getMaxZoom(),d=m===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Is(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){S.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,o){const d=S.create("button",m,this._container);return d.type="button",d.addEventListener("click",o),d}_setButtonTitle(m,o){const d=this._map._getUIString(`NavigationControl.${o}`);m.title=d,m.setAttribute("aria-label",d)}},GeolocateControl:class extends l.Evented{constructor(m){super(),this.options=l.extend({},Xh,m),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var o;return this._map=m,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,Mo!==void 0?o(Mo):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(d=>{Mo=d.state!=="denied",o(Mo)}):(Mo=!!window.navigator.geolocation,o(Mo)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),S.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ci=0,Po=!1}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),d=m.coords;return o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",m)),this._finish()}}_updateCamera(m){const o=new l.LngLat(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,p=this._map.getBearing(),_=l.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(d),_,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new l.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,o=this._map.unproject([0,m]),d=this._map.unproject([1,m]),p=o.distanceTo(d),_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&Po)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=S.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=S.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new $a(this._dotElement),this._circleElement=S.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $a({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ci--,Po=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ci++,Ci>1?(m={maximumAge:6e5,timeout:0},Po=!0):(m=this.options.positionOptions,Po=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Yl,LogoControl:Yc,ScaleControl:class{constructor(m){this.options=l.extend({},Ms,m),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Pp(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){S.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,Pp(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){S.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=S.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(m){this.options=m,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(m){return this._map=m,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=S.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),S.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){S.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(m){super(),this.options=l.extend(Object.create(Un),m),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&S.remove(this._content),this._container&&(S.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=l.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const o=document.createDocumentFragment(),d=document.createElement("body");let p;for(d.innerHTML=m;p=d.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=S.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=S.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=S.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=S.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(b=>this._container.classList.add(b)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ql(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const o=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let d=this.options.anchor;const p=qh(this.options.offset);if(!d){const b=this._container.offsetWidth,A=this._container.offsetHeight;let M;M=o.y+p.bottom.y<A?["top"]:o.y>this._map.transform.height-A?["bottom"]:[],o.x<b/2?M.push("left"):o.x>this._map.transform.width-b/2&&M.push("right"),d=M.length===0?"bottom":M.join("-")}const _=o.add(p[d]).round();S.setTransform(this._container,`${ft[d]} translate(${_.x}px,${_.y}px)`),Tt(this._container,d,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(ei);m&&m.focus()}_onClose(){this.remove()}},Marker:$a,Style:ci,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:en,GeoJSONSource:Yn,ImageSource:vt,RasterDEMTileSource:yt,RasterTileSource:Lt,VectorTileSource:Xt,VideoSource:Et,prewarm:function(){Ti().acquire(Hi)},clearPrewarmedResources:function(){const m=tr;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Hi),tr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return ai.workerCount},set workerCount(m){ai.workerCount=m},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){l.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){l.clearTileCache(m)},workerUrl:"",addProtocol(m,o){l.config.REGISTERED_PROTOCOLS[m]=o},removeProtocol(m){delete l.config.REGISTERED_PROTOCOLS[m]}};return Fr.extend(na,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),na});var h=r;return h})})(lL);var Q$=lL.exports;const eZ=k1(Q$),tZ={version:8,sources:{stamen:{type:"raster",tiles:["https://stamen-tiles.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.jpg"],tileSize:256,attribution:"&copy; OpenStreetMap Contributors",maxzoom:19},osm:{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap Contributors",maxzoom:19}},layers:[{id:"osm",type:"raster",source:"osm"}]};function nZ(){return dr.jsxs("svg",{version:"1.1",id:"L7",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 100 100",enableBackground:"new 0 0 100 100",xmlSpace:"preserve",children:[dr.jsx("path",{fill:"#4361ee",d:`M31.6,3.5C5.9,13.6-6.6,42.7,3.5,68.4c10.1,25.7,39.2,38.3,64.9,28.1l-3.1-7.9c-21.3,8.4-45.4-2-53.8-23.3
  c-8.4-21.3,2-45.4,23.3-53.8L31.6,3.5z`,children:dr.jsx("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"2s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})}),dr.jsx("path",{fill:"#4361ee",d:`M42.3,39.6c5.7-4.3,13.9-3.1,18.1,2.7c4.3,5.7,3.1,13.9-2.7,18.1l4.1,5.5c8.8-6.5,10.6-19,4.1-27.7
  c-6.5-8.8-19-10.6-27.7-4.1L42.3,39.6z`,children:dr.jsx("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1s",from:"0 50 50",to:"-360 50 50",repeatCount:"indefinite"})}),dr.jsx("path",{fill:"#4361ee",d:`M82,35.7C74.1,18,53.4,10.1,35.7,18S10.1,46.6,18,64.3l7.6-3.4c-6-13.5,0-29.3,13.5-35.3s29.3,0,35.3,13.5
  L82,35.7z`,children:dr.jsx("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"2s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})})]})}const W2={assetId:432728,tilesetUrl:"https://assets.ion.cesium.com/432728/tileset.json",token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3M2MzZGExMy1hZjkxLTRjNWYtYjY1ZS1mMWVhYzM4Njc4ZWYiLCJpZCI6MzMxMTAsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1OTc5OTk2MTl9.4vC26sbJu1v_p0rP8xptK6BBSBLlNAqJEVwXvgMhf5E"},iZ={longitude:146.99350838486077,latitude:-6.673466970329599,zoom:9};function rZ(t){return xh(()=>new C$(t)).setProps(t),null}function sZ(){const t=Pt.useRef(null),[e,n]=Pt.useState(!0),i=new Ub({id:"layer-3d",pointSize:2,data:W2.tilesetUrl,loader:eL,loadOptions:{"cesium-ion":{accessToken:W2.token}},onTilesetLoad(r){var h;const{cartographicCenter:a}=r;a&&((h=t.current)==null||h.flyTo({center:[a[0],a[1]],zoom:19,bearing:-80,pitch:80}),n(!1))}});return dr.jsxs(Vb,{mapLib:eZ,mapStyle:tZ,initialViewState:iZ,style:{width:"100vw",height:"100vh"},ref:t,children:[dr.jsx(rZ,{layers:[i]}),dr.jsx(K$,{}),e?dr.jsx("span",{className:"absolute top-2 left-2 z-[9999] w-24 h-24",children:dr.jsx(nZ,{})}):void 0]})}function oZ(){return dr.jsx("div",{className:"h-full w-full",children:dr.jsx(sZ,{})})}iv.createRoot(document.getElementById("root")).render(dr.jsx(gD.StrictMode,{children:dr.jsx(oZ,{})}));export{eD as c,k1 as g};
